function zb(l,i){for(var r=0;r<i.length;r++){const s=i[r];if(typeof s!="string"&&!Array.isArray(s)){for(const c in s)if(c!=="default"&&!(c in l)){const d=Object.getOwnPropertyDescriptor(s,c);d&&Object.defineProperty(l,c,d.get?d:{enumerable:!0,get:()=>s[c]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();function wg(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function kb(l){if(Object.prototype.hasOwnProperty.call(l,"__esModule"))return l;var i=l.default;if(typeof i=="function"){var r=function s(){var c=!1;try{c=this instanceof s}catch{}return c?Reflect.construct(i,arguments,this.constructor):i.apply(this,arguments)};r.prototype=i.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(l).forEach(function(s){var c=Object.getOwnPropertyDescriptor(l,s);Object.defineProperty(r,s,c.get?c:{enumerable:!0,get:function(){return l[s]}})}),r}var vd={exports:{}},zo={};var Lp;function Rb(){if(Lp)return zo;Lp=1;var l=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function r(s,c,d){var f=null;if(d!==void 0&&(f=""+d),c.key!==void 0&&(f=""+c.key),"key"in c){d={};for(var g in c)g!=="key"&&(d[g]=c[g])}else d=c;return c=d.ref,{$$typeof:l,type:s,key:f,ref:c!==void 0?c:null,props:d}}return zo.Fragment=i,zo.jsx=r,zo.jsxs=r,zo}var Ip;function Ob(){return Ip||(Ip=1,vd.exports=Rb()),vd.exports}var t=Ob(),jd={exports:{}},ko={},Sd={exports:{}},_d={};var Mp;function Db(){return Mp||(Mp=1,(function(l){function i(N,q){var X=N.length;N.push(q);e:for(;0<X;){var ge=X-1>>>1,re=N[ge];if(0<c(re,q))N[ge]=q,N[X]=re,X=ge;else break e}}function r(N){return N.length===0?null:N[0]}function s(N){if(N.length===0)return null;var q=N[0],X=N.pop();if(X!==q){N[0]=X;e:for(var ge=0,re=N.length,U=re>>>1;ge<U;){var $=2*(ge+1)-1,H=N[$],Z=$+1,ee=N[Z];if(0>c(H,X))Z<re&&0>c(ee,H)?(N[ge]=ee,N[Z]=X,ge=Z):(N[ge]=H,N[$]=X,ge=$);else if(Z<re&&0>c(ee,X))N[ge]=ee,N[Z]=X,ge=Z;else break e}}return q}function c(N,q){var X=N.sortIndex-q.sortIndex;return X!==0?X:N.id-q.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;l.unstable_now=function(){return d.now()}}else{var f=Date,g=f.now();l.unstable_now=function(){return f.now()-g}}var p=[],m=[],b=1,S=null,j=3,x=!1,w=!1,v=!1,E=!1,T=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function z(N){for(var q=r(m);q!==null;){if(q.callback===null)s(m);else if(q.startTime<=N)s(m),q.sortIndex=q.expirationTime,i(p,q);else break;q=r(m)}}function C(N){if(v=!1,z(N),!w)if(r(p)!==null)w=!0,O||(O=!0,ne());else{var q=r(m);q!==null&&A(C,q.startTime-N)}}var O=!1,I=-1,k=5,M=-1;function G(){return E?!0:!(l.unstable_now()-M<k)}function K(){if(E=!1,O){var N=l.unstable_now();M=N;var q=!0;try{e:{w=!1,v&&(v=!1,L(I),I=-1),x=!0;var X=j;try{t:{for(z(N),S=r(p);S!==null&&!(S.expirationTime>N&&G());){var ge=S.callback;if(typeof ge=="function"){S.callback=null,j=S.priorityLevel;var re=ge(S.expirationTime<=N);if(N=l.unstable_now(),typeof re=="function"){S.callback=re,z(N),q=!0;break t}S===r(p)&&s(p),z(N)}else s(p);S=r(p)}if(S!==null)q=!0;else{var U=r(m);U!==null&&A(C,U.startTime-N),q=!1}}break e}finally{S=null,j=X,x=!1}q=void 0}}finally{q?ne():O=!1}}}var ne;if(typeof R=="function")ne=function(){R(K)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,B=Y.port2;Y.port1.onmessage=K,ne=function(){B.postMessage(null)}}else ne=function(){T(K,0)};function A(N,q){I=T(function(){N(l.unstable_now())},q)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(N){N.callback=null},l.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<N?Math.floor(1e3/N):5},l.unstable_getCurrentPriorityLevel=function(){return j},l.unstable_next=function(N){switch(j){case 1:case 2:case 3:var q=3;break;default:q=j}var X=j;j=q;try{return N()}finally{j=X}},l.unstable_requestPaint=function(){E=!0},l.unstable_runWithPriority=function(N,q){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var X=j;j=N;try{return q()}finally{j=X}},l.unstable_scheduleCallback=function(N,q,X){var ge=l.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?ge+X:ge):X=ge,N){case 1:var re=-1;break;case 2:re=250;break;case 5:re=1073741823;break;case 4:re=1e4;break;default:re=5e3}return re=X+re,N={id:b++,callback:q,priorityLevel:N,startTime:X,expirationTime:re,sortIndex:-1},X>ge?(N.sortIndex=X,i(m,N),r(p)===null&&N===r(m)&&(v?(L(I),I=-1):v=!0,A(C,X-ge))):(N.sortIndex=re,i(p,N),w||x||(w=!0,O||(O=!0,ne()))),N},l.unstable_shouldYield=G,l.unstable_wrapCallback=function(N){var q=j;return function(){var X=j;j=q;try{return N.apply(this,arguments)}finally{j=X}}}})(_d)),_d}var qp;function Bb(){return qp||(qp=1,Sd.exports=Db()),Sd.exports}var wd={exports:{}},Ze={};var $p;function Ub(){if($p)return Ze;$p=1;var l=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),S=Symbol.for("react.activity"),j=Symbol.iterator;function x(U){return U===null||typeof U!="object"?null:(U=j&&U[j]||U["@@iterator"],typeof U=="function"?U:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,E={};function T(U,$,H){this.props=U,this.context=$,this.refs=E,this.updater=H||w}T.prototype.isReactComponent={},T.prototype.setState=function(U,$){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,$,"setState")},T.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function L(){}L.prototype=T.prototype;function R(U,$,H){this.props=U,this.context=$,this.refs=E,this.updater=H||w}var z=R.prototype=new L;z.constructor=R,v(z,T.prototype),z.isPureReactComponent=!0;var C=Array.isArray;function O(){}var I={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function M(U,$,H){var Z=H.ref;return{$$typeof:l,type:U,key:$,ref:Z!==void 0?Z:null,props:H}}function G(U,$){return M(U.type,$,U.props)}function K(U){return typeof U=="object"&&U!==null&&U.$$typeof===l}function ne(U){var $={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(H){return $[H]})}var Y=/\/+/g;function B(U,$){return typeof U=="object"&&U!==null&&U.key!=null?ne(""+U.key):$.toString(36)}function A(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(O,O):(U.status="pending",U.then(function($){U.status==="pending"&&(U.status="fulfilled",U.value=$)},function($){U.status==="pending"&&(U.status="rejected",U.reason=$)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function N(U,$,H,Z,ee){var oe=typeof U;(oe==="undefined"||oe==="boolean")&&(U=null);var P=!1;if(U===null)P=!0;else switch(oe){case"bigint":case"string":case"number":P=!0;break;case"object":switch(U.$$typeof){case l:case i:P=!0;break;case b:return P=U._init,N(P(U._payload),$,H,Z,ee)}}if(P)return ee=ee(U),P=Z===""?"."+B(U,0):Z,C(ee)?(H="",P!=null&&(H=P.replace(Y,"$&/")+"/"),N(ee,$,H,"",function(ae){return ae})):ee!=null&&(K(ee)&&(ee=G(ee,H+(ee.key==null||U&&U.key===ee.key?"":(""+ee.key).replace(Y,"$&/")+"/")+P)),$.push(ee)),1;P=0;var Se=Z===""?".":Z+":";if(C(U))for(var J=0;J<U.length;J++)Z=U[J],oe=Se+B(Z,J),P+=N(Z,$,H,oe,ee);else if(J=x(U),typeof J=="function")for(U=J.call(U),J=0;!(Z=U.next()).done;)Z=Z.value,oe=Se+B(Z,J++),P+=N(Z,$,H,oe,ee);else if(oe==="object"){if(typeof U.then=="function")return N(A(U),$,H,Z,ee);throw $=String(U),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return P}function q(U,$,H){if(U==null)return U;var Z=[],ee=0;return N(U,Z,"","",function(oe){return $.call(H,oe,ee++)}),Z}function X(U){if(U._status===-1){var $=U._result;$=$(),$.then(function(H){(U._status===0||U._status===-1)&&(U._status=1,U._result=H)},function(H){(U._status===0||U._status===-1)&&(U._status=2,U._result=H)}),U._status===-1&&(U._status=0,U._result=$)}if(U._status===1)return U._result.default;throw U._result}var ge=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)},re={map:q,forEach:function(U,$,H){q(U,function(){$.apply(this,arguments)},H)},count:function(U){var $=0;return q(U,function(){$++}),$},toArray:function(U){return q(U,function($){return $})||[]},only:function(U){if(!K(U))throw Error("React.Children.only expected to receive a single React element child.");return U}};return Ze.Activity=S,Ze.Children=re,Ze.Component=T,Ze.Fragment=r,Ze.Profiler=c,Ze.PureComponent=R,Ze.StrictMode=s,Ze.Suspense=p,Ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,Ze.__COMPILER_RUNTIME={__proto__:null,c:function(U){return I.H.useMemoCache(U)}},Ze.cache=function(U){return function(){return U.apply(null,arguments)}},Ze.cacheSignal=function(){return null},Ze.cloneElement=function(U,$,H){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var Z=v({},U.props),ee=U.key;if($!=null)for(oe in $.key!==void 0&&(ee=""+$.key),$)!k.call($,oe)||oe==="key"||oe==="__self"||oe==="__source"||oe==="ref"&&$.ref===void 0||(Z[oe]=$[oe]);var oe=arguments.length-2;if(oe===1)Z.children=H;else if(1<oe){for(var P=Array(oe),Se=0;Se<oe;Se++)P[Se]=arguments[Se+2];Z.children=P}return M(U.type,ee,Z)},Ze.createContext=function(U){return U={$$typeof:f,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:d,_context:U},U},Ze.createElement=function(U,$,H){var Z,ee={},oe=null;if($!=null)for(Z in $.key!==void 0&&(oe=""+$.key),$)k.call($,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(ee[Z]=$[Z]);var P=arguments.length-2;if(P===1)ee.children=H;else if(1<P){for(var Se=Array(P),J=0;J<P;J++)Se[J]=arguments[J+2];ee.children=Se}if(U&&U.defaultProps)for(Z in P=U.defaultProps,P)ee[Z]===void 0&&(ee[Z]=P[Z]);return M(U,oe,ee)},Ze.createRef=function(){return{current:null}},Ze.forwardRef=function(U){return{$$typeof:g,render:U}},Ze.isValidElement=K,Ze.lazy=function(U){return{$$typeof:b,_payload:{_status:-1,_result:U},_init:X}},Ze.memo=function(U,$){return{$$typeof:m,type:U,compare:$===void 0?null:$}},Ze.startTransition=function(U){var $=I.T,H={};I.T=H;try{var Z=U(),ee=I.S;ee!==null&&ee(H,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(O,ge)}catch(oe){ge(oe)}finally{$!==null&&H.types!==null&&($.types=H.types),I.T=$}},Ze.unstable_useCacheRefresh=function(){return I.H.useCacheRefresh()},Ze.use=function(U){return I.H.use(U)},Ze.useActionState=function(U,$,H){return I.H.useActionState(U,$,H)},Ze.useCallback=function(U,$){return I.H.useCallback(U,$)},Ze.useContext=function(U){return I.H.useContext(U)},Ze.useDebugValue=function(){},Ze.useDeferredValue=function(U,$){return I.H.useDeferredValue(U,$)},Ze.useEffect=function(U,$){return I.H.useEffect(U,$)},Ze.useEffectEvent=function(U){return I.H.useEffectEvent(U)},Ze.useId=function(){return I.H.useId()},Ze.useImperativeHandle=function(U,$,H){return I.H.useImperativeHandle(U,$,H)},Ze.useInsertionEffect=function(U,$){return I.H.useInsertionEffect(U,$)},Ze.useLayoutEffect=function(U,$){return I.H.useLayoutEffect(U,$)},Ze.useMemo=function(U,$){return I.H.useMemo(U,$)},Ze.useOptimistic=function(U,$){return I.H.useOptimistic(U,$)},Ze.useReducer=function(U,$,H){return I.H.useReducer(U,$,H)},Ze.useRef=function(U){return I.H.useRef(U)},Ze.useState=function(U){return I.H.useState(U)},Ze.useSyncExternalStore=function(U,$,H){return I.H.useSyncExternalStore(U,$,H)},Ze.useTransition=function(){return I.H.useTransition()},Ze.version="19.2.0",Ze}var Hp;function Yd(){return Hp||(Hp=1,wd.exports=Ub()),wd.exports}var Cd={exports:{}},pn={};var Pp;function Lb(){if(Pp)return pn;Pp=1;var l=Yd();function i(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)m+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var s={d:{f:r,r:function(){throw Error(i(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},c=Symbol.for("react.portal");function d(p,m,b){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:S==null?null:""+S,children:p,containerInfo:m,implementation:b}}var f=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function g(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return pn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,pn.createPortal=function(p,m){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(i(299));return d(p,m,null,b)},pn.flushSync=function(p){var m=f.T,b=s.p;try{if(f.T=null,s.p=2,p)return p()}finally{f.T=m,s.p=b,s.d.f()}},pn.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,s.d.C(p,m))},pn.prefetchDNS=function(p){typeof p=="string"&&s.d.D(p)},pn.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var b=m.as,S=g(b,m.crossOrigin),j=typeof m.integrity=="string"?m.integrity:void 0,x=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;b==="style"?s.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:S,integrity:j,fetchPriority:x}):b==="script"&&s.d.X(p,{crossOrigin:S,integrity:j,fetchPriority:x,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},pn.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var b=g(m.as,m.crossOrigin);s.d.M(p,{crossOrigin:b,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&s.d.M(p)},pn.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var b=m.as,S=g(b,m.crossOrigin);s.d.L(p,b,{crossOrigin:S,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},pn.preloadModule=function(p,m){if(typeof p=="string")if(m){var b=g(m.as,m.crossOrigin);s.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:b,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else s.d.m(p)},pn.requestFormReset=function(p){s.d.r(p)},pn.unstable_batchedUpdates=function(p,m){return p(m)},pn.useFormState=function(p,m,b){return f.H.useFormState(p,m,b)},pn.useFormStatus=function(){return f.H.useHostTransitionStatus()},pn.version="19.2.0",pn}var Fp;function Cg(){if(Fp)return Cd.exports;Fp=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(i){console.error(i)}}return l(),Cd.exports=Lb(),Cd.exports}var Vp;function Ib(){if(Vp)return ko;Vp=1;var l=Bb(),i=Yd(),r=Cg();function s(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function d(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function g(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function p(e){if(d(e)!==e)throw Error(s(188))}function m(e){var n=e.alternate;if(!n){if(n=d(e),n===null)throw Error(s(188));return n!==e?null:e}for(var a=e,o=n;;){var u=a.return;if(u===null)break;var h=u.alternate;if(h===null){if(o=u.return,o!==null){a=o;continue}break}if(u.child===h.child){for(h=u.child;h;){if(h===a)return p(u),e;if(h===o)return p(u),n;h=h.sibling}throw Error(s(188))}if(a.return!==o.return)a=u,o=h;else{for(var _=!1,D=u.child;D;){if(D===a){_=!0,a=u,o=h;break}if(D===o){_=!0,o=u,a=h;break}D=D.sibling}if(!_){for(D=h.child;D;){if(D===a){_=!0,a=h,o=u;break}if(D===o){_=!0,o=h,a=u;break}D=D.sibling}if(!_)throw Error(s(189))}}if(a.alternate!==o)throw Error(s(190))}if(a.tag!==3)throw Error(s(188));return a.stateNode.current===a?e:n}function b(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=b(e),n!==null)return n;e=e.sibling}return null}var S=Object.assign,j=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),L=Symbol.for("react.consumer"),R=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),K=Symbol.iterator;function ne(e){return e===null||typeof e!="object"?null:(e=K&&e[K]||e["@@iterator"],typeof e=="function"?e:null)}var Y=Symbol.for("react.client.reference");function B(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Y?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case v:return"Fragment";case T:return"Profiler";case E:return"StrictMode";case C:return"Suspense";case O:return"SuspenseList";case M:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case w:return"Portal";case R:return e.displayName||"Context";case L:return(e._context.displayName||"Context")+".Consumer";case z:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case I:return n=e.displayName||null,n!==null?n:B(e.type)||"Memo";case k:n=e._payload,e=e._init;try{return B(e(n))}catch{}}return null}var A=Array.isArray,N=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},ge=[],re=-1;function U(e){return{current:e}}function $(e){0>re||(e.current=ge[re],ge[re]=null,re--)}function H(e,n){re++,ge[re]=e.current,e.current=n}var Z=U(null),ee=U(null),oe=U(null),P=U(null);function Se(e,n){switch(H(oe,n),H(ee,e),H(Z,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?op(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=op(n),e=sp(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}$(Z),H(Z,e)}function J(){$(Z),$(ee),$(oe)}function ae(e){e.memoizedState!==null&&H(P,e);var n=Z.current,a=sp(n,e.type);n!==a&&(H(ee,e),H(Z,a))}function V(e){ee.current===e&&($(Z),$(ee)),P.current===e&&($(P),Eo._currentValue=X)}var ue,de;function he(e){if(ue===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);ue=n&&n[1]||"",de=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ue+e+de}var Te=!1;function Oe(e,n){if(!e||Te)return"";Te=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(n){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(ye){var fe=ye}Reflect.construct(e,[],Ee)}else{try{Ee.call()}catch(ye){fe=ye}e.call(Ee.prototype)}}else{try{throw Error()}catch(ye){fe=ye}(Ee=e())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(ye){if(ye&&fe&&typeof ye.stack=="string")return[ye.stack,fe.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=o.DetermineComponentFrameRoot(),_=h[0],D=h[1];if(_&&D){var W=_.split(`
`),ce=D.split(`
`);for(u=o=0;o<W.length&&!W[o].includes("DetermineComponentFrameRoot");)o++;for(;u<ce.length&&!ce[u].includes("DetermineComponentFrameRoot");)u++;if(o===W.length||u===ce.length)for(o=W.length-1,u=ce.length-1;1<=o&&0<=u&&W[o]!==ce[u];)u--;for(;1<=o&&0<=u;o--,u--)if(W[o]!==ce[u]){if(o!==1||u!==1)do if(o--,u--,0>u||W[o]!==ce[u]){var je=`
`+W[o].replace(" at new "," at ");return e.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",e.displayName)),je}while(1<=o&&0<=u);break}}}finally{Te=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?he(a):""}function Ue(e,n){switch(e.tag){case 26:case 27:case 5:return he(e.type);case 16:return he("Lazy");case 13:return e.child!==n&&n!==null?he("Suspense Fallback"):he("Suspense");case 19:return he("SuspenseList");case 0:case 15:return Oe(e.type,!1);case 11:return Oe(e.type.render,!1);case 1:return Oe(e.type,!0);case 31:return he("Activity");default:return""}}function Le(e){try{var n="",a=null;do n+=Ue(e,a),a=e,e=e.return;while(e);return n}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}var ze=Object.prototype.hasOwnProperty,se=l.unstable_scheduleCallback,ve=l.unstable_cancelCallback,$e=l.unstable_shouldYield,gt=l.unstable_requestPaint,st=l.unstable_now,vt=l.unstable_getCurrentPriorityLevel,kt=l.unstable_ImmediatePriority,Rt=l.unstable_UserBlockingPriority,ut=l.unstable_NormalPriority,mn=l.unstable_LowPriority,Ot=l.unstable_IdlePriority,Nn=l.log,bn=l.unstable_setDisableYieldValue,qe=null,et=null;function ft(e){if(typeof Nn=="function"&&bn(e),et&&typeof et.setStrictMode=="function")try{et.setStrictMode(qe,e)}catch{}}var lt=Math.clz32?Math.clz32:rn,bt=Math.log,ht=Math.LN2;function rn(e){return e>>>=0,e===0?32:31-(bt(e)/ht|0)|0}var Xt=256,on=262144,xn=4194304;function qn(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function fa(e,n,a){var o=e.pendingLanes;if(o===0)return 0;var u=0,h=e.suspendedLanes,_=e.pingedLanes;e=e.warmLanes;var D=o&134217727;return D!==0?(o=D&~h,o!==0?u=qn(o):(_&=D,_!==0?u=qn(_):a||(a=D&~e,a!==0&&(u=qn(a))))):(D=o&~h,D!==0?u=qn(D):_!==0?u=qn(_):a||(a=o&~e,a!==0&&(u=qn(a)))),u===0?0:n!==0&&n!==u&&(n&h)===0&&(h=u&-u,a=n&-n,h>=a||h===32&&(a&4194048)!==0)?n:u}function ea(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function qo(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $o(){var e=xn;return xn<<=1,(xn&62914560)===0&&(xn=4194304),e}function Gi(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function Si(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function bl(e,n,a,o,u,h){var _=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var D=e.entanglements,W=e.expirationTimes,ce=e.hiddenUpdates;for(a=_&~a;0<a;){var je=31-lt(a),Ee=1<<je;D[je]=0,W[je]=-1;var fe=ce[je];if(fe!==null)for(ce[je]=null,je=0;je<fe.length;je++){var ye=fe[je];ye!==null&&(ye.lane&=-536870913)}a&=~Ee}o!==0&&Lr(e,o,0),h!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=h&~(_&~n))}function Lr(e,n,a){e.pendingLanes|=n,e.suspendedLanes&=~n;var o=31-lt(n);e.entangledLanes|=n,e.entanglements[o]=e.entanglements[o]|1073741824|a&261930}function Ya(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var o=31-lt(a),u=1<<o;u&n|e[o]&n&&(e[o]|=n),a&=~u}}function Ho(e,n){var a=n&-n;return a=(a&42)!==0?1:Ir(a),(a&(e.suspendedLanes|n))!==0?0:a}function Ir(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Mr(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Po(){var e=q.p;return e!==0?e:(e=window.event,e===void 0?32:zp(e.type))}function qr(e,n){var a=q.p;try{return q.p=e,n()}finally{q.p=a}}var ta=Math.random().toString(36).slice(2),Ft="__reactFiber$"+ta,hn="__reactProps$"+ta,vn="__reactContainer$"+ta,$n="__reactEvents$"+ta,Fo="__reactListeners$"+ta,xl="__reactHandles$"+ta,Vo="__reactResources$"+ta,Ea="__reactMarker$"+ta;function $r(e){delete e[Ft],delete e[hn],delete e[$n],delete e[Fo],delete e[xl]}function ha(e){var n=e[Ft];if(n)return n;for(var a=e.parentNode;a;){if(n=a[vn]||a[Ft]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=pp(e);e!==null;){if(a=e[Ft])return a;e=pp(e)}return n}e=a,a=e.parentNode}return null}function pa(e){if(e=e[Ft]||e[vn]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function tn(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(s(33))}function Ka(e){var n=e[Vo];return n||(n=e[Vo]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Vt(e){e[Ea]=!0}var Wo=new Set,Hr={};function Ta(e,n){ga(e,n),ga(e+"Capture",n)}function ga(e,n){for(Hr[e]=n,e=0;e<n.length;e++)Wo.add(n[e])}var Na=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),vl={},Pr={};function jl(e){return ze.call(Pr,e)?!0:ze.call(vl,e)?!1:Na.test(e)?Pr[e]=!0:(vl[e]=!0,!1)}function _i(e,n,a){if(jl(n))if(a===null)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var o=n.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+a)}}function wi(e,n,a){if(a===null)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+a)}}function na(e,n,a,o){if(o===null)e.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(n,a,""+o)}}function jn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Go(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function te(e,n,a){var o=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var u=o.get,h=o.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return u.call(this)},set:function(_){a=""+_,h.call(this,_)}}),Object.defineProperty(e,n,{enumerable:o.enumerable}),{getValue:function(){return a},setValue:function(_){a=""+_},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function be(e){if(!e._valueTracker){var n=Go(e)?"checked":"value";e._valueTracker=te(e,n,""+e[n])}}function Ne(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),o="";return e&&(o=Go(e)?e.checked?"true":"false":e.value),e=o,e!==a?(n.setValue(e),!0):!1}function pe(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var _e=/[\n"\\]/g;function ke(e){return e.replace(_e,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Ae(e,n,a,o,u,h,_,D){e.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?e.type=_:e.removeAttribute("type"),n!=null?_==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+jn(n)):e.value!==""+jn(n)&&(e.value=""+jn(n)):_!=="submit"&&_!=="reset"||e.removeAttribute("value"),n!=null?we(e,_,jn(n)):a!=null?we(e,_,jn(a)):o!=null&&e.removeAttribute("value"),u==null&&h!=null&&(e.defaultChecked=!!h),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?e.name=""+jn(D):e.removeAttribute("name")}function xe(e,n,a,o,u,h,_,D){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),n!=null||a!=null){if(!(h!=="submit"&&h!=="reset"||n!=null)){be(e);return}a=a!=null?""+jn(a):"",n=n!=null?""+jn(n):a,D||n===e.value||(e.value=n),e.defaultValue=n}o=o??u,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=D?e.checked:!!o,e.defaultChecked=!!o,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(e.name=_),be(e)}function we(e,n,a){n==="number"&&pe(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function me(e,n,a,o){if(e=e.options,n){n={};for(var u=0;u<a.length;u++)n["$"+a[u]]=!0;for(a=0;a<e.length;a++)u=n.hasOwnProperty("$"+e[a].value),e[a].selected!==u&&(e[a].selected=u),u&&o&&(e[a].defaultSelected=!0)}else{for(a=""+jn(a),n=null,u=0;u<e.length;u++){if(e[u].value===a){e[u].selected=!0,o&&(e[u].defaultSelected=!0);return}n!==null||e[u].disabled||(n=e[u])}n!==null&&(n.selected=!0)}}function Re(e,n,a){if(n!=null&&(n=""+jn(n),n!==e.value&&(e.value=n),a==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=a!=null?""+jn(a):""}function Fe(e,n,a,o){if(n==null){if(o!=null){if(a!=null)throw Error(s(92));if(A(o)){if(1<o.length)throw Error(s(93));o=o[0]}a=o}a==null&&(a=""),n=a}a=jn(n),e.defaultValue=a,o=e.textContent,o===a&&o!==""&&o!==null&&(e.value=o),be(e)}function Ie(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var Nt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qt(e,n,a){var o=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?o?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":o?e.setProperty(n,a):typeof a!="number"||a===0||Nt.has(n)?n==="float"?e.cssFloat=a:e[n]=(""+a).trim():e[n]=a+"px"}function Xe(e,n,a){if(n!=null&&typeof n!="object")throw Error(s(62));if(e=e.style,a!=null){for(var o in a)!a.hasOwnProperty(o)||n!=null&&n.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var u in n)o=n[u],n.hasOwnProperty(u)&&a[u]!==o&&qt(e,u,o)}else for(var h in n)n.hasOwnProperty(h)&&qt(e,h,n[h])}function at(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),aa=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Hn(e){return aa.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Wt(){}var Aa=null;function Yi(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ma=null,An=null;function ya(e){var n=pa(e);if(n&&(e=n.stateNode)){var a=e[hn]||null;e:switch(e=n.stateNode,n.type){case"input":if(Ae(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ke(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var o=a[n];if(o!==e&&o.form===e.form){var u=o[hn]||null;if(!u)throw Error(s(90));Ae(o,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(n=0;n<a.length;n++)o=a[n],o.form===e.form&&Ne(o)}break e;case"textarea":Re(e,a.value,a.defaultValue);break e;case"select":n=a.value,n!=null&&me(e,!!a.multiple,n,!1)}}}var Be=!1;function Ke(e,n,a){if(Be)return e(n,a);Be=!0;try{var o=e(n);return o}finally{if(Be=!1,(ma!==null||An!==null)&&(Rs(),ma&&(n=ma,e=An,An=ma=null,ya(n),e)))for(n=0;n<e.length;n++)ya(e[n])}}function it(e,n){var a=e.stateNode;if(a===null)return null;var o=a[hn]||null;if(o===null)return null;a=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(s(231,n,typeof a));return a}var De=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ve=!1;if(De)try{var Qe={};Object.defineProperty(Qe,"passive",{get:function(){Ve=!0}}),window.addEventListener("test",Qe,Qe),window.removeEventListener("test",Qe,Qe)}catch{Ve=!1}var Ut=null,nn=null,$t=null;function ia(){if($t)return $t;var e,n=nn,a=n.length,o,u="value"in Ut?Ut.value:Ut.textContent,h=u.length;for(e=0;e<a&&n[e]===u[e];e++);var _=a-e;for(o=1;o<=_&&n[a-o]===u[h-o];o++);return $t=u.slice(e,1<o?1-o:void 0)}function ra(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Ja(){return!0}function Yo(){return!1}function sn(e){function n(a,o,u,h,_){this._reactName=a,this._targetInst=u,this.type=o,this.nativeEvent=h,this.target=_,this.currentTarget=null;for(var D in e)e.hasOwnProperty(D)&&(a=e[D],this[D]=a?a(h):h[D]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Ja:Yo,this.isPropagationStopped=Yo,this}return S(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Ja)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Ja)},persist:function(){},isPersistent:Ja}),n}var ba={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ko=sn(ba),Fr=S({},ba,{view:0,detail:0}),Nm=sn(Fr),Sl,_l,Vr,Jo=S({},Fr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cl,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Vr&&(Vr&&e.type==="mousemove"?(Sl=e.screenX-Vr.screenX,_l=e.screenY-Vr.screenY):_l=Sl=0,Vr=e),Sl)},movementY:function(e){return"movementY"in e?e.movementY:_l}}),lu=sn(Jo),Am=S({},Jo,{dataTransfer:0}),zm=sn(Am),km=S({},Fr,{relatedTarget:0}),wl=sn(km),Rm=S({},ba,{animationName:0,elapsedTime:0,pseudoElement:0}),Om=sn(Rm),Dm=S({},ba,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Bm=sn(Dm),Um=S({},ba,{data:0}),cu=sn(Um),Lm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Im={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Mm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qm(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=Mm[e])?!!n[e]:!1}function Cl(){return qm}var $m=S({},Fr,{key:function(e){if(e.key){var n=Lm[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=ra(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Im[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cl,charCode:function(e){return e.type==="keypress"?ra(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ra(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Hm=sn($m),Pm=S({},Jo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),du=sn(Pm),Fm=S({},Fr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cl}),Vm=sn(Fm),Wm=S({},ba,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gm=sn(Wm),Ym=S({},Jo,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Km=sn(Ym),Jm=S({},ba,{newState:0,oldState:0}),Qm=sn(Jm),Xm=[9,13,27,32],El=De&&"CompositionEvent"in window,Wr=null;De&&"documentMode"in document&&(Wr=document.documentMode);var Zm=De&&"TextEvent"in window&&!Wr,uu=De&&(!El||Wr&&8<Wr&&11>=Wr),fu=" ",hu=!1;function pu(e,n){switch(e){case"keyup":return Xm.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ki=!1;function ey(e,n){switch(e){case"compositionend":return gu(n);case"keypress":return n.which!==32?null:(hu=!0,fu);case"textInput":return e=n.data,e===fu&&hu?null:e;default:return null}}function ty(e,n){if(Ki)return e==="compositionend"||!El&&pu(e,n)?(e=ia(),$t=nn=Ut=null,Ki=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return uu&&n.locale!=="ko"?null:n.data;default:return null}}var ny={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mu(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!ny[e.type]:n==="textarea"}function yu(e,n,a,o){ma?An?An.push(o):An=[o]:ma=o,n=Ms(n,"onChange"),0<n.length&&(a=new Ko("onChange","change",null,a,o),e.push({event:a,listeners:n}))}var Gr=null,Yr=null;function ay(e){ep(e,0)}function Qo(e){var n=tn(e);if(Ne(n))return e}function bu(e,n){if(e==="change")return n}var xu=!1;if(De){var Tl;if(De){var Nl="oninput"in document;if(!Nl){var vu=document.createElement("div");vu.setAttribute("oninput","return;"),Nl=typeof vu.oninput=="function"}Tl=Nl}else Tl=!1;xu=Tl&&(!document.documentMode||9<document.documentMode)}function ju(){Gr&&(Gr.detachEvent("onpropertychange",Su),Yr=Gr=null)}function Su(e){if(e.propertyName==="value"&&Qo(Yr)){var n=[];yu(n,Yr,e,Yi(e)),Ke(ay,n)}}function iy(e,n,a){e==="focusin"?(ju(),Gr=n,Yr=a,Gr.attachEvent("onpropertychange",Su)):e==="focusout"&&ju()}function ry(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Qo(Yr)}function oy(e,n){if(e==="click")return Qo(n)}function sy(e,n){if(e==="input"||e==="change")return Qo(n)}function ly(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var zn=typeof Object.is=="function"?Object.is:ly;function Kr(e,n){if(zn(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),o=Object.keys(n);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var u=a[o];if(!ze.call(n,u)||!zn(e[u],n[u]))return!1}return!0}function _u(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function wu(e,n){var a=_u(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=n&&o>=n)return{node:a,offset:n-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=_u(a)}}function Cu(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?Cu(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function Eu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=pe(e.document);n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=pe(e.document)}return n}function Al(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var cy=De&&"documentMode"in document&&11>=document.documentMode,Ji=null,zl=null,Jr=null,kl=!1;function Tu(e,n,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;kl||Ji==null||Ji!==pe(o)||(o=Ji,"selectionStart"in o&&Al(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Jr&&Kr(Jr,o)||(Jr=o,o=Ms(zl,"onSelect"),0<o.length&&(n=new Ko("onSelect","select",null,n,a),e.push({event:n,listeners:o}),n.target=Ji)))}function Ci(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var Qi={animationend:Ci("Animation","AnimationEnd"),animationiteration:Ci("Animation","AnimationIteration"),animationstart:Ci("Animation","AnimationStart"),transitionrun:Ci("Transition","TransitionRun"),transitionstart:Ci("Transition","TransitionStart"),transitioncancel:Ci("Transition","TransitionCancel"),transitionend:Ci("Transition","TransitionEnd")},Rl={},Nu={};De&&(Nu=document.createElement("div").style,"AnimationEvent"in window||(delete Qi.animationend.animation,delete Qi.animationiteration.animation,delete Qi.animationstart.animation),"TransitionEvent"in window||delete Qi.transitionend.transition);function Ei(e){if(Rl[e])return Rl[e];if(!Qi[e])return e;var n=Qi[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in Nu)return Rl[e]=n[a];return e}var Au=Ei("animationend"),zu=Ei("animationiteration"),ku=Ei("animationstart"),dy=Ei("transitionrun"),uy=Ei("transitionstart"),fy=Ei("transitioncancel"),Ru=Ei("transitionend"),Ou=new Map,Ol="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ol.push("scrollEnd");function oa(e,n){Ou.set(e,n),Ta(n,[e])}var Xo=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Pn=[],Xi=0,Dl=0;function Zo(){for(var e=Xi,n=Dl=Xi=0;n<e;){var a=Pn[n];Pn[n++]=null;var o=Pn[n];Pn[n++]=null;var u=Pn[n];Pn[n++]=null;var h=Pn[n];if(Pn[n++]=null,o!==null&&u!==null){var _=o.pending;_===null?u.next=u:(u.next=_.next,_.next=u),o.pending=u}h!==0&&Du(a,u,h)}}function es(e,n,a,o){Pn[Xi++]=e,Pn[Xi++]=n,Pn[Xi++]=a,Pn[Xi++]=o,Dl|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Bl(e,n,a,o){return es(e,n,a,o),ts(e)}function Ti(e,n){return es(e,null,null,n),ts(e)}function Du(e,n,a){e.lanes|=a;var o=e.alternate;o!==null&&(o.lanes|=a);for(var u=!1,h=e.return;h!==null;)h.childLanes|=a,o=h.alternate,o!==null&&(o.childLanes|=a),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(u=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,u&&n!==null&&(u=31-lt(a),e=h.hiddenUpdates,o=e[u],o===null?e[u]=[n]:o.push(n),n.lane=a|536870912),h):null}function ts(e){if(50<xo)throw xo=0,Fc=null,Error(s(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Zi={};function hy(e,n,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kn(e,n,a,o){return new hy(e,n,a,o)}function Ul(e){return e=e.prototype,!(!e||!e.isReactComponent)}function za(e,n){var a=e.alternate;return a===null?(a=kn(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Bu(e,n){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,n=a.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function ns(e,n,a,o,u,h){var _=0;if(o=e,typeof e=="function")Ul(e)&&(_=1);else if(typeof e=="string")_=bb(e,a,Z.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case M:return e=kn(31,a,n,u),e.elementType=M,e.lanes=h,e;case v:return Ni(a.children,u,h,n);case E:_=8,u|=24;break;case T:return e=kn(12,a,n,u|2),e.elementType=T,e.lanes=h,e;case C:return e=kn(13,a,n,u),e.elementType=C,e.lanes=h,e;case O:return e=kn(19,a,n,u),e.elementType=O,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case R:_=10;break e;case L:_=9;break e;case z:_=11;break e;case I:_=14;break e;case k:_=16,o=null;break e}_=29,a=Error(s(130,e===null?"null":typeof e,"")),o=null}return n=kn(_,a,n,u),n.elementType=e,n.type=o,n.lanes=h,n}function Ni(e,n,a,o){return e=kn(7,e,o,n),e.lanes=a,e}function Ll(e,n,a){return e=kn(6,e,null,n),e.lanes=a,e}function Uu(e){var n=kn(18,null,null,0);return n.stateNode=e,n}function Il(e,n,a){return n=kn(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Lu=new WeakMap;function Fn(e,n){if(typeof e=="object"&&e!==null){var a=Lu.get(e);return a!==void 0?a:(n={value:e,source:n,stack:Le(n)},Lu.set(e,n),n)}return{value:e,source:n,stack:Le(n)}}var er=[],tr=0,as=null,Qr=0,Vn=[],Wn=0,Qa=null,xa=1,va="";function ka(e,n){er[tr++]=Qr,er[tr++]=as,as=e,Qr=n}function Iu(e,n,a){Vn[Wn++]=xa,Vn[Wn++]=va,Vn[Wn++]=Qa,Qa=e;var o=xa;e=va;var u=32-lt(o)-1;o&=~(1<<u),a+=1;var h=32-lt(n)+u;if(30<h){var _=u-u%5;h=(o&(1<<_)-1).toString(32),o>>=_,u-=_,xa=1<<32-lt(n)+u|a<<u|o,va=h+e}else xa=1<<h|a<<u|o,va=e}function Ml(e){e.return!==null&&(ka(e,1),Iu(e,1,0))}function ql(e){for(;e===as;)as=er[--tr],er[tr]=null,Qr=er[--tr],er[tr]=null;for(;e===Qa;)Qa=Vn[--Wn],Vn[Wn]=null,va=Vn[--Wn],Vn[Wn]=null,xa=Vn[--Wn],Vn[Wn]=null}function Mu(e,n){Vn[Wn++]=xa,Vn[Wn++]=va,Vn[Wn++]=Qa,xa=n.id,va=n.overflow,Qa=e}var ln=null,At=null,pt=!1,Xa=null,Gn=!1,$l=Error(s(519));function Za(e){var n=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Xr(Fn(n,e)),$l}function qu(e){var n=e.stateNode,a=e.type,o=e.memoizedProps;switch(n[Ft]=e,n[hn]=o,a){case"dialog":ot("cancel",n),ot("close",n);break;case"iframe":case"object":case"embed":ot("load",n);break;case"video":case"audio":for(a=0;a<jo.length;a++)ot(jo[a],n);break;case"source":ot("error",n);break;case"img":case"image":case"link":ot("error",n),ot("load",n);break;case"details":ot("toggle",n);break;case"input":ot("invalid",n),xe(n,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0);break;case"select":ot("invalid",n);break;case"textarea":ot("invalid",n),Fe(n,o.value,o.defaultValue,o.children)}a=o.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||o.suppressHydrationWarning===!0||ip(n.textContent,a)?(o.popover!=null&&(ot("beforetoggle",n),ot("toggle",n)),o.onScroll!=null&&ot("scroll",n),o.onScrollEnd!=null&&ot("scrollend",n),o.onClick!=null&&(n.onclick=Wt),n=!0):n=!1,n||Za(e,!0)}function $u(e){for(ln=e.return;ln;)switch(ln.tag){case 5:case 31:case 13:Gn=!1;return;case 27:case 3:Gn=!0;return;default:ln=ln.return}}function nr(e){if(e!==ln)return!1;if(!pt)return $u(e),pt=!0,!1;var n=e.tag,a;if((a=n!==3&&n!==27)&&((a=n===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||rd(e.type,e.memoizedProps)),a=!a),a&&At&&Za(e),$u(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));At=hp(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));At=hp(e)}else n===27?(n=At,hi(e.type)?(e=dd,dd=null,At=e):At=n):At=ln?Kn(e.stateNode.nextSibling):null;return!0}function Ai(){At=ln=null,pt=!1}function Hl(){var e=Xa;return e!==null&&(Cn===null?Cn=e:Cn.push.apply(Cn,e),Xa=null),e}function Xr(e){Xa===null?Xa=[e]:Xa.push(e)}var Pl=U(null),zi=null,Ra=null;function ei(e,n,a){H(Pl,n._currentValue),n._currentValue=a}function Oa(e){e._currentValue=Pl.current,$(Pl)}function Fl(e,n,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),e===a)break;e=e.return}}function Vl(e,n,a,o){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var h=u.dependencies;if(h!==null){var _=u.child;h=h.firstContext;e:for(;h!==null;){var D=h;h=u;for(var W=0;W<n.length;W++)if(D.context===n[W]){h.lanes|=a,D=h.alternate,D!==null&&(D.lanes|=a),Fl(h.return,a,e),o||(_=null);break e}h=D.next}}else if(u.tag===18){if(_=u.return,_===null)throw Error(s(341));_.lanes|=a,h=_.alternate,h!==null&&(h.lanes|=a),Fl(_,a,e),_=null}else _=u.child;if(_!==null)_.return=u;else for(_=u;_!==null;){if(_===e){_=null;break}if(u=_.sibling,u!==null){u.return=_.return,_=u;break}_=_.return}u=_}}function ar(e,n,a,o){e=null;for(var u=n,h=!1;u!==null;){if(!h){if((u.flags&524288)!==0)h=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var _=u.alternate;if(_===null)throw Error(s(387));if(_=_.memoizedProps,_!==null){var D=u.type;zn(u.pendingProps.value,_.value)||(e!==null?e.push(D):e=[D])}}else if(u===P.current){if(_=u.alternate,_===null)throw Error(s(387));_.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(Eo):e=[Eo])}u=u.return}e!==null&&Vl(n,e,a,o),n.flags|=262144}function is(e){for(e=e.firstContext;e!==null;){if(!zn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ki(e){zi=e,Ra=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function cn(e){return Hu(zi,e)}function rs(e,n){return zi===null&&ki(e),Hu(e,n)}function Hu(e,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},Ra===null){if(e===null)throw Error(s(308));Ra=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else Ra=Ra.next=n;return a}var py=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(a,o){e.push(o)}};this.abort=function(){n.aborted=!0,e.forEach(function(a){return a()})}},gy=l.unstable_scheduleCallback,my=l.unstable_NormalPriority,Gt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wl(){return{controller:new py,data:new Map,refCount:0}}function Zr(e){e.refCount--,e.refCount===0&&gy(my,function(){e.controller.abort()})}var eo=null,Gl=0,ir=0,rr=null;function yy(e,n){if(eo===null){var a=eo=[];Gl=0,ir=Jc(),rr={status:"pending",value:void 0,then:function(o){a.push(o)}}}return Gl++,n.then(Pu,Pu),n}function Pu(){if(--Gl===0&&eo!==null){rr!==null&&(rr.status="fulfilled");var e=eo;eo=null,ir=0,rr=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function by(e,n){var a=[],o={status:"pending",value:null,reason:null,then:function(u){a.push(u)}};return e.then(function(){o.status="fulfilled",o.value=n;for(var u=0;u<a.length;u++)(0,a[u])(n)},function(u){for(o.status="rejected",o.reason=u,u=0;u<a.length;u++)(0,a[u])(void 0)}),o}var Fu=N.S;N.S=function(e,n){Nh=st(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&yy(e,n),Fu!==null&&Fu(e,n)};var Ri=U(null);function Yl(){var e=Ri.current;return e!==null?e:Et.pooledCache}function os(e,n){n===null?H(Ri,Ri.current):H(Ri,n.pool)}function Vu(){var e=Yl();return e===null?null:{parent:Gt._currentValue,pool:e}}var or=Error(s(460)),Kl=Error(s(474)),ss=Error(s(542)),ls={then:function(){}};function Wu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Gu(e,n,a){switch(a=e[a],a===void 0?e.push(n):a!==n&&(n.then(Wt,Wt),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ku(e),e;default:if(typeof n.status=="string")n.then(Wt,Wt);else{if(e=Et,e!==null&&100<e.shellSuspendCounter)throw Error(s(482));e=n,e.status="pending",e.then(function(o){if(n.status==="pending"){var u=n;u.status="fulfilled",u.value=o}},function(o){if(n.status==="pending"){var u=n;u.status="rejected",u.reason=o}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Ku(e),e}throw Di=n,or}}function Oi(e){try{var n=e._init;return n(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Di=a,or):a}}var Di=null;function Yu(){if(Di===null)throw Error(s(459));var e=Di;return Di=null,e}function Ku(e){if(e===or||e===ss)throw Error(s(483))}var sr=null,to=0;function cs(e){var n=to;return to+=1,sr===null&&(sr=[]),Gu(sr,e,n)}function no(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function ds(e,n){throw n.$$typeof===j?Error(s(525)):(e=Object.prototype.toString.call(n),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Ju(e){function n(ie,Q){if(e){var le=ie.deletions;le===null?(ie.deletions=[Q],ie.flags|=16):le.push(Q)}}function a(ie,Q){if(!e)return null;for(;Q!==null;)n(ie,Q),Q=Q.sibling;return null}function o(ie){for(var Q=new Map;ie!==null;)ie.key!==null?Q.set(ie.key,ie):Q.set(ie.index,ie),ie=ie.sibling;return Q}function u(ie,Q){return ie=za(ie,Q),ie.index=0,ie.sibling=null,ie}function h(ie,Q,le){return ie.index=le,e?(le=ie.alternate,le!==null?(le=le.index,le<Q?(ie.flags|=67108866,Q):le):(ie.flags|=67108866,Q)):(ie.flags|=1048576,Q)}function _(ie){return e&&ie.alternate===null&&(ie.flags|=67108866),ie}function D(ie,Q,le,Ce){return Q===null||Q.tag!==6?(Q=Ll(le,ie.mode,Ce),Q.return=ie,Q):(Q=u(Q,le),Q.return=ie,Q)}function W(ie,Q,le,Ce){var Ge=le.type;return Ge===v?je(ie,Q,le.props.children,Ce,le.key):Q!==null&&(Q.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===k&&Oi(Ge)===Q.type)?(Q=u(Q,le.props),no(Q,le),Q.return=ie,Q):(Q=ns(le.type,le.key,le.props,null,ie.mode,Ce),no(Q,le),Q.return=ie,Q)}function ce(ie,Q,le,Ce){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==le.containerInfo||Q.stateNode.implementation!==le.implementation?(Q=Il(le,ie.mode,Ce),Q.return=ie,Q):(Q=u(Q,le.children||[]),Q.return=ie,Q)}function je(ie,Q,le,Ce,Ge){return Q===null||Q.tag!==7?(Q=Ni(le,ie.mode,Ce,Ge),Q.return=ie,Q):(Q=u(Q,le),Q.return=ie,Q)}function Ee(ie,Q,le){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=Ll(""+Q,ie.mode,le),Q.return=ie,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case x:return le=ns(Q.type,Q.key,Q.props,null,ie.mode,le),no(le,Q),le.return=ie,le;case w:return Q=Il(Q,ie.mode,le),Q.return=ie,Q;case k:return Q=Oi(Q),Ee(ie,Q,le)}if(A(Q)||ne(Q))return Q=Ni(Q,ie.mode,le,null),Q.return=ie,Q;if(typeof Q.then=="function")return Ee(ie,cs(Q),le);if(Q.$$typeof===R)return Ee(ie,rs(ie,Q),le);ds(ie,Q)}return null}function fe(ie,Q,le,Ce){var Ge=Q!==null?Q.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Ge!==null?null:D(ie,Q,""+le,Ce);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case x:return le.key===Ge?W(ie,Q,le,Ce):null;case w:return le.key===Ge?ce(ie,Q,le,Ce):null;case k:return le=Oi(le),fe(ie,Q,le,Ce)}if(A(le)||ne(le))return Ge!==null?null:je(ie,Q,le,Ce,null);if(typeof le.then=="function")return fe(ie,Q,cs(le),Ce);if(le.$$typeof===R)return fe(ie,Q,rs(ie,le),Ce);ds(ie,le)}return null}function ye(ie,Q,le,Ce,Ge){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return ie=ie.get(le)||null,D(Q,ie,""+Ce,Ge);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case x:return ie=ie.get(Ce.key===null?le:Ce.key)||null,W(Q,ie,Ce,Ge);case w:return ie=ie.get(Ce.key===null?le:Ce.key)||null,ce(Q,ie,Ce,Ge);case k:return Ce=Oi(Ce),ye(ie,Q,le,Ce,Ge)}if(A(Ce)||ne(Ce))return ie=ie.get(le)||null,je(Q,ie,Ce,Ge,null);if(typeof Ce.then=="function")return ye(ie,Q,le,cs(Ce),Ge);if(Ce.$$typeof===R)return ye(ie,Q,le,rs(Q,Ce),Ge);ds(Q,Ce)}return null}function Me(ie,Q,le,Ce){for(var Ge=null,mt=null,He=Q,nt=Q=0,dt=null;He!==null&&nt<le.length;nt++){He.index>nt?(dt=He,He=null):dt=He.sibling;var yt=fe(ie,He,le[nt],Ce);if(yt===null){He===null&&(He=dt);break}e&&He&&yt.alternate===null&&n(ie,He),Q=h(yt,Q,nt),mt===null?Ge=yt:mt.sibling=yt,mt=yt,He=dt}if(nt===le.length)return a(ie,He),pt&&ka(ie,nt),Ge;if(He===null){for(;nt<le.length;nt++)He=Ee(ie,le[nt],Ce),He!==null&&(Q=h(He,Q,nt),mt===null?Ge=He:mt.sibling=He,mt=He);return pt&&ka(ie,nt),Ge}for(He=o(He);nt<le.length;nt++)dt=ye(He,ie,nt,le[nt],Ce),dt!==null&&(e&&dt.alternate!==null&&He.delete(dt.key===null?nt:dt.key),Q=h(dt,Q,nt),mt===null?Ge=dt:mt.sibling=dt,mt=dt);return e&&He.forEach(function(bi){return n(ie,bi)}),pt&&ka(ie,nt),Ge}function Ye(ie,Q,le,Ce){if(le==null)throw Error(s(151));for(var Ge=null,mt=null,He=Q,nt=Q=0,dt=null,yt=le.next();He!==null&&!yt.done;nt++,yt=le.next()){He.index>nt?(dt=He,He=null):dt=He.sibling;var bi=fe(ie,He,yt.value,Ce);if(bi===null){He===null&&(He=dt);break}e&&He&&bi.alternate===null&&n(ie,He),Q=h(bi,Q,nt),mt===null?Ge=bi:mt.sibling=bi,mt=bi,He=dt}if(yt.done)return a(ie,He),pt&&ka(ie,nt),Ge;if(He===null){for(;!yt.done;nt++,yt=le.next())yt=Ee(ie,yt.value,Ce),yt!==null&&(Q=h(yt,Q,nt),mt===null?Ge=yt:mt.sibling=yt,mt=yt);return pt&&ka(ie,nt),Ge}for(He=o(He);!yt.done;nt++,yt=le.next())yt=ye(He,ie,nt,yt.value,Ce),yt!==null&&(e&&yt.alternate!==null&&He.delete(yt.key===null?nt:yt.key),Q=h(yt,Q,nt),mt===null?Ge=yt:mt.sibling=yt,mt=yt);return e&&He.forEach(function(Ab){return n(ie,Ab)}),pt&&ka(ie,nt),Ge}function Ct(ie,Q,le,Ce){if(typeof le=="object"&&le!==null&&le.type===v&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case x:e:{for(var Ge=le.key;Q!==null;){if(Q.key===Ge){if(Ge=le.type,Ge===v){if(Q.tag===7){a(ie,Q.sibling),Ce=u(Q,le.props.children),Ce.return=ie,ie=Ce;break e}}else if(Q.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===k&&Oi(Ge)===Q.type){a(ie,Q.sibling),Ce=u(Q,le.props),no(Ce,le),Ce.return=ie,ie=Ce;break e}a(ie,Q);break}else n(ie,Q);Q=Q.sibling}le.type===v?(Ce=Ni(le.props.children,ie.mode,Ce,le.key),Ce.return=ie,ie=Ce):(Ce=ns(le.type,le.key,le.props,null,ie.mode,Ce),no(Ce,le),Ce.return=ie,ie=Ce)}return _(ie);case w:e:{for(Ge=le.key;Q!==null;){if(Q.key===Ge)if(Q.tag===4&&Q.stateNode.containerInfo===le.containerInfo&&Q.stateNode.implementation===le.implementation){a(ie,Q.sibling),Ce=u(Q,le.children||[]),Ce.return=ie,ie=Ce;break e}else{a(ie,Q);break}else n(ie,Q);Q=Q.sibling}Ce=Il(le,ie.mode,Ce),Ce.return=ie,ie=Ce}return _(ie);case k:return le=Oi(le),Ct(ie,Q,le,Ce)}if(A(le))return Me(ie,Q,le,Ce);if(ne(le)){if(Ge=ne(le),typeof Ge!="function")throw Error(s(150));return le=Ge.call(le),Ye(ie,Q,le,Ce)}if(typeof le.then=="function")return Ct(ie,Q,cs(le),Ce);if(le.$$typeof===R)return Ct(ie,Q,rs(ie,le),Ce);ds(ie,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,Q!==null&&Q.tag===6?(a(ie,Q.sibling),Ce=u(Q,le),Ce.return=ie,ie=Ce):(a(ie,Q),Ce=Ll(le,ie.mode,Ce),Ce.return=ie,ie=Ce),_(ie)):a(ie,Q)}return function(ie,Q,le,Ce){try{to=0;var Ge=Ct(ie,Q,le,Ce);return sr=null,Ge}catch(He){if(He===or||He===ss)throw He;var mt=kn(29,He,null,ie.mode);return mt.lanes=Ce,mt.return=ie,mt}finally{}}}var Bi=Ju(!0),Qu=Ju(!1),ti=!1;function Jl(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ql(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ni(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ai(e,n,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(xt&2)!==0){var u=o.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),o.pending=n,n=ts(e),Du(e,null,a),n}return es(e,o,n,a),ts(e)}function ao(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194048)!==0)){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,Ya(e,a)}}function Xl(e,n){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var u=null,h=null;if(a=a.firstBaseUpdate,a!==null){do{var _={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};h===null?u=h=_:h=h.next=_,a=a.next}while(a!==null);h===null?u=h=n:h=h.next=n}else u=h=n;a={baseState:o.baseState,firstBaseUpdate:u,lastBaseUpdate:h,shared:o.shared,callbacks:o.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}var Zl=!1;function io(){if(Zl){var e=rr;if(e!==null)throw e}}function ro(e,n,a,o){Zl=!1;var u=e.updateQueue;ti=!1;var h=u.firstBaseUpdate,_=u.lastBaseUpdate,D=u.shared.pending;if(D!==null){u.shared.pending=null;var W=D,ce=W.next;W.next=null,_===null?h=ce:_.next=ce,_=W;var je=e.alternate;je!==null&&(je=je.updateQueue,D=je.lastBaseUpdate,D!==_&&(D===null?je.firstBaseUpdate=ce:D.next=ce,je.lastBaseUpdate=W))}if(h!==null){var Ee=u.baseState;_=0,je=ce=W=null,D=h;do{var fe=D.lane&-536870913,ye=fe!==D.lane;if(ye?(ct&fe)===fe:(o&fe)===fe){fe!==0&&fe===ir&&(Zl=!0),je!==null&&(je=je.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var Me=e,Ye=D;fe=n;var Ct=a;switch(Ye.tag){case 1:if(Me=Ye.payload,typeof Me=="function"){Ee=Me.call(Ct,Ee,fe);break e}Ee=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=Ye.payload,fe=typeof Me=="function"?Me.call(Ct,Ee,fe):Me,fe==null)break e;Ee=S({},Ee,fe);break e;case 2:ti=!0}}fe=D.callback,fe!==null&&(e.flags|=64,ye&&(e.flags|=8192),ye=u.callbacks,ye===null?u.callbacks=[fe]:ye.push(fe))}else ye={lane:fe,tag:D.tag,payload:D.payload,callback:D.callback,next:null},je===null?(ce=je=ye,W=Ee):je=je.next=ye,_|=fe;if(D=D.next,D===null){if(D=u.shared.pending,D===null)break;ye=D,D=ye.next,ye.next=null,u.lastBaseUpdate=ye,u.shared.pending=null}}while(!0);je===null&&(W=Ee),u.baseState=W,u.firstBaseUpdate=ce,u.lastBaseUpdate=je,h===null&&(u.shared.lanes=0),li|=_,e.lanes=_,e.memoizedState=Ee}}function Xu(e,n){if(typeof e!="function")throw Error(s(191,e));e.call(n)}function Zu(e,n){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)Xu(a[e],n)}var lr=U(null),us=U(0);function ef(e,n){e=Ha,H(us,e),H(lr,n),Ha=e|n.baseLanes}function ec(){H(us,Ha),H(lr,lr.current)}function tc(){Ha=us.current,$(lr),$(us)}var Rn=U(null),Yn=null;function ii(e){var n=e.alternate;H(Ht,Ht.current&1),H(Rn,e),Yn===null&&(n===null||lr.current!==null||n.memoizedState!==null)&&(Yn=e)}function nc(e){H(Ht,Ht.current),H(Rn,e),Yn===null&&(Yn=e)}function tf(e){e.tag===22?(H(Ht,Ht.current),H(Rn,e),Yn===null&&(Yn=e)):ri()}function ri(){H(Ht,Ht.current),H(Rn,Rn.current)}function On(e){$(Rn),Yn===e&&(Yn=null),$(Ht)}var Ht=U(0);function fs(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||ld(a)||cd(a)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Da=0,tt=null,_t=null,Yt=null,hs=!1,cr=!1,Ui=!1,ps=0,oo=0,dr=null,xy=0;function It(){throw Error(s(321))}function ac(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!zn(e[a],n[a]))return!1;return!0}function ic(e,n,a,o,u,h){return Da=h,tt=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,N.H=e===null||e.memoizedState===null?Mf:xc,Ui=!1,h=a(o,u),Ui=!1,cr&&(h=af(n,a,o,u)),nf(e),h}function nf(e){N.H=co;var n=_t!==null&&_t.next!==null;if(Da=0,Yt=_t=tt=null,hs=!1,oo=0,dr=null,n)throw Error(s(300));e===null||Kt||(e=e.dependencies,e!==null&&is(e)&&(Kt=!0))}function af(e,n,a,o){tt=e;var u=0;do{if(cr&&(dr=null),oo=0,cr=!1,25<=u)throw Error(s(301));if(u+=1,Yt=_t=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}N.H=qf,h=n(a,o)}while(cr);return h}function vy(){var e=N.H,n=e.useState()[0];return n=typeof n.then=="function"?so(n):n,e=e.useState()[0],(_t!==null?_t.memoizedState:null)!==e&&(tt.flags|=1024),n}function rc(){var e=ps!==0;return ps=0,e}function oc(e,n,a){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~a}function sc(e){if(hs){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}hs=!1}Da=0,Yt=_t=tt=null,cr=!1,oo=ps=0,dr=null}function yn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yt===null?tt.memoizedState=Yt=e:Yt=Yt.next=e,Yt}function Pt(){if(_t===null){var e=tt.alternate;e=e!==null?e.memoizedState:null}else e=_t.next;var n=Yt===null?tt.memoizedState:Yt.next;if(n!==null)Yt=n,_t=e;else{if(e===null)throw tt.alternate===null?Error(s(467)):Error(s(310));_t=e,e={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},Yt===null?tt.memoizedState=Yt=e:Yt=Yt.next=e}return Yt}function gs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function so(e){var n=oo;return oo+=1,dr===null&&(dr=[]),e=Gu(dr,e,n),n=tt,(Yt===null?n.memoizedState:Yt.next)===null&&(n=n.alternate,N.H=n===null||n.memoizedState===null?Mf:xc),e}function ms(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return so(e);if(e.$$typeof===R)return cn(e)}throw Error(s(438,String(e)))}function lc(e){var n=null,a=tt.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var o=tt.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(n={data:o.data.map(function(u){return u.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=gs(),tt.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(e),o=0;o<e;o++)a[o]=G;return n.index++,a}function Ba(e,n){return typeof n=="function"?n(e):n}function ys(e){var n=Pt();return cc(n,_t,e)}function cc(e,n,a){var o=e.queue;if(o===null)throw Error(s(311));o.lastRenderedReducer=a;var u=e.baseQueue,h=o.pending;if(h!==null){if(u!==null){var _=u.next;u.next=h.next,h.next=_}n.baseQueue=u=h,o.pending=null}if(h=e.baseState,u===null)e.memoizedState=h;else{n=u.next;var D=_=null,W=null,ce=n,je=!1;do{var Ee=ce.lane&-536870913;if(Ee!==ce.lane?(ct&Ee)===Ee:(Da&Ee)===Ee){var fe=ce.revertLane;if(fe===0)W!==null&&(W=W.next={lane:0,revertLane:0,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),Ee===ir&&(je=!0);else if((Da&fe)===fe){ce=ce.next,fe===ir&&(je=!0);continue}else Ee={lane:0,revertLane:ce.revertLane,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},W===null?(D=W=Ee,_=h):W=W.next=Ee,tt.lanes|=fe,li|=fe;Ee=ce.action,Ui&&a(h,Ee),h=ce.hasEagerState?ce.eagerState:a(h,Ee)}else fe={lane:Ee,revertLane:ce.revertLane,gesture:ce.gesture,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},W===null?(D=W=fe,_=h):W=W.next=fe,tt.lanes|=Ee,li|=Ee;ce=ce.next}while(ce!==null&&ce!==n);if(W===null?_=h:W.next=D,!zn(h,e.memoizedState)&&(Kt=!0,je&&(a=rr,a!==null)))throw a;e.memoizedState=h,e.baseState=_,e.baseQueue=W,o.lastRenderedState=h}return u===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function dc(e){var n=Pt(),a=n.queue;if(a===null)throw Error(s(311));a.lastRenderedReducer=e;var o=a.dispatch,u=a.pending,h=n.memoizedState;if(u!==null){a.pending=null;var _=u=u.next;do h=e(h,_.action),_=_.next;while(_!==u);zn(h,n.memoizedState)||(Kt=!0),n.memoizedState=h,n.baseQueue===null&&(n.baseState=h),a.lastRenderedState=h}return[h,o]}function rf(e,n,a){var o=tt,u=Pt(),h=pt;if(h){if(a===void 0)throw Error(s(407));a=a()}else a=n();var _=!zn((_t||u).memoizedState,a);if(_&&(u.memoizedState=a,Kt=!0),u=u.queue,hc(lf.bind(null,o,u,e),[e]),u.getSnapshot!==n||_||Yt!==null&&Yt.memoizedState.tag&1){if(o.flags|=2048,ur(9,{destroy:void 0},sf.bind(null,o,u,a,n),null),Et===null)throw Error(s(349));h||(Da&127)!==0||of(o,n,a)}return a}function of(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=tt.updateQueue,n===null?(n=gs(),tt.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function sf(e,n,a,o){n.value=a,n.getSnapshot=o,cf(n)&&df(e)}function lf(e,n,a){return a(function(){cf(n)&&df(e)})}function cf(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!zn(e,a)}catch{return!0}}function df(e){var n=Ti(e,2);n!==null&&En(n,e,2)}function uc(e){var n=yn();if(typeof e=="function"){var a=e;if(e=a(),Ui){ft(!0);try{a()}finally{ft(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:e},n}function uf(e,n,a,o){return e.baseState=a,cc(e,_t,typeof o=="function"?o:Ba)}function jy(e,n,a,o,u){if(vs(e))throw Error(s(485));if(e=n.action,e!==null){var h={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){h.listeners.push(_)}};N.T!==null?a(!0):h.isTransition=!1,o(h),a=n.pending,a===null?(h.next=n.pending=h,ff(n,h)):(h.next=a.next,n.pending=a.next=h)}}function ff(e,n){var a=n.action,o=n.payload,u=e.state;if(n.isTransition){var h=N.T,_={};N.T=_;try{var D=a(u,o),W=N.S;W!==null&&W(_,D),hf(e,n,D)}catch(ce){fc(e,n,ce)}finally{h!==null&&_.types!==null&&(h.types=_.types),N.T=h}}else try{h=a(u,o),hf(e,n,h)}catch(ce){fc(e,n,ce)}}function hf(e,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(o){pf(e,n,o)},function(o){return fc(e,n,o)}):pf(e,n,a)}function pf(e,n,a){n.status="fulfilled",n.value=a,gf(n),e.state=a,n=e.pending,n!==null&&(a=n.next,a===n?e.pending=null:(a=a.next,n.next=a,ff(e,a)))}function fc(e,n,a){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do n.status="rejected",n.reason=a,gf(n),n=n.next;while(n!==o)}e.action=null}function gf(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function mf(e,n){return n}function yf(e,n){if(pt){var a=Et.formState;if(a!==null){e:{var o=tt;if(pt){if(At){t:{for(var u=At,h=Gn;u.nodeType!==8;){if(!h){u=null;break t}if(u=Kn(u.nextSibling),u===null){u=null;break t}}h=u.data,u=h==="F!"||h==="F"?u:null}if(u){At=Kn(u.nextSibling),o=u.data==="F!";break e}}Za(o)}o=!1}o&&(n=a[0])}}return a=yn(),a.memoizedState=a.baseState=n,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:mf,lastRenderedState:n},a.queue=o,a=Uf.bind(null,tt,o),o.dispatch=a,o=uc(!1),h=bc.bind(null,tt,!1,o.queue),o=yn(),u={state:n,dispatch:null,action:e,pending:null},o.queue=u,a=jy.bind(null,tt,u,h,a),u.dispatch=a,o.memoizedState=e,[n,a,!1]}function bf(e){var n=Pt();return xf(n,_t,e)}function xf(e,n,a){if(n=cc(e,n,mf)[0],e=ys(Ba)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var o=so(n)}catch(_){throw _===or?ss:_}else o=n;n=Pt();var u=n.queue,h=u.dispatch;return a!==n.memoizedState&&(tt.flags|=2048,ur(9,{destroy:void 0},Sy.bind(null,u,a),null)),[o,h,e]}function Sy(e,n){e.action=n}function vf(e){var n=Pt(),a=_t;if(a!==null)return xf(n,a,e);Pt(),n=n.memoizedState,a=Pt();var o=a.queue.dispatch;return a.memoizedState=e,[n,o,!1]}function ur(e,n,a,o){return e={tag:e,create:a,deps:o,inst:n,next:null},n=tt.updateQueue,n===null&&(n=gs(),tt.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,n.lastEffect=e),e}function jf(){return Pt().memoizedState}function bs(e,n,a,o){var u=yn();tt.flags|=e,u.memoizedState=ur(1|n,{destroy:void 0},a,o===void 0?null:o)}function xs(e,n,a,o){var u=Pt();o=o===void 0?null:o;var h=u.memoizedState.inst;_t!==null&&o!==null&&ac(o,_t.memoizedState.deps)?u.memoizedState=ur(n,h,a,o):(tt.flags|=e,u.memoizedState=ur(1|n,h,a,o))}function Sf(e,n){bs(8390656,8,e,n)}function hc(e,n){xs(2048,8,e,n)}function _y(e){tt.flags|=4;var n=tt.updateQueue;if(n===null)n=gs(),tt.updateQueue=n,n.events=[e];else{var a=n.events;a===null?n.events=[e]:a.push(e)}}function _f(e){var n=Pt().memoizedState;return _y({ref:n,nextImpl:e}),function(){if((xt&2)!==0)throw Error(s(440));return n.impl.apply(void 0,arguments)}}function wf(e,n){return xs(4,2,e,n)}function Cf(e,n){return xs(4,4,e,n)}function Ef(e,n){if(typeof n=="function"){e=e();var a=n(e);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function Tf(e,n,a){a=a!=null?a.concat([e]):null,xs(4,4,Ef.bind(null,n,e),a)}function pc(){}function Nf(e,n){var a=Pt();n=n===void 0?null:n;var o=a.memoizedState;return n!==null&&ac(n,o[1])?o[0]:(a.memoizedState=[e,n],e)}function Af(e,n){var a=Pt();n=n===void 0?null:n;var o=a.memoizedState;if(n!==null&&ac(n,o[1]))return o[0];if(o=e(),Ui){ft(!0);try{e()}finally{ft(!1)}}return a.memoizedState=[o,n],o}function gc(e,n,a){return a===void 0||(Da&1073741824)!==0&&(ct&261930)===0?e.memoizedState=n:(e.memoizedState=a,e=zh(),tt.lanes|=e,li|=e,a)}function zf(e,n,a,o){return zn(a,n)?a:lr.current!==null?(e=gc(e,a,o),zn(e,n)||(Kt=!0),e):(Da&42)===0||(Da&1073741824)!==0&&(ct&261930)===0?(Kt=!0,e.memoizedState=a):(e=zh(),tt.lanes|=e,li|=e,n)}function kf(e,n,a,o,u){var h=q.p;q.p=h!==0&&8>h?h:8;var _=N.T,D={};N.T=D,bc(e,!1,n,a);try{var W=u(),ce=N.S;if(ce!==null&&ce(D,W),W!==null&&typeof W=="object"&&typeof W.then=="function"){var je=by(W,o);lo(e,n,je,Un(e))}else lo(e,n,o,Un(e))}catch(Ee){lo(e,n,{then:function(){},status:"rejected",reason:Ee},Un())}finally{q.p=h,_!==null&&D.types!==null&&(_.types=D.types),N.T=_}}function wy(){}function mc(e,n,a,o){if(e.tag!==5)throw Error(s(476));var u=Rf(e).queue;kf(e,u,n,X,a===null?wy:function(){return Of(e),a(o)})}function Rf(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:X},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ba,lastRenderedState:a},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function Of(e){var n=Rf(e);n.next===null&&(n=e.alternate.memoizedState),lo(e,n.next.queue,{},Un())}function yc(){return cn(Eo)}function Df(){return Pt().memoizedState}function Bf(){return Pt().memoizedState}function Cy(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var a=Un();e=ni(a);var o=ai(n,e,a);o!==null&&(En(o,n,a),ao(o,n,a)),n={cache:Wl()},e.payload=n;return}n=n.return}}function Ey(e,n,a){var o=Un();a={lane:o,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},vs(e)?Lf(n,a):(a=Bl(e,n,a,o),a!==null&&(En(a,e,o),If(a,n,o)))}function Uf(e,n,a){var o=Un();lo(e,n,a,o)}function lo(e,n,a,o){var u={lane:o,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(vs(e))Lf(n,u);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=n.lastRenderedReducer,h!==null))try{var _=n.lastRenderedState,D=h(_,a);if(u.hasEagerState=!0,u.eagerState=D,zn(D,_))return es(e,n,u,0),Et===null&&Zo(),!1}catch{}finally{}if(a=Bl(e,n,u,o),a!==null)return En(a,e,o),If(a,n,o),!0}return!1}function bc(e,n,a,o){if(o={lane:2,revertLane:Jc(),gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},vs(e)){if(n)throw Error(s(479))}else n=Bl(e,a,o,2),n!==null&&En(n,e,2)}function vs(e){var n=e.alternate;return e===tt||n!==null&&n===tt}function Lf(e,n){cr=hs=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function If(e,n,a){if((a&4194048)!==0){var o=n.lanes;o&=e.pendingLanes,a|=o,n.lanes=a,Ya(e,a)}}var co={readContext:cn,use:ms,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useLayoutEffect:It,useInsertionEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useSyncExternalStore:It,useId:It,useHostTransitionStatus:It,useFormState:It,useActionState:It,useOptimistic:It,useMemoCache:It,useCacheRefresh:It};co.useEffectEvent=It;var Mf={readContext:cn,use:ms,useCallback:function(e,n){return yn().memoizedState=[e,n===void 0?null:n],e},useContext:cn,useEffect:Sf,useImperativeHandle:function(e,n,a){a=a!=null?a.concat([e]):null,bs(4194308,4,Ef.bind(null,n,e),a)},useLayoutEffect:function(e,n){return bs(4194308,4,e,n)},useInsertionEffect:function(e,n){bs(4,2,e,n)},useMemo:function(e,n){var a=yn();n=n===void 0?null:n;var o=e();if(Ui){ft(!0);try{e()}finally{ft(!1)}}return a.memoizedState=[o,n],o},useReducer:function(e,n,a){var o=yn();if(a!==void 0){var u=a(n);if(Ui){ft(!0);try{a(n)}finally{ft(!1)}}}else u=n;return o.memoizedState=o.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},o.queue=e,e=e.dispatch=Ey.bind(null,tt,e),[o.memoizedState,e]},useRef:function(e){var n=yn();return e={current:e},n.memoizedState=e},useState:function(e){e=uc(e);var n=e.queue,a=Uf.bind(null,tt,n);return n.dispatch=a,[e.memoizedState,a]},useDebugValue:pc,useDeferredValue:function(e,n){var a=yn();return gc(a,e,n)},useTransition:function(){var e=uc(!1);return e=kf.bind(null,tt,e.queue,!0,!1),yn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,a){var o=tt,u=yn();if(pt){if(a===void 0)throw Error(s(407));a=a()}else{if(a=n(),Et===null)throw Error(s(349));(ct&127)!==0||of(o,n,a)}u.memoizedState=a;var h={value:a,getSnapshot:n};return u.queue=h,Sf(lf.bind(null,o,h,e),[e]),o.flags|=2048,ur(9,{destroy:void 0},sf.bind(null,o,h,a,n),null),a},useId:function(){var e=yn(),n=Et.identifierPrefix;if(pt){var a=va,o=xa;a=(o&~(1<<32-lt(o)-1)).toString(32)+a,n="_"+n+"R_"+a,a=ps++,0<a&&(n+="H"+a.toString(32)),n+="_"}else a=xy++,n="_"+n+"r_"+a.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:yc,useFormState:yf,useActionState:yf,useOptimistic:function(e){var n=yn();n.memoizedState=n.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=bc.bind(null,tt,!0,a),a.dispatch=n,[e,n]},useMemoCache:lc,useCacheRefresh:function(){return yn().memoizedState=Cy.bind(null,tt)},useEffectEvent:function(e){var n=yn(),a={impl:e};return n.memoizedState=a,function(){if((xt&2)!==0)throw Error(s(440));return a.impl.apply(void 0,arguments)}}},xc={readContext:cn,use:ms,useCallback:Nf,useContext:cn,useEffect:hc,useImperativeHandle:Tf,useInsertionEffect:wf,useLayoutEffect:Cf,useMemo:Af,useReducer:ys,useRef:jf,useState:function(){return ys(Ba)},useDebugValue:pc,useDeferredValue:function(e,n){var a=Pt();return zf(a,_t.memoizedState,e,n)},useTransition:function(){var e=ys(Ba)[0],n=Pt().memoizedState;return[typeof e=="boolean"?e:so(e),n]},useSyncExternalStore:rf,useId:Df,useHostTransitionStatus:yc,useFormState:bf,useActionState:bf,useOptimistic:function(e,n){var a=Pt();return uf(a,_t,e,n)},useMemoCache:lc,useCacheRefresh:Bf};xc.useEffectEvent=_f;var qf={readContext:cn,use:ms,useCallback:Nf,useContext:cn,useEffect:hc,useImperativeHandle:Tf,useInsertionEffect:wf,useLayoutEffect:Cf,useMemo:Af,useReducer:dc,useRef:jf,useState:function(){return dc(Ba)},useDebugValue:pc,useDeferredValue:function(e,n){var a=Pt();return _t===null?gc(a,e,n):zf(a,_t.memoizedState,e,n)},useTransition:function(){var e=dc(Ba)[0],n=Pt().memoizedState;return[typeof e=="boolean"?e:so(e),n]},useSyncExternalStore:rf,useId:Df,useHostTransitionStatus:yc,useFormState:vf,useActionState:vf,useOptimistic:function(e,n){var a=Pt();return _t!==null?uf(a,_t,e,n):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:lc,useCacheRefresh:Bf};qf.useEffectEvent=_f;function vc(e,n,a,o){n=e.memoizedState,a=a(o,n),a=a==null?n:S({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var jc={enqueueSetState:function(e,n,a){e=e._reactInternals;var o=Un(),u=ni(o);u.payload=n,a!=null&&(u.callback=a),n=ai(e,u,o),n!==null&&(En(n,e,o),ao(n,e,o))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var o=Un(),u=ni(o);u.tag=1,u.payload=n,a!=null&&(u.callback=a),n=ai(e,u,o),n!==null&&(En(n,e,o),ao(n,e,o))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=Un(),o=ni(a);o.tag=2,n!=null&&(o.callback=n),n=ai(e,o,a),n!==null&&(En(n,e,a),ao(n,e,a))}};function $f(e,n,a,o,u,h,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,h,_):n.prototype&&n.prototype.isPureReactComponent?!Kr(a,o)||!Kr(u,h):!0}function Hf(e,n,a,o){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,o),n.state!==e&&jc.enqueueReplaceState(n,n.state,null)}function Li(e,n){var a=n;if("ref"in n){a={};for(var o in n)o!=="ref"&&(a[o]=n[o])}if(e=e.defaultProps){a===n&&(a=S({},a));for(var u in e)a[u]===void 0&&(a[u]=e[u])}return a}function Pf(e){Xo(e)}function Ff(e){console.error(e)}function Vf(e){Xo(e)}function js(e,n){try{var a=e.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(o){setTimeout(function(){throw o})}}function Wf(e,n,a){try{var o=e.onCaughtError;o(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Sc(e,n,a){return a=ni(a),a.tag=3,a.payload={element:null},a.callback=function(){js(e,n)},a}function Gf(e){return e=ni(e),e.tag=3,e}function Yf(e,n,a,o){var u=a.type.getDerivedStateFromError;if(typeof u=="function"){var h=o.value;e.payload=function(){return u(h)},e.callback=function(){Wf(n,a,o)}}var _=a.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(e.callback=function(){Wf(n,a,o),typeof u!="function"&&(ci===null?ci=new Set([this]):ci.add(this));var D=o.stack;this.componentDidCatch(o.value,{componentStack:D!==null?D:""})})}function Ty(e,n,a,o,u){if(a.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(n=a.alternate,n!==null&&ar(n,a,u,!0),a=Rn.current,a!==null){switch(a.tag){case 31:case 13:return Yn===null?Os():a.alternate===null&&Mt===0&&(Mt=3),a.flags&=-257,a.flags|=65536,a.lanes=u,o===ls?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([o]):n.add(o),Gc(e,o,u)),!1;case 22:return a.flags|=65536,o===ls?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([o])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([o]):a.add(o)),Gc(e,o,u)),!1}throw Error(s(435,a.tag))}return Gc(e,o,u),Os(),!1}if(pt)return n=Rn.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=u,o!==$l&&(e=Error(s(422),{cause:o}),Xr(Fn(e,a)))):(o!==$l&&(n=Error(s(423),{cause:o}),Xr(Fn(n,a))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,o=Fn(o,a),u=Sc(e.stateNode,o,u),Xl(e,u),Mt!==4&&(Mt=2)),!1;var h=Error(s(520),{cause:o});if(h=Fn(h,a),bo===null?bo=[h]:bo.push(h),Mt!==4&&(Mt=2),n===null)return!0;o=Fn(o,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,e=u&-u,a.lanes|=e,e=Sc(a.stateNode,o,e),Xl(a,e),!1;case 1:if(n=a.type,h=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(ci===null||!ci.has(h))))return a.flags|=65536,u&=-u,a.lanes|=u,u=Gf(u),Yf(u,e,a,o),Xl(a,u),!1}a=a.return}while(a!==null);return!1}var _c=Error(s(461)),Kt=!1;function dn(e,n,a,o){n.child=e===null?Qu(n,null,a,o):Bi(n,e.child,a,o)}function Kf(e,n,a,o,u){a=a.render;var h=n.ref;if("ref"in o){var _={};for(var D in o)D!=="ref"&&(_[D]=o[D])}else _=o;return ki(n),o=ic(e,n,a,_,h,u),D=rc(),e!==null&&!Kt?(oc(e,n,u),Ua(e,n,u)):(pt&&D&&Ml(n),n.flags|=1,dn(e,n,o,u),n.child)}function Jf(e,n,a,o,u){if(e===null){var h=a.type;return typeof h=="function"&&!Ul(h)&&h.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=h,Qf(e,n,h,o,u)):(e=ns(a.type,null,o,n,n.mode,u),e.ref=n.ref,e.return=n,n.child=e)}if(h=e.child,!kc(e,u)){var _=h.memoizedProps;if(a=a.compare,a=a!==null?a:Kr,a(_,o)&&e.ref===n.ref)return Ua(e,n,u)}return n.flags|=1,e=za(h,o),e.ref=n.ref,e.return=n,n.child=e}function Qf(e,n,a,o,u){if(e!==null){var h=e.memoizedProps;if(Kr(h,o)&&e.ref===n.ref)if(Kt=!1,n.pendingProps=o=h,kc(e,u))(e.flags&131072)!==0&&(Kt=!0);else return n.lanes=e.lanes,Ua(e,n,u)}return wc(e,n,a,o,u)}function Xf(e,n,a,o){var u=o.children,h=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.mode==="hidden"){if((n.flags&128)!==0){if(h=h!==null?h.baseLanes|a:a,e!==null){for(o=n.child=e.child,u=0;o!==null;)u=u|o.lanes|o.childLanes,o=o.sibling;o=u&~h}else o=0,n.child=null;return Zf(e,n,h,a,o)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&os(n,h!==null?h.cachePool:null),h!==null?ef(n,h):ec(),tf(n);else return o=n.lanes=536870912,Zf(e,n,h!==null?h.baseLanes|a:a,a,o)}else h!==null?(os(n,h.cachePool),ef(n,h),ri(),n.memoizedState=null):(e!==null&&os(n,null),ec(),ri());return dn(e,n,u,a),n.child}function uo(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Zf(e,n,a,o,u){var h=Yl();return h=h===null?null:{parent:Gt._currentValue,pool:h},n.memoizedState={baseLanes:a,cachePool:h},e!==null&&os(n,null),ec(),tf(n),e!==null&&ar(e,n,o,!0),n.childLanes=u,null}function Ss(e,n){return n=ws({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function eh(e,n,a){return Bi(n,e.child,null,a),e=Ss(n,n.pendingProps),e.flags|=2,On(n),n.memoizedState=null,e}function Ny(e,n,a){var o=n.pendingProps,u=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(pt){if(o.mode==="hidden")return e=Ss(n,o),n.lanes=536870912,uo(null,e);if(nc(n),(e=At)?(e=fp(e,Gn),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:Qa!==null?{id:xa,overflow:va}:null,retryLane:536870912,hydrationErrors:null},a=Uu(e),a.return=n,n.child=a,ln=n,At=null)):e=null,e===null)throw Za(n);return n.lanes=536870912,null}return Ss(n,o)}var h=e.memoizedState;if(h!==null){var _=h.dehydrated;if(nc(n),u)if(n.flags&256)n.flags&=-257,n=eh(e,n,a);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(s(558));else if(Kt||ar(e,n,a,!1),u=(a&e.childLanes)!==0,Kt||u){if(o=Et,o!==null&&(_=Ho(o,a),_!==0&&_!==h.retryLane))throw h.retryLane=_,Ti(e,_),En(o,e,_),_c;Os(),n=eh(e,n,a)}else e=h.treeContext,At=Kn(_.nextSibling),ln=n,pt=!0,Xa=null,Gn=!1,e!==null&&Mu(n,e),n=Ss(n,o),n.flags|=4096;return n}return e=za(e.child,{mode:o.mode,children:o.children}),e.ref=n.ref,n.child=e,e.return=n,e}function _s(e,n){var a=n.ref;if(a===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(s(284));(e===null||e.ref!==a)&&(n.flags|=4194816)}}function wc(e,n,a,o,u){return ki(n),a=ic(e,n,a,o,void 0,u),o=rc(),e!==null&&!Kt?(oc(e,n,u),Ua(e,n,u)):(pt&&o&&Ml(n),n.flags|=1,dn(e,n,a,u),n.child)}function th(e,n,a,o,u,h){return ki(n),n.updateQueue=null,a=af(n,o,a,u),nf(e),o=rc(),e!==null&&!Kt?(oc(e,n,h),Ua(e,n,h)):(pt&&o&&Ml(n),n.flags|=1,dn(e,n,a,h),n.child)}function nh(e,n,a,o,u){if(ki(n),n.stateNode===null){var h=Zi,_=a.contextType;typeof _=="object"&&_!==null&&(h=cn(_)),h=new a(o,h),n.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=jc,n.stateNode=h,h._reactInternals=n,h=n.stateNode,h.props=o,h.state=n.memoizedState,h.refs={},Jl(n),_=a.contextType,h.context=typeof _=="object"&&_!==null?cn(_):Zi,h.state=n.memoizedState,_=a.getDerivedStateFromProps,typeof _=="function"&&(vc(n,a,_,o),h.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(_=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),_!==h.state&&jc.enqueueReplaceState(h,h.state,null),ro(n,o,h,u),io(),h.state=n.memoizedState),typeof h.componentDidMount=="function"&&(n.flags|=4194308),o=!0}else if(e===null){h=n.stateNode;var D=n.memoizedProps,W=Li(a,D);h.props=W;var ce=h.context,je=a.contextType;_=Zi,typeof je=="object"&&je!==null&&(_=cn(je));var Ee=a.getDerivedStateFromProps;je=typeof Ee=="function"||typeof h.getSnapshotBeforeUpdate=="function",D=n.pendingProps!==D,je||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(D||ce!==_)&&Hf(n,h,o,_),ti=!1;var fe=n.memoizedState;h.state=fe,ro(n,o,h,u),io(),ce=n.memoizedState,D||fe!==ce||ti?(typeof Ee=="function"&&(vc(n,a,Ee,o),ce=n.memoizedState),(W=ti||$f(n,a,W,o,fe,ce,_))?(je||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(n.flags|=4194308)):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=ce),h.props=o,h.state=ce,h.context=_,o=W):(typeof h.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{h=n.stateNode,Ql(e,n),_=n.memoizedProps,je=Li(a,_),h.props=je,Ee=n.pendingProps,fe=h.context,ce=a.contextType,W=Zi,typeof ce=="object"&&ce!==null&&(W=cn(ce)),D=a.getDerivedStateFromProps,(ce=typeof D=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(_!==Ee||fe!==W)&&Hf(n,h,o,W),ti=!1,fe=n.memoizedState,h.state=fe,ro(n,o,h,u),io();var ye=n.memoizedState;_!==Ee||fe!==ye||ti||e!==null&&e.dependencies!==null&&is(e.dependencies)?(typeof D=="function"&&(vc(n,a,D,o),ye=n.memoizedState),(je=ti||$f(n,a,je,o,fe,ye,W)||e!==null&&e.dependencies!==null&&is(e.dependencies))?(ce||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(o,ye,W),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(o,ye,W)),typeof h.componentDidUpdate=="function"&&(n.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof h.componentDidUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=ye),h.props=o,h.state=ye,h.context=W,o=je):(typeof h.componentDidUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(n.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||_===e.memoizedProps&&fe===e.memoizedState||(n.flags|=1024),o=!1)}return h=o,_s(e,n),o=(n.flags&128)!==0,h||o?(h=n.stateNode,a=o&&typeof a.getDerivedStateFromError!="function"?null:h.render(),n.flags|=1,e!==null&&o?(n.child=Bi(n,e.child,null,u),n.child=Bi(n,null,a,u)):dn(e,n,a,u),n.memoizedState=h.state,e=n.child):e=Ua(e,n,u),e}function ah(e,n,a,o){return Ai(),n.flags|=256,dn(e,n,a,o),n.child}var Cc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ec(e){return{baseLanes:e,cachePool:Vu()}}function Tc(e,n,a){return e=e!==null?e.childLanes&~a:0,n&&(e|=Bn),e}function ih(e,n,a){var o=n.pendingProps,u=!1,h=(n.flags&128)!==0,_;if((_=h)||(_=e!==null&&e.memoizedState===null?!1:(Ht.current&2)!==0),_&&(u=!0,n.flags&=-129),_=(n.flags&32)!==0,n.flags&=-33,e===null){if(pt){if(u?ii(n):ri(),(e=At)?(e=fp(e,Gn),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:Qa!==null?{id:xa,overflow:va}:null,retryLane:536870912,hydrationErrors:null},a=Uu(e),a.return=n,n.child=a,ln=n,At=null)):e=null,e===null)throw Za(n);return cd(e)?n.lanes=32:n.lanes=536870912,null}var D=o.children;return o=o.fallback,u?(ri(),u=n.mode,D=ws({mode:"hidden",children:D},u),o=Ni(o,u,a,null),D.return=n,o.return=n,D.sibling=o,n.child=D,o=n.child,o.memoizedState=Ec(a),o.childLanes=Tc(e,_,a),n.memoizedState=Cc,uo(null,o)):(ii(n),Nc(n,D))}var W=e.memoizedState;if(W!==null&&(D=W.dehydrated,D!==null)){if(h)n.flags&256?(ii(n),n.flags&=-257,n=Ac(e,n,a)):n.memoizedState!==null?(ri(),n.child=e.child,n.flags|=128,n=null):(ri(),D=o.fallback,u=n.mode,o=ws({mode:"visible",children:o.children},u),D=Ni(D,u,a,null),D.flags|=2,o.return=n,D.return=n,o.sibling=D,n.child=o,Bi(n,e.child,null,a),o=n.child,o.memoizedState=Ec(a),o.childLanes=Tc(e,_,a),n.memoizedState=Cc,n=uo(null,o));else if(ii(n),cd(D)){if(_=D.nextSibling&&D.nextSibling.dataset,_)var ce=_.dgst;_=ce,o=Error(s(419)),o.stack="",o.digest=_,Xr({value:o,source:null,stack:null}),n=Ac(e,n,a)}else if(Kt||ar(e,n,a,!1),_=(a&e.childLanes)!==0,Kt||_){if(_=Et,_!==null&&(o=Ho(_,a),o!==0&&o!==W.retryLane))throw W.retryLane=o,Ti(e,o),En(_,e,o),_c;ld(D)||Os(),n=Ac(e,n,a)}else ld(D)?(n.flags|=192,n.child=e.child,n=null):(e=W.treeContext,At=Kn(D.nextSibling),ln=n,pt=!0,Xa=null,Gn=!1,e!==null&&Mu(n,e),n=Nc(n,o.children),n.flags|=4096);return n}return u?(ri(),D=o.fallback,u=n.mode,W=e.child,ce=W.sibling,o=za(W,{mode:"hidden",children:o.children}),o.subtreeFlags=W.subtreeFlags&65011712,ce!==null?D=za(ce,D):(D=Ni(D,u,a,null),D.flags|=2),D.return=n,o.return=n,o.sibling=D,n.child=o,uo(null,o),o=n.child,D=e.child.memoizedState,D===null?D=Ec(a):(u=D.cachePool,u!==null?(W=Gt._currentValue,u=u.parent!==W?{parent:W,pool:W}:u):u=Vu(),D={baseLanes:D.baseLanes|a,cachePool:u}),o.memoizedState=D,o.childLanes=Tc(e,_,a),n.memoizedState=Cc,uo(e.child,o)):(ii(n),a=e.child,e=a.sibling,a=za(a,{mode:"visible",children:o.children}),a.return=n,a.sibling=null,e!==null&&(_=n.deletions,_===null?(n.deletions=[e],n.flags|=16):_.push(e)),n.child=a,n.memoizedState=null,a)}function Nc(e,n){return n=ws({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function ws(e,n){return e=kn(22,e,null,n),e.lanes=0,e}function Ac(e,n,a){return Bi(n,e.child,null,a),e=Nc(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function rh(e,n,a){e.lanes|=n;var o=e.alternate;o!==null&&(o.lanes|=n),Fl(e.return,n,a)}function zc(e,n,a,o,u,h){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:u,treeForkCount:h}:(_.isBackwards=n,_.rendering=null,_.renderingStartTime=0,_.last=o,_.tail=a,_.tailMode=u,_.treeForkCount=h)}function oh(e,n,a){var o=n.pendingProps,u=o.revealOrder,h=o.tail;o=o.children;var _=Ht.current,D=(_&2)!==0;if(D?(_=_&1|2,n.flags|=128):_&=1,H(Ht,_),dn(e,n,o,a),o=pt?Qr:0,!D&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&rh(e,a,n);else if(e.tag===19)rh(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(u){case"forwards":for(a=n.child,u=null;a!==null;)e=a.alternate,e!==null&&fs(e)===null&&(u=a),a=a.sibling;a=u,a===null?(u=n.child,n.child=null):(u=a.sibling,a.sibling=null),zc(n,!1,u,a,h,o);break;case"backwards":case"unstable_legacy-backwards":for(a=null,u=n.child,n.child=null;u!==null;){if(e=u.alternate,e!==null&&fs(e)===null){n.child=u;break}e=u.sibling,u.sibling=a,a=u,u=e}zc(n,!0,a,null,h,o);break;case"together":zc(n,!1,null,null,void 0,o);break;default:n.memoizedState=null}return n.child}function Ua(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),li|=n.lanes,(a&n.childLanes)===0)if(e!==null){if(ar(e,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(s(153));if(n.child!==null){for(e=n.child,a=za(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=za(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function kc(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&is(e)))}function Ay(e,n,a){switch(n.tag){case 3:Se(n,n.stateNode.containerInfo),ei(n,Gt,e.memoizedState.cache),Ai();break;case 27:case 5:ae(n);break;case 4:Se(n,n.stateNode.containerInfo);break;case 10:ei(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,nc(n),null;break;case 13:var o=n.memoizedState;if(o!==null)return o.dehydrated!==null?(ii(n),n.flags|=128,null):(a&n.child.childLanes)!==0?ih(e,n,a):(ii(n),e=Ua(e,n,a),e!==null?e.sibling:null);ii(n);break;case 19:var u=(e.flags&128)!==0;if(o=(a&n.childLanes)!==0,o||(ar(e,n,a,!1),o=(a&n.childLanes)!==0),u){if(o)return oh(e,n,a);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),H(Ht,Ht.current),o)break;return null;case 22:return n.lanes=0,Xf(e,n,a,n.pendingProps);case 24:ei(n,Gt,e.memoizedState.cache)}return Ua(e,n,a)}function sh(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps)Kt=!0;else{if(!kc(e,a)&&(n.flags&128)===0)return Kt=!1,Ay(e,n,a);Kt=(e.flags&131072)!==0}else Kt=!1,pt&&(n.flags&1048576)!==0&&Iu(n,Qr,n.index);switch(n.lanes=0,n.tag){case 16:e:{var o=n.pendingProps;if(e=Oi(n.elementType),n.type=e,typeof e=="function")Ul(e)?(o=Li(e,o),n.tag=1,n=nh(null,n,e,o,a)):(n.tag=0,n=wc(null,n,e,o,a));else{if(e!=null){var u=e.$$typeof;if(u===z){n.tag=11,n=Kf(null,n,e,o,a);break e}else if(u===I){n.tag=14,n=Jf(null,n,e,o,a);break e}}throw n=B(e)||e,Error(s(306,n,""))}}return n;case 0:return wc(e,n,n.type,n.pendingProps,a);case 1:return o=n.type,u=Li(o,n.pendingProps),nh(e,n,o,u,a);case 3:e:{if(Se(n,n.stateNode.containerInfo),e===null)throw Error(s(387));o=n.pendingProps;var h=n.memoizedState;u=h.element,Ql(e,n),ro(n,o,null,a);var _=n.memoizedState;if(o=_.cache,ei(n,Gt,o),o!==h.cache&&Vl(n,[Gt],a,!0),io(),o=_.element,h.isDehydrated)if(h={element:o,isDehydrated:!1,cache:_.cache},n.updateQueue.baseState=h,n.memoizedState=h,n.flags&256){n=ah(e,n,o,a);break e}else if(o!==u){u=Fn(Error(s(424)),n),Xr(u),n=ah(e,n,o,a);break e}else{switch(e=n.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(At=Kn(e.firstChild),ln=n,pt=!0,Xa=null,Gn=!0,a=Qu(n,null,o,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(Ai(),o===u){n=Ua(e,n,a);break e}dn(e,n,o,a)}n=n.child}return n;case 26:return _s(e,n),e===null?(a=bp(n.type,null,n.pendingProps,null))?n.memoizedState=a:pt||(a=n.type,e=n.pendingProps,o=qs(oe.current).createElement(a),o[Ft]=n,o[hn]=e,un(o,a,e),Vt(o),n.stateNode=o):n.memoizedState=bp(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return ae(n),e===null&&pt&&(o=n.stateNode=gp(n.type,n.pendingProps,oe.current),ln=n,Gn=!0,u=At,hi(n.type)?(dd=u,At=Kn(o.firstChild)):At=u),dn(e,n,n.pendingProps.children,a),_s(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&pt&&((u=o=At)&&(o=rb(o,n.type,n.pendingProps,Gn),o!==null?(n.stateNode=o,ln=n,At=Kn(o.firstChild),Gn=!1,u=!0):u=!1),u||Za(n)),ae(n),u=n.type,h=n.pendingProps,_=e!==null?e.memoizedProps:null,o=h.children,rd(u,h)?o=null:_!==null&&rd(u,_)&&(n.flags|=32),n.memoizedState!==null&&(u=ic(e,n,vy,null,null,a),Eo._currentValue=u),_s(e,n),dn(e,n,o,a),n.child;case 6:return e===null&&pt&&((e=a=At)&&(a=ob(a,n.pendingProps,Gn),a!==null?(n.stateNode=a,ln=n,At=null,e=!0):e=!1),e||Za(n)),null;case 13:return ih(e,n,a);case 4:return Se(n,n.stateNode.containerInfo),o=n.pendingProps,e===null?n.child=Bi(n,null,o,a):dn(e,n,o,a),n.child;case 11:return Kf(e,n,n.type,n.pendingProps,a);case 7:return dn(e,n,n.pendingProps,a),n.child;case 8:return dn(e,n,n.pendingProps.children,a),n.child;case 12:return dn(e,n,n.pendingProps.children,a),n.child;case 10:return o=n.pendingProps,ei(n,n.type,o.value),dn(e,n,o.children,a),n.child;case 9:return u=n.type._context,o=n.pendingProps.children,ki(n),u=cn(u),o=o(u),n.flags|=1,dn(e,n,o,a),n.child;case 14:return Jf(e,n,n.type,n.pendingProps,a);case 15:return Qf(e,n,n.type,n.pendingProps,a);case 19:return oh(e,n,a);case 31:return Ny(e,n,a);case 22:return Xf(e,n,a,n.pendingProps);case 24:return ki(n),o=cn(Gt),e===null?(u=Yl(),u===null&&(u=Et,h=Wl(),u.pooledCache=h,h.refCount++,h!==null&&(u.pooledCacheLanes|=a),u=h),n.memoizedState={parent:o,cache:u},Jl(n),ei(n,Gt,u)):((e.lanes&a)!==0&&(Ql(e,n),ro(n,null,null,a),io()),u=e.memoizedState,h=n.memoizedState,u.parent!==o?(u={parent:o,cache:o},n.memoizedState=u,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=u),ei(n,Gt,o)):(o=h.cache,ei(n,Gt,o),o!==u.cache&&Vl(n,[Gt],a,!0))),dn(e,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function La(e){e.flags|=4}function Rc(e,n,a,o,u){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(u&335544128)===u)if(e.stateNode.complete)e.flags|=8192;else if(Dh())e.flags|=8192;else throw Di=ls,Kl}else e.flags&=-16777217}function lh(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!_p(n))if(Dh())e.flags|=8192;else throw Di=ls,Kl}function Cs(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?$o():536870912,e.lanes|=n,gr|=n)}function fo(e,n){if(!pt)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function zt(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(n)for(var u=e.child;u!==null;)a|=u.lanes|u.childLanes,o|=u.subtreeFlags&65011712,o|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)a|=u.lanes|u.childLanes,o|=u.subtreeFlags,o|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=o,e.childLanes=a,n}function zy(e,n,a){var o=n.pendingProps;switch(ql(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zt(n),null;case 1:return zt(n),null;case 3:return a=n.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Oa(Gt),J(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(nr(n)?La(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Hl())),zt(n),null;case 26:var u=n.type,h=n.memoizedState;return e===null?(La(n),h!==null?(zt(n),lh(n,h)):(zt(n),Rc(n,u,null,o,a))):h?h!==e.memoizedState?(La(n),zt(n),lh(n,h)):(zt(n),n.flags&=-16777217):(e=e.memoizedProps,e!==o&&La(n),zt(n),Rc(n,u,e,o,a)),null;case 27:if(V(n),a=oe.current,u=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==o&&La(n);else{if(!o){if(n.stateNode===null)throw Error(s(166));return zt(n),null}e=Z.current,nr(n)?qu(n):(e=gp(u,o,a),n.stateNode=e,La(n))}return zt(n),null;case 5:if(V(n),u=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==o&&La(n);else{if(!o){if(n.stateNode===null)throw Error(s(166));return zt(n),null}if(h=Z.current,nr(n))qu(n);else{var _=qs(oe.current);switch(h){case 1:h=_.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:h=_.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":h=_.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":h=_.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":h=_.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof o.is=="string"?_.createElement("select",{is:o.is}):_.createElement("select"),o.multiple?h.multiple=!0:o.size&&(h.size=o.size);break;default:h=typeof o.is=="string"?_.createElement(u,{is:o.is}):_.createElement(u)}}h[Ft]=n,h[hn]=o;e:for(_=n.child;_!==null;){if(_.tag===5||_.tag===6)h.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===n)break e;for(;_.sibling===null;){if(_.return===null||_.return===n)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}n.stateNode=h;e:switch(un(h,u,o),u){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&La(n)}}return zt(n),Rc(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,a),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==o&&La(n);else{if(typeof o!="string"&&n.stateNode===null)throw Error(s(166));if(e=oe.current,nr(n)){if(e=n.stateNode,a=n.memoizedProps,o=null,u=ln,u!==null)switch(u.tag){case 27:case 5:o=u.memoizedProps}e[Ft]=n,e=!!(e.nodeValue===a||o!==null&&o.suppressHydrationWarning===!0||ip(e.nodeValue,a)),e||Za(n,!0)}else e=qs(e).createTextNode(o),e[Ft]=n,n.stateNode=e}return zt(n),null;case 31:if(a=n.memoizedState,e===null||e.memoizedState!==null){if(o=nr(n),a!==null){if(e===null){if(!o)throw Error(s(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(557));e[Ft]=n}else Ai(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;zt(n),e=!1}else a=Hl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return n.flags&256?(On(n),n):(On(n),null);if((n.flags&128)!==0)throw Error(s(558))}return zt(n),null;case 13:if(o=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=nr(n),o!==null&&o.dehydrated!==null){if(e===null){if(!u)throw Error(s(318));if(u=n.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));u[Ft]=n}else Ai(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;zt(n),u=!1}else u=Hl(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return n.flags&256?(On(n),n):(On(n),null)}return On(n),(n.flags&128)!==0?(n.lanes=a,n):(a=o!==null,e=e!==null&&e.memoizedState!==null,a&&(o=n.child,u=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(u=o.alternate.memoizedState.cachePool.pool),h=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),h!==u&&(o.flags|=2048)),a!==e&&a&&(n.child.flags|=8192),Cs(n,n.updateQueue),zt(n),null);case 4:return J(),e===null&&ed(n.stateNode.containerInfo),zt(n),null;case 10:return Oa(n.type),zt(n),null;case 19:if($(Ht),o=n.memoizedState,o===null)return zt(n),null;if(u=(n.flags&128)!==0,h=o.rendering,h===null)if(u)fo(o,!1);else{if(Mt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(h=fs(e),h!==null){for(n.flags|=128,fo(o,!1),e=h.updateQueue,n.updateQueue=e,Cs(n,e),n.subtreeFlags=0,e=a,a=n.child;a!==null;)Bu(a,e),a=a.sibling;return H(Ht,Ht.current&1|2),pt&&ka(n,o.treeForkCount),n.child}e=e.sibling}o.tail!==null&&st()>zs&&(n.flags|=128,u=!0,fo(o,!1),n.lanes=4194304)}else{if(!u)if(e=fs(h),e!==null){if(n.flags|=128,u=!0,e=e.updateQueue,n.updateQueue=e,Cs(n,e),fo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!h.alternate&&!pt)return zt(n),null}else 2*st()-o.renderingStartTime>zs&&a!==536870912&&(n.flags|=128,u=!0,fo(o,!1),n.lanes=4194304);o.isBackwards?(h.sibling=n.child,n.child=h):(e=o.last,e!==null?e.sibling=h:n.child=h,o.last=h)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=st(),e.sibling=null,a=Ht.current,H(Ht,u?a&1|2:a&1),pt&&ka(n,o.treeForkCount),e):(zt(n),null);case 22:case 23:return On(n),tc(),o=n.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(n.flags|=8192):o&&(n.flags|=8192),o?(a&536870912)!==0&&(n.flags&128)===0&&(zt(n),n.subtreeFlags&6&&(n.flags|=8192)):zt(n),a=n.updateQueue,a!==null&&Cs(n,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),o=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),o!==a&&(n.flags|=2048),e!==null&&$(Ri),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),Oa(Gt),zt(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function ky(e,n){switch(ql(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return Oa(Gt),J(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return V(n),null;case 31:if(n.memoizedState!==null){if(On(n),n.alternate===null)throw Error(s(340));Ai()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(On(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(s(340));Ai()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return $(Ht),null;case 4:return J(),null;case 10:return Oa(n.type),null;case 22:case 23:return On(n),tc(),e!==null&&$(Ri),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return Oa(Gt),null;case 25:return null;default:return null}}function ch(e,n){switch(ql(n),n.tag){case 3:Oa(Gt),J();break;case 26:case 27:case 5:V(n);break;case 4:J();break;case 31:n.memoizedState!==null&&On(n);break;case 13:On(n);break;case 19:$(Ht);break;case 10:Oa(n.type);break;case 22:case 23:On(n),tc(),e!==null&&$(Ri);break;case 24:Oa(Gt)}}function ho(e,n){try{var a=n.updateQueue,o=a!==null?a.lastEffect:null;if(o!==null){var u=o.next;a=u;do{if((a.tag&e)===e){o=void 0;var h=a.create,_=a.inst;o=h(),_.destroy=o}a=a.next}while(a!==u)}}catch(D){St(n,n.return,D)}}function oi(e,n,a){try{var o=n.updateQueue,u=o!==null?o.lastEffect:null;if(u!==null){var h=u.next;o=h;do{if((o.tag&e)===e){var _=o.inst,D=_.destroy;if(D!==void 0){_.destroy=void 0,u=n;var W=a,ce=D;try{ce()}catch(je){St(u,W,je)}}}o=o.next}while(o!==h)}}catch(je){St(n,n.return,je)}}function dh(e){var n=e.updateQueue;if(n!==null){var a=e.stateNode;try{Zu(n,a)}catch(o){St(e,e.return,o)}}}function uh(e,n,a){a.props=Li(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(o){St(e,n,o)}}function po(e,n){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof a=="function"?e.refCleanup=a(o):a.current=o}}catch(u){St(e,n,u)}}function ja(e,n){var a=e.ref,o=e.refCleanup;if(a!==null)if(typeof o=="function")try{o()}catch(u){St(e,n,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(u){St(e,n,u)}else a.current=null}function fh(e){var n=e.type,a=e.memoizedProps,o=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&o.focus();break e;case"img":a.src?o.src=a.src:a.srcSet&&(o.srcset=a.srcSet)}}catch(u){St(e,e.return,u)}}function Oc(e,n,a){try{var o=e.stateNode;Zy(o,e.type,a,n),o[hn]=n}catch(u){St(e,e.return,u)}}function hh(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&hi(e.type)||e.tag===4}function Dc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||hh(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&hi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Bc(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,n):(n=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,n.appendChild(e),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=Wt));else if(o!==4&&(o===27&&hi(e.type)&&(a=e.stateNode,n=null),e=e.child,e!==null))for(Bc(e,n,a),e=e.sibling;e!==null;)Bc(e,n,a),e=e.sibling}function Es(e,n,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(o!==4&&(o===27&&hi(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Es(e,n,a),e=e.sibling;e!==null;)Es(e,n,a),e=e.sibling}function ph(e){var n=e.stateNode,a=e.memoizedProps;try{for(var o=e.type,u=n.attributes;u.length;)n.removeAttributeNode(u[0]);un(n,o,a),n[Ft]=e,n[hn]=a}catch(h){St(e,e.return,h)}}var Ia=!1,Jt=!1,Uc=!1,gh=typeof WeakSet=="function"?WeakSet:Set,an=null;function Ry(e,n){if(e=e.containerInfo,ad=Gs,e=Eu(e),Al(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var u=o.anchorOffset,h=o.focusNode;o=o.focusOffset;try{a.nodeType,h.nodeType}catch{a=null;break e}var _=0,D=-1,W=-1,ce=0,je=0,Ee=e,fe=null;t:for(;;){for(var ye;Ee!==a||u!==0&&Ee.nodeType!==3||(D=_+u),Ee!==h||o!==0&&Ee.nodeType!==3||(W=_+o),Ee.nodeType===3&&(_+=Ee.nodeValue.length),(ye=Ee.firstChild)!==null;)fe=Ee,Ee=ye;for(;;){if(Ee===e)break t;if(fe===a&&++ce===u&&(D=_),fe===h&&++je===o&&(W=_),(ye=Ee.nextSibling)!==null)break;Ee=fe,fe=Ee.parentNode}Ee=ye}a=D===-1||W===-1?null:{start:D,end:W}}else a=null}a=a||{start:0,end:0}}else a=null;for(id={focusedElem:e,selectionRange:a},Gs=!1,an=n;an!==null;)if(n=an,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,an=e;else for(;an!==null;){switch(n=an,h=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)u=e[a],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,a=n,u=h.memoizedProps,h=h.memoizedState,o=a.stateNode;try{var Me=Li(a.type,u);e=o.getSnapshotBeforeUpdate(Me,h),o.__reactInternalSnapshotBeforeUpdate=e}catch(Ye){St(a,a.return,Ye)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,a=e.nodeType,a===9)sd(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":sd(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(s(163))}if(e=n.sibling,e!==null){e.return=n.return,an=e;break}an=n.return}}function mh(e,n,a){var o=a.flags;switch(a.tag){case 0:case 11:case 15:qa(e,a),o&4&&ho(5,a);break;case 1:if(qa(e,a),o&4)if(e=a.stateNode,n===null)try{e.componentDidMount()}catch(_){St(a,a.return,_)}else{var u=Li(a.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(u,n,e.__reactInternalSnapshotBeforeUpdate)}catch(_){St(a,a.return,_)}}o&64&&dh(a),o&512&&po(a,a.return);break;case 3:if(qa(e,a),o&64&&(e=a.updateQueue,e!==null)){if(n=null,a.child!==null)switch(a.child.tag){case 27:case 5:n=a.child.stateNode;break;case 1:n=a.child.stateNode}try{Zu(e,n)}catch(_){St(a,a.return,_)}}break;case 27:n===null&&o&4&&ph(a);case 26:case 5:qa(e,a),n===null&&o&4&&fh(a),o&512&&po(a,a.return);break;case 12:qa(e,a);break;case 31:qa(e,a),o&4&&xh(e,a);break;case 13:qa(e,a),o&4&&vh(e,a),o&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=$y.bind(null,a),sb(e,a))));break;case 22:if(o=a.memoizedState!==null||Ia,!o){n=n!==null&&n.memoizedState!==null||Jt,u=Ia;var h=Jt;Ia=o,(Jt=n)&&!h?$a(e,a,(a.subtreeFlags&8772)!==0):qa(e,a),Ia=u,Jt=h}break;case 30:break;default:qa(e,a)}}function yh(e){var n=e.alternate;n!==null&&(e.alternate=null,yh(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&$r(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Dt=null,Sn=!1;function Ma(e,n,a){for(a=a.child;a!==null;)bh(e,n,a),a=a.sibling}function bh(e,n,a){if(et&&typeof et.onCommitFiberUnmount=="function")try{et.onCommitFiberUnmount(qe,a)}catch{}switch(a.tag){case 26:Jt||ja(a,n),Ma(e,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Jt||ja(a,n);var o=Dt,u=Sn;hi(a.type)&&(Dt=a.stateNode,Sn=!1),Ma(e,n,a),_o(a.stateNode),Dt=o,Sn=u;break;case 5:Jt||ja(a,n);case 6:if(o=Dt,u=Sn,Dt=null,Ma(e,n,a),Dt=o,Sn=u,Dt!==null)if(Sn)try{(Dt.nodeType===9?Dt.body:Dt.nodeName==="HTML"?Dt.ownerDocument.body:Dt).removeChild(a.stateNode)}catch(h){St(a,n,h)}else try{Dt.removeChild(a.stateNode)}catch(h){St(a,n,h)}break;case 18:Dt!==null&&(Sn?(e=Dt,dp(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),_r(e)):dp(Dt,a.stateNode));break;case 4:o=Dt,u=Sn,Dt=a.stateNode.containerInfo,Sn=!0,Ma(e,n,a),Dt=o,Sn=u;break;case 0:case 11:case 14:case 15:oi(2,a,n),Jt||oi(4,a,n),Ma(e,n,a);break;case 1:Jt||(ja(a,n),o=a.stateNode,typeof o.componentWillUnmount=="function"&&uh(a,n,o)),Ma(e,n,a);break;case 21:Ma(e,n,a);break;case 22:Jt=(o=Jt)||a.memoizedState!==null,Ma(e,n,a),Jt=o;break;default:Ma(e,n,a)}}function xh(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{_r(e)}catch(a){St(n,n.return,a)}}}function vh(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{_r(e)}catch(a){St(n,n.return,a)}}function Oy(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new gh),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new gh),n;default:throw Error(s(435,e.tag))}}function Ts(e,n){var a=Oy(e);n.forEach(function(o){if(!a.has(o)){a.add(o);var u=Hy.bind(null,e,o);o.then(u,u)}})}function _n(e,n){var a=n.deletions;if(a!==null)for(var o=0;o<a.length;o++){var u=a[o],h=e,_=n,D=_;e:for(;D!==null;){switch(D.tag){case 27:if(hi(D.type)){Dt=D.stateNode,Sn=!1;break e}break;case 5:Dt=D.stateNode,Sn=!1;break e;case 3:case 4:Dt=D.stateNode.containerInfo,Sn=!0;break e}D=D.return}if(Dt===null)throw Error(s(160));bh(h,_,u),Dt=null,Sn=!1,h=u.alternate,h!==null&&(h.return=null),u.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)jh(n,e),n=n.sibling}var sa=null;function jh(e,n){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:_n(n,e),wn(e),o&4&&(oi(3,e,e.return),ho(3,e),oi(5,e,e.return));break;case 1:_n(n,e),wn(e),o&512&&(Jt||a===null||ja(a,a.return)),o&64&&Ia&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?o:a.concat(o))));break;case 26:var u=sa;if(_n(n,e),wn(e),o&512&&(Jt||a===null||ja(a,a.return)),o&4){var h=a!==null?a.memoizedState:null;if(o=e.memoizedState,a===null)if(o===null)if(e.stateNode===null){e:{o=e.type,a=e.memoizedProps,u=u.ownerDocument||u;t:switch(o){case"title":h=u.getElementsByTagName("title")[0],(!h||h[Ea]||h[Ft]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=u.createElement(o),u.head.insertBefore(h,u.querySelector("head > title"))),un(h,o,a),h[Ft]=e,Vt(h),o=h;break e;case"link":var _=jp("link","href",u).get(o+(a.href||""));if(_){for(var D=0;D<_.length;D++)if(h=_[D],h.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&h.getAttribute("rel")===(a.rel==null?null:a.rel)&&h.getAttribute("title")===(a.title==null?null:a.title)&&h.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){_.splice(D,1);break t}}h=u.createElement(o),un(h,o,a),u.head.appendChild(h);break;case"meta":if(_=jp("meta","content",u).get(o+(a.content||""))){for(D=0;D<_.length;D++)if(h=_[D],h.getAttribute("content")===(a.content==null?null:""+a.content)&&h.getAttribute("name")===(a.name==null?null:a.name)&&h.getAttribute("property")===(a.property==null?null:a.property)&&h.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&h.getAttribute("charset")===(a.charSet==null?null:a.charSet)){_.splice(D,1);break t}}h=u.createElement(o),un(h,o,a),u.head.appendChild(h);break;default:throw Error(s(468,o))}h[Ft]=e,Vt(h),o=h}e.stateNode=o}else Sp(u,e.type,e.stateNode);else e.stateNode=vp(u,o,e.memoizedProps);else h!==o?(h===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):h.count--,o===null?Sp(u,e.type,e.stateNode):vp(u,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Oc(e,e.memoizedProps,a.memoizedProps)}break;case 27:_n(n,e),wn(e),o&512&&(Jt||a===null||ja(a,a.return)),a!==null&&o&4&&Oc(e,e.memoizedProps,a.memoizedProps);break;case 5:if(_n(n,e),wn(e),o&512&&(Jt||a===null||ja(a,a.return)),e.flags&32){u=e.stateNode;try{Ie(u,"")}catch(Me){St(e,e.return,Me)}}o&4&&e.stateNode!=null&&(u=e.memoizedProps,Oc(e,u,a!==null?a.memoizedProps:u)),o&1024&&(Uc=!0);break;case 6:if(_n(n,e),wn(e),o&4){if(e.stateNode===null)throw Error(s(162));o=e.memoizedProps,a=e.stateNode;try{a.nodeValue=o}catch(Me){St(e,e.return,Me)}}break;case 3:if(Ps=null,u=sa,sa=$s(n.containerInfo),_n(n,e),sa=u,wn(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{_r(n.containerInfo)}catch(Me){St(e,e.return,Me)}Uc&&(Uc=!1,Sh(e));break;case 4:o=sa,sa=$s(e.stateNode.containerInfo),_n(n,e),wn(e),sa=o;break;case 12:_n(n,e),wn(e);break;case 31:_n(n,e),wn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Ts(e,o)));break;case 13:_n(n,e),wn(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(As=st()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Ts(e,o)));break;case 22:u=e.memoizedState!==null;var W=a!==null&&a.memoizedState!==null,ce=Ia,je=Jt;if(Ia=ce||u,Jt=je||W,_n(n,e),Jt=je,Ia=ce,wn(e),o&8192)e:for(n=e.stateNode,n._visibility=u?n._visibility&-2:n._visibility|1,u&&(a===null||W||Ia||Jt||Ii(e)),a=null,n=e;;){if(n.tag===5||n.tag===26){if(a===null){W=a=n;try{if(h=W.stateNode,u)_=h.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{D=W.stateNode;var Ee=W.memoizedProps.style,fe=Ee!=null&&Ee.hasOwnProperty("display")?Ee.display:null;D.style.display=fe==null||typeof fe=="boolean"?"":(""+fe).trim()}}catch(Me){St(W,W.return,Me)}}}else if(n.tag===6){if(a===null){W=n;try{W.stateNode.nodeValue=u?"":W.memoizedProps}catch(Me){St(W,W.return,Me)}}}else if(n.tag===18){if(a===null){W=n;try{var ye=W.stateNode;u?up(ye,!0):up(W.stateNode,!1)}catch(Me){St(W,W.return,Me)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}o&4&&(o=e.updateQueue,o!==null&&(a=o.retryQueue,a!==null&&(o.retryQueue=null,Ts(e,a))));break;case 19:_n(n,e),wn(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,Ts(e,o)));break;case 30:break;case 21:break;default:_n(n,e),wn(e)}}function wn(e){var n=e.flags;if(n&2){try{for(var a,o=e.return;o!==null;){if(hh(o)){a=o;break}o=o.return}if(a==null)throw Error(s(160));switch(a.tag){case 27:var u=a.stateNode,h=Dc(e);Es(e,h,u);break;case 5:var _=a.stateNode;a.flags&32&&(Ie(_,""),a.flags&=-33);var D=Dc(e);Es(e,D,_);break;case 3:case 4:var W=a.stateNode.containerInfo,ce=Dc(e);Bc(e,ce,W);break;default:throw Error(s(161))}}catch(je){St(e,e.return,je)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function Sh(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;Sh(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function qa(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)mh(e,n.alternate,n),n=n.sibling}function Ii(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:oi(4,n,n.return),Ii(n);break;case 1:ja(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&uh(n,n.return,a),Ii(n);break;case 27:_o(n.stateNode);case 26:case 5:ja(n,n.return),Ii(n);break;case 22:n.memoizedState===null&&Ii(n);break;case 30:Ii(n);break;default:Ii(n)}e=e.sibling}}function $a(e,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var o=n.alternate,u=e,h=n,_=h.flags;switch(h.tag){case 0:case 11:case 15:$a(u,h,a),ho(4,h);break;case 1:if($a(u,h,a),o=h,u=o.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(ce){St(o,o.return,ce)}if(o=h,u=o.updateQueue,u!==null){var D=o.stateNode;try{var W=u.shared.hiddenCallbacks;if(W!==null)for(u.shared.hiddenCallbacks=null,u=0;u<W.length;u++)Xu(W[u],D)}catch(ce){St(o,o.return,ce)}}a&&_&64&&dh(h),po(h,h.return);break;case 27:ph(h);case 26:case 5:$a(u,h,a),a&&o===null&&_&4&&fh(h),po(h,h.return);break;case 12:$a(u,h,a);break;case 31:$a(u,h,a),a&&_&4&&xh(u,h);break;case 13:$a(u,h,a),a&&_&4&&vh(u,h);break;case 22:h.memoizedState===null&&$a(u,h,a),po(h,h.return);break;case 30:break;default:$a(u,h,a)}n=n.sibling}}function Lc(e,n){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Zr(a))}function Ic(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Zr(e))}function la(e,n,a,o){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)_h(e,n,a,o),n=n.sibling}function _h(e,n,a,o){var u=n.flags;switch(n.tag){case 0:case 11:case 15:la(e,n,a,o),u&2048&&ho(9,n);break;case 1:la(e,n,a,o);break;case 3:la(e,n,a,o),u&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Zr(e)));break;case 12:if(u&2048){la(e,n,a,o),e=n.stateNode;try{var h=n.memoizedProps,_=h.id,D=h.onPostCommit;typeof D=="function"&&D(_,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(W){St(n,n.return,W)}}else la(e,n,a,o);break;case 31:la(e,n,a,o);break;case 13:la(e,n,a,o);break;case 23:break;case 22:h=n.stateNode,_=n.alternate,n.memoizedState!==null?h._visibility&2?la(e,n,a,o):go(e,n):h._visibility&2?la(e,n,a,o):(h._visibility|=2,fr(e,n,a,o,(n.subtreeFlags&10256)!==0||!1)),u&2048&&Lc(_,n);break;case 24:la(e,n,a,o),u&2048&&Ic(n.alternate,n);break;default:la(e,n,a,o)}}function fr(e,n,a,o,u){for(u=u&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var h=e,_=n,D=a,W=o,ce=_.flags;switch(_.tag){case 0:case 11:case 15:fr(h,_,D,W,u),ho(8,_);break;case 23:break;case 22:var je=_.stateNode;_.memoizedState!==null?je._visibility&2?fr(h,_,D,W,u):go(h,_):(je._visibility|=2,fr(h,_,D,W,u)),u&&ce&2048&&Lc(_.alternate,_);break;case 24:fr(h,_,D,W,u),u&&ce&2048&&Ic(_.alternate,_);break;default:fr(h,_,D,W,u)}n=n.sibling}}function go(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=e,o=n,u=o.flags;switch(o.tag){case 22:go(a,o),u&2048&&Lc(o.alternate,o);break;case 24:go(a,o),u&2048&&Ic(o.alternate,o);break;default:go(a,o)}n=n.sibling}}var mo=8192;function hr(e,n,a){if(e.subtreeFlags&mo)for(e=e.child;e!==null;)wh(e,n,a),e=e.sibling}function wh(e,n,a){switch(e.tag){case 26:hr(e,n,a),e.flags&mo&&e.memoizedState!==null&&xb(a,sa,e.memoizedState,e.memoizedProps);break;case 5:hr(e,n,a);break;case 3:case 4:var o=sa;sa=$s(e.stateNode.containerInfo),hr(e,n,a),sa=o;break;case 22:e.memoizedState===null&&(o=e.alternate,o!==null&&o.memoizedState!==null?(o=mo,mo=16777216,hr(e,n,a),mo=o):hr(e,n,a));break;default:hr(e,n,a)}}function Ch(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function yo(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var o=n[a];an=o,Th(o,e)}Ch(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Eh(e),e=e.sibling}function Eh(e){switch(e.tag){case 0:case 11:case 15:yo(e),e.flags&2048&&oi(9,e,e.return);break;case 3:yo(e);break;case 12:yo(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,Ns(e)):yo(e);break;default:yo(e)}}function Ns(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var o=n[a];an=o,Th(o,e)}Ch(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:oi(8,n,n.return),Ns(n);break;case 22:a=n.stateNode,a._visibility&2&&(a._visibility&=-3,Ns(n));break;default:Ns(n)}e=e.sibling}}function Th(e,n){for(;an!==null;){var a=an;switch(a.tag){case 0:case 11:case 15:oi(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var o=a.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:Zr(a.memoizedState.cache)}if(o=a.child,o!==null)o.return=a,an=o;else e:for(a=e;an!==null;){o=an;var u=o.sibling,h=o.return;if(yh(o),o===a){an=null;break e}if(u!==null){u.return=h,an=u;break e}an=h}}}var Dy={getCacheForType:function(e){var n=cn(Gt),a=n.data.get(e);return a===void 0&&(a=e(),n.data.set(e,a)),a},cacheSignal:function(){return cn(Gt).controller.signal}},By=typeof WeakMap=="function"?WeakMap:Map,xt=0,Et=null,rt=null,ct=0,jt=0,Dn=null,si=!1,pr=!1,Mc=!1,Ha=0,Mt=0,li=0,Mi=0,qc=0,Bn=0,gr=0,bo=null,Cn=null,$c=!1,As=0,Nh=0,zs=1/0,ks=null,ci=null,Zt=0,di=null,mr=null,Pa=0,Hc=0,Pc=null,Ah=null,xo=0,Fc=null;function Un(){return(xt&2)!==0&&ct!==0?ct&-ct:N.T!==null?Jc():Po()}function zh(){if(Bn===0)if((ct&536870912)===0||pt){var e=on;on<<=1,(on&3932160)===0&&(on=262144),Bn=e}else Bn=536870912;return e=Rn.current,e!==null&&(e.flags|=32),Bn}function En(e,n,a){(e===Et&&(jt===2||jt===9)||e.cancelPendingCommit!==null)&&(yr(e,0),ui(e,ct,Bn,!1)),Si(e,a),((xt&2)===0||e!==Et)&&(e===Et&&((xt&2)===0&&(Mi|=a),Mt===4&&ui(e,ct,Bn,!1)),Sa(e))}function kh(e,n,a){if((xt&6)!==0)throw Error(s(327));var o=!a&&(n&127)===0&&(n&e.expiredLanes)===0||ea(e,n),u=o?Iy(e,n):Wc(e,n,!0),h=o;do{if(u===0){pr&&!o&&ui(e,n,0,!1);break}else{if(a=e.current.alternate,h&&!Uy(a)){u=Wc(e,n,!1),h=!1;continue}if(u===2){if(h=n,e.errorRecoveryDisabledLanes&h)var _=0;else _=e.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){n=_;e:{var D=e;u=bo;var W=D.current.memoizedState.isDehydrated;if(W&&(yr(D,_).flags|=256),_=Wc(D,_,!1),_!==2){if(Mc&&!W){D.errorRecoveryDisabledLanes|=h,Mi|=h,u=4;break e}h=Cn,Cn=u,h!==null&&(Cn===null?Cn=h:Cn.push.apply(Cn,h))}u=_}if(h=!1,u!==2)continue}}if(u===1){yr(e,0),ui(e,n,0,!0);break}e:{switch(o=e,h=u,h){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:ui(o,n,Bn,!si);break e;case 2:Cn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(u=As+300-st(),10<u)){if(ui(o,n,Bn,!si),fa(o,0,!0)!==0)break e;Pa=n,o.timeoutHandle=lp(Rh.bind(null,o,a,Cn,ks,$c,n,Bn,Mi,gr,si,h,"Throttled",-0,0),u);break e}Rh(o,a,Cn,ks,$c,n,Bn,Mi,gr,si,h,null,-0,0)}}break}while(!0);Sa(e)}function Rh(e,n,a,o,u,h,_,D,W,ce,je,Ee,fe,ye){if(e.timeoutHandle=-1,Ee=n.subtreeFlags,Ee&8192||(Ee&16785408)===16785408){Ee={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Wt},wh(n,h,Ee);var Me=(h&62914560)===h?As-st():(h&4194048)===h?Nh-st():0;if(Me=vb(Ee,Me),Me!==null){Pa=h,e.cancelPendingCommit=Me(qh.bind(null,e,n,h,a,o,u,_,D,W,je,Ee,null,fe,ye)),ui(e,h,_,!ce);return}}qh(e,n,h,a,o,u,_,D,W)}function Uy(e){for(var n=e;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var o=0;o<a.length;o++){var u=a[o],h=u.getSnapshot;u=u.value;try{if(!zn(h(),u))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function ui(e,n,a,o){n&=~qc,n&=~Mi,e.suspendedLanes|=n,e.pingedLanes&=~n,o&&(e.warmLanes|=n),o=e.expirationTimes;for(var u=n;0<u;){var h=31-lt(u),_=1<<h;o[h]=-1,u&=~_}a!==0&&Lr(e,a,n)}function Rs(){return(xt&6)===0?(vo(0),!1):!0}function Vc(){if(rt!==null){if(jt===0)var e=rt.return;else e=rt,Ra=zi=null,sc(e),sr=null,to=0,e=rt;for(;e!==null;)ch(e.alternate,e),e=e.return;rt=null}}function yr(e,n){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,nb(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Pa=0,Vc(),Et=e,rt=a=za(e.current,null),ct=n,jt=0,Dn=null,si=!1,pr=ea(e,n),Mc=!1,gr=Bn=qc=Mi=li=Mt=0,Cn=bo=null,$c=!1,(n&8)!==0&&(n|=n&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=n;0<o;){var u=31-lt(o),h=1<<u;n|=e[u],o&=~h}return Ha=n,Zo(),a}function Oh(e,n){tt=null,N.H=co,n===or||n===ss?(n=Yu(),jt=3):n===Kl?(n=Yu(),jt=4):jt=n===_c?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Dn=n,rt===null&&(Mt=1,js(e,Fn(n,e.current)))}function Dh(){var e=Rn.current;return e===null?!0:(ct&4194048)===ct?Yn===null:(ct&62914560)===ct||(ct&536870912)!==0?e===Yn:!1}function Bh(){var e=N.H;return N.H=co,e===null?co:e}function Uh(){var e=N.A;return N.A=Dy,e}function Os(){Mt=4,si||(ct&4194048)!==ct&&Rn.current!==null||(pr=!0),(li&134217727)===0&&(Mi&134217727)===0||Et===null||ui(Et,ct,Bn,!1)}function Wc(e,n,a){var o=xt;xt|=2;var u=Bh(),h=Uh();(Et!==e||ct!==n)&&(ks=null,yr(e,n)),n=!1;var _=Mt;e:do try{if(jt!==0&&rt!==null){var D=rt,W=Dn;switch(jt){case 8:Vc(),_=6;break e;case 3:case 2:case 9:case 6:Rn.current===null&&(n=!0);var ce=jt;if(jt=0,Dn=null,br(e,D,W,ce),a&&pr){_=0;break e}break;default:ce=jt,jt=0,Dn=null,br(e,D,W,ce)}}Ly(),_=Mt;break}catch(je){Oh(e,je)}while(!0);return n&&e.shellSuspendCounter++,Ra=zi=null,xt=o,N.H=u,N.A=h,rt===null&&(Et=null,ct=0,Zo()),_}function Ly(){for(;rt!==null;)Lh(rt)}function Iy(e,n){var a=xt;xt|=2;var o=Bh(),u=Uh();Et!==e||ct!==n?(ks=null,zs=st()+500,yr(e,n)):pr=ea(e,n);e:do try{if(jt!==0&&rt!==null){n=rt;var h=Dn;t:switch(jt){case 1:jt=0,Dn=null,br(e,n,h,1);break;case 2:case 9:if(Wu(h)){jt=0,Dn=null,Ih(n);break}n=function(){jt!==2&&jt!==9||Et!==e||(jt=7),Sa(e)},h.then(n,n);break e;case 3:jt=7;break e;case 4:jt=5;break e;case 7:Wu(h)?(jt=0,Dn=null,Ih(n)):(jt=0,Dn=null,br(e,n,h,7));break;case 5:var _=null;switch(rt.tag){case 26:_=rt.memoizedState;case 5:case 27:var D=rt;if(_?_p(_):D.stateNode.complete){jt=0,Dn=null;var W=D.sibling;if(W!==null)rt=W;else{var ce=D.return;ce!==null?(rt=ce,Ds(ce)):rt=null}break t}}jt=0,Dn=null,br(e,n,h,5);break;case 6:jt=0,Dn=null,br(e,n,h,6);break;case 8:Vc(),Mt=6;break e;default:throw Error(s(462))}}My();break}catch(je){Oh(e,je)}while(!0);return Ra=zi=null,N.H=o,N.A=u,xt=a,rt!==null?0:(Et=null,ct=0,Zo(),Mt)}function My(){for(;rt!==null&&!$e();)Lh(rt)}function Lh(e){var n=sh(e.alternate,e,Ha);e.memoizedProps=e.pendingProps,n===null?Ds(e):rt=n}function Ih(e){var n=e,a=n.alternate;switch(n.tag){case 15:case 0:n=th(a,n,n.pendingProps,n.type,void 0,ct);break;case 11:n=th(a,n,n.pendingProps,n.type.render,n.ref,ct);break;case 5:sc(n);default:ch(a,n),n=rt=Bu(n,Ha),n=sh(a,n,Ha)}e.memoizedProps=e.pendingProps,n===null?Ds(e):rt=n}function br(e,n,a,o){Ra=zi=null,sc(n),sr=null,to=0;var u=n.return;try{if(Ty(e,u,n,a,ct)){Mt=1,js(e,Fn(a,e.current)),rt=null;return}}catch(h){if(u!==null)throw rt=u,h;Mt=1,js(e,Fn(a,e.current)),rt=null;return}n.flags&32768?(pt||o===1?e=!0:pr||(ct&536870912)!==0?e=!1:(si=e=!0,(o===2||o===9||o===3||o===6)&&(o=Rn.current,o!==null&&o.tag===13&&(o.flags|=16384))),Mh(n,e)):Ds(n)}function Ds(e){var n=e;do{if((n.flags&32768)!==0){Mh(n,si);return}e=n.return;var a=zy(n.alternate,n,Ha);if(a!==null){rt=a;return}if(n=n.sibling,n!==null){rt=n;return}rt=n=e}while(n!==null);Mt===0&&(Mt=5)}function Mh(e,n){do{var a=ky(e.alternate,e);if(a!==null){a.flags&=32767,rt=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(e=e.sibling,e!==null)){rt=e;return}rt=e=a}while(e!==null);Mt=6,rt=null}function qh(e,n,a,o,u,h,_,D,W){e.cancelPendingCommit=null;do Bs();while(Zt!==0);if((xt&6)!==0)throw Error(s(327));if(n!==null){if(n===e.current)throw Error(s(177));if(h=n.lanes|n.childLanes,h|=Dl,bl(e,a,h,_,D,W),e===Et&&(rt=Et=null,ct=0),mr=n,di=e,Pa=a,Hc=h,Pc=u,Ah=o,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Py(ut,function(){return Vh(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||o){o=N.T,N.T=null,u=q.p,q.p=2,_=xt,xt|=4;try{Ry(e,n,a)}finally{xt=_,q.p=u,N.T=o}}Zt=1,$h(),Hh(),Ph()}}function $h(){if(Zt===1){Zt=0;var e=di,n=mr,a=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||a){a=N.T,N.T=null;var o=q.p;q.p=2;var u=xt;xt|=4;try{jh(n,e);var h=id,_=Eu(e.containerInfo),D=h.focusedElem,W=h.selectionRange;if(_!==D&&D&&D.ownerDocument&&Cu(D.ownerDocument.documentElement,D)){if(W!==null&&Al(D)){var ce=W.start,je=W.end;if(je===void 0&&(je=ce),"selectionStart"in D)D.selectionStart=ce,D.selectionEnd=Math.min(je,D.value.length);else{var Ee=D.ownerDocument||document,fe=Ee&&Ee.defaultView||window;if(fe.getSelection){var ye=fe.getSelection(),Me=D.textContent.length,Ye=Math.min(W.start,Me),Ct=W.end===void 0?Ye:Math.min(W.end,Me);!ye.extend&&Ye>Ct&&(_=Ct,Ct=Ye,Ye=_);var ie=wu(D,Ye),Q=wu(D,Ct);if(ie&&Q&&(ye.rangeCount!==1||ye.anchorNode!==ie.node||ye.anchorOffset!==ie.offset||ye.focusNode!==Q.node||ye.focusOffset!==Q.offset)){var le=Ee.createRange();le.setStart(ie.node,ie.offset),ye.removeAllRanges(),Ye>Ct?(ye.addRange(le),ye.extend(Q.node,Q.offset)):(le.setEnd(Q.node,Q.offset),ye.addRange(le))}}}}for(Ee=[],ye=D;ye=ye.parentNode;)ye.nodeType===1&&Ee.push({element:ye,left:ye.scrollLeft,top:ye.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<Ee.length;D++){var Ce=Ee[D];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}Gs=!!ad,id=ad=null}finally{xt=u,q.p=o,N.T=a}}e.current=n,Zt=2}}function Hh(){if(Zt===2){Zt=0;var e=di,n=mr,a=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||a){a=N.T,N.T=null;var o=q.p;q.p=2;var u=xt;xt|=4;try{mh(e,n.alternate,n)}finally{xt=u,q.p=o,N.T=a}}Zt=3}}function Ph(){if(Zt===4||Zt===3){Zt=0,gt();var e=di,n=mr,a=Pa,o=Ah;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Zt=5:(Zt=0,mr=di=null,Fh(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(ci=null),Mr(a),n=n.stateNode,et&&typeof et.onCommitFiberRoot=="function")try{et.onCommitFiberRoot(qe,n,void 0,(n.current.flags&128)===128)}catch{}if(o!==null){n=N.T,u=q.p,q.p=2,N.T=null;try{for(var h=e.onRecoverableError,_=0;_<o.length;_++){var D=o[_];h(D.value,{componentStack:D.stack})}}finally{N.T=n,q.p=u}}(Pa&3)!==0&&Bs(),Sa(e),u=e.pendingLanes,(a&261930)!==0&&(u&42)!==0?e===Fc?xo++:(xo=0,Fc=e):xo=0,vo(0)}}function Fh(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Zr(n)))}function Bs(){return $h(),Hh(),Ph(),Vh()}function Vh(){if(Zt!==5)return!1;var e=di,n=Hc;Hc=0;var a=Mr(Pa),o=N.T,u=q.p;try{q.p=32>a?32:a,N.T=null,a=Pc,Pc=null;var h=di,_=Pa;if(Zt=0,mr=di=null,Pa=0,(xt&6)!==0)throw Error(s(331));var D=xt;if(xt|=4,Eh(h.current),_h(h,h.current,_,a),xt=D,vo(0,!1),et&&typeof et.onPostCommitFiberRoot=="function")try{et.onPostCommitFiberRoot(qe,h)}catch{}return!0}finally{q.p=u,N.T=o,Fh(e,n)}}function Wh(e,n,a){n=Fn(a,n),n=Sc(e.stateNode,n,2),e=ai(e,n,2),e!==null&&(Si(e,2),Sa(e))}function St(e,n,a){if(e.tag===3)Wh(e,e,a);else for(;n!==null;){if(n.tag===3){Wh(n,e,a);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(ci===null||!ci.has(o))){e=Fn(a,e),a=Gf(2),o=ai(n,a,2),o!==null&&(Yf(a,o,n,e),Si(o,2),Sa(o));break}}n=n.return}}function Gc(e,n,a){var o=e.pingCache;if(o===null){o=e.pingCache=new By;var u=new Set;o.set(n,u)}else u=o.get(n),u===void 0&&(u=new Set,o.set(n,u));u.has(a)||(Mc=!0,u.add(a),e=qy.bind(null,e,n,a),n.then(e,e))}function qy(e,n,a){var o=e.pingCache;o!==null&&o.delete(n),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,Et===e&&(ct&a)===a&&(Mt===4||Mt===3&&(ct&62914560)===ct&&300>st()-As?(xt&2)===0&&yr(e,0):qc|=a,gr===ct&&(gr=0)),Sa(e)}function Gh(e,n){n===0&&(n=$o()),e=Ti(e,n),e!==null&&(Si(e,n),Sa(e))}function $y(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),Gh(e,a)}function Hy(e,n){var a=0;switch(e.tag){case 31:case 13:var o=e.stateNode,u=e.memoizedState;u!==null&&(a=u.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(s(314))}o!==null&&o.delete(n),Gh(e,a)}function Py(e,n){return se(e,n)}var Us=null,xr=null,Yc=!1,Ls=!1,Kc=!1,fi=0;function Sa(e){e!==xr&&e.next===null&&(xr===null?Us=xr=e:xr=xr.next=e),Ls=!0,Yc||(Yc=!0,Vy())}function vo(e,n){if(!Kc&&Ls){Kc=!0;do for(var a=!1,o=Us;o!==null;){if(e!==0){var u=o.pendingLanes;if(u===0)var h=0;else{var _=o.suspendedLanes,D=o.pingedLanes;h=(1<<31-lt(42|e)+1)-1,h&=u&~(_&~D),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(a=!0,Qh(o,h))}else h=ct,h=fa(o,o===Et?h:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(h&3)===0||ea(o,h)||(a=!0,Qh(o,h));o=o.next}while(a);Kc=!1}}function Fy(){Yh()}function Yh(){Ls=Yc=!1;var e=0;fi!==0&&tb()&&(e=fi);for(var n=st(),a=null,o=Us;o!==null;){var u=o.next,h=Kh(o,n);h===0?(o.next=null,a===null?Us=u:a.next=u,u===null&&(xr=a)):(a=o,(e!==0||(h&3)!==0)&&(Ls=!0)),o=u}Zt!==0&&Zt!==5||vo(e),fi!==0&&(fi=0)}function Kh(e,n){for(var a=e.suspendedLanes,o=e.pingedLanes,u=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var _=31-lt(h),D=1<<_,W=u[_];W===-1?((D&a)===0||(D&o)!==0)&&(u[_]=qo(D,n)):W<=n&&(e.expiredLanes|=D),h&=~D}if(n=Et,a=ct,a=fa(e,e===n?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,a===0||e===n&&(jt===2||jt===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&ve(o),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||ea(e,a)){if(n=a&-a,n===e.callbackPriority)return n;switch(o!==null&&ve(o),Mr(a)){case 2:case 8:a=Rt;break;case 32:a=ut;break;case 268435456:a=Ot;break;default:a=ut}return o=Jh.bind(null,e),a=se(a,o),e.callbackPriority=n,e.callbackNode=a,n}return o!==null&&o!==null&&ve(o),e.callbackPriority=2,e.callbackNode=null,2}function Jh(e,n){if(Zt!==0&&Zt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Bs()&&e.callbackNode!==a)return null;var o=ct;return o=fa(e,e===Et?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(kh(e,o,n),Kh(e,st()),e.callbackNode!=null&&e.callbackNode===a?Jh.bind(null,e):null)}function Qh(e,n){if(Bs())return null;kh(e,n,!0)}function Vy(){ab(function(){(xt&6)!==0?se(kt,Fy):Yh()})}function Jc(){if(fi===0){var e=ir;e===0&&(e=Xt,Xt<<=1,(Xt&261888)===0&&(Xt=256)),fi=e}return fi}function Xh(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Hn(""+e)}function Zh(e,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,e.id&&a.setAttribute("form",e.id),n.parentNode.insertBefore(a,n),e=new FormData(e),a.parentNode.removeChild(a),e}function Wy(e,n,a,o,u){if(n==="submit"&&a&&a.stateNode===u){var h=Xh((u[hn]||null).action),_=o.submitter;_&&(n=(n=_[hn]||null)?Xh(n.formAction):_.getAttribute("formAction"),n!==null&&(h=n,_=null));var D=new Ko("action","action",null,o,u);e.push({event:D,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(fi!==0){var W=_?Zh(u,_):new FormData(u);mc(a,{pending:!0,data:W,method:u.method,action:h},null,W)}}else typeof h=="function"&&(D.preventDefault(),W=_?Zh(u,_):new FormData(u),mc(a,{pending:!0,data:W,method:u.method,action:h},h,W))},currentTarget:u}]})}}for(var Qc=0;Qc<Ol.length;Qc++){var Xc=Ol[Qc],Gy=Xc.toLowerCase(),Yy=Xc[0].toUpperCase()+Xc.slice(1);oa(Gy,"on"+Yy)}oa(Au,"onAnimationEnd"),oa(zu,"onAnimationIteration"),oa(ku,"onAnimationStart"),oa("dblclick","onDoubleClick"),oa("focusin","onFocus"),oa("focusout","onBlur"),oa(dy,"onTransitionRun"),oa(uy,"onTransitionStart"),oa(fy,"onTransitionCancel"),oa(Ru,"onTransitionEnd"),ga("onMouseEnter",["mouseout","mouseover"]),ga("onMouseLeave",["mouseout","mouseover"]),ga("onPointerEnter",["pointerout","pointerover"]),ga("onPointerLeave",["pointerout","pointerover"]),Ta("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ta("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ta("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ta("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ta("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ta("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ky=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jo));function ep(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],u=o.event;o=o.listeners;e:{var h=void 0;if(n)for(var _=o.length-1;0<=_;_--){var D=o[_],W=D.instance,ce=D.currentTarget;if(D=D.listener,W!==h&&u.isPropagationStopped())break e;h=D,u.currentTarget=ce;try{h(u)}catch(je){Xo(je)}u.currentTarget=null,h=W}else for(_=0;_<o.length;_++){if(D=o[_],W=D.instance,ce=D.currentTarget,D=D.listener,W!==h&&u.isPropagationStopped())break e;h=D,u.currentTarget=ce;try{h(u)}catch(je){Xo(je)}u.currentTarget=null,h=W}}}}function ot(e,n){var a=n[$n];a===void 0&&(a=n[$n]=new Set);var o=e+"__bubble";a.has(o)||(tp(n,e,2,!1),a.add(o))}function Zc(e,n,a){var o=0;n&&(o|=4),tp(a,e,o,n)}var Is="_reactListening"+Math.random().toString(36).slice(2);function ed(e){if(!e[Is]){e[Is]=!0,Wo.forEach(function(a){a!=="selectionchange"&&(Ky.has(a)||Zc(a,!1,e),Zc(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Is]||(n[Is]=!0,Zc("selectionchange",!1,n))}}function tp(e,n,a,o){switch(zp(n)){case 2:var u=_b;break;case 8:u=wb;break;default:u=gd}a=u.bind(null,n,a,e),u=void 0,!Ve||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),o?u!==void 0?e.addEventListener(n,a,{capture:!0,passive:u}):e.addEventListener(n,a,!0):u!==void 0?e.addEventListener(n,a,{passive:u}):e.addEventListener(n,a,!1)}function td(e,n,a,o,u){var h=o;if((n&1)===0&&(n&2)===0&&o!==null)e:for(;;){if(o===null)return;var _=o.tag;if(_===3||_===4){var D=o.stateNode.containerInfo;if(D===u)break;if(_===4)for(_=o.return;_!==null;){var W=_.tag;if((W===3||W===4)&&_.stateNode.containerInfo===u)return;_=_.return}for(;D!==null;){if(_=ha(D),_===null)return;if(W=_.tag,W===5||W===6||W===26||W===27){o=h=_;continue e}D=D.parentNode}}o=o.return}Ke(function(){var ce=h,je=Yi(a),Ee=[];e:{var fe=Ou.get(e);if(fe!==void 0){var ye=Ko,Me=e;switch(e){case"keypress":if(ra(a)===0)break e;case"keydown":case"keyup":ye=Hm;break;case"focusin":Me="focus",ye=wl;break;case"focusout":Me="blur",ye=wl;break;case"beforeblur":case"afterblur":ye=wl;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=lu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=zm;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=Vm;break;case Au:case zu:case ku:ye=Om;break;case Ru:ye=Gm;break;case"scroll":case"scrollend":ye=Nm;break;case"wheel":ye=Km;break;case"copy":case"cut":case"paste":ye=Bm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=du;break;case"toggle":case"beforetoggle":ye=Qm}var Ye=(n&4)!==0,Ct=!Ye&&(e==="scroll"||e==="scrollend"),ie=Ye?fe!==null?fe+"Capture":null:fe;Ye=[];for(var Q=ce,le;Q!==null;){var Ce=Q;if(le=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||le===null||ie===null||(Ce=it(Q,ie),Ce!=null&&Ye.push(So(Q,Ce,le))),Ct)break;Q=Q.return}0<Ye.length&&(fe=new ye(fe,Me,null,a,je),Ee.push({event:fe,listeners:Ye}))}}if((n&7)===0){e:{if(fe=e==="mouseover"||e==="pointerover",ye=e==="mouseout"||e==="pointerout",fe&&a!==Aa&&(Me=a.relatedTarget||a.fromElement)&&(ha(Me)||Me[vn]))break e;if((ye||fe)&&(fe=je.window===je?je:(fe=je.ownerDocument)?fe.defaultView||fe.parentWindow:window,ye?(Me=a.relatedTarget||a.toElement,ye=ce,Me=Me?ha(Me):null,Me!==null&&(Ct=d(Me),Ye=Me.tag,Me!==Ct||Ye!==5&&Ye!==27&&Ye!==6)&&(Me=null)):(ye=null,Me=ce),ye!==Me)){if(Ye=lu,Ce="onMouseLeave",ie="onMouseEnter",Q="mouse",(e==="pointerout"||e==="pointerover")&&(Ye=du,Ce="onPointerLeave",ie="onPointerEnter",Q="pointer"),Ct=ye==null?fe:tn(ye),le=Me==null?fe:tn(Me),fe=new Ye(Ce,Q+"leave",ye,a,je),fe.target=Ct,fe.relatedTarget=le,Ce=null,ha(je)===ce&&(Ye=new Ye(ie,Q+"enter",Me,a,je),Ye.target=le,Ye.relatedTarget=Ct,Ce=Ye),Ct=Ce,ye&&Me)t:{for(Ye=Jy,ie=ye,Q=Me,le=0,Ce=ie;Ce;Ce=Ye(Ce))le++;Ce=0;for(var Ge=Q;Ge;Ge=Ye(Ge))Ce++;for(;0<le-Ce;)ie=Ye(ie),le--;for(;0<Ce-le;)Q=Ye(Q),Ce--;for(;le--;){if(ie===Q||Q!==null&&ie===Q.alternate){Ye=ie;break t}ie=Ye(ie),Q=Ye(Q)}Ye=null}else Ye=null;ye!==null&&np(Ee,fe,ye,Ye,!1),Me!==null&&Ct!==null&&np(Ee,Ct,Me,Ye,!0)}}e:{if(fe=ce?tn(ce):window,ye=fe.nodeName&&fe.nodeName.toLowerCase(),ye==="select"||ye==="input"&&fe.type==="file")var mt=bu;else if(mu(fe))if(xu)mt=sy;else{mt=ry;var He=iy}else ye=fe.nodeName,!ye||ye.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?ce&&at(ce.elementType)&&(mt=bu):mt=oy;if(mt&&(mt=mt(e,ce))){yu(Ee,mt,a,je);break e}He&&He(e,fe,ce),e==="focusout"&&ce&&fe.type==="number"&&ce.memoizedProps.value!=null&&we(fe,"number",fe.value)}switch(He=ce?tn(ce):window,e){case"focusin":(mu(He)||He.contentEditable==="true")&&(Ji=He,zl=ce,Jr=null);break;case"focusout":Jr=zl=Ji=null;break;case"mousedown":kl=!0;break;case"contextmenu":case"mouseup":case"dragend":kl=!1,Tu(Ee,a,je);break;case"selectionchange":if(cy)break;case"keydown":case"keyup":Tu(Ee,a,je)}var nt;if(El)e:{switch(e){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else Ki?pu(e,a)&&(dt="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(dt="onCompositionStart");dt&&(uu&&a.locale!=="ko"&&(Ki||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&Ki&&(nt=ia()):(Ut=je,nn="value"in Ut?Ut.value:Ut.textContent,Ki=!0)),He=Ms(ce,dt),0<He.length&&(dt=new cu(dt,e,null,a,je),Ee.push({event:dt,listeners:He}),nt?dt.data=nt:(nt=gu(a),nt!==null&&(dt.data=nt)))),(nt=Zm?ey(e,a):ty(e,a))&&(dt=Ms(ce,"onBeforeInput"),0<dt.length&&(He=new cu("onBeforeInput","beforeinput",null,a,je),Ee.push({event:He,listeners:dt}),He.data=nt)),Wy(Ee,e,ce,a,je)}ep(Ee,n)})}function So(e,n,a){return{instance:e,listener:n,currentTarget:a}}function Ms(e,n){for(var a=n+"Capture",o=[];e!==null;){var u=e,h=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||h===null||(u=it(e,a),u!=null&&o.unshift(So(e,u,h)),u=it(e,n),u!=null&&o.push(So(e,u,h))),e.tag===3)return o;e=e.return}return[]}function Jy(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function np(e,n,a,o,u){for(var h=n._reactName,_=[];a!==null&&a!==o;){var D=a,W=D.alternate,ce=D.stateNode;if(D=D.tag,W!==null&&W===o)break;D!==5&&D!==26&&D!==27||ce===null||(W=ce,u?(ce=it(a,h),ce!=null&&_.unshift(So(a,ce,W))):u||(ce=it(a,h),ce!=null&&_.push(So(a,ce,W)))),a=a.return}_.length!==0&&e.push({event:n,listeners:_})}var Qy=/\r\n?/g,Xy=/\u0000|\uFFFD/g;function ap(e){return(typeof e=="string"?e:""+e).replace(Qy,`
`).replace(Xy,"")}function ip(e,n){return n=ap(n),ap(e)===n}function wt(e,n,a,o,u,h){switch(a){case"children":typeof o=="string"?n==="body"||n==="textarea"&&o===""||Ie(e,o):(typeof o=="number"||typeof o=="bigint")&&n!=="body"&&Ie(e,""+o);break;case"className":wi(e,"class",o);break;case"tabIndex":wi(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":wi(e,a,o);break;case"style":Xe(e,o,h);break;case"data":if(n!=="object"){wi(e,"data",o);break}case"src":case"href":if(o===""&&(n!=="a"||a!=="href")){e.removeAttribute(a);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=Hn(""+o),e.setAttribute(a,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(a==="formAction"?(n!=="input"&&wt(e,n,"name",u.name,u,null),wt(e,n,"formEncType",u.formEncType,u,null),wt(e,n,"formMethod",u.formMethod,u,null),wt(e,n,"formTarget",u.formTarget,u,null)):(wt(e,n,"encType",u.encType,u,null),wt(e,n,"method",u.method,u,null),wt(e,n,"target",u.target,u,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=Hn(""+o),e.setAttribute(a,o);break;case"onClick":o!=null&&(e.onclick=Wt);break;case"onScroll":o!=null&&ot("scroll",e);break;case"onScrollEnd":o!=null&&ot("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(s(61));if(a=o.__html,a!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=a}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}a=Hn(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""+o):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":o===!0?e.setAttribute(a,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,o):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(a,o):e.removeAttribute(a);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(a):e.setAttribute(a,o);break;case"popover":ot("beforetoggle",e),ot("toggle",e),_i(e,"popover",o);break;case"xlinkActuate":na(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":na(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":na(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":na(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":na(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":na(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":na(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":na(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":na(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":_i(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Bt.get(a)||a,_i(e,a,o))}}function nd(e,n,a,o,u,h){switch(a){case"style":Xe(e,o,h);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(s(61));if(a=o.__html,a!=null){if(u.children!=null)throw Error(s(60));e.innerHTML=a}}break;case"children":typeof o=="string"?Ie(e,o):(typeof o=="number"||typeof o=="bigint")&&Ie(e,""+o);break;case"onScroll":o!=null&&ot("scroll",e);break;case"onScrollEnd":o!=null&&ot("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Wt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Hr.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(u=a.endsWith("Capture"),n=a.slice(2,u?a.length-7:void 0),h=e[hn]||null,h=h!=null?h[a]:null,typeof h=="function"&&e.removeEventListener(n,h,u),typeof o=="function")){typeof h!="function"&&h!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(n,o,u);break e}a in e?e[a]=o:o===!0?e.setAttribute(a,""):_i(e,a,o)}}}function un(e,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ot("error",e),ot("load",e);var o=!1,u=!1,h;for(h in a)if(a.hasOwnProperty(h)){var _=a[h];if(_!=null)switch(h){case"src":o=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:wt(e,n,h,_,a,null)}}u&&wt(e,n,"srcSet",a.srcSet,a,null),o&&wt(e,n,"src",a.src,a,null);return;case"input":ot("invalid",e);var D=h=_=u=null,W=null,ce=null;for(o in a)if(a.hasOwnProperty(o)){var je=a[o];if(je!=null)switch(o){case"name":u=je;break;case"type":_=je;break;case"checked":W=je;break;case"defaultChecked":ce=je;break;case"value":h=je;break;case"defaultValue":D=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(s(137,n));break;default:wt(e,n,o,je,a,null)}}xe(e,h,D,W,ce,_,u,!1);return;case"select":ot("invalid",e),o=_=h=null;for(u in a)if(a.hasOwnProperty(u)&&(D=a[u],D!=null))switch(u){case"value":h=D;break;case"defaultValue":_=D;break;case"multiple":o=D;default:wt(e,n,u,D,a,null)}n=h,a=_,e.multiple=!!o,n!=null?me(e,!!o,n,!1):a!=null&&me(e,!!o,a,!0);return;case"textarea":ot("invalid",e),h=u=o=null;for(_ in a)if(a.hasOwnProperty(_)&&(D=a[_],D!=null))switch(_){case"value":o=D;break;case"defaultValue":u=D;break;case"children":h=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(s(91));break;default:wt(e,n,_,D,a,null)}Fe(e,o,u,h);return;case"option":for(W in a)if(a.hasOwnProperty(W)&&(o=a[W],o!=null))switch(W){case"selected":e.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:wt(e,n,W,o,a,null)}return;case"dialog":ot("beforetoggle",e),ot("toggle",e),ot("cancel",e),ot("close",e);break;case"iframe":case"object":ot("load",e);break;case"video":case"audio":for(o=0;o<jo.length;o++)ot(jo[o],e);break;case"image":ot("error",e),ot("load",e);break;case"details":ot("toggle",e);break;case"embed":case"source":case"link":ot("error",e),ot("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in a)if(a.hasOwnProperty(ce)&&(o=a[ce],o!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:wt(e,n,ce,o,a,null)}return;default:if(at(n)){for(je in a)a.hasOwnProperty(je)&&(o=a[je],o!==void 0&&nd(e,n,je,o,a,void 0));return}}for(D in a)a.hasOwnProperty(D)&&(o=a[D],o!=null&&wt(e,n,D,o,a,null))}function Zy(e,n,a,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,h=null,_=null,D=null,W=null,ce=null,je=null;for(ye in a){var Ee=a[ye];if(a.hasOwnProperty(ye)&&Ee!=null)switch(ye){case"checked":break;case"value":break;case"defaultValue":W=Ee;default:o.hasOwnProperty(ye)||wt(e,n,ye,null,o,Ee)}}for(var fe in o){var ye=o[fe];if(Ee=a[fe],o.hasOwnProperty(fe)&&(ye!=null||Ee!=null))switch(fe){case"type":h=ye;break;case"name":u=ye;break;case"checked":ce=ye;break;case"defaultChecked":je=ye;break;case"value":_=ye;break;case"defaultValue":D=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(s(137,n));break;default:ye!==Ee&&wt(e,n,fe,ye,o,Ee)}}Ae(e,_,D,W,ce,je,h,u);return;case"select":ye=_=D=fe=null;for(h in a)if(W=a[h],a.hasOwnProperty(h)&&W!=null)switch(h){case"value":break;case"multiple":ye=W;default:o.hasOwnProperty(h)||wt(e,n,h,null,o,W)}for(u in o)if(h=o[u],W=a[u],o.hasOwnProperty(u)&&(h!=null||W!=null))switch(u){case"value":fe=h;break;case"defaultValue":D=h;break;case"multiple":_=h;default:h!==W&&wt(e,n,u,h,o,W)}n=D,a=_,o=ye,fe!=null?me(e,!!a,fe,!1):!!o!=!!a&&(n!=null?me(e,!!a,n,!0):me(e,!!a,a?[]:"",!1));return;case"textarea":ye=fe=null;for(D in a)if(u=a[D],a.hasOwnProperty(D)&&u!=null&&!o.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:wt(e,n,D,null,o,u)}for(_ in o)if(u=o[_],h=a[_],o.hasOwnProperty(_)&&(u!=null||h!=null))switch(_){case"value":fe=u;break;case"defaultValue":ye=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(s(91));break;default:u!==h&&wt(e,n,_,u,o,h)}Re(e,fe,ye);return;case"option":for(var Me in a)if(fe=a[Me],a.hasOwnProperty(Me)&&fe!=null&&!o.hasOwnProperty(Me))switch(Me){case"selected":e.selected=!1;break;default:wt(e,n,Me,null,o,fe)}for(W in o)if(fe=o[W],ye=a[W],o.hasOwnProperty(W)&&fe!==ye&&(fe!=null||ye!=null))switch(W){case"selected":e.selected=fe&&typeof fe!="function"&&typeof fe!="symbol";break;default:wt(e,n,W,fe,o,ye)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ye in a)fe=a[Ye],a.hasOwnProperty(Ye)&&fe!=null&&!o.hasOwnProperty(Ye)&&wt(e,n,Ye,null,o,fe);for(ce in o)if(fe=o[ce],ye=a[ce],o.hasOwnProperty(ce)&&fe!==ye&&(fe!=null||ye!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(s(137,n));break;default:wt(e,n,ce,fe,o,ye)}return;default:if(at(n)){for(var Ct in a)fe=a[Ct],a.hasOwnProperty(Ct)&&fe!==void 0&&!o.hasOwnProperty(Ct)&&nd(e,n,Ct,void 0,o,fe);for(je in o)fe=o[je],ye=a[je],!o.hasOwnProperty(je)||fe===ye||fe===void 0&&ye===void 0||nd(e,n,je,fe,o,ye);return}}for(var ie in a)fe=a[ie],a.hasOwnProperty(ie)&&fe!=null&&!o.hasOwnProperty(ie)&&wt(e,n,ie,null,o,fe);for(Ee in o)fe=o[Ee],ye=a[Ee],!o.hasOwnProperty(Ee)||fe===ye||fe==null&&ye==null||wt(e,n,Ee,fe,o,ye)}function rp(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function eb(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,a=performance.getEntriesByType("resource"),o=0;o<a.length;o++){var u=a[o],h=u.transferSize,_=u.initiatorType,D=u.duration;if(h&&D&&rp(_)){for(_=0,D=u.responseEnd,o+=1;o<a.length;o++){var W=a[o],ce=W.startTime;if(ce>D)break;var je=W.transferSize,Ee=W.initiatorType;je&&rp(Ee)&&(W=W.responseEnd,_+=je*(W<D?1:(D-ce)/(W-ce)))}if(--o,n+=8*(h+_)/(u.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var ad=null,id=null;function qs(e){return e.nodeType===9?e:e.ownerDocument}function op(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sp(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function rd(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var od=null;function tb(){var e=window.event;return e&&e.type==="popstate"?e===od?!1:(od=e,!0):(od=null,!1)}var lp=typeof setTimeout=="function"?setTimeout:void 0,nb=typeof clearTimeout=="function"?clearTimeout:void 0,cp=typeof Promise=="function"?Promise:void 0,ab=typeof queueMicrotask=="function"?queueMicrotask:typeof cp<"u"?function(e){return cp.resolve(null).then(e).catch(ib)}:lp;function ib(e){setTimeout(function(){throw e})}function hi(e){return e==="head"}function dp(e,n){var a=n,o=0;do{var u=a.nextSibling;if(e.removeChild(a),u&&u.nodeType===8)if(a=u.data,a==="/$"||a==="/&"){if(o===0){e.removeChild(u),_r(n);return}o--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")o++;else if(a==="html")_o(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,_o(a);for(var h=a.firstChild;h;){var _=h.nextSibling,D=h.nodeName;h[Ea]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&h.rel.toLowerCase()==="stylesheet"||a.removeChild(h),h=_}}else a==="body"&&_o(e.ownerDocument.body);a=u}while(a);_r(n)}function up(e,n){var a=e;e=0;do{var o=a.nextSibling;if(a.nodeType===1?n?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(n?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),o&&o.nodeType===8)if(a=o.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=o}while(a)}function sd(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":sd(a),$r(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function rb(e,n,a,o){for(;e.nodeType===1;){var u=a;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[Ea])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var h=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=Kn(e.nextSibling),e===null)break}return null}function ob(e,n,a){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Kn(e.nextSibling),e===null))return null;return e}function fp(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=Kn(e.nextSibling),e===null))return null;return e}function ld(e){return e.data==="$?"||e.data==="$~"}function cd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function sb(e,n){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||a.readyState!=="loading")n();else{var o=function(){n(),a.removeEventListener("DOMContentLoaded",o)};a.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function Kn(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var dd=null;function hp(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(n===0)return Kn(e.nextSibling);n--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||n++}e=e.nextSibling}return null}function pp(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(n===0)return e;n--}else a!=="/$"&&a!=="/&"||n++}e=e.previousSibling}return null}function gp(e,n,a){switch(n=qs(a),e){case"html":if(e=n.documentElement,!e)throw Error(s(452));return e;case"head":if(e=n.head,!e)throw Error(s(453));return e;case"body":if(e=n.body,!e)throw Error(s(454));return e;default:throw Error(s(451))}}function _o(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);$r(e)}var Jn=new Map,mp=new Set;function $s(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Fa=q.d;q.d={f:lb,r:cb,D:db,C:ub,L:fb,m:hb,X:gb,S:pb,M:mb};function lb(){var e=Fa.f(),n=Rs();return e||n}function cb(e){var n=pa(e);n!==null&&n.tag===5&&n.type==="form"?Of(n):Fa.r(e)}var vr=typeof document>"u"?null:document;function yp(e,n,a){var o=vr;if(o&&typeof n=="string"&&n){var u=ke(n);u='link[rel="'+e+'"][href="'+u+'"]',typeof a=="string"&&(u+='[crossorigin="'+a+'"]'),mp.has(u)||(mp.add(u),e={rel:e,crossOrigin:a,href:n},o.querySelector(u)===null&&(n=o.createElement("link"),un(n,"link",e),Vt(n),o.head.appendChild(n)))}}function db(e){Fa.D(e),yp("dns-prefetch",e,null)}function ub(e,n){Fa.C(e,n),yp("preconnect",e,n)}function fb(e,n,a){Fa.L(e,n,a);var o=vr;if(o&&e&&n){var u='link[rel="preload"][as="'+ke(n)+'"]';n==="image"&&a&&a.imageSrcSet?(u+='[imagesrcset="'+ke(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(u+='[imagesizes="'+ke(a.imageSizes)+'"]')):u+='[href="'+ke(e)+'"]';var h=u;switch(n){case"style":h=jr(e);break;case"script":h=Sr(e)}Jn.has(h)||(e=S({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:e,as:n},a),Jn.set(h,e),o.querySelector(u)!==null||n==="style"&&o.querySelector(wo(h))||n==="script"&&o.querySelector(Co(h))||(n=o.createElement("link"),un(n,"link",e),Vt(n),o.head.appendChild(n)))}}function hb(e,n){Fa.m(e,n);var a=vr;if(a&&e){var o=n&&typeof n.as=="string"?n.as:"script",u='link[rel="modulepreload"][as="'+ke(o)+'"][href="'+ke(e)+'"]',h=u;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=Sr(e)}if(!Jn.has(h)&&(e=S({rel:"modulepreload",href:e},n),Jn.set(h,e),a.querySelector(u)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Co(h)))return}o=a.createElement("link"),un(o,"link",e),Vt(o),a.head.appendChild(o)}}}function pb(e,n,a){Fa.S(e,n,a);var o=vr;if(o&&e){var u=Ka(o).hoistableStyles,h=jr(e);n=n||"default";var _=u.get(h);if(!_){var D={loading:0,preload:null};if(_=o.querySelector(wo(h)))D.loading=5;else{e=S({rel:"stylesheet",href:e,"data-precedence":n},a),(a=Jn.get(h))&&ud(e,a);var W=_=o.createElement("link");Vt(W),un(W,"link",e),W._p=new Promise(function(ce,je){W.onload=ce,W.onerror=je}),W.addEventListener("load",function(){D.loading|=1}),W.addEventListener("error",function(){D.loading|=2}),D.loading|=4,Hs(_,n,o)}_={type:"stylesheet",instance:_,count:1,state:D},u.set(h,_)}}}function gb(e,n){Fa.X(e,n);var a=vr;if(a&&e){var o=Ka(a).hoistableScripts,u=Sr(e),h=o.get(u);h||(h=a.querySelector(Co(u)),h||(e=S({src:e,async:!0},n),(n=Jn.get(u))&&fd(e,n),h=a.createElement("script"),Vt(h),un(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},o.set(u,h))}}function mb(e,n){Fa.M(e,n);var a=vr;if(a&&e){var o=Ka(a).hoistableScripts,u=Sr(e),h=o.get(u);h||(h=a.querySelector(Co(u)),h||(e=S({src:e,async:!0,type:"module"},n),(n=Jn.get(u))&&fd(e,n),h=a.createElement("script"),Vt(h),un(h,"link",e),a.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},o.set(u,h))}}function bp(e,n,a,o){var u=(u=oe.current)?$s(u):null;if(!u)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=jr(a.href),a=Ka(u).hoistableStyles,o=a.get(n),o||(o={type:"style",instance:null,count:0,state:null},a.set(n,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=jr(a.href);var h=Ka(u).hoistableStyles,_=h.get(e);if(_||(u=u.ownerDocument||u,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,_),(h=u.querySelector(wo(e)))&&!h._p&&(_.instance=h,_.state.loading=5),Jn.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Jn.set(e,a),h||yb(u,e,a,_.state))),n&&o===null)throw Error(s(528,""));return _}if(n&&o!==null)throw Error(s(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Sr(a),a=Ka(u).hoistableScripts,o=a.get(n),o||(o={type:"script",instance:null,count:0,state:null},a.set(n,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function jr(e){return'href="'+ke(e)+'"'}function wo(e){return'link[rel="stylesheet"]['+e+"]"}function xp(e){return S({},e,{"data-precedence":e.precedence,precedence:null})}function yb(e,n,a,o){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?o.loading=1:(n=e.createElement("link"),o.preload=n,n.addEventListener("load",function(){return o.loading|=1}),n.addEventListener("error",function(){return o.loading|=2}),un(n,"link",a),Vt(n),e.head.appendChild(n))}function Sr(e){return'[src="'+ke(e)+'"]'}function Co(e){return"script[async]"+e}function vp(e,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var o=e.querySelector('style[data-href~="'+ke(a.href)+'"]');if(o)return n.instance=o,Vt(o),o;var u=S({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),Vt(o),un(o,"style",u),Hs(o,a.precedence,e),n.instance=o;case"stylesheet":u=jr(a.href);var h=e.querySelector(wo(u));if(h)return n.state.loading|=4,n.instance=h,Vt(h),h;o=xp(a),(u=Jn.get(u))&&ud(o,u),h=(e.ownerDocument||e).createElement("link"),Vt(h);var _=h;return _._p=new Promise(function(D,W){_.onload=D,_.onerror=W}),un(h,"link",o),n.state.loading|=4,Hs(h,a.precedence,e),n.instance=h;case"script":return h=Sr(a.src),(u=e.querySelector(Co(h)))?(n.instance=u,Vt(u),u):(o=a,(u=Jn.get(h))&&(o=S({},a),fd(o,u)),e=e.ownerDocument||e,u=e.createElement("script"),Vt(u),un(u,"link",o),e.head.appendChild(u),n.instance=u);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(o=n.instance,n.state.loading|=4,Hs(o,a.precedence,e));return n.instance}function Hs(e,n,a){for(var o=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=o.length?o[o.length-1]:null,h=u,_=0;_<o.length;_++){var D=o[_];if(D.dataset.precedence===n)h=D;else if(h!==u)break}h?h.parentNode.insertBefore(e,h.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(e,n.firstChild))}function ud(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function fd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var Ps=null;function jp(e,n,a){if(Ps===null){var o=new Map,u=Ps=new Map;u.set(a,o)}else u=Ps,o=u.get(a),o||(o=new Map,u.set(a,o));if(o.has(e))return o;for(o.set(e,null),a=a.getElementsByTagName(e),u=0;u<a.length;u++){var h=a[u];if(!(h[Ea]||h[Ft]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var _=h.getAttribute(n)||"";_=e+_;var D=o.get(_);D?D.push(h):o.set(_,[h])}}return o}function Sp(e,n,a){e=e.ownerDocument||e,e.head.insertBefore(a,n==="title"?e.querySelector("head > title"):null)}function bb(e,n,a){if(a===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return e=n.disabled,typeof n.precedence=="string"&&e==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function _p(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function xb(e,n,a,o){if(a.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var u=jr(o.href),h=n.querySelector(wo(u));if(h){n=h._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=Fs.bind(e),n.then(e,e)),a.state.loading|=4,a.instance=h,Vt(h);return}h=n.ownerDocument||n,o=xp(o),(u=Jn.get(u))&&ud(o,u),h=h.createElement("link"),Vt(h);var _=h;_._p=new Promise(function(D,W){_.onload=D,_.onerror=W}),un(h,"link",o),a.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=Fs.bind(e),n.addEventListener("load",a),n.addEventListener("error",a))}}var hd=0;function vb(e,n){return e.stylesheets&&e.count===0&&Ws(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var o=setTimeout(function(){if(e.stylesheets&&Ws(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+n);0<e.imgBytes&&hd===0&&(hd=62500*eb());var u=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Ws(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>hd?50:800)+n);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(o),clearTimeout(u)}}:null}function Fs(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ws(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Vs=null;function Ws(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Vs=new Map,n.forEach(jb,e),Vs=null,Fs.call(e))}function jb(e,n){if(!(n.state.loading&4)){var a=Vs.get(e);if(a)var o=a.get(null);else{a=new Map,Vs.set(e,a);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<u.length;h++){var _=u[h];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(a.set(_.dataset.precedence,_),o=_)}o&&a.set(null,o)}u=n.instance,_=u.getAttribute("data-precedence"),h=a.get(_)||o,h===o&&a.set(null,u),a.set(_,u),this.count++,o=Fs.bind(this),u.addEventListener("load",o),u.addEventListener("error",o),h?h.parentNode.insertBefore(u,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),n.state.loading|=4}}var Eo={$$typeof:R,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function Sb(e,n,a,o,u,h,_,D,W){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Gi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gi(0),this.hiddenUpdates=Gi(null),this.identifierPrefix=o,this.onUncaughtError=u,this.onCaughtError=h,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function wp(e,n,a,o,u,h,_,D,W,ce,je,Ee){return e=new Sb(e,n,a,_,W,ce,je,Ee,D),n=1,h===!0&&(n|=24),h=kn(3,null,null,n),e.current=h,h.stateNode=e,n=Wl(),n.refCount++,e.pooledCache=n,n.refCount++,h.memoizedState={element:o,isDehydrated:a,cache:n},Jl(h),e}function Cp(e){return e?(e=Zi,e):Zi}function Ep(e,n,a,o,u,h){u=Cp(u),o.context===null?o.context=u:o.pendingContext=u,o=ni(n),o.payload={element:a},h=h===void 0?null:h,h!==null&&(o.callback=h),a=ai(e,o,n),a!==null&&(En(a,e,n),ao(a,e,n))}function Tp(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function pd(e,n){Tp(e,n),(e=e.alternate)&&Tp(e,n)}function Np(e){if(e.tag===13||e.tag===31){var n=Ti(e,67108864);n!==null&&En(n,e,67108864),pd(e,67108864)}}function Ap(e){if(e.tag===13||e.tag===31){var n=Un();n=Ir(n);var a=Ti(e,n);a!==null&&En(a,e,n),pd(e,n)}}var Gs=!0;function _b(e,n,a,o){var u=N.T;N.T=null;var h=q.p;try{q.p=2,gd(e,n,a,o)}finally{q.p=h,N.T=u}}function wb(e,n,a,o){var u=N.T;N.T=null;var h=q.p;try{q.p=8,gd(e,n,a,o)}finally{q.p=h,N.T=u}}function gd(e,n,a,o){if(Gs){var u=md(o);if(u===null)td(e,n,o,Ys,a),kp(e,o);else if(Eb(u,e,n,a,o))o.stopPropagation();else if(kp(e,o),n&4&&-1<Cb.indexOf(e)){for(;u!==null;){var h=pa(u);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var _=qn(h.pendingLanes);if(_!==0){var D=h;for(D.pendingLanes|=2,D.entangledLanes|=2;_;){var W=1<<31-lt(_);D.entanglements[1]|=W,_&=~W}Sa(h),(xt&6)===0&&(zs=st()+500,vo(0))}}break;case 31:case 13:D=Ti(h,2),D!==null&&En(D,h,2),Rs(),pd(h,2)}if(h=md(o),h===null&&td(e,n,o,Ys,a),h===u)break;u=h}u!==null&&o.stopPropagation()}else td(e,n,o,null,a)}}function md(e){return e=Yi(e),yd(e)}var Ys=null;function yd(e){if(Ys=null,e=ha(e),e!==null){var n=d(e);if(n===null)e=null;else{var a=n.tag;if(a===13){if(e=f(n),e!==null)return e;e=null}else if(a===31){if(e=g(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return Ys=e,null}function zp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vt()){case kt:return 2;case Rt:return 8;case ut:case mn:return 32;case Ot:return 268435456;default:return 32}default:return 32}}var bd=!1,pi=null,gi=null,mi=null,To=new Map,No=new Map,yi=[],Cb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function kp(e,n){switch(e){case"focusin":case"focusout":pi=null;break;case"dragenter":case"dragleave":gi=null;break;case"mouseover":case"mouseout":mi=null;break;case"pointerover":case"pointerout":To.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":No.delete(n.pointerId)}}function Ao(e,n,a,o,u,h){return e===null||e.nativeEvent!==h?(e={blockedOn:n,domEventName:a,eventSystemFlags:o,nativeEvent:h,targetContainers:[u]},n!==null&&(n=pa(n),n!==null&&Np(n)),e):(e.eventSystemFlags|=o,n=e.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),e)}function Eb(e,n,a,o,u){switch(n){case"focusin":return pi=Ao(pi,e,n,a,o,u),!0;case"dragenter":return gi=Ao(gi,e,n,a,o,u),!0;case"mouseover":return mi=Ao(mi,e,n,a,o,u),!0;case"pointerover":var h=u.pointerId;return To.set(h,Ao(To.get(h)||null,e,n,a,o,u)),!0;case"gotpointercapture":return h=u.pointerId,No.set(h,Ao(No.get(h)||null,e,n,a,o,u)),!0}return!1}function Rp(e){var n=ha(e.target);if(n!==null){var a=d(n);if(a!==null){if(n=a.tag,n===13){if(n=f(a),n!==null){e.blockedOn=n,qr(e.priority,function(){Ap(a)});return}}else if(n===31){if(n=g(a),n!==null){e.blockedOn=n,qr(e.priority,function(){Ap(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ks(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=md(e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);Aa=o,a.target.dispatchEvent(o),Aa=null}else return n=pa(a),n!==null&&Np(n),e.blockedOn=a,!1;n.shift()}return!0}function Op(e,n,a){Ks(e)&&a.delete(n)}function Tb(){bd=!1,pi!==null&&Ks(pi)&&(pi=null),gi!==null&&Ks(gi)&&(gi=null),mi!==null&&Ks(mi)&&(mi=null),To.forEach(Op),No.forEach(Op)}function Js(e,n){e.blockedOn===n&&(e.blockedOn=null,bd||(bd=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,Tb)))}var Qs=null;function Dp(e){Qs!==e&&(Qs=e,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){Qs===e&&(Qs=null);for(var n=0;n<e.length;n+=3){var a=e[n],o=e[n+1],u=e[n+2];if(typeof o!="function"){if(yd(o||a)===null)continue;break}var h=pa(a);h!==null&&(e.splice(n,3),n-=3,mc(h,{pending:!0,data:u,method:a.method,action:o},o,u))}}))}function _r(e){function n(W){return Js(W,e)}pi!==null&&Js(pi,e),gi!==null&&Js(gi,e),mi!==null&&Js(mi,e),To.forEach(n),No.forEach(n);for(var a=0;a<yi.length;a++){var o=yi[a];o.blockedOn===e&&(o.blockedOn=null)}for(;0<yi.length&&(a=yi[0],a.blockedOn===null);)Rp(a),a.blockedOn===null&&yi.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(o=0;o<a.length;o+=3){var u=a[o],h=a[o+1],_=u[hn]||null;if(typeof h=="function")_||Dp(a);else if(_){var D=null;if(h&&h.hasAttribute("formAction")){if(u=h,_=h[hn]||null)D=_.formAction;else if(yd(u)!==null)continue}else D=_.action;typeof D=="function"?a[o+1]=D:(a.splice(o,3),o-=3),Dp(a)}}}function Bp(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(_){return u=_})},focusReset:"manual",scroll:"manual"})}function n(){u!==null&&(u(),u=null),o||setTimeout(a,20)}function a(){if(!o&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var o=!1,u=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(a,100),function(){o=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),u!==null&&(u(),u=null)}}}function xd(e){this._internalRoot=e}Xs.prototype.render=xd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(s(409));var a=n.current,o=Un();Ep(a,o,e,n,null,null)},Xs.prototype.unmount=xd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Ep(e.current,2,null,e,null,null),Rs(),n[vn]=null}};function Xs(e){this._internalRoot=e}Xs.prototype.unstable_scheduleHydration=function(e){if(e){var n=Po();e={blockedOn:null,target:e,priority:n};for(var a=0;a<yi.length&&n!==0&&n<yi[a].priority;a++);yi.splice(a,0,e),a===0&&Rp(e)}};var Up=i.version;if(Up!=="19.2.0")throw Error(s(527,Up,"19.2.0"));q.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=m(n),e=e!==null?b(e):null,e=e===null?null:e.stateNode,e};var Nb={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zs.isDisabled&&Zs.supportsFiber)try{qe=Zs.inject(Nb),et=Zs}catch{}}return ko.createRoot=function(e,n){if(!c(e))throw Error(s(299));var a=!1,o="",u=Pf,h=Ff,_=Vf;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onUncaughtError!==void 0&&(u=n.onUncaughtError),n.onCaughtError!==void 0&&(h=n.onCaughtError),n.onRecoverableError!==void 0&&(_=n.onRecoverableError)),n=wp(e,1,!1,null,null,a,o,null,u,h,_,Bp),e[vn]=n.current,ed(e),new xd(n)},ko.hydrateRoot=function(e,n,a){if(!c(e))throw Error(s(299));var o=!1,u="",h=Pf,_=Ff,D=Vf,W=null;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(h=a.onUncaughtError),a.onCaughtError!==void 0&&(_=a.onCaughtError),a.onRecoverableError!==void 0&&(D=a.onRecoverableError),a.formState!==void 0&&(W=a.formState)),n=wp(e,1,!0,n,a??null,o,u,W,h,_,D,Bp),n.context=Cp(null),a=n.current,o=Un(),o=Ir(o),u=ni(o),u.callback=null,ai(a,u,o),a=o,n.current.lanes=a,Si(n,a),Sa(n),e[vn]=n.current,ed(e),new Xs(n)},ko.version="19.2.0",ko}var Wp;function Mb(){if(Wp)return jd.exports;Wp=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(i){console.error(i)}}return l(),jd.exports=Ib(),jd.exports}var qb=Mb(),y=Yd();const Dr=wg(y);var Bd=function(l,i){return Bd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(r[c]=s[c])},Bd(l,i)};function Eg(l,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");Bd(l,i);function r(){this.constructor=l}l.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}var cl=function(){return cl=Object.assign||function(i){for(var r,s=1,c=arguments.length;s<c;s++){r=arguments[s];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(i[d]=r[d])}return i},cl.apply(this,arguments)};function Br(l,i){var r={};for(var s in l)Object.prototype.hasOwnProperty.call(l,s)&&i.indexOf(s)<0&&(r[s]=l[s]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(l);c<s.length;c++)i.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(l,s[c])&&(r[s[c]]=l[s[c]]);return r}function Tg(l,i,r,s){var c=arguments.length,d=c<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(l,i,r,s);else for(var g=l.length-1;g>=0;g--)(f=l[g])&&(d=(c<3?f(d):c>3?f(i,r,d):f(i,r))||d);return c>3&&d&&Object.defineProperty(i,r,d),d}function Ng(l,i){return function(r,s){i(r,s,l)}}function Ag(l,i,r,s,c,d){function f(T){if(T!==void 0&&typeof T!="function")throw new TypeError("Function expected");return T}for(var g=s.kind,p=g==="getter"?"get":g==="setter"?"set":"value",m=!i&&l?s.static?l:l.prototype:null,b=i||(m?Object.getOwnPropertyDescriptor(m,s.name):{}),S,j=!1,x=r.length-1;x>=0;x--){var w={};for(var v in s)w[v]=v==="access"?{}:s[v];for(var v in s.access)w.access[v]=s.access[v];w.addInitializer=function(T){if(j)throw new TypeError("Cannot add initializers after decoration has completed");d.push(f(T||null))};var E=(0,r[x])(g==="accessor"?{get:b.get,set:b.set}:b[p],w);if(g==="accessor"){if(E===void 0)continue;if(E===null||typeof E!="object")throw new TypeError("Object expected");(S=f(E.get))&&(b.get=S),(S=f(E.set))&&(b.set=S),(S=f(E.init))&&c.unshift(S)}else(S=f(E))&&(g==="field"?c.unshift(S):b[p]=S)}m&&Object.defineProperty(m,s.name,b),j=!0}function zg(l,i,r){for(var s=arguments.length>2,c=0;c<i.length;c++)r=s?i[c].call(l,r):i[c].call(l);return s?r:void 0}function kg(l){return typeof l=="symbol"?l:"".concat(l)}function Rg(l,i,r){return typeof i=="symbol"&&(i=i.description?"[".concat(i.description,"]"):""),Object.defineProperty(l,"name",{configurable:!0,value:r?"".concat(r," ",i):i})}function Og(l,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,i)}function Pe(l,i,r,s){function c(d){return d instanceof r?d:new r(function(f){f(d)})}return new(r||(r=Promise))(function(d,f){function g(b){try{m(s.next(b))}catch(S){f(S)}}function p(b){try{m(s.throw(b))}catch(S){f(S)}}function m(b){b.done?d(b.value):c(b.value).then(g,p)}m((s=s.apply(l,i||[])).next())})}function Dg(l,i){var r={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},s,c,d,f=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return f.next=g(0),f.throw=g(1),f.return=g(2),typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function g(m){return function(b){return p([m,b])}}function p(m){if(s)throw new TypeError("Generator is already executing.");for(;f&&(f=0,m[0]&&(r=0)),r;)try{if(s=1,c&&(d=m[0]&2?c.return:m[0]?c.throw||((d=c.return)&&d.call(c),0):c.next)&&!(d=d.call(c,m[1])).done)return d;switch(c=0,d&&(m=[m[0]&2,d.value]),m[0]){case 0:case 1:d=m;break;case 4:return r.label++,{value:m[1],done:!1};case 5:r.label++,c=m[1],m=[0];continue;case 7:m=r.ops.pop(),r.trys.pop();continue;default:if(d=r.trys,!(d=d.length>0&&d[d.length-1])&&(m[0]===6||m[0]===2)){r=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){r.label=m[1];break}if(m[0]===6&&r.label<d[1]){r.label=d[1],d=m;break}if(d&&r.label<d[2]){r.label=d[2],r.ops.push(m);break}d[2]&&r.ops.pop(),r.trys.pop();continue}m=i.call(l,r)}catch(b){m=[6,b],c=0}finally{s=d=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}var ml=Object.create?(function(l,i,r,s){s===void 0&&(s=r);var c=Object.getOwnPropertyDescriptor(i,r);(!c||("get"in c?!i.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return i[r]}}),Object.defineProperty(l,s,c)}):(function(l,i,r,s){s===void 0&&(s=r),l[s]=i[r]});function Bg(l,i){for(var r in l)r!=="default"&&!Object.prototype.hasOwnProperty.call(i,r)&&ml(i,l,r)}function dl(l){var i=typeof Symbol=="function"&&Symbol.iterator,r=i&&l[i],s=0;if(r)return r.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&s>=l.length&&(l=void 0),{value:l&&l[s++],done:!l}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kd(l,i){var r=typeof Symbol=="function"&&l[Symbol.iterator];if(!r)return l;var s=r.call(l),c,d=[],f;try{for(;(i===void 0||i-- >0)&&!(c=s.next()).done;)d.push(c.value)}catch(g){f={error:g}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return d}function Ug(){for(var l=[],i=0;i<arguments.length;i++)l=l.concat(Kd(arguments[i]));return l}function Lg(){for(var l=0,i=0,r=arguments.length;i<r;i++)l+=arguments[i].length;for(var s=Array(l),c=0,i=0;i<r;i++)for(var d=arguments[i],f=0,g=d.length;f<g;f++,c++)s[c]=d[f];return s}function Ig(l,i,r){if(r||arguments.length===2)for(var s=0,c=i.length,d;s<c;s++)(d||!(s in i))&&(d||(d=Array.prototype.slice.call(i,0,s)),d[s]=i[s]);return l.concat(d||Array.prototype.slice.call(i))}function Or(l){return this instanceof Or?(this.v=l,this):new Or(l)}function Mg(l,i,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(l,i||[]),c,d=[];return c=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),g("next"),g("throw"),g("return",f),c[Symbol.asyncIterator]=function(){return this},c;function f(x){return function(w){return Promise.resolve(w).then(x,S)}}function g(x,w){s[x]&&(c[x]=function(v){return new Promise(function(E,T){d.push([x,v,E,T])>1||p(x,v)})},w&&(c[x]=w(c[x])))}function p(x,w){try{m(s[x](w))}catch(v){j(d[0][3],v)}}function m(x){x.value instanceof Or?Promise.resolve(x.value.v).then(b,S):j(d[0][2],x)}function b(x){p("next",x)}function S(x){p("throw",x)}function j(x,w){x(w),d.shift(),d.length&&p(d[0][0],d[0][1])}}function qg(l){var i,r;return i={},s("next"),s("throw",function(c){throw c}),s("return"),i[Symbol.iterator]=function(){return this},i;function s(c,d){i[c]=l[c]?function(f){return(r=!r)?{value:Or(l[c](f)),done:!1}:d?d(f):f}:d}}function $g(l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=l[Symbol.asyncIterator],r;return i?i.call(l):(l=typeof dl=="function"?dl(l):l[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(d){r[d]=l[d]&&function(f){return new Promise(function(g,p){f=l[d](f),c(g,p,f.done,f.value)})}}function c(d,f,g,p){Promise.resolve(p).then(function(m){d({value:m,done:g})},f)}}function Hg(l,i){return Object.defineProperty?Object.defineProperty(l,"raw",{value:i}):l.raw=i,l}var $b=Object.create?(function(l,i){Object.defineProperty(l,"default",{enumerable:!0,value:i})}):function(l,i){l.default=i},Ud=function(l){return Ud=Object.getOwnPropertyNames||function(i){var r=[];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[r.length]=s);return r},Ud(l)};function Pg(l){if(l&&l.__esModule)return l;var i={};if(l!=null)for(var r=Ud(l),s=0;s<r.length;s++)r[s]!=="default"&&ml(i,l,r[s]);return $b(i,l),i}function Fg(l){return l&&l.__esModule?l:{default:l}}function Vg(l,i,r,s){if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?l!==i||!s:!i.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?s:r==="a"?s.call(l):s?s.value:i.get(l)}function Wg(l,i,r,s,c){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof i=="function"?l!==i||!c:!i.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?c.call(l,r):c?c.value=r:i.set(l,r),r}function Gg(l,i){if(i===null||typeof i!="object"&&typeof i!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof l=="function"?i===l:l.has(i)}function Yg(l,i,r){if(i!=null){if(typeof i!="object"&&typeof i!="function")throw new TypeError("Object expected.");var s,c;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=i[Symbol.asyncDispose]}if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=i[Symbol.dispose],r&&(c=s)}if(typeof s!="function")throw new TypeError("Object not disposable.");c&&(s=function(){try{c.call(this)}catch(d){return Promise.reject(d)}}),l.stack.push({value:i,dispose:s,async:r})}else r&&l.stack.push({async:!0});return i}var Hb=typeof SuppressedError=="function"?SuppressedError:function(l,i,r){var s=new Error(r);return s.name="SuppressedError",s.error=l,s.suppressed=i,s};function Kg(l){function i(d){l.error=l.hasError?new Hb(d,l.error,"An error was suppressed during disposal."):d,l.hasError=!0}var r,s=0;function c(){for(;r=l.stack.pop();)try{if(!r.async&&s===1)return s=0,l.stack.push(r),Promise.resolve().then(c);if(r.dispose){var d=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(d).then(c,function(f){return i(f),c()})}else s|=1}catch(f){i(f)}if(s===1)return l.hasError?Promise.reject(l.error):Promise.resolve();if(l.hasError)throw l.error}return c()}function Jg(l,i){return typeof l=="string"&&/^\.\.?\//.test(l)?l.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,s,c,d,f){return s?i?".jsx":".js":c&&(!d||!f)?r:c+d+"."+f.toLowerCase()+"js"}):l}const Pb={__extends:Eg,__assign:cl,__rest:Br,__decorate:Tg,__param:Ng,__esDecorate:Ag,__runInitializers:zg,__propKey:kg,__setFunctionName:Rg,__metadata:Og,__awaiter:Pe,__generator:Dg,__createBinding:ml,__exportStar:Bg,__values:dl,__read:Kd,__spread:Ug,__spreadArrays:Lg,__spreadArray:Ig,__await:Or,__asyncGenerator:Mg,__asyncDelegator:qg,__asyncValues:$g,__makeTemplateObject:Hg,__importStar:Pg,__importDefault:Fg,__classPrivateFieldGet:Vg,__classPrivateFieldSet:Wg,__classPrivateFieldIn:Gg,__addDisposableResource:Yg,__disposeResources:Kg,__rewriteRelativeImportExtension:Jg},Fb=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Yg,get __assign(){return cl},__asyncDelegator:qg,__asyncGenerator:Mg,__asyncValues:$g,__await:Or,__awaiter:Pe,__classPrivateFieldGet:Vg,__classPrivateFieldIn:Gg,__classPrivateFieldSet:Wg,__createBinding:ml,__decorate:Tg,__disposeResources:Kg,__esDecorate:Ag,__exportStar:Bg,__extends:Eg,__generator:Dg,__importDefault:Fg,__importStar:Pg,__makeTemplateObject:Hg,__metadata:Og,__param:Ng,__propKey:kg,__read:Kd,__rest:Br,__rewriteRelativeImportExtension:Jg,__runInitializers:zg,__setFunctionName:Rg,__spread:Ug,__spreadArray:Ig,__spreadArrays:Lg,__values:dl,default:Pb},Symbol.toStringTag,{value:"Module"})),Vb=l=>l?(...i)=>l(...i):(...i)=>fetch(...i);class Jd extends Error{constructor(i,r="FunctionsError",s){super(i),this.name=r,this.context=s}}class Wb extends Jd{constructor(i){super("Failed to send a request to the Edge Function","FunctionsFetchError",i)}}class Gp extends Jd{constructor(i){super("Relay Error invoking the Edge Function","FunctionsRelayError",i)}}class Yp extends Jd{constructor(i){super("Edge Function returned a non-2xx status code","FunctionsHttpError",i)}}var Ld;(function(l){l.Any="any",l.ApNortheast1="ap-northeast-1",l.ApNortheast2="ap-northeast-2",l.ApSouth1="ap-south-1",l.ApSoutheast1="ap-southeast-1",l.ApSoutheast2="ap-southeast-2",l.CaCentral1="ca-central-1",l.EuCentral1="eu-central-1",l.EuWest1="eu-west-1",l.EuWest2="eu-west-2",l.EuWest3="eu-west-3",l.SaEast1="sa-east-1",l.UsEast1="us-east-1",l.UsWest1="us-west-1",l.UsWest2="us-west-2"})(Ld||(Ld={}));class Gb{constructor(i,{headers:r={},customFetch:s,region:c=Ld.Any}={}){this.url=i,this.headers=r,this.region=c,this.fetch=Vb(s)}setAuth(i){this.headers.Authorization=`Bearer ${i}`}invoke(i){return Pe(this,arguments,void 0,function*(r,s={}){var c;let d,f;try{const{headers:g,method:p,body:m,signal:b,timeout:S}=s;let j={},{region:x}=s;x||(x=this.region);const w=new URL(`${this.url}/${r}`);x&&x!=="any"&&(j["x-region"]=x,w.searchParams.set("forceFunctionRegion",x));let v;m&&(g&&!Object.prototype.hasOwnProperty.call(g,"Content-Type")||!g)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(j["Content-Type"]="application/octet-stream",v=m):typeof m=="string"?(j["Content-Type"]="text/plain",v=m):typeof FormData<"u"&&m instanceof FormData?v=m:(j["Content-Type"]="application/json",v=JSON.stringify(m)):v=m;let E=b;S&&(f=new AbortController,d=setTimeout(()=>f.abort(),S),b?(E=f.signal,b.addEventListener("abort",()=>f.abort())):E=f.signal);const T=yield this.fetch(w.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},j),this.headers),g),body:v,signal:E}).catch(C=>{throw new Wb(C)}),L=T.headers.get("x-relay-error");if(L&&L==="true")throw new Gp(T);if(!T.ok)throw new Yp(T);let R=((c=T.headers.get("Content-Type"))!==null&&c!==void 0?c:"text/plain").split(";")[0].trim(),z;return R==="application/json"?z=yield T.json():R==="application/octet-stream"||R==="application/pdf"?z=yield T.blob():R==="text/event-stream"?z=T:R==="multipart/form-data"?z=yield T.formData():z=yield T.text(),{data:z,error:null,response:T}}catch(g){return{data:null,error:g,response:g instanceof Yp||g instanceof Gp?g.context:void 0}}finally{d&&clearTimeout(d)}})}}var gn={};const Ur=kb(Fb);var el={},tl={},nl={},al={},il={},rl={},Kp;function Qg(){if(Kp)return rl;Kp=1,Object.defineProperty(rl,"__esModule",{value:!0});class l extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return rl.default=l,rl}var Jp;function Xg(){if(Jp)return il;Jp=1,Object.defineProperty(il,"__esModule",{value:!0});const i=Ur.__importDefault(Qg());class r{constructor(c){var d,f;this.shouldThrowOnError=!1,this.method=c.method,this.url=c.url,this.headers=new Headers(c.headers),this.schema=c.schema,this.body=c.body,this.shouldThrowOnError=(d=c.shouldThrowOnError)!==null&&d!==void 0?d:!1,this.signal=c.signal,this.isMaybeSingle=(f=c.isMaybeSingle)!==null&&f!==void 0?f:!1,c.fetch?this.fetch=c.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(c,d){return this.headers=new Headers(this.headers),this.headers.set(c,d),this}then(c,d){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const f=this.fetch;let g=f(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async p=>{var m,b,S,j;let x=null,w=null,v=null,E=p.status,T=p.statusText;if(p.ok){if(this.method!=="HEAD"){const C=await p.text();C===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((m=this.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?w=C:w=JSON.parse(C))}const R=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),z=(S=p.headers.get("content-range"))===null||S===void 0?void 0:S.split("/");R&&z&&z.length>1&&(v=parseInt(z[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(w)&&(w.length>1?(x={code:"PGRST116",details:`Results contain ${w.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},w=null,v=null,E=406,T="Not Acceptable"):w.length===1?w=w[0]:w=null)}else{const R=await p.text();try{x=JSON.parse(R),Array.isArray(x)&&p.status===404&&(w=[],x=null,E=200,T="OK")}catch{p.status===404&&R===""?(E=204,T="No Content"):x={message:R}}if(x&&this.isMaybeSingle&&(!((j=x?.details)===null||j===void 0)&&j.includes("0 rows"))&&(x=null,E=200,T="OK"),x&&this.shouldThrowOnError)throw new i.default(x)}return{error:x,data:w,count:v,status:E,statusText:T}});return this.shouldThrowOnError||(g=g.catch(p=>{var m,b,S;return{error:{message:`${(m=p?.name)!==null&&m!==void 0?m:"FetchError"}: ${p?.message}`,details:`${(b=p?.stack)!==null&&b!==void 0?b:""}`,hint:"",code:`${(S=p?.code)!==null&&S!==void 0?S:""}`},data:null,count:null,status:0,statusText:""}})),g.then(c,d)}returns(){return this}overrideTypes(){return this}}return il.default=r,il}var Qp;function Zg(){if(Qp)return al;Qp=1,Object.defineProperty(al,"__esModule",{value:!0});const i=Ur.__importDefault(Xg());class r extends i.default{select(c){let d=!1;const f=(c??"*").split("").map(g=>/\s/.test(g)&&!d?"":(g==='"'&&(d=!d),g)).join("");return this.url.searchParams.set("select",f),this.headers.append("Prefer","return=representation"),this}order(c,{ascending:d=!0,nullsFirst:f,foreignTable:g,referencedTable:p=g}={}){const m=p?`${p}.order`:"order",b=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${b?`${b},`:""}${c}.${d?"asc":"desc"}${f===void 0?"":f?".nullsfirst":".nullslast"}`),this}limit(c,{foreignTable:d,referencedTable:f=d}={}){const g=typeof f>"u"?"limit":`${f}.limit`;return this.url.searchParams.set(g,`${c}`),this}range(c,d,{foreignTable:f,referencedTable:g=f}={}){const p=typeof g>"u"?"offset":`${g}.offset`,m=typeof g>"u"?"limit":`${g}.limit`;return this.url.searchParams.set(p,`${c}`),this.url.searchParams.set(m,`${d-c+1}`),this}abortSignal(c){return this.signal=c,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:c=!1,verbose:d=!1,settings:f=!1,buffers:g=!1,wal:p=!1,format:m="text"}={}){var b;const S=[c?"analyze":null,d?"verbose":null,f?"settings":null,g?"buffers":null,p?"wal":null].filter(Boolean).join("|"),j=(b=this.headers.get("Accept"))!==null&&b!==void 0?b:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${j}"; options=${S};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(c){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${c}`),this}}return al.default=r,al}var Xp;function Qd(){if(Xp)return nl;Xp=1,Object.defineProperty(nl,"__esModule",{value:!0});const i=Ur.__importDefault(Zg()),r=new RegExp("[,()]");class s extends i.default{eq(d,f){return this.url.searchParams.append(d,`eq.${f}`),this}neq(d,f){return this.url.searchParams.append(d,`neq.${f}`),this}gt(d,f){return this.url.searchParams.append(d,`gt.${f}`),this}gte(d,f){return this.url.searchParams.append(d,`gte.${f}`),this}lt(d,f){return this.url.searchParams.append(d,`lt.${f}`),this}lte(d,f){return this.url.searchParams.append(d,`lte.${f}`),this}like(d,f){return this.url.searchParams.append(d,`like.${f}`),this}likeAllOf(d,f){return this.url.searchParams.append(d,`like(all).{${f.join(",")}}`),this}likeAnyOf(d,f){return this.url.searchParams.append(d,`like(any).{${f.join(",")}}`),this}ilike(d,f){return this.url.searchParams.append(d,`ilike.${f}`),this}ilikeAllOf(d,f){return this.url.searchParams.append(d,`ilike(all).{${f.join(",")}}`),this}ilikeAnyOf(d,f){return this.url.searchParams.append(d,`ilike(any).{${f.join(",")}}`),this}is(d,f){return this.url.searchParams.append(d,`is.${f}`),this}in(d,f){const g=Array.from(new Set(f)).map(p=>typeof p=="string"&&r.test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(d,`in.(${g})`),this}contains(d,f){return typeof f=="string"?this.url.searchParams.append(d,`cs.${f}`):Array.isArray(f)?this.url.searchParams.append(d,`cs.{${f.join(",")}}`):this.url.searchParams.append(d,`cs.${JSON.stringify(f)}`),this}containedBy(d,f){return typeof f=="string"?this.url.searchParams.append(d,`cd.${f}`):Array.isArray(f)?this.url.searchParams.append(d,`cd.{${f.join(",")}}`):this.url.searchParams.append(d,`cd.${JSON.stringify(f)}`),this}rangeGt(d,f){return this.url.searchParams.append(d,`sr.${f}`),this}rangeGte(d,f){return this.url.searchParams.append(d,`nxl.${f}`),this}rangeLt(d,f){return this.url.searchParams.append(d,`sl.${f}`),this}rangeLte(d,f){return this.url.searchParams.append(d,`nxr.${f}`),this}rangeAdjacent(d,f){return this.url.searchParams.append(d,`adj.${f}`),this}overlaps(d,f){return typeof f=="string"?this.url.searchParams.append(d,`ov.${f}`):this.url.searchParams.append(d,`ov.{${f.join(",")}}`),this}textSearch(d,f,{config:g,type:p}={}){let m="";p==="plain"?m="pl":p==="phrase"?m="ph":p==="websearch"&&(m="w");const b=g===void 0?"":`(${g})`;return this.url.searchParams.append(d,`${m}fts${b}.${f}`),this}match(d){return Object.entries(d).forEach(([f,g])=>{this.url.searchParams.append(f,`eq.${g}`)}),this}not(d,f,g){return this.url.searchParams.append(d,`not.${f}.${g}`),this}or(d,{foreignTable:f,referencedTable:g=f}={}){const p=g?`${g}.or`:"or";return this.url.searchParams.append(p,`(${d})`),this}filter(d,f,g){return this.url.searchParams.append(d,`${f}.${g}`),this}}return nl.default=s,nl}var Zp;function em(){if(Zp)return tl;Zp=1,Object.defineProperty(tl,"__esModule",{value:!0});const i=Ur.__importDefault(Qd());class r{constructor(c,{headers:d={},schema:f,fetch:g}){this.url=c,this.headers=new Headers(d),this.schema=f,this.fetch=g}select(c,d){const{head:f=!1,count:g}=d??{},p=f?"HEAD":"GET";let m=!1;const b=(c??"*").split("").map(S=>/\s/.test(S)&&!m?"":(S==='"'&&(m=!m),S)).join("");return this.url.searchParams.set("select",b),g&&this.headers.append("Prefer",`count=${g}`),new i.default({method:p,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(c,{count:d,defaultToNull:f=!0}={}){var g;const p="POST";if(d&&this.headers.append("Prefer",`count=${d}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(c)){const m=c.reduce((b,S)=>b.concat(Object.keys(S)),[]);if(m.length>0){const b=[...new Set(m)].map(S=>`"${S}"`);this.url.searchParams.set("columns",b.join(","))}}return new i.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:c,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}upsert(c,{onConflict:d,ignoreDuplicates:f=!1,count:g,defaultToNull:p=!0}={}){var m;const b="POST";if(this.headers.append("Prefer",`resolution=${f?"ignore":"merge"}-duplicates`),d!==void 0&&this.url.searchParams.set("on_conflict",d),g&&this.headers.append("Prefer",`count=${g}`),p||this.headers.append("Prefer","missing=default"),Array.isArray(c)){const S=c.reduce((j,x)=>j.concat(Object.keys(x)),[]);if(S.length>0){const j=[...new Set(S)].map(x=>`"${x}"`);this.url.searchParams.set("columns",j.join(","))}}return new i.default({method:b,url:this.url,headers:this.headers,schema:this.schema,body:c,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(c,{count:d}={}){var f;const g="PATCH";return d&&this.headers.append("Prefer",`count=${d}`),new i.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:c,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}delete({count:c}={}){var d;const f="DELETE";return c&&this.headers.append("Prefer",`count=${c}`),new i.default({method:f,url:this.url,headers:this.headers,schema:this.schema,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return tl.default=r,tl}var eg;function Yb(){if(eg)return el;eg=1,Object.defineProperty(el,"__esModule",{value:!0});const l=Ur,i=l.__importDefault(em()),r=l.__importDefault(Qd());class s{constructor(d,{headers:f={},schema:g,fetch:p}={}){this.url=d,this.headers=new Headers(f),this.schemaName=g,this.fetch=p}from(d){const f=new URL(`${this.url}/${d}`);return new i.default(f,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(d){return new s(this.url,{headers:this.headers,schema:d,fetch:this.fetch})}rpc(d,f={},{head:g=!1,get:p=!1,count:m}={}){var b;let S;const j=new URL(`${this.url}/rpc/${d}`);let x;g||p?(S=g?"HEAD":"GET",Object.entries(f).filter(([v,E])=>E!==void 0).map(([v,E])=>[v,Array.isArray(E)?`{${E.join(",")}}`:`${E}`]).forEach(([v,E])=>{j.searchParams.append(v,E)})):(S="POST",x=f);const w=new Headers(this.headers);return m&&w.set("Prefer",`count=${m}`),new r.default({method:S,url:j,headers:w,schema:this.schemaName,body:x,fetch:(b=this.fetch)!==null&&b!==void 0?b:fetch})}}return el.default=s,el}var tg;function Kb(){if(tg)return gn;tg=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.PostgrestError=gn.PostgrestBuilder=gn.PostgrestTransformBuilder=gn.PostgrestFilterBuilder=gn.PostgrestQueryBuilder=gn.PostgrestClient=void 0;const l=Ur,i=l.__importDefault(Yb());gn.PostgrestClient=i.default;const r=l.__importDefault(em());gn.PostgrestQueryBuilder=r.default;const s=l.__importDefault(Qd());gn.PostgrestFilterBuilder=s.default;const c=l.__importDefault(Zg());gn.PostgrestTransformBuilder=c.default;const d=l.__importDefault(Xg());gn.PostgrestBuilder=d.default;const f=l.__importDefault(Qg());return gn.PostgrestError=f.default,gn.default={PostgrestClient:i.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:c.default,PostgrestBuilder:d.default,PostgrestError:f.default},gn}var tm=Kb();const nm=wg(tm),Jb=zb({__proto__:null,default:nm},[tm]),{PostgrestClient:Qb,PostgrestQueryBuilder:p1,PostgrestFilterBuilder:g1,PostgrestTransformBuilder:m1,PostgrestBuilder:y1,PostgrestError:b1}=nm||Jb;class Xb{static detectEnvironment(){var i;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((i=navigator.userAgent)===null||i===void 0)&&i.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const s=r.node,c=parseInt(s.replace(/^v/,"").split(".")[0]);return c>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${c} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${c} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const i=this.detectEnvironment();if(i.constructor)return i.constructor;let r=i.error||"WebSocket not supported in this environment.";throw i.workaround&&(r+=`

Suggested solution: ${i.workaround}`),new Error(r)}static createWebSocket(i,r){const s=this.getWebSocketConstructor();return new s(i,r)}static isWebSocketSupported(){try{const i=this.detectEnvironment();return i.type==="native"||i.type==="ws"}catch{return!1}}}const Zb="2.81.1",e0=`realtime-js/${Zb}`,am="1.0.0",t0="2.0.0",ng=am,Id=1e4,n0=1e3,a0=100;var Pi;(function(l){l[l.connecting=0]="connecting",l[l.open=1]="open",l[l.closing=2]="closing",l[l.closed=3]="closed"})(Pi||(Pi={}));var en;(function(l){l.closed="closed",l.errored="errored",l.joined="joined",l.joining="joining",l.leaving="leaving"})(en||(en={}));var Qn;(function(l){l.close="phx_close",l.error="phx_error",l.join="phx_join",l.reply="phx_reply",l.leave="phx_leave",l.access_token="access_token"})(Qn||(Qn={}));var Md;(function(l){l.websocket="websocket"})(Md||(Md={}));var Fi;(function(l){l.Connecting="connecting",l.Open="open",l.Closing="closing",l.Closed="closed"})(Fi||(Fi={}));class i0{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(i,r){if(this._isArrayBuffer(i.payload))return r(this._binaryEncodePush(i));if(i.event===this.BROADCAST&&!(i.payload instanceof ArrayBuffer)&&typeof i.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(i));let s=[i.join_ref,i.ref,i.topic,i.event,i.payload];return r(JSON.stringify(s))}_binaryEncodePush(i){const{join_ref:r,ref:s,event:c,topic:d,payload:f}=i,g=this.META_LENGTH+r.length+s.length+d.length+c.length,p=new ArrayBuffer(this.HEADER_LENGTH+g);let m=new DataView(p),b=0;m.setUint8(b++,this.KINDS.push),m.setUint8(b++,r.length),m.setUint8(b++,s.length),m.setUint8(b++,d.length),m.setUint8(b++,c.length),Array.from(r,j=>m.setUint8(b++,j.charCodeAt(0))),Array.from(s,j=>m.setUint8(b++,j.charCodeAt(0))),Array.from(d,j=>m.setUint8(b++,j.charCodeAt(0))),Array.from(c,j=>m.setUint8(b++,j.charCodeAt(0)));var S=new Uint8Array(p.byteLength+f.byteLength);return S.set(new Uint8Array(p),0),S.set(new Uint8Array(f),p.byteLength),S.buffer}_binaryEncodeUserBroadcastPush(i){var r;return this._isArrayBuffer((r=i.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(i):this._encodeJsonUserBroadcastPush(i)}_encodeBinaryUserBroadcastPush(i){var r,s;const{join_ref:c,ref:d,topic:f}=i,g=i.payload.event,p=(s=(r=i.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:new ArrayBuffer(0),m=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+d.length+f.length+g.length,b=new ArrayBuffer(this.HEADER_LENGTH+m);let S=new DataView(b),j=0;S.setUint8(j++,this.KINDS.userBroadcastPush),S.setUint8(j++,c.length),S.setUint8(j++,d.length),S.setUint8(j++,f.length),S.setUint8(j++,g.length),S.setUint8(j++,this.BINARY_ENCODING),Array.from(c,w=>S.setUint8(j++,w.charCodeAt(0))),Array.from(d,w=>S.setUint8(j++,w.charCodeAt(0))),Array.from(f,w=>S.setUint8(j++,w.charCodeAt(0))),Array.from(g,w=>S.setUint8(j++,w.charCodeAt(0)));var x=new Uint8Array(b.byteLength+p.byteLength);return x.set(new Uint8Array(b),0),x.set(new Uint8Array(p),b.byteLength),x.buffer}_encodeJsonUserBroadcastPush(i){var r,s;const{join_ref:c,ref:d,topic:f}=i,g=i.payload.event,p=(s=(r=i.payload)===null||r===void 0?void 0:r.payload)!==null&&s!==void 0?s:{},b=new TextEncoder().encode(JSON.stringify(p)).buffer,S=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+d.length+f.length+g.length,j=new ArrayBuffer(this.HEADER_LENGTH+S);let x=new DataView(j),w=0;x.setUint8(w++,this.KINDS.userBroadcastPush),x.setUint8(w++,c.length),x.setUint8(w++,d.length),x.setUint8(w++,f.length),x.setUint8(w++,g.length),x.setUint8(w++,this.JSON_ENCODING),Array.from(c,E=>x.setUint8(w++,E.charCodeAt(0))),Array.from(d,E=>x.setUint8(w++,E.charCodeAt(0))),Array.from(f,E=>x.setUint8(w++,E.charCodeAt(0))),Array.from(g,E=>x.setUint8(w++,E.charCodeAt(0)));var v=new Uint8Array(j.byteLength+b.byteLength);return v.set(new Uint8Array(j),0),v.set(new Uint8Array(b),j.byteLength),v.buffer}decode(i,r){if(this._isArrayBuffer(i)){let s=this._binaryDecode(i);return r(s)}if(typeof i=="string"){const s=JSON.parse(i),[c,d,f,g,p]=s;return r({join_ref:c,ref:d,topic:f,event:g,payload:p})}return r({})}_binaryDecode(i){const r=new DataView(i),s=r.getUint8(0),c=new TextDecoder;switch(s){case this.KINDS.push:return this._decodePush(i,r,c);case this.KINDS.reply:return this._decodeReply(i,r,c);case this.KINDS.broadcast:return this._decodeBroadcast(i,r,c);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(i,r,c)}}_decodePush(i,r,s){const c=r.getUint8(1),d=r.getUint8(2),f=r.getUint8(3);let g=this.HEADER_LENGTH+this.META_LENGTH-1;const p=s.decode(i.slice(g,g+c));g=g+c;const m=s.decode(i.slice(g,g+d));g=g+d;const b=s.decode(i.slice(g,g+f));g=g+f;const S=JSON.parse(s.decode(i.slice(g,i.byteLength)));return{join_ref:p,ref:null,topic:m,event:b,payload:S}}_decodeReply(i,r,s){const c=r.getUint8(1),d=r.getUint8(2),f=r.getUint8(3),g=r.getUint8(4);let p=this.HEADER_LENGTH+this.META_LENGTH;const m=s.decode(i.slice(p,p+c));p=p+c;const b=s.decode(i.slice(p,p+d));p=p+d;const S=s.decode(i.slice(p,p+f));p=p+f;const j=s.decode(i.slice(p,p+g));p=p+g;const x=JSON.parse(s.decode(i.slice(p,i.byteLength))),w={status:j,response:x};return{join_ref:m,ref:b,topic:S,event:Qn.reply,payload:w}}_decodeBroadcast(i,r,s){const c=r.getUint8(1),d=r.getUint8(2);let f=this.HEADER_LENGTH+2;const g=s.decode(i.slice(f,f+c));f=f+c;const p=s.decode(i.slice(f,f+d));f=f+d;const m=JSON.parse(s.decode(i.slice(f,i.byteLength)));return{join_ref:null,ref:null,topic:g,event:p,payload:m}}_decodeUserBroadcast(i,r,s){const c=r.getUint8(1),d=r.getUint8(2),f=r.getUint8(3),g=r.getUint8(4);let p=this.HEADER_LENGTH+4;const m=s.decode(i.slice(p,p+c));p=p+c;const b=s.decode(i.slice(p,p+d));p=p+d;const S=s.decode(i.slice(p,p+f));p=p+f;const j=i.slice(p,i.byteLength),x=g===this.JSON_ENCODING?JSON.parse(s.decode(j)):j,w={type:this.BROADCAST,event:b,payload:x};return f>0&&(w.meta=JSON.parse(S)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST,payload:w}}_isArrayBuffer(i){var r;return i instanceof ArrayBuffer||((r=i?.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class im{constructor(i,r){this.callback=i,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=i,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Tt;(function(l){l.abstime="abstime",l.bool="bool",l.date="date",l.daterange="daterange",l.float4="float4",l.float8="float8",l.int2="int2",l.int4="int4",l.int4range="int4range",l.int8="int8",l.int8range="int8range",l.json="json",l.jsonb="jsonb",l.money="money",l.numeric="numeric",l.oid="oid",l.reltime="reltime",l.text="text",l.time="time",l.timestamp="timestamp",l.timestamptz="timestamptz",l.timetz="timetz",l.tsrange="tsrange",l.tstzrange="tstzrange"})(Tt||(Tt={}));const ag=(l,i,r={})=>{var s;const c=(s=r.skipTypes)!==null&&s!==void 0?s:[];return i?Object.keys(i).reduce((d,f)=>(d[f]=r0(f,l,i,c),d),{}):{}},r0=(l,i,r,s)=>{const c=i.find(g=>g.name===l),d=c?.type,f=r[l];return d&&!s.includes(d)?rm(d,f):qd(f)},rm=(l,i)=>{if(l.charAt(0)==="_"){const r=l.slice(1,l.length);return c0(i,r)}switch(l){case Tt.bool:return o0(i);case Tt.float4:case Tt.float8:case Tt.int2:case Tt.int4:case Tt.int8:case Tt.numeric:case Tt.oid:return s0(i);case Tt.json:case Tt.jsonb:return l0(i);case Tt.timestamp:return d0(i);case Tt.abstime:case Tt.date:case Tt.daterange:case Tt.int4range:case Tt.int8range:case Tt.money:case Tt.reltime:case Tt.text:case Tt.time:case Tt.timestamptz:case Tt.timetz:case Tt.tsrange:case Tt.tstzrange:return qd(i);default:return qd(i)}},qd=l=>l,o0=l=>{switch(l){case"t":return!0;case"f":return!1;default:return l}},s0=l=>{if(typeof l=="string"){const i=parseFloat(l);if(!Number.isNaN(i))return i}return l},l0=l=>{if(typeof l=="string")try{return JSON.parse(l)}catch(i){return console.log(`JSON parse error: ${i}`),l}return l},c0=(l,i)=>{if(typeof l!="string")return l;const r=l.length-1,s=l[r];if(l[0]==="{"&&s==="}"){let d;const f=l.slice(1,r);try{d=JSON.parse("["+f+"]")}catch{d=f?f.split(","):[]}return d.map(g=>rm(i,g))}return l},d0=l=>typeof l=="string"?l.replace(" ","T"):l,om=l=>{const i=new URL(l);return i.protocol=i.protocol.replace(/^ws/i,"http"),i.pathname=i.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),i.pathname===""||i.pathname==="/"?i.pathname="/api/broadcast":i.pathname=i.pathname+"/api/broadcast",i.href};class Ed{constructor(i,r,s={},c=Id){this.channel=i,this.event=r,this.payload=s,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(i){this.timeout=i,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(i){this.payload=Object.assign(Object.assign({},this.payload),i)}receive(i,r){var s;return this._hasReceived(i)&&r((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:i,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const i=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},i),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(i,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:i,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:i,response:r}){this.recHooks.filter(s=>s.status===i).forEach(s=>s.callback(r))}_hasReceived(i){return this.receivedResp&&this.receivedResp.status===i}}var ig;(function(l){l.SYNC="sync",l.JOIN="join",l.LEAVE="leave"})(ig||(ig={}));class Oo{constructor(i,r){this.channel=i,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},c=>{const{onJoin:d,onLeave:f,onSync:g}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Oo.syncState(this.state,c,d,f),this.pendingDiffs.forEach(p=>{this.state=Oo.syncDiff(this.state,p,d,f)}),this.pendingDiffs=[],g()}),this.channel._on(s.diff,{},c=>{const{onJoin:d,onLeave:f,onSync:g}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=Oo.syncDiff(this.state,c,d,f),g())}),this.onJoin((c,d,f)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:d,newPresences:f})}),this.onLeave((c,d,f)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:d,leftPresences:f})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(i,r,s,c){const d=this.cloneDeep(i),f=this.transformState(r),g={},p={};return this.map(d,(m,b)=>{f[m]||(p[m]=b)}),this.map(f,(m,b)=>{const S=d[m];if(S){const j=b.map(E=>E.presence_ref),x=S.map(E=>E.presence_ref),w=b.filter(E=>x.indexOf(E.presence_ref)<0),v=S.filter(E=>j.indexOf(E.presence_ref)<0);w.length>0&&(g[m]=w),v.length>0&&(p[m]=v)}else g[m]=b}),this.syncDiff(d,{joins:g,leaves:p},s,c)}static syncDiff(i,r,s,c){const{joins:d,leaves:f}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return s||(s=()=>{}),c||(c=()=>{}),this.map(d,(g,p)=>{var m;const b=(m=i[g])!==null&&m!==void 0?m:[];if(i[g]=this.cloneDeep(p),b.length>0){const S=i[g].map(x=>x.presence_ref),j=b.filter(x=>S.indexOf(x.presence_ref)<0);i[g].unshift(...j)}s(g,b,p)}),this.map(f,(g,p)=>{let m=i[g];if(!m)return;const b=p.map(S=>S.presence_ref);m=m.filter(S=>b.indexOf(S.presence_ref)<0),i[g]=m,c(g,m,p),m.length===0&&delete i[g]}),i}static map(i,r){return Object.getOwnPropertyNames(i).map(s=>r(s,i[s]))}static transformState(i){return i=this.cloneDeep(i),Object.getOwnPropertyNames(i).reduce((r,s)=>{const c=i[s];return"metas"in c?r[s]=c.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):r[s]=c,r},{})}static cloneDeep(i){return JSON.parse(JSON.stringify(i))}onJoin(i){this.caller.onJoin=i}onLeave(i){this.caller.onLeave=i}onSync(i){this.caller.onSync=i}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var rg;(function(l){l.ALL="*",l.INSERT="INSERT",l.UPDATE="UPDATE",l.DELETE="DELETE"})(rg||(rg={}));var Do;(function(l){l.BROADCAST="broadcast",l.PRESENCE="presence",l.POSTGRES_CHANGES="postgres_changes",l.SYSTEM="system"})(Do||(Do={}));var Wa;(function(l){l.SUBSCRIBED="SUBSCRIBED",l.TIMED_OUT="TIMED_OUT",l.CLOSED="CLOSED",l.CHANNEL_ERROR="CHANNEL_ERROR"})(Wa||(Wa={}));class Xd{constructor(i,r={config:{}},s){var c,d;if(this.topic=i,this.params=r,this.socket=s,this.bindings={},this.state=en.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=i.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Ed(this,Qn.join,this.params,this.timeout),this.rejoinTimer=new im(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=en.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(f=>f.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=en.closed,this.socket._remove(this)}),this._onError(f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=en.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=en.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=en.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qn.reply,{},(f,g)=>{this._trigger(this._replyEventName(g),f)}),this.presence=new Oo(this),this.broadcastEndpointURL=om(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((d=(c=this.params.config)===null||c===void 0?void 0:c.broadcast)===null||d===void 0)&&d.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(i,r=this.timeout){var s,c,d;if(this.socket.isConnected()||this.socket.connect(),this.state==en.closed){const{config:{broadcast:f,presence:g,private:p}}=this.params,m=(c=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(x=>x.filter))!==null&&c!==void 0?c:[],b=!!this.bindings[Do.PRESENCE]&&this.bindings[Do.PRESENCE].length>0||((d=this.params.config.presence)===null||d===void 0?void 0:d.enabled)===!0,S={},j={broadcast:f,presence:Object.assign(Object.assign({},g),{enabled:b}),postgres_changes:m,private:p};this.socket.accessTokenValue&&(S.access_token=this.socket.accessTokenValue),this._onError(x=>i?.(Wa.CHANNEL_ERROR,x)),this._onClose(()=>i?.(Wa.CLOSED)),this.updateJoinPayload(Object.assign({config:j},S)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:x})=>{var w;if(this.socket.setAuth(),x===void 0){i?.(Wa.SUBSCRIBED);return}else{const v=this.bindings.postgres_changes,E=(w=v?.length)!==null&&w!==void 0?w:0,T=[];for(let L=0;L<E;L++){const R=v[L],{filter:{event:z,schema:C,table:O,filter:I}}=R,k=x&&x[L];if(k&&k.event===z&&k.schema===C&&k.table===O&&k.filter===I)T.push(Object.assign(Object.assign({},R),{id:k.id}));else{this.unsubscribe(),this.state=en.errored,i?.(Wa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=T,i&&i(Wa.SUBSCRIBED);return}}).receive("error",x=>{this.state=en.errored,i?.(Wa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(x).join(", ")||"error")))}).receive("timeout",()=>{i?.(Wa.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(i,r={}){return await this.send({type:"presence",event:"track",payload:i},r.timeout||this.timeout)}async untrack(i={}){return await this.send({type:"presence",event:"untrack"},i)}on(i,r,s){return this.state===en.joined&&i===Do.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(i,r,s)}async httpSend(i,r,s={}){var c;const d=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const f={method:"POST",headers:{Authorization:d,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:r,private:this.private}]})},g=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(c=s.timeout)!==null&&c!==void 0?c:this.timeout);if(g.status===202)return{success:!0};let p=g.statusText;try{const m=await g.json();p=m.error||m.message||p}catch{}return Promise.reject(new Error(p))}async send(i,r={}){var s,c;if(!this._canPush()&&i.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:d,payload:f}=i,p={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:f,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);return await((c=m.body)===null||c===void 0?void 0:c.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var f,g,p;const m=this._push(i.type,i,r.timeout||this.timeout);i.type==="broadcast"&&!(!((p=(g=(f=this.params)===null||f===void 0?void 0:f.config)===null||g===void 0?void 0:g.broadcast)===null||p===void 0)&&p.ack)&&d("ok"),m.receive("ok",()=>d("ok")),m.receive("error",()=>d("error")),m.receive("timeout",()=>d("timed out"))})}updateJoinPayload(i){this.joinPush.updatePayload(i)}unsubscribe(i=this.timeout){this.state=en.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qn.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(c=>{s=new Ed(this,Qn.leave,{},i),s.receive("ok",()=>{r(),c("ok")}).receive("timeout",()=>{r(),c("timed out")}).receive("error",()=>{c("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(i=>i.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=en.closed,this.bindings={}}async _fetchWithTimeout(i,r,s){const c=new AbortController,d=setTimeout(()=>c.abort(),s),f=await this.socket.fetch(i,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(d),f}_push(i,r,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${i}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new Ed(this,i,r,s);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(i){if(i.startTimeout(),this.pushBuffer.push(i),this.pushBuffer.length>a0){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(i,r,s){return r}_isMember(i){return this.topic===i}_joinRef(){return this.joinPush.ref}_trigger(i,r,s){var c,d;const f=i.toLocaleLowerCase(),{close:g,error:p,leave:m,join:b}=Qn;if(s&&[g,p,m,b].indexOf(f)>=0&&s!==this._joinRef())return;let j=this._onMessage(f,r,s);if(r&&!j)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(x=>{var w,v,E;return((w=x.filter)===null||w===void 0?void 0:w.event)==="*"||((E=(v=x.filter)===null||v===void 0?void 0:v.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===f}).map(x=>x.callback(j,s)):(d=this.bindings[f])===null||d===void 0||d.filter(x=>{var w,v,E,T,L,R;if(["broadcast","presence","postgres_changes"].includes(f))if("id"in x){const z=x.id,C=(w=x.filter)===null||w===void 0?void 0:w.event;return z&&((v=r.ids)===null||v===void 0?void 0:v.includes(z))&&(C==="*"||C?.toLocaleLowerCase()===((E=r.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const z=(L=(T=x?.filter)===null||T===void 0?void 0:T.event)===null||L===void 0?void 0:L.toLocaleLowerCase();return z==="*"||z===((R=r?.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===f}).map(x=>{if(typeof j=="object"&&"ids"in j){const w=j.data,{schema:v,table:E,commit_timestamp:T,type:L,errors:R}=w;j=Object.assign(Object.assign({},{schema:v,table:E,commit_timestamp:T,eventType:L,new:{},old:{},errors:R}),this._getPayloadRecords(w))}x.callback(j,s)})}_isClosed(){return this.state===en.closed}_isJoined(){return this.state===en.joined}_isJoining(){return this.state===en.joining}_isLeaving(){return this.state===en.leaving}_replyEventName(i){return`chan_reply_${i}`}_on(i,r,s){const c=i.toLocaleLowerCase(),d={type:c,filter:r,callback:s};return this.bindings[c]?this.bindings[c].push(d):this.bindings[c]=[d],this}_off(i,r){const s=i.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(c=>{var d;return!(((d=c.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===s&&Xd.isEqual(c.filter,r))})),this}static isEqual(i,r){if(Object.keys(i).length!==Object.keys(r).length)return!1;for(const s in i)if(i[s]!==r[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(i){this._on(Qn.close,{},i)}_onError(i){this._on(Qn.error,{},r=>i(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(i=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=en.joining,this.joinPush.resend(i))}_getPayloadRecords(i){const r={new:{},old:{}};return(i.type==="INSERT"||i.type==="UPDATE")&&(r.new=ag(i.columns,i.record)),(i.type==="UPDATE"||i.type==="DELETE")&&(r.old=ag(i.columns,i.old_record)),r}}const Td=()=>{},ol={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},u0=[1e3,2e3,5e3,1e4],f0=1e4,h0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class p0{constructor(i,r){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Id,this.transport=null,this.heartbeatIntervalMs=ol.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Td,this.ref=0,this.reconnectTimer=null,this.vsn=ng,this.logger=Td,this.conn=null,this.sendBuffer=[],this.serializer=new i0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>c?(...d)=>c(...d):(...d)=>fetch(...d),!(!((s=r?.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${i}/${Md.websocket}`,this.httpEndpoint=om(i),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Xb.createWebSocket(this.endpointURL())}catch(i){this._setConnectionState("disconnected");const r=i.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(i,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(i?this.conn.close(i,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(i){const r=await i.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const i=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),i}log(i,r,s){this.logger(i,r,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Pi.connecting:return Fi.Connecting;case Pi.open:return Fi.Open;case Pi.closing:return Fi.Closing;default:return Fi.Closed}}isConnected(){return this.connectionState()===Fi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(i,r={config:{}}){const s=`realtime:${i}`,c=this.getChannels().find(d=>d.topic===s);if(c)return c;{const d=new Xd(`realtime:${i}`,r,this);return this.channels.push(d),d}}push(i){const{topic:r,event:s,payload:c,ref:d}=i,f=()=>{this.encode(i,g=>{var p;(p=this.conn)===null||p===void 0||p.send(g)})};this.log("push",`${r} ${s} (${d})`,c),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(i=null){this._authPromise=this._performAuth(i);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var i;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(i=this.conn)===null||i===void 0||i.close(n0,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},ol.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(i){this.heartbeatCallback=i}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(i=>i()),this.sendBuffer=[])}_makeRef(){let i=this.ref+1;return i===this.ref?this.ref=0:this.ref=i,this.ref.toString()}_leaveOpenTopic(i){let r=this.channels.find(s=>s.topic===i&&(s._isJoined()||s._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${i}"`),r.unsubscribe())}_remove(i){this.channels=this.channels.filter(r=>r.topic!==i.topic)}_onConnMessage(i){this.decode(i.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:c,payload:d,ref:f}=r,g=f?`(${f})`:"",p=d.status||"";this.log("receive",`${p} ${s} ${c} ${g}`.trim(),d),this.channels.filter(m=>m._isMember(s)).forEach(m=>m._trigger(c,d,f)),this._triggerStateCallbacks("message",r)})}_clearTimer(i){var r;i==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):i==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=i=>this._onConnError(i),this.conn.onmessage=i=>this._onConnMessage(i),this.conn.onclose=i=>this._onConnClose(i))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Pi.open||this.conn.readyState===Pi.connecting)try{this.conn.close()}catch(i){this.log("error","Error closing connection",i)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(i=>i.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const i=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(i),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(i){var r;this._setConnectionState("disconnected"),this.log("transport","close",i),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",i)}_onConnError(i){this._setConnectionState("disconnected"),this.log("transport",`${i}`),this._triggerChanError(),this._triggerStateCallbacks("error",i)}_triggerChanError(){this.channels.forEach(i=>i._trigger(Qn.error))}_appendParams(i,r){if(Object.keys(r).length===0)return i;const s=i.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${i}${s}${c}`}_workerObjectUrl(i){let r;if(i)r=i;else{const s=new Blob([h0],{type:"application/javascript"});r=URL.createObjectURL(s)}return r}_setConnectionState(i,r=!1){this._connectionState=i,i==="connecting"?this._wasManualDisconnect=!1:i==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(i=null){let r;i?r=i:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(s=>{const c={access_token:r,version:e0};r&&s.updateJoinPayload(c),s.joinedOnce&&s._isJoined()&&s._push(Qn.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(i="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${i}`,r)})}_triggerStateCallbacks(i,r){try{this.stateChangeCallbacks[i].forEach(s=>{try{s(r)}catch(c){this.log("error",`error in ${i} callback`,c)}})}catch(s){this.log("error",`error triggering ${i} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new im(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ol.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(i){var r,s,c,d,f,g,p,m,b,S,j,x;switch(this.transport=(r=i?.transport)!==null&&r!==void 0?r:null,this.timeout=(s=i?.timeout)!==null&&s!==void 0?s:Id,this.heartbeatIntervalMs=(c=i?.heartbeatIntervalMs)!==null&&c!==void 0?c:ol.HEARTBEAT_INTERVAL,this.worker=(d=i?.worker)!==null&&d!==void 0?d:!1,this.accessToken=(f=i?.accessToken)!==null&&f!==void 0?f:null,this.heartbeatCallback=(g=i?.heartbeatCallback)!==null&&g!==void 0?g:Td,this.vsn=(p=i?.vsn)!==null&&p!==void 0?p:ng,i?.params&&(this.params=i.params),i?.logger&&(this.logger=i.logger),(i?.logLevel||i?.log_level)&&(this.logLevel=i.logLevel||i.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=i?.reconnectAfterMs)!==null&&m!==void 0?m:(w=>u0[w-1]||f0),this.vsn){case am:this.encode=(b=i?.encode)!==null&&b!==void 0?b:((w,v)=>v(JSON.stringify(w))),this.decode=(S=i?.decode)!==null&&S!==void 0?S:((w,v)=>v(JSON.parse(w)));break;case t0:this.encode=(j=i?.encode)!==null&&j!==void 0?j:this.serializer.encode.bind(this.serializer),this.decode=(x=i?.decode)!==null&&x!==void 0?x:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=i?.workerUrl}}}class Zd extends Error{constructor(i){super(i),this.__isStorageError=!0,this.name="StorageError"}}function Lt(l){return typeof l=="object"&&l!==null&&"__isStorageError"in l}class g0 extends Zd{constructor(i,r,s){super(i),this.name="StorageApiError",this.status=r,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class $d extends Zd{constructor(i,r){super(i),this.name="StorageUnknownError",this.originalError=r}}const eu=l=>l?(...i)=>l(...i):(...i)=>fetch(...i),m0=()=>Response,Hd=l=>{if(Array.isArray(l))return l.map(r=>Hd(r));if(typeof l=="function"||l!==Object(l))return l;const i={};return Object.entries(l).forEach(([r,s])=>{const c=r.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));i[c]=Hd(s)}),i},y0=l=>{if(typeof l!="object"||l===null)return!1;const i=Object.getPrototypeOf(l);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)},Nd=l=>{var i;return l.msg||l.message||l.error_description||(typeof l.error=="string"?l.error:(i=l.error)===null||i===void 0?void 0:i.message)||JSON.stringify(l)},b0=(l,i,r)=>Pe(void 0,void 0,void 0,function*(){const s=yield m0();l instanceof s&&!r?.noResolveJson?l.json().then(c=>{const d=l.status||500,f=c?.statusCode||d+"";i(new g0(Nd(c),d,f))}).catch(c=>{i(new $d(Nd(c),c))}):i(new $d(Nd(l),l))}),x0=(l,i,r,s)=>{const c={method:l,headers:i?.headers||{}};return l==="GET"||!s?c:(y0(s)?(c.headers=Object.assign({"Content-Type":"application/json"},i?.headers),c.body=JSON.stringify(s)):c.body=s,i?.duplex&&(c.duplex=i.duplex),Object.assign(Object.assign({},c),r))};function Mo(l,i,r,s,c,d){return Pe(this,void 0,void 0,function*(){return new Promise((f,g)=>{l(r,x0(i,s,c,d)).then(p=>{if(!p.ok)throw p;return s?.noResolveJson?p:p.json()}).then(p=>f(p)).catch(p=>b0(p,g,s))})})}function Bo(l,i,r,s){return Pe(this,void 0,void 0,function*(){return Mo(l,"GET",i,r,s)})}function ua(l,i,r,s,c){return Pe(this,void 0,void 0,function*(){return Mo(l,"POST",i,s,c,r)})}function Pd(l,i,r,s,c){return Pe(this,void 0,void 0,function*(){return Mo(l,"PUT",i,s,c,r)})}function v0(l,i,r,s){return Pe(this,void 0,void 0,function*(){return Mo(l,"HEAD",i,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}function tu(l,i,r,s,c){return Pe(this,void 0,void 0,function*(){return Mo(l,"DELETE",i,s,c,r)})}class j0{constructor(i,r){this.downloadFn=i,this.shouldThrowOnError=r}then(i,r){return this.execute().then(i,r)}execute(){return Pe(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Lt(i))return{data:null,error:i};throw i}})}}var sm;class S0{constructor(i,r){this.downloadFn=i,this.shouldThrowOnError=r,this[sm]="BlobDownloadBuilder",this.promise=null}asStream(){return new j0(this.downloadFn,this.shouldThrowOnError)}then(i,r){return this.getPromise().then(i,r)}catch(i){return this.getPromise().catch(i)}finally(i){return this.getPromise().finally(i)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Pe(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Lt(i))return{data:null,error:i};throw i}})}}sm=Symbol.toStringTag;const _0={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},og={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class w0{constructor(i,r={},s,c){this.shouldThrowOnError=!1,this.url=i,this.headers=r,this.bucketId=s,this.fetch=eu(c)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(i,r,s,c){return Pe(this,void 0,void 0,function*(){try{let d;const f=Object.assign(Object.assign({},og),c);let g=Object.assign(Object.assign({},this.headers),i==="POST"&&{"x-upsert":String(f.upsert)});const p=f.metadata;typeof Blob<"u"&&s instanceof Blob?(d=new FormData,d.append("cacheControl",f.cacheControl),p&&d.append("metadata",this.encodeMetadata(p)),d.append("",s)):typeof FormData<"u"&&s instanceof FormData?(d=s,d.has("cacheControl")||d.append("cacheControl",f.cacheControl),p&&!d.has("metadata")&&d.append("metadata",this.encodeMetadata(p))):(d=s,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType,p&&(g["x-metadata"]=this.toBase64(this.encodeMetadata(p))),(typeof ReadableStream<"u"&&d instanceof ReadableStream||d&&typeof d=="object"&&"pipe"in d&&typeof d.pipe=="function")&&!f.duplex&&(f.duplex="half")),c?.headers&&(g=Object.assign(Object.assign({},g),c.headers));const m=this._removeEmptyFolders(r),b=this._getFinalPath(m),S=yield(i=="PUT"?Pd:ua)(this.fetch,`${this.url}/object/${b}`,d,Object.assign({headers:g},f?.duplex?{duplex:f.duplex}:{}));return{data:{path:m,id:S.Id,fullPath:S.Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(Lt(d))return{data:null,error:d};throw d}})}upload(i,r,s){return Pe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",i,r,s)})}uploadToSignedUrl(i,r,s,c){return Pe(this,void 0,void 0,function*(){const d=this._removeEmptyFolders(i),f=this._getFinalPath(d),g=new URL(this.url+`/object/upload/sign/${f}`);g.searchParams.set("token",r);try{let p;const m=Object.assign({upsert:og.upsert},c),b=Object.assign(Object.assign({},this.headers),{"x-upsert":String(m.upsert)});typeof Blob<"u"&&s instanceof Blob?(p=new FormData,p.append("cacheControl",m.cacheControl),p.append("",s)):typeof FormData<"u"&&s instanceof FormData?(p=s,p.append("cacheControl",m.cacheControl)):(p=s,b["cache-control"]=`max-age=${m.cacheControl}`,b["content-type"]=m.contentType);const S=yield Pd(this.fetch,g.toString(),p,{headers:b});return{data:{path:d,fullPath:S.Key},error:null}}catch(p){if(this.shouldThrowOnError)throw p;if(Lt(p))return{data:null,error:p};throw p}})}createSignedUploadUrl(i,r){return Pe(this,void 0,void 0,function*(){try{let s=this._getFinalPath(i);const c=Object.assign({},this.headers);r?.upsert&&(c["x-upsert"]="true");const d=yield ua(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:c}),f=new URL(this.url+d.url),g=f.searchParams.get("token");if(!g)throw new Zd("No token returned by API");return{data:{signedUrl:f.toString(),path:i,token:g},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Lt(s))return{data:null,error:s};throw s}})}update(i,r,s){return Pe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",i,r,s)})}move(i,r,s){return Pe(this,void 0,void 0,function*(){try{return{data:yield ua(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:i,destinationKey:r,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Lt(c))return{data:null,error:c};throw c}})}copy(i,r,s){return Pe(this,void 0,void 0,function*(){try{return{data:{path:(yield ua(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:i,destinationKey:r,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Lt(c))return{data:null,error:c};throw c}})}createSignedUrl(i,r,s){return Pe(this,void 0,void 0,function*(){try{let c=this._getFinalPath(i),d=yield ua(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const f=s?.download?`&download=${s.download===!0?"":s.download}`:"";return d={signedUrl:encodeURI(`${this.url}${d.signedURL}${f}`)},{data:d,error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Lt(c))return{data:null,error:c};throw c}})}createSignedUrls(i,r,s){return Pe(this,void 0,void 0,function*(){try{const c=yield ua(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:i},{headers:this.headers}),d=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:c.map(f=>Object.assign(Object.assign({},f),{signedUrl:f.signedURL?encodeURI(`${this.url}${f.signedURL}${d}`):null})),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Lt(c))return{data:null,error:c};throw c}})}download(i,r){const c=typeof r?.transform<"u"?"render/image/authenticated":"object",d=this.transformOptsToQueryString(r?.transform||{}),f=d?`?${d}`:"",g=this._getFinalPath(i),p=()=>Bo(this.fetch,`${this.url}/${c}/${g}${f}`,{headers:this.headers,noResolveJson:!0});return new S0(p,this.shouldThrowOnError)}info(i){return Pe(this,void 0,void 0,function*(){const r=this._getFinalPath(i);try{const s=yield Bo(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:Hd(s),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Lt(s))return{data:null,error:s};throw s}})}exists(i){return Pe(this,void 0,void 0,function*(){const r=this._getFinalPath(i);try{return yield v0(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Lt(s)&&s instanceof $d){const c=s.originalError;if([400,404].includes(c?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(i,r){const s=this._getFinalPath(i),c=[],d=r?.download?`download=${r.download===!0?"":r.download}`:"";d!==""&&c.push(d);const g=typeof r?.transform<"u"?"render/image":"object",p=this.transformOptsToQueryString(r?.transform||{});p!==""&&c.push(p);let m=c.join("&");return m!==""&&(m=`?${m}`),{data:{publicUrl:encodeURI(`${this.url}/${g}/public/${s}${m}`)}}}remove(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield tu(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:i},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}list(i,r,s){return Pe(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},_0),r),{prefix:i||""});return{data:yield ua(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},s),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Lt(c))return{data:null,error:c};throw c}})}listV2(i,r){return Pe(this,void 0,void 0,function*(){try{const s=Object.assign({},i);return{data:yield ua(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Lt(s))return{data:null,error:s};throw s}})}encodeMetadata(i){return JSON.stringify(i)}toBase64(i){return typeof Buffer<"u"?Buffer.from(i).toString("base64"):btoa(i)}_getFinalPath(i){return`${this.bucketId}/${i.replace(/^\/+/,"")}`}_removeEmptyFolders(i){return i.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(i){const r=[];return i.width&&r.push(`width=${i.width}`),i.height&&r.push(`height=${i.height}`),i.resize&&r.push(`resize=${i.resize}`),i.format&&r.push(`format=${i.format}`),i.quality&&r.push(`quality=${i.quality}`),r.join("&")}}const lm="2.81.1",cm={"X-Client-Info":`storage-js/${lm}`};class C0{constructor(i,r={},s,c){this.shouldThrowOnError=!1;const d=new URL(i);c?.useNewHostname&&/supabase\.(co|in|red)$/.test(d.hostname)&&!d.hostname.includes("storage.supabase.")&&(d.hostname=d.hostname.replace("supabase.","storage.supabase.")),this.url=d.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cm),r),this.fetch=eu(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(i){return Pe(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(i);return{data:yield Bo(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}getBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield Bo(this.fetch,`${this.url}/bucket/${i}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}createBucket(i){return Pe(this,arguments,void 0,function*(r,s={public:!1}){try{return{data:yield ua(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Lt(c))return{data:null,error:c};throw c}})}updateBucket(i,r){return Pe(this,void 0,void 0,function*(){try{return{data:yield Pd(this.fetch,`${this.url}/bucket/${i}`,{id:i,name:i,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Lt(s))return{data:null,error:s};throw s}})}emptyBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield ua(this.fetch,`${this.url}/bucket/${i}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}deleteBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield tu(this.fetch,`${this.url}/bucket/${i}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(i){const r={};return i&&("limit"in i&&(r.limit=String(i.limit)),"offset"in i&&(r.offset=String(i.offset)),i.search&&(r.search=i.search),i.sortColumn&&(r.sortColumn=i.sortColumn),i.sortOrder&&(r.sortOrder=i.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class E0{constructor(i,r={},s){this.shouldThrowOnError=!1,this.url=i.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},cm),r),this.fetch=eu(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield ua(this.fetch,`${this.url}/bucket`,{name:i},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}listBuckets(i){return Pe(this,void 0,void 0,function*(){try{const r=new URLSearchParams;i?.limit!==void 0&&r.set("limit",i.limit.toString()),i?.offset!==void 0&&r.set("offset",i.offset.toString()),i?.sortColumn&&r.set("sortColumn",i.sortColumn),i?.sortOrder&&r.set("sortOrder",i.sortOrder),i?.search&&r.set("search",i.search);const s=r.toString(),c=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:yield Bo(this.fetch,c,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}deleteBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield tu(this.fetch,`${this.url}/bucket/${i}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Lt(r))return{data:null,error:r};throw r}})}}const nu={"X-Client-Info":`storage-js/${lm}`,"Content-Type":"application/json"};class dm extends Error{constructor(i){super(i),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Ln(l){return typeof l=="object"&&l!==null&&"__isStorageVectorsError"in l}class Ad extends dm{constructor(i,r,s){super(i),this.name="StorageVectorsApiError",this.status=r,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class T0 extends dm{constructor(i,r){super(i),this.name="StorageVectorsUnknownError",this.originalError=r}}var sg;(function(l){l.InternalError="InternalError",l.S3VectorConflictException="S3VectorConflictException",l.S3VectorNotFoundException="S3VectorNotFoundException",l.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",l.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",l.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(sg||(sg={}));const au=l=>l?(...i)=>l(...i):(...i)=>fetch(...i),N0=l=>{if(typeof l!="object"||l===null)return!1;const i=Object.getPrototypeOf(l);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)},lg=l=>l.msg||l.message||l.error_description||l.error||JSON.stringify(l),A0=(l,i,r)=>Pe(void 0,void 0,void 0,function*(){if(l&&typeof l=="object"&&"status"in l&&"ok"in l&&typeof l.status=="number"&&!r?.noResolveJson){const c=l.status||500,d=l;if(typeof d.json=="function")d.json().then(f=>{const g=f?.statusCode||f?.code||c+"";i(new Ad(lg(f),c,g))}).catch(()=>{const f=c+"",g=d.statusText||`HTTP ${c} error`;i(new Ad(g,c,f))});else{const f=c+"",g=d.statusText||`HTTP ${c} error`;i(new Ad(g,c,f))}}else i(new T0(lg(l),l))}),z0=(l,i,r,s)=>{const c={method:l,headers:i?.headers||{}};return s?(N0(s)?(c.headers=Object.assign({"Content-Type":"application/json"},i?.headers),c.body=JSON.stringify(s)):c.body=s,Object.assign(Object.assign({},c),r)):c};function k0(l,i,r,s,c,d){return Pe(this,void 0,void 0,function*(){return new Promise((f,g)=>{l(r,z0(i,s,c,d)).then(p=>{if(!p.ok)throw p;if(s?.noResolveJson)return p;const m=p.headers.get("content-type");return!m||!m.includes("application/json")?{}:p.json()}).then(p=>f(p)).catch(p=>A0(p,g,s))})})}function In(l,i,r,s,c){return Pe(this,void 0,void 0,function*(){return k0(l,"POST",i,s,c,r)})}class R0{constructor(i,r={},s){this.shouldThrowOnError=!1,this.url=i.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},nu),r),this.fetch=au(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(i){return Pe(this,void 0,void 0,function*(){try{return{data:(yield In(this.fetch,`${this.url}/CreateIndex`,i,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}getIndex(i,r){return Pe(this,void 0,void 0,function*(){try{return{data:yield In(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:i,indexName:r},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ln(s))return{data:null,error:s};throw s}})}listIndexes(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield In(this.fetch,`${this.url}/ListIndexes`,i,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}deleteIndex(i,r){return Pe(this,void 0,void 0,function*(){try{return{data:(yield In(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:i,indexName:r},{headers:this.headers}))||{},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ln(s))return{data:null,error:s};throw s}})}}class O0{constructor(i,r={},s){this.shouldThrowOnError=!1,this.url=i.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},nu),r),this.fetch=au(s)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(i){return Pe(this,void 0,void 0,function*(){try{if(i.vectors.length<1||i.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield In(this.fetch,`${this.url}/PutVectors`,i,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}getVectors(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield In(this.fetch,`${this.url}/GetVectors`,i,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}listVectors(i){return Pe(this,void 0,void 0,function*(){try{if(i.segmentCount!==void 0){if(i.segmentCount<1||i.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(i.segmentIndex!==void 0&&(i.segmentIndex<0||i.segmentIndex>=i.segmentCount))throw new Error(`segmentIndex must be between 0 and ${i.segmentCount-1}`)}return{data:yield In(this.fetch,`${this.url}/ListVectors`,i,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}queryVectors(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield In(this.fetch,`${this.url}/QueryVectors`,i,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}deleteVectors(i){return Pe(this,void 0,void 0,function*(){try{if(i.keys.length<1||i.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield In(this.fetch,`${this.url}/DeleteVectors`,i,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}}class D0{constructor(i,r={},s){this.shouldThrowOnError=!1,this.url=i.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},nu),r),this.fetch=au(s)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:(yield In(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:i},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}getBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:yield In(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:i},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}listBuckets(){return Pe(this,arguments,void 0,function*(i={}){try{return{data:yield In(this.fetch,`${this.url}/ListVectorBuckets`,i,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}deleteBucket(i){return Pe(this,void 0,void 0,function*(){try{return{data:(yield In(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:i},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}})}}class B0 extends D0{constructor(i,r={}){super(i,r.headers||{},r.fetch)}from(i){return new U0(this.url,this.headers,i,this.fetch)}}class U0 extends R0{constructor(i,r,s,c){super(i,r,c),this.vectorBucketName=s}createIndex(i){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Pe(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const i=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Pe(this,arguments,void 0,function*(r={}){return i.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(i){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Pe(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,i)})}deleteIndex(i){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Pe(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,i)})}index(i){return new L0(this.url,this.headers,this.vectorBucketName,i,this.fetch)}}class L0 extends O0{constructor(i,r,s,c,d){super(i,r,d),this.vectorBucketName=s,this.indexName=c}putVectors(i){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Pe(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(i){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Pe(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const i=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Pe(this,arguments,void 0,function*(r={}){return i.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(i){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Pe(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(i){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Pe(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},i),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class I0 extends C0{constructor(i,r={},s,c){super(i,r,s,c)}from(i){return new w0(this.url,this.headers,i,this.fetch)}get vectors(){return new B0(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new E0(this.url+"/iceberg",this.headers,this.fetch)}}const M0="2.81.1";let Ro="";typeof Deno<"u"?Ro="deno":typeof document<"u"?Ro="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ro="react-native":Ro="node";const q0={"X-Client-Info":`supabase-js-${Ro}/${M0}`},$0={headers:q0},H0={schema:"public"},P0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},F0={},V0=l=>l?(...i)=>l(...i):(...i)=>fetch(...i),W0=()=>Headers,G0=(l,i,r)=>{const s=V0(r),c=W0();return async(d,f)=>{var g;const p=(g=await i())!==null&&g!==void 0?g:l;let m=new c(f?.headers);return m.has("apikey")||m.set("apikey",l),m.has("Authorization")||m.set("Authorization",`Bearer ${p}`),s(d,Object.assign(Object.assign({},f),{headers:m}))}};function Y0(l){return l.endsWith("/")?l:l+"/"}function K0(l,i){var r,s;const{db:c,auth:d,realtime:f,global:g}=l,{db:p,auth:m,realtime:b,global:S}=i,j={db:Object.assign(Object.assign({},p),c),auth:Object.assign(Object.assign({},m),d),realtime:Object.assign(Object.assign({},b),f),storage:{},global:Object.assign(Object.assign(Object.assign({},S),g),{headers:Object.assign(Object.assign({},(r=S?.headers)!==null&&r!==void 0?r:{}),(s=g?.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return l.accessToken?j.accessToken=l.accessToken:delete j.accessToken,j}function J0(l){const i=l?.trim();if(!i)throw new Error("supabaseUrl is required.");if(!i.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Y0(i))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const um="2.81.1",zr=30*1e3,Fd=3,zd=Fd*zr,Q0="http://localhost:9999",X0="supabase.auth.token",Z0={"X-Client-Info":`gotrue-js/${um}`},Vd="X-Supabase-Api-Version",fm={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ex=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,tx=600*1e3;class Uo extends Error{constructor(i,r,s){super(i),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=s}}function We(l){return typeof l=="object"&&l!==null&&"__isAuthError"in l}class nx extends Uo{constructor(i,r,s){super(i,r,s),this.name="AuthApiError",this.status=r,this.code=s}}function ax(l){return We(l)&&l.name==="AuthApiError"}class Vi extends Uo{constructor(i,r){super(i),this.name="AuthUnknownError",this.originalError=r}}class ji extends Uo{constructor(i,r,s,c){super(i,s,c),this.name=r,this.status=s}}class ca extends ji{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ix(l){return We(l)&&l.name==="AuthSessionMissingError"}class wr extends ji{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class sl extends ji{constructor(i){super(i,"AuthInvalidCredentialsError",400,void 0)}}class ll extends ji{constructor(i,r=null){super(i,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function rx(l){return We(l)&&l.name==="AuthImplicitGrantRedirectError"}class cg extends ji{constructor(i,r=null){super(i,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Wd extends ji{constructor(i,r){super(i,"AuthRetryableFetchError",r,void 0)}}function kd(l){return We(l)&&l.name==="AuthRetryableFetchError"}class dg extends ji{constructor(i,r,s){super(i,"AuthWeakPasswordError",r,"weak_password"),this.reasons=s}}class Gd extends ji{constructor(i){super(i,"AuthInvalidJwtError",400,"invalid_jwt")}}const ul="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ug=` 	
\r=`.split(""),ox=(()=>{const l=new Array(128);for(let i=0;i<l.length;i+=1)l[i]=-1;for(let i=0;i<ug.length;i+=1)l[ug[i].charCodeAt(0)]=-2;for(let i=0;i<ul.length;i+=1)l[ul[i].charCodeAt(0)]=i;return l})();function fg(l,i,r){if(l!==null)for(i.queue=i.queue<<8|l,i.queuedBits+=8;i.queuedBits>=6;){const s=i.queue>>i.queuedBits-6&63;r(ul[s]),i.queuedBits-=6}else if(i.queuedBits>0)for(i.queue=i.queue<<6-i.queuedBits,i.queuedBits=6;i.queuedBits>=6;){const s=i.queue>>i.queuedBits-6&63;r(ul[s]),i.queuedBits-=6}}function hm(l,i,r){const s=ox[l];if(s>-1)for(i.queue=i.queue<<6|s,i.queuedBits+=6;i.queuedBits>=8;)r(i.queue>>i.queuedBits-8&255),i.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(l)}"`)}}function hg(l){const i=[],r=f=>{i.push(String.fromCodePoint(f))},s={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},d=f=>{cx(f,s,r)};for(let f=0;f<l.length;f+=1)hm(l.charCodeAt(f),c,d);return i.join("")}function sx(l,i){if(l<=127){i(l);return}else if(l<=2047){i(192|l>>6),i(128|l&63);return}else if(l<=65535){i(224|l>>12),i(128|l>>6&63),i(128|l&63);return}else if(l<=1114111){i(240|l>>18),i(128|l>>12&63),i(128|l>>6&63),i(128|l&63);return}throw new Error(`Unrecognized Unicode codepoint: ${l.toString(16)}`)}function lx(l,i){for(let r=0;r<l.length;r+=1){let s=l.charCodeAt(r);if(s>55295&&s<=56319){const c=(s-55296)*1024&65535;s=(l.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}sx(s,i)}}function cx(l,i,r){if(i.utf8seq===0){if(l<=127){r(l);return}for(let s=1;s<6;s+=1)if((l>>7-s&1)===0){i.utf8seq=s;break}if(i.utf8seq===2)i.codepoint=l&31;else if(i.utf8seq===3)i.codepoint=l&15;else if(i.utf8seq===4)i.codepoint=l&7;else throw new Error("Invalid UTF-8 sequence");i.utf8seq-=1}else if(i.utf8seq>0){if(l<=127)throw new Error("Invalid UTF-8 sequence");i.codepoint=i.codepoint<<6|l&63,i.utf8seq-=1,i.utf8seq===0&&r(i.codepoint)}}function Rr(l){const i=[],r={queue:0,queuedBits:0},s=c=>{i.push(c)};for(let c=0;c<l.length;c+=1)hm(l.charCodeAt(c),r,s);return new Uint8Array(i)}function dx(l){const i=[];return lx(l,r=>i.push(r)),new Uint8Array(i)}function Wi(l){const i=[],r={queue:0,queuedBits:0},s=c=>{i.push(c)};return l.forEach(c=>fg(c,r,s)),fg(null,r,s),i.join("")}function ux(l){return Math.round(Date.now()/1e3)+l}function fx(){return Symbol("auth-callback")}const fn=()=>typeof window<"u"&&typeof document<"u",qi={tested:!1,writable:!1},pm=()=>{if(!fn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(qi.tested)return qi.writable;const l=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(l,l),globalThis.localStorage.removeItem(l),qi.tested=!0,qi.writable=!0}catch{qi.tested=!0,qi.writable=!1}return qi.writable};function hx(l){const i={},r=new URL(l);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((c,d)=>{i[d]=c})}catch{}return r.searchParams.forEach((s,c)=>{i[c]=s}),i}const gm=l=>l?(...i)=>l(...i):(...i)=>fetch(...i),px=l=>typeof l=="object"&&l!==null&&"status"in l&&"ok"in l&&"json"in l&&typeof l.json=="function",kr=async(l,i,r)=>{await l.setItem(i,JSON.stringify(r))},$i=async(l,i)=>{const r=await l.getItem(i);if(!r)return null;try{return JSON.parse(r)}catch{return r}},xi=async(l,i)=>{await l.removeItem(i)};class yl{constructor(){this.promise=new yl.promiseConstructor((i,r)=>{this.resolve=i,this.reject=r})}}yl.promiseConstructor=Promise;function Rd(l){const i=l.split(".");if(i.length!==3)throw new Gd("Invalid JWT structure");for(let s=0;s<i.length;s++)if(!ex.test(i[s]))throw new Gd("JWT not in base64url format");return{header:JSON.parse(hg(i[0])),payload:JSON.parse(hg(i[1])),signature:Rr(i[2]),raw:{header:i[0],payload:i[1]}}}async function gx(l){return await new Promise(i=>{setTimeout(()=>i(null),l)})}function mx(l,i){return new Promise((s,c)=>{(async()=>{for(let d=0;d<1/0;d++)try{const f=await l(d);if(!i(d,null,f)){s(f);return}}catch(f){if(!i(d,f)){c(f);return}}})()})}function yx(l){return("0"+l.toString(16)).substr(-2)}function bx(){const i=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=r.length;let c="";for(let d=0;d<56;d++)c+=r.charAt(Math.floor(Math.random()*s));return c}return crypto.getRandomValues(i),Array.from(i,yx).join("")}async function xx(l){const r=new TextEncoder().encode(l),s=await crypto.subtle.digest("SHA-256",r),c=new Uint8Array(s);return Array.from(c).map(d=>String.fromCharCode(d)).join("")}async function vx(l){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),l;const r=await xx(l);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Cr(l,i,r=!1){const s=bx();let c=s;r&&(c+="/PASSWORD_RECOVERY"),await kr(l,`${i}-code-verifier`,c);const d=await vx(s);return[d,s===d?"plain":"s256"]}const jx=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Sx(l){const i=l.headers.get(Vd);if(!i||!i.match(jx))return null;try{return new Date(`${i}T00:00:00.0Z`)}catch{return null}}function _x(l){if(!l)throw new Error("Missing exp claim");const i=Math.floor(Date.now()/1e3);if(l<=i)throw new Error("JWT has expired")}function wx(l){switch(l){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Cx=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Er(l){if(!Cx.test(l))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Od(){const l={};return new Proxy(l,{get:(i,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const s=r.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(i,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(i,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ex(l,i){return new Proxy(l,{get:(r,s,c)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const d=s.toString();if(d==="Symbol(Symbol.toPrimitive)"||d==="Symbol(Symbol.toStringTag)"||d==="Symbol(util.inspect.custom)"||d==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,s,c)}return!i.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i.value=!0),Reflect.get(r,s,c)}})}function pg(l){return JSON.parse(JSON.stringify(l))}const Hi=l=>l.msg||l.message||l.error_description||l.error||JSON.stringify(l),Tx=[502,503,504];async function gg(l){var i;if(!px(l))throw new Wd(Hi(l),0);if(Tx.includes(l.status))throw new Wd(Hi(l),l.status);let r;try{r=await l.json()}catch(d){throw new Vi(Hi(d),d)}let s;const c=Sx(l);if(c&&c.getTime()>=fm["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?s=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(s=r.error_code),s){if(s==="weak_password")throw new dg(Hi(r),l.status,((i=r.weak_password)===null||i===void 0?void 0:i.reasons)||[]);if(s==="session_not_found")throw new ca}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((d,f)=>d&&typeof f=="string",!0))throw new dg(Hi(r),l.status,r.weak_password.reasons);throw new nx(Hi(r),l.status||500,s)}const Nx=(l,i,r,s)=>{const c={method:l,headers:i?.headers||{}};return l==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},i?.headers),c.body=JSON.stringify(s),Object.assign(Object.assign({},c),r))};async function Je(l,i,r,s){var c;const d=Object.assign({},s?.headers);d[Vd]||(d[Vd]=fm["2024-01-01"].name),s?.jwt&&(d.Authorization=`Bearer ${s.jwt}`);const f=(c=s?.query)!==null&&c!==void 0?c:{};s?.redirectTo&&(f.redirect_to=s.redirectTo);const g=Object.keys(f).length?"?"+new URLSearchParams(f).toString():"",p=await Ax(l,i,r+g,{headers:d,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(p):{data:Object.assign({},p),error:null}}async function Ax(l,i,r,s,c,d){const f=Nx(i,s,c,d);let g;try{g=await l(r,Object.assign({},f))}catch(p){throw console.error(p),new Wd(Hi(p),0)}if(g.ok||await gg(g),s?.noResolveJson)return g;try{return await g.json()}catch(p){await gg(p)}}function da(l){var i;let r=null;Rx(l)&&(r=Object.assign({},l),l.expires_at||(r.expires_at=ux(l.expires_in)));const s=(i=l.user)!==null&&i!==void 0?i:l;return{data:{session:r,user:s},error:null}}function mg(l){const i=da(l);return!i.error&&l.weak_password&&typeof l.weak_password=="object"&&Array.isArray(l.weak_password.reasons)&&l.weak_password.reasons.length&&l.weak_password.message&&typeof l.weak_password.message=="string"&&l.weak_password.reasons.reduce((r,s)=>r&&typeof s=="string",!0)&&(i.data.weak_password=l.weak_password),i}function vi(l){var i;return{data:{user:(i=l.user)!==null&&i!==void 0?i:l},error:null}}function zx(l){return{data:l,error:null}}function kx(l){const{action_link:i,email_otp:r,hashed_token:s,redirect_to:c,verification_type:d}=l,f=Br(l,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),g={action_link:i,email_otp:r,hashed_token:s,redirect_to:c,verification_type:d},p=Object.assign({},f);return{data:{properties:g,user:p},error:null}}function yg(l){return l}function Rx(l){return l.access_token&&l.refresh_token&&l.expires_in}const Dd=["global","local","others"];class Ox{constructor({url:i="",headers:r={},fetch:s}){this.url=i,this.headers=r,this.fetch=gm(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(i,r=Dd[0]){if(Dd.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Dd.join(", ")}`);try{return await Je(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:i,noResolveJson:!0}),{data:null,error:null}}catch(s){if(We(s))return{data:null,error:s};throw s}}async inviteUserByEmail(i,r={}){try{return await Je(this.fetch,"POST",`${this.url}/invite`,{body:{email:i,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:vi})}catch(s){if(We(s))return{data:{user:null},error:s};throw s}}async generateLink(i){try{const{options:r}=i,s=Br(i,["options"]),c=Object.assign(Object.assign({},s),r);return"newEmail"in s&&(c.new_email=s?.newEmail,delete c.newEmail),await Je(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:kx,redirectTo:r?.redirectTo})}catch(r){if(We(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(i){try{return await Je(this.fetch,"POST",`${this.url}/admin/users`,{body:i,headers:this.headers,xform:vi})}catch(r){if(We(r))return{data:{user:null},error:r};throw r}}async listUsers(i){var r,s,c,d,f,g,p;try{const m={nextPage:null,lastPage:0,total:0},b=await Je(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=i?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(d=(c=i?.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:yg});if(b.error)throw b.error;const S=await b.json(),j=(f=b.headers.get("x-total-count"))!==null&&f!==void 0?f:0,x=(p=(g=b.headers.get("link"))===null||g===void 0?void 0:g.split(","))!==null&&p!==void 0?p:[];return x.length>0&&(x.forEach(w=>{const v=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(w.split(";")[1].split("=")[1]);m[`${E}Page`]=v}),m.total=parseInt(j)),{data:Object.assign(Object.assign({},S),m),error:null}}catch(m){if(We(m))return{data:{users:[]},error:m};throw m}}async getUserById(i){Er(i);try{return await Je(this.fetch,"GET",`${this.url}/admin/users/${i}`,{headers:this.headers,xform:vi})}catch(r){if(We(r))return{data:{user:null},error:r};throw r}}async updateUserById(i,r){Er(i);try{return await Je(this.fetch,"PUT",`${this.url}/admin/users/${i}`,{body:r,headers:this.headers,xform:vi})}catch(s){if(We(s))return{data:{user:null},error:s};throw s}}async deleteUser(i,r=!1){Er(i);try{return await Je(this.fetch,"DELETE",`${this.url}/admin/users/${i}`,{headers:this.headers,body:{should_soft_delete:r},xform:vi})}catch(s){if(We(s))return{data:{user:null},error:s};throw s}}async _listFactors(i){Er(i.userId);try{const{data:r,error:s}=await Je(this.fetch,"GET",`${this.url}/admin/users/${i.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:s}}catch(r){if(We(r))return{data:null,error:r};throw r}}async _deleteFactor(i){Er(i.userId),Er(i.id);try{return{data:await Je(this.fetch,"DELETE",`${this.url}/admin/users/${i.userId}/factors/${i.id}`,{headers:this.headers}),error:null}}catch(r){if(We(r))return{data:null,error:r};throw r}}async _listOAuthClients(i){var r,s,c,d,f,g,p;try{const m={nextPage:null,lastPage:0,total:0},b=await Je(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(r=i?.page)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:"",per_page:(d=(c=i?.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:yg});if(b.error)throw b.error;const S=await b.json(),j=(f=b.headers.get("x-total-count"))!==null&&f!==void 0?f:0,x=(p=(g=b.headers.get("link"))===null||g===void 0?void 0:g.split(","))!==null&&p!==void 0?p:[];return x.length>0&&(x.forEach(w=>{const v=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(w.split(";")[1].split("=")[1]);m[`${E}Page`]=v}),m.total=parseInt(j)),{data:Object.assign(Object.assign({},S),m),error:null}}catch(m){if(We(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(i){try{return await Je(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:i,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(We(r))return{data:null,error:r};throw r}}async _getOAuthClient(i){try{return await Je(this.fetch,"GET",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(We(r))return{data:null,error:r};throw r}}async _updateOAuthClient(i,r){try{return await Je(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${i}`,{body:r,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(We(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(i){try{return await Je(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${i}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(We(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(i){try{return await Je(this.fetch,"POST",`${this.url}/admin/oauth/clients/${i}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(We(r))return{data:null,error:r};throw r}}}function bg(l={}){return{getItem:i=>l[i]||null,setItem:(i,r)=>{l[i]=r},removeItem:i=>{delete l[i]}}}const Tr={debug:!!(globalThis&&pm()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class mm extends Error{constructor(i){super(i),this.isAcquireTimeout=!0}}class Dx extends mm{}async function Bx(l,i,r){Tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",l,i);const s=new globalThis.AbortController;return i>0&&setTimeout(()=>{s.abort(),Tr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",l)},i),await Promise.resolve().then(()=>globalThis.navigator.locks.request(l,i===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async c=>{if(c){Tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",l,c.name);try{return await r()}finally{Tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",l,c.name)}}else{if(i===0)throw Tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",l),new Dx(`Acquiring an exclusive Navigator LockManager lock "${l}" immediately failed`);if(Tr.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Ux(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function ym(l){if(!/^0x[a-fA-F0-9]{40}$/.test(l))throw new Error(`@supabase/auth-js: Address "${l}" is invalid.`);return l.toLowerCase()}function Lx(l){return parseInt(l,16)}function Ix(l){const i=new TextEncoder().encode(l);return"0x"+Array.from(i,s=>s.toString(16).padStart(2,"0")).join("")}function Mx(l){var i;const{chainId:r,domain:s,expirationTime:c,issuedAt:d=new Date,nonce:f,notBefore:g,requestId:p,resources:m,scheme:b,uri:S,version:j}=l;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(f&&f.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${f}`);if(!S)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(j!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${j}`);if(!((i=l.statement)===null||i===void 0)&&i.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${l.statement}`)}const x=ym(l.address),w=b?`${b}://${s}`:s,v=l.statement?`${l.statement}
`:"",E=`${w} wants you to sign in with your Ethereum account:
${x}

${v}`;let T=`URI: ${S}
Version: ${j}
Chain ID: ${r}${f?`
Nonce: ${f}`:""}
Issued At: ${d.toISOString()}`;if(c&&(T+=`
Expiration Time: ${c.toISOString()}`),g&&(T+=`
Not Before: ${g.toISOString()}`),p&&(T+=`
Request ID: ${p}`),m){let L=`
Resources:`;for(const R of m){if(!R||typeof R!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${R}`);L+=`
- ${R}`}T+=L}return`${E}
${T}`}class Qt extends Error{constructor({message:i,code:r,cause:s,name:c}){var d;super(i,{cause:s}),this.__isWebAuthnError=!0,this.name=(d=c??(s instanceof Error?s.name:void 0))!==null&&d!==void 0?d:"Unknown Error",this.code=r}}class fl extends Qt{constructor(i,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:i}),this.name="WebAuthnUnknownError",this.originalError=r}}function qx({error:l,options:i}){var r,s,c;const{publicKey:d}=i;if(!d)throw Error("options was missing required publicKey property");if(l.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Qt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:l})}else if(l.name==="ConstraintError"){if(((r=d.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Qt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:l});if(i.mediation==="conditional"&&((s=d.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Qt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:l});if(((c=d.authenticatorSelection)===null||c===void 0?void 0:c.userVerification)==="required")return new Qt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:l})}else{if(l.name==="InvalidStateError")return new Qt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:l});if(l.name==="NotAllowedError")return new Qt({message:l.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l});if(l.name==="NotSupportedError")return d.pubKeyCredParams.filter(g=>g.type==="public-key").length===0?new Qt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:l}):new Qt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:l});if(l.name==="SecurityError"){const f=window.location.hostname;if(bm(f)){if(d.rp.id!==f)return new Qt({message:`The RP ID "${d.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:l})}else return new Qt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:l})}else if(l.name==="TypeError"){if(d.user.id.byteLength<1||d.user.id.byteLength>64)return new Qt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:l})}else if(l.name==="UnknownError")return new Qt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:l})}return new Qt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l})}function $x({error:l,options:i}){const{publicKey:r}=i;if(!r)throw Error("options was missing required publicKey property");if(l.name==="AbortError"){if(i.signal instanceof AbortSignal)return new Qt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:l})}else{if(l.name==="NotAllowedError")return new Qt({message:l.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l});if(l.name==="SecurityError"){const s=window.location.hostname;if(bm(s)){if(r.rpId!==s)return new Qt({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:l})}else return new Qt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:l})}else if(l.name==="UnknownError")return new Qt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:l})}return new Qt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l})}class Hx{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const i=new AbortController;return this.controller=i,i.signal}cancelCeremony(){if(this.controller){const i=new Error("Manually cancelling existing WebAuthn API call");i.name="AbortError",this.controller.abort(i),this.controller=void 0}}}const Px=new Hx;function Fx(l){if(!l)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(l);const{challenge:i,user:r,excludeCredentials:s}=l,c=Br(l,["challenge","user","excludeCredentials"]),d=Rr(i).buffer,f=Object.assign(Object.assign({},r),{id:Rr(r.id).buffer}),g=Object.assign(Object.assign({},c),{challenge:d,user:f});if(s&&s.length>0){g.excludeCredentials=new Array(s.length);for(let p=0;p<s.length;p++){const m=s[p];g.excludeCredentials[p]=Object.assign(Object.assign({},m),{id:Rr(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return g}function Vx(l){if(!l)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(l);const{challenge:i,allowCredentials:r}=l,s=Br(l,["challenge","allowCredentials"]),c=Rr(i).buffer,d=Object.assign(Object.assign({},s),{challenge:c});if(r&&r.length>0){d.allowCredentials=new Array(r.length);for(let f=0;f<r.length;f++){const g=r[f];d.allowCredentials[f]=Object.assign(Object.assign({},g),{id:Rr(g.id).buffer,type:g.type||"public-key",transports:g.transports})}}return d}function Wx(l){var i;if("toJSON"in l&&typeof l.toJSON=="function")return l.toJSON();const r=l;return{id:l.id,rawId:l.id,response:{attestationObject:Wi(new Uint8Array(l.response.attestationObject)),clientDataJSON:Wi(new Uint8Array(l.response.clientDataJSON))},type:"public-key",clientExtensionResults:l.getClientExtensionResults(),authenticatorAttachment:(i=r.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function Gx(l){var i;if("toJSON"in l&&typeof l.toJSON=="function")return l.toJSON();const r=l,s=l.getClientExtensionResults(),c=l.response;return{id:l.id,rawId:l.id,response:{authenticatorData:Wi(new Uint8Array(c.authenticatorData)),clientDataJSON:Wi(new Uint8Array(c.clientDataJSON)),signature:Wi(new Uint8Array(c.signature)),userHandle:c.userHandle?Wi(new Uint8Array(c.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(i=r.authenticatorAttachment)!==null&&i!==void 0?i:void 0}}function bm(l){return l==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(l)}function xg(){var l,i;return!!(fn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((l=navigator?.credentials)===null||l===void 0?void 0:l.create)=="function"&&typeof((i=navigator?.credentials)===null||i===void 0?void 0:i.get)=="function")}async function Yx(l){try{const i=await navigator.credentials.create(l);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new fl("Browser returned unexpected credential type",i)}:{data:null,error:new fl("Empty credential response",i)}}catch(i){return{data:null,error:qx({error:i,options:l})}}}async function Kx(l){try{const i=await navigator.credentials.get(l);return i?i instanceof PublicKeyCredential?{data:i,error:null}:{data:null,error:new fl("Browser returned unexpected credential type",i)}:{data:null,error:new fl("Empty credential response",i)}}catch(i){return{data:null,error:$x({error:i,options:l})}}}const Jx={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Qx={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function hl(...l){const i=c=>c!==null&&typeof c=="object"&&!Array.isArray(c),r=c=>c instanceof ArrayBuffer||ArrayBuffer.isView(c),s={};for(const c of l)if(c)for(const d in c){const f=c[d];if(f!==void 0)if(Array.isArray(f))s[d]=f;else if(r(f))s[d]=f;else if(i(f)){const g=s[d];i(g)?s[d]=hl(g,f):s[d]=hl(f)}else s[d]=f}return s}function Xx(l,i){return hl(Jx,l,i||{})}function Zx(l,i){return hl(Qx,l,i||{})}class ev{constructor(i){this.client=i,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(i){return this.client.mfa.enroll(Object.assign(Object.assign({},i),{factorType:"webauthn"}))}async _challenge({factorId:i,webauthn:r,friendlyName:s,signal:c},d){try{const{data:f,error:g}=await this.client.mfa.challenge({factorId:i,webauthn:r});if(!f)return{data:null,error:g};const p=c??Px.createNewAbortSignal();if(f.webauthn.type==="create"){const{user:m}=f.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${s}`),m.displayName||(m.displayName=m.name)}switch(f.webauthn.type){case"create":{const m=Xx(f.webauthn.credential_options.publicKey,d?.create),{data:b,error:S}=await Yx({publicKey:m,signal:p});return b?{data:{factorId:i,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:b}},error:null}:{data:null,error:S}}case"request":{const m=Zx(f.webauthn.credential_options.publicKey,d?.request),{data:b,error:S}=await Kx(Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:m,signal:p}));return b?{data:{factorId:i,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:b}},error:null}:{data:null,error:S}}}}catch(f){return We(f)?{data:null,error:f}:{data:null,error:new Vi("Unexpected error in challenge",f)}}}async _verify({challengeId:i,factorId:r,webauthn:s}){return this.client.mfa.verify({factorId:r,challengeId:i,webauthn:s})}async _authenticate({factorId:i,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:c}={}},d){if(!r)return{data:null,error:new Uo("rpId is required for WebAuthn authentication")};try{if(!xg())return{data:null,error:new Vi("Browser does not support WebAuthn",null)};const{data:f,error:g}=await this.challenge({factorId:i,webauthn:{rpId:r,rpOrigins:s},signal:c},{request:d});if(!f)return{data:null,error:g};const{webauthn:p}=f;return this._verify({factorId:i,challengeId:f.challengeId,webauthn:{type:p.type,rpId:r,rpOrigins:s,credential_response:p.credential_response}})}catch(f){return We(f)?{data:null,error:f}:{data:null,error:new Vi("Unexpected error in authenticate",f)}}}async _register({friendlyName:i,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:c}={}},d){if(!r)return{data:null,error:new Uo("rpId is required for WebAuthn registration")};try{if(!xg())return{data:null,error:new Vi("Browser does not support WebAuthn",null)};const{data:f,error:g}=await this._enroll({friendlyName:i});if(!f)return await this.client.mfa.listFactors().then(b=>{var S;return(S=b.data)===null||S===void 0?void 0:S.all.find(j=>j.factor_type==="webauthn"&&j.friendly_name===i&&j.status!=="unverified")}).then(b=>b?this.client.mfa.unenroll({factorId:b?.id}):void 0),{data:null,error:g};const{data:p,error:m}=await this._challenge({factorId:f.id,friendlyName:f.friendly_name,webauthn:{rpId:r,rpOrigins:s},signal:c},{create:d});return p?this._verify({factorId:f.id,challengeId:p.challengeId,webauthn:{rpId:r,rpOrigins:s,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:m}}catch(f){return We(f)?{data:null,error:f}:{data:null,error:new Vi("Unexpected error in register",f)}}}}Ux();const tv={url:Q0,storageKey:X0,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Z0,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function vg(l,i,r){return await r()}const Nr={};class Lo{get jwks(){var i,r;return(r=(i=Nr[this.storageKey])===null||i===void 0?void 0:i.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(i){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{jwks:i})}get jwks_cached_at(){var i,r;return(r=(i=Nr[this.storageKey])===null||i===void 0?void 0:i.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(i){Nr[this.storageKey]=Object.assign(Object.assign({},Nr[this.storageKey]),{cachedAt:i})}constructor(i){var r,s,c;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const d=Object.assign(Object.assign({},tv),i);if(this.storageKey=d.storageKey,this.instanceID=(r=Lo.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Lo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!d.debug,typeof d.debug=="function"&&(this.logger=d.debug),this.instanceID>0&&fn()){const f=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(f),this.logDebugMessages&&console.trace(f)}if(this.persistSession=d.persistSession,this.autoRefreshToken=d.autoRefreshToken,this.admin=new Ox({url:d.url,headers:d.headers,fetch:d.fetch}),this.url=d.url,this.headers=d.headers,this.fetch=gm(d.fetch),this.lock=d.lock||vg,this.detectSessionInUrl=d.detectSessionInUrl,this.flowType=d.flowType,this.hasCustomAuthorizationHeader=d.hasCustomAuthorizationHeader,this.throwOnError=d.throwOnError,d.lock?this.lock=d.lock:fn()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Bx:this.lock=vg,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ev(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(d.storage?this.storage=d.storage:pm()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=bg(this.memoryStorage)),d.userStorage&&(this.userStorage=d.userStorage)):(this.memoryStorage={},this.storage=bg(this.memoryStorage)),fn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(f){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",f)}(c=this.broadcastChannel)===null||c===void 0||c.addEventListener("message",async f=>{this._debug("received broadcast notification from other tab or client",f),await this._notifyAllSubscribers(f.data.event,f.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(i){if(this.throwOnError&&i&&i.error)throw i.error;return i}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${um}) ${new Date().toISOString()}`}_debug(...i){return this.logDebugMessages&&this.logger(this._logPrefix(),...i),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var i;try{let r={},s="none";if(fn()&&(r=hx(window.location.href),this._isImplicitGrantCallback(r)?s="implicit":await this._isPKCECallback(r)&&(s="pkce")),fn()&&this.detectSessionInUrl&&s!=="none"){const{data:c,error:d}=await this._getSessionFromURL(r,s);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),rx(d)){const p=(i=d.details)===null||i===void 0?void 0:i.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:d}}return await this._removeSession(),{error:d}}const{session:f,redirectType:g}=c;return this._debug("#_initialize()","detected session in URL",f,"redirect type",g),await this._saveSession(f),setTimeout(async()=>{g==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",f):await this._notifyAllSubscribers("SIGNED_IN",f)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return We(r)?this._returnResult({error:r}):this._returnResult({error:new Vi("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(i){var r,s,c;try{const d=await Je(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=i?.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(c=i?.options)===null||c===void 0?void 0:c.captchaToken}},xform:da}),{data:f,error:g}=d;if(g||!f)return this._returnResult({data:{user:null,session:null},error:g});const p=f.session,m=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(d){if(We(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signUp(i){var r,s,c;try{let d;if("email"in i){const{email:b,password:S,options:j}=i;let x=null,w=null;this.flowType==="pkce"&&([x,w]=await Cr(this.storage,this.storageKey)),d=await Je(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:j?.emailRedirectTo,body:{email:b,password:S,data:(r=j?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:j?.captchaToken},code_challenge:x,code_challenge_method:w},xform:da})}else if("phone"in i){const{phone:b,password:S,options:j}=i;d=await Je(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:S,data:(s=j?.data)!==null&&s!==void 0?s:{},channel:(c=j?.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:j?.captchaToken}},xform:da})}else throw new sl("You must provide either an email or phone number and a password");const{data:f,error:g}=d;if(g||!f)return this._returnResult({data:{user:null,session:null},error:g});const p=f.session,m=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(d){if(We(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signInWithPassword(i){try{let r;if("email"in i){const{email:d,password:f,options:g}=i;r=await Je(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:f,gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:mg})}else if("phone"in i){const{phone:d,password:f,options:g}=i;r=await Je(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:f,gotrue_meta_security:{captcha_token:g?.captchaToken}},xform:mg})}else throw new sl("You must provide either an email or phone number and a password");const{data:s,error:c}=r;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!s||!s.session||!s.user){const d=new wr;return this._returnResult({data:{user:null,session:null},error:d})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:c})}catch(r){if(We(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(i){var r,s,c,d;return await this._handleProviderSignIn(i.provider,{redirectTo:(r=i.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=i.options)===null||s===void 0?void 0:s.scopes,queryParams:(c=i.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(d=i.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(i){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(i))}async signInWithWeb3(i){const{chain:r}=i;switch(r){case"ethereum":return await this.signInWithEthereum(i);case"solana":return await this.signInWithSolana(i);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(i){var r,s,c,d,f,g,p,m,b,S,j;let x,w;if("message"in i)x=i.message,w=i.signature;else{const{chain:v,wallet:E,statement:T,options:L}=i;let R;if(fn())if(typeof E=="object")R=E;else{const M=window;if("ethereum"in M&&typeof M.ethereum=="object"&&"request"in M.ethereum&&typeof M.ethereum.request=="function")R=M.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=E}const z=new URL((r=L?.url)!==null&&r!==void 0?r:window.location.href),C=await R.request({method:"eth_requestAccounts"}).then(M=>M).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!C||C.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const O=ym(C[0]);let I=(s=L?.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!I){const M=await R.request({method:"eth_chainId"});I=Lx(M)}const k={domain:z.host,address:O,statement:T,uri:z.href,version:"1",chainId:I,nonce:(c=L?.signInWithEthereum)===null||c===void 0?void 0:c.nonce,issuedAt:(f=(d=L?.signInWithEthereum)===null||d===void 0?void 0:d.issuedAt)!==null&&f!==void 0?f:new Date,expirationTime:(g=L?.signInWithEthereum)===null||g===void 0?void 0:g.expirationTime,notBefore:(p=L?.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(m=L?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(b=L?.signInWithEthereum)===null||b===void 0?void 0:b.resources};x=Mx(k),w=await R.request({method:"personal_sign",params:[Ix(x),O]})}try{const{data:v,error:E}=await Je(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:x,signature:w},!((S=i.options)===null||S===void 0)&&S.captchaToken?{gotrue_meta_security:{captcha_token:(j=i.options)===null||j===void 0?void 0:j.captchaToken}}:null),xform:da});if(E)throw E;if(!v||!v.session||!v.user){const T=new wr;return this._returnResult({data:{user:null,session:null},error:T})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:E})}catch(v){if(We(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async signInWithSolana(i){var r,s,c,d,f,g,p,m,b,S,j,x;let w,v;if("message"in i)w=i.message,v=i.signature;else{const{chain:E,wallet:T,statement:L,options:R}=i;let z;if(fn())if(typeof T=="object")z=T;else{const O=window;if("solana"in O&&typeof O.solana=="object"&&("signIn"in O.solana&&typeof O.solana.signIn=="function"||"signMessage"in O.solana&&typeof O.solana.signMessage=="function"))z=O.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof T!="object"||!R?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=T}const C=new URL((r=R?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in z&&z.signIn){const O=await z.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},R?.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),L?{statement:L}:null));let I;if(Array.isArray(O)&&O[0]&&typeof O[0]=="object")I=O[0];else if(O&&typeof O=="object"&&"signedMessage"in O&&"signature"in O)I=O;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)w=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),v=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in z)||typeof z.signMessage!="function"||!("publicKey"in z)||typeof z!="object"||!z.publicKey||!("toBase58"in z.publicKey)||typeof z.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${C.host} wants you to sign in with your Solana account:`,z.publicKey.toBase58(),...L?["",L,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(c=(s=R?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((d=R?.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${R.signInWithSolana.notBefore}`]:[],...!((f=R?.signInWithSolana)===null||f===void 0)&&f.expirationTime?[`Expiration Time: ${R.signInWithSolana.expirationTime}`]:[],...!((g=R?.signInWithSolana)===null||g===void 0)&&g.chainId?[`Chain ID: ${R.signInWithSolana.chainId}`]:[],...!((p=R?.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${R.signInWithSolana.nonce}`]:[],...!((m=R?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${R.signInWithSolana.requestId}`]:[],...!((S=(b=R?.signInWithSolana)===null||b===void 0?void 0:b.resources)===null||S===void 0)&&S.length?["Resources",...R.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const O=await z.signMessage(new TextEncoder().encode(w),"utf8");if(!O||!(O instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");v=O}}try{const{data:E,error:T}=await Je(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:Wi(v)},!((j=i.options)===null||j===void 0)&&j.captchaToken?{gotrue_meta_security:{captcha_token:(x=i.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:da});if(T)throw T;if(!E||!E.session||!E.user){const L=new wr;return this._returnResult({data:{user:null,session:null},error:L})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:T})}catch(E){if(We(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async _exchangeCodeForSession(i){const r=await $i(this.storage,`${this.storageKey}-code-verifier`),[s,c]=(r??"").split("/");try{const{data:d,error:f}=await Je(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:i,code_verifier:s},xform:da});if(await xi(this.storage,`${this.storageKey}-code-verifier`),f)throw f;if(!d||!d.session||!d.user){const g=new wr;return this._returnResult({data:{user:null,session:null,redirectType:null},error:g})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:Object.assign(Object.assign({},d),{redirectType:c??null}),error:f})}catch(d){if(We(d))return this._returnResult({data:{user:null,session:null,redirectType:null},error:d});throw d}}async signInWithIdToken(i){try{const{options:r,provider:s,token:c,access_token:d,nonce:f}=i,g=await Je(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:c,access_token:d,nonce:f,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:da}),{data:p,error:m}=g;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!p||!p.session||!p.user){const b=new wr;return this._returnResult({data:{user:null,session:null},error:b})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:m})}catch(r){if(We(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(i){var r,s,c,d,f;try{if("email"in i){const{email:g,options:p}=i;let m=null,b=null;this.flowType==="pkce"&&([m,b]=await Cr(this.storage,this.storageKey));const{error:S}=await Je(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:g,data:(r=p?.data)!==null&&r!==void 0?r:{},create_user:(s=p?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:m,code_challenge_method:b},redirectTo:p?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:S})}if("phone"in i){const{phone:g,options:p}=i,{data:m,error:b}=await Je(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:g,data:(c=p?.data)!==null&&c!==void 0?c:{},create_user:(d=p?.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(f=p?.channel)!==null&&f!==void 0?f:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:b})}throw new sl("You must provide either an email or phone number.")}catch(g){if(We(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async verifyOtp(i){var r,s;try{let c,d;"options"in i&&(c=(r=i.options)===null||r===void 0?void 0:r.redirectTo,d=(s=i.options)===null||s===void 0?void 0:s.captchaToken);const{data:f,error:g}=await Je(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},i),{gotrue_meta_security:{captcha_token:d}}),redirectTo:c,xform:da});if(g)throw g;if(!f)throw new Error("An error occurred on token verification.");const p=f.session,m=f.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(i.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(c){if(We(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithSSO(i){var r,s,c,d,f;try{let g=null,p=null;this.flowType==="pkce"&&([g,p]=await Cr(this.storage,this.storageKey));const m=await Je(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in i?{provider_id:i.providerId}:null),"domain"in i?{domain:i.domain}:null),{redirect_to:(s=(r=i.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((c=i?.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:i.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:g,code_challenge_method:p}),headers:this.headers,xform:zx});return!((d=m.data)===null||d===void 0)&&d.url&&fn()&&!(!((f=i.options)===null||f===void 0)&&f.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(g){if(We(g))return this._returnResult({data:null,error:g});throw g}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async i=>{const{data:{session:r},error:s}=i;if(s)throw s;if(!r)throw new ca;const{error:c}=await Je(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:c})})}catch(i){if(We(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async resend(i){try{const r=`${this.url}/resend`;if("email"in i){const{email:s,type:c,options:d}=i,{error:f}=await Je(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:c,gotrue_meta_security:{captcha_token:d?.captchaToken}},redirectTo:d?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}else if("phone"in i){const{phone:s,type:c,options:d}=i,{data:f,error:g}=await Je(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:c,gotrue_meta_security:{captcha_token:d?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:g})}throw new sl("You must provide either an email or phone number and a type")}catch(r){if(We(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(i,r){this._debug("#_acquireLock","begin",i);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await s,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,i,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=r();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(i){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await i(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let i=null;const r=await $i(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?i=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!i)return{data:{session:null},error:null};const s=i.expires_at?i.expires_at*1e3-Date.now()<zd:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",i.expires_at),!s){if(this.userStorage){const f=await $i(this.userStorage,this.storageKey+"-user");f?.user?i.user=f.user:i.user=Od()}if(this.storage.isServer&&i.user&&!i.user.__isUserNotAvailableProxy){const f={value:this.suppressGetSessionWarning};i.user=Ex(i.user,f),f.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:i},error:null}}const{data:c,error:d}=await this._callRefreshToken(i.refresh_token);return d?this._returnResult({data:{session:null},error:d}):this._returnResult({data:{session:c},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(i){return i?await this._getUser(i):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(i){try{return i?await Je(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:i,xform:vi}):await this._useSession(async r=>{var s,c,d;const{data:f,error:g}=r;if(g)throw g;return!(!((s=f.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ca}:await Je(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(c=f.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0,xform:vi})})}catch(r){if(We(r))return ix(r)&&(await this._removeSession(),await xi(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(i,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(i,r))}async _updateUser(i,r={}){try{return await this._useSession(async s=>{const{data:c,error:d}=s;if(d)throw d;if(!c.session)throw new ca;const f=c.session;let g=null,p=null;this.flowType==="pkce"&&i.email!=null&&([g,p]=await Cr(this.storage,this.storageKey));const{data:m,error:b}=await Je(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},i),{code_challenge:g,code_challenge_method:p}),jwt:f.access_token,xform:vi});if(b)throw b;return f.user=m.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),this._returnResult({data:{user:f.user},error:null})})}catch(s){if(We(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(i){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(i))}async _setSession(i){try{if(!i.access_token||!i.refresh_token)throw new ca;const r=Date.now()/1e3;let s=r,c=!0,d=null;const{payload:f}=Rd(i.access_token);if(f.exp&&(s=f.exp,c=s<=r),c){const{data:g,error:p}=await this._callRefreshToken(i.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!g)return{data:{user:null,session:null},error:null};d=g}else{const{data:g,error:p}=await this._getUser(i.access_token);if(p)throw p;d={access_token:i.access_token,refresh_token:i.refresh_token,user:g.user,token_type:"bearer",expires_in:s-r,expires_at:s},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return this._returnResult({data:{user:d.user,session:d},error:null})}catch(r){if(We(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(i){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(i))}async _refreshSession(i){try{return await this._useSession(async r=>{var s;if(!i){const{data:f,error:g}=r;if(g)throw g;i=(s=f.session)!==null&&s!==void 0?s:void 0}if(!i?.refresh_token)throw new ca;const{data:c,error:d}=await this._callRefreshToken(i.refresh_token);return d?this._returnResult({data:{user:null,session:null},error:d}):c?this._returnResult({data:{user:c.user,session:c},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(We(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(i,r){try{if(!fn())throw new ll("No browser detected.");if(i.error||i.error_description||i.error_code)throw new ll(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new cg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ll("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!i.code)throw new cg("No code detected.");const{data:L,error:R}=await this._exchangeCodeForSession(i.code);if(R)throw R;const z=new URL(window.location.href);return z.searchParams.delete("code"),window.history.replaceState(window.history.state,"",z.toString()),{data:{session:L.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:c,access_token:d,refresh_token:f,expires_in:g,expires_at:p,token_type:m}=i;if(!d||!g||!f||!m)throw new ll("No session defined in URL");const b=Math.round(Date.now()/1e3),S=parseInt(g);let j=b+S;p&&(j=parseInt(p));const x=j-b;x*1e3<=zr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${S}s`);const w=j-S;b-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,j,b):b-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,j,b);const{data:v,error:E}=await this._getUser(d);if(E)throw E;const T={provider_token:s,provider_refresh_token:c,access_token:d,expires_in:S,expires_at:j,refresh_token:f,token_type:m,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:T,redirectType:i.type},error:null})}catch(s){if(We(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(i){return!!(i.access_token||i.error_description)}async _isPKCECallback(i){const r=await $i(this.storage,`${this.storageKey}-code-verifier`);return!!(i.code&&r)}async signOut(i={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(i))}async _signOut({scope:i}={scope:"global"}){return await this._useSession(async r=>{var s;const{data:c,error:d}=r;if(d)return this._returnResult({error:d});const f=(s=c.session)===null||s===void 0?void 0:s.access_token;if(f){const{error:g}=await this.admin.signOut(f,i);if(g&&!(ax(g)&&(g.status===404||g.status===401||g.status===403)))return this._returnResult({error:g})}return i!=="others"&&(await this._removeSession(),await xi(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(i){const r=fx(),s={id:r,callback:i,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:s}}}async _emitInitialSession(i){return await this._useSession(async r=>{var s,c;try{const{data:{session:d},error:f}=r;if(f)throw f;await((s=this.stateChangeEmitters.get(i))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",i,"session",d)}catch(d){await((c=this.stateChangeEmitters.get(i))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",i,"error",d),console.error(d)}})}async resetPasswordForEmail(i,r={}){let s=null,c=null;this.flowType==="pkce"&&([s,c]=await Cr(this.storage,this.storageKey,!0));try{return await Je(this.fetch,"POST",`${this.url}/recover`,{body:{email:i,code_challenge:s,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(d){if(We(d))return this._returnResult({data:null,error:d});throw d}}async getUserIdentities(){var i;try{const{data:r,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(i=r.user.identities)!==null&&i!==void 0?i:[]},error:null})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(i){return"token"in i?this.linkIdentityIdToken(i):this.linkIdentityOAuth(i)}async linkIdentityOAuth(i){var r;try{const{data:s,error:c}=await this._useSession(async d=>{var f,g,p,m,b;const{data:S,error:j}=d;if(j)throw j;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,i.provider,{redirectTo:(f=i.options)===null||f===void 0?void 0:f.redirectTo,scopes:(g=i.options)===null||g===void 0?void 0:g.scopes,queryParams:(p=i.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await Je(this.fetch,"GET",x,{headers:this.headers,jwt:(b=(m=S.session)===null||m===void 0?void 0:m.access_token)!==null&&b!==void 0?b:void 0})});if(c)throw c;return fn()&&!(!((r=i.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),this._returnResult({data:{provider:i.provider,url:s?.url},error:null})}catch(s){if(We(s))return this._returnResult({data:{provider:i.provider,url:null},error:s});throw s}}async linkIdentityIdToken(i){return await this._useSession(async r=>{var s;try{const{error:c,data:{session:d}}=r;if(c)throw c;const{options:f,provider:g,token:p,access_token:m,nonce:b}=i,S=await Je(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=d?.access_token)!==null&&s!==void 0?s:void 0,body:{provider:g,id_token:p,access_token:m,nonce:b,link_identity:!0,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:da}),{data:j,error:x}=S;return x?this._returnResult({data:{user:null,session:null},error:x}):!j||!j.session||!j.user?this._returnResult({data:{user:null,session:null},error:new wr}):(j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("USER_UPDATED",j.session)),this._returnResult({data:j,error:x}))}catch(c){if(We(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}})}async unlinkIdentity(i){try{return await this._useSession(async r=>{var s,c;const{data:d,error:f}=r;if(f)throw f;return await Je(this.fetch,"DELETE",`${this.url}/user/identities/${i.identity_id}`,{headers:this.headers,jwt:(c=(s=d.session)===null||s===void 0?void 0:s.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(i){const r=`#_refreshAccessToken(${i.substring(0,5)}...)`;this._debug(r,"begin");try{const s=Date.now();return await mx(async c=>(c>0&&await gx(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await Je(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:i},headers:this.headers,xform:da})),(c,d)=>{const f=200*Math.pow(2,c);return d&&kd(d)&&Date.now()+f-s<zr})}catch(s){if(this._debug(r,"error",s),We(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(r,"end")}}_isValidSession(i){return typeof i=="object"&&i!==null&&"access_token"in i&&"refresh_token"in i&&"expires_at"in i}async _handleProviderSignIn(i,r){const s=await this._getUrlForProvider(`${this.url}/authorize`,i,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",i,"options",r,"url",s),fn()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:i,url:s},error:null}}async _recoverAndRefresh(){var i,r;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const c=await $i(this.storage,this.storageKey);if(c&&this.userStorage){let f=await $i(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!f&&(f={user:c.user},await kr(this.userStorage,this.storageKey+"-user",f)),c.user=(i=f?.user)!==null&&i!==void 0?i:Od()}else if(c&&!c.user&&!c.user){const f=await $i(this.storage,this.storageKey+"-user");f&&f?.user?(c.user=f.user,await xi(this.storage,this.storageKey+"-user"),await kr(this.storage,this.storageKey,c)):c.user=Od()}if(this._debug(s,"session from storage",c),!this._isValidSession(c)){this._debug(s,"session is not valid"),c!==null&&await this._removeSession();return}const d=((r=c.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<zd;if(this._debug(s,`session has${d?"":" not"} expired with margin of ${zd}s`),d){if(this.autoRefreshToken&&c.refresh_token){const{error:f}=await this._callRefreshToken(c.refresh_token);f&&(console.error(f),kd(f)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",f),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:f,error:g}=await this._getUser(c.access_token);!g&&f?.user?(c.user=f.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(f){console.error("Error getting user data:",f),this._debug(s,"error getting user data, skipping SIGNED_IN notification",f)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(s,"error",c),console.error(c);return}finally{this._debug(s,"end")}}async _callRefreshToken(i){var r,s;if(!i)throw new ca;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${i.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new yl;const{data:d,error:f}=await this._refreshAccessToken(i);if(f)throw f;if(!d.session)throw new ca;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const g={data:d.session,error:null};return this.refreshingDeferred.resolve(g),g}catch(d){if(this._debug(c,"error",d),We(d)){const f={data:null,error:d};return kd(d)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(f),f}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(d),d}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(i,r,s=!0){const c=`#_notifyAllSubscribers(${i})`;this._debug(c,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:i,session:r});const d=[],f=Array.from(this.stateChangeEmitters.values()).map(async g=>{try{await g.callback(i,r)}catch(p){d.push(p)}});if(await Promise.all(f),d.length>0){for(let g=0;g<d.length;g+=1)console.error(d[g]);throw d[0]}}finally{this._debug(c,"end")}}async _saveSession(i){this._debug("#_saveSession()",i),this.suppressGetSessionWarning=!0;const r=Object.assign({},i),s=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&r.user&&await kr(this.userStorage,this.storageKey+"-user",{user:r.user});const c=Object.assign({},r);delete c.user;const d=pg(c);await kr(this.storage,this.storageKey,d)}else{const c=pg(r);await kr(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),await xi(this.storage,this.storageKey),await xi(this.storage,this.storageKey+"-code-verifier"),await xi(this.storage,this.storageKey+"-user"),this.userStorage&&await xi(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const i=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{i&&fn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",i)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const i=setInterval(()=>this._autoRefreshTokenTick(),zr);this.autoRefreshTicker=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const i=this.autoRefreshTicker;this.autoRefreshTicker=null,i&&clearInterval(i)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const i=Date.now();try{return await this._useSession(async r=>{const{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((s.expires_at*1e3-i)/zr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${zr}ms, refresh threshold is ${Fd} ticks`),c<=Fd&&await this._callRefreshToken(s.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(i){if(i.isAcquireTimeout||i instanceof mm)this._debug("auto refresh token tick lock not available");else throw i}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(i){console.error("_handleVisibilityChange",i)}}async _onVisibilityChanged(i){const r=`#_onVisibilityChanged(${i})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),i||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(i,r,s){const c=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&c.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&c.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[d,f]=await Cr(this.storage,this.storageKey),g=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(f)}`});c.push(g.toString())}if(s?.queryParams){const d=new URLSearchParams(s.queryParams);c.push(d.toString())}return s?.skipBrowserRedirect&&c.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${i}?${c.join("&")}`}async _unenroll(i){try{return await this._useSession(async r=>{var s;const{data:c,error:d}=r;return d?this._returnResult({data:null,error:d}):await Je(this.fetch,"DELETE",`${this.url}/factors/${i.factorId}`,{headers:this.headers,jwt:(s=c?.session)===null||s===void 0?void 0:s.access_token})})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(i){try{return await this._useSession(async r=>{var s,c;const{data:d,error:f}=r;if(f)return this._returnResult({data:null,error:f});const g=Object.assign({friendly_name:i.friendlyName,factor_type:i.factorType},i.factorType==="phone"?{phone:i.phone}:i.factorType==="totp"?{issuer:i.issuer}:{}),{data:p,error:m}=await Je(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:(s=d?.session)===null||s===void 0?void 0:s.access_token});return m?this._returnResult({data:null,error:m}):(i.factorType==="totp"&&p.type==="totp"&&(!((c=p?.totp)===null||c===void 0)&&c.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}}async _verify(i){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var s;const{data:c,error:d}=r;if(d)return this._returnResult({data:null,error:d});const f=Object.assign({challenge_id:i.challengeId},"webauthn"in i?{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_response:i.webauthn.type==="create"?Wx(i.webauthn.credential_response):Gx(i.webauthn.credential_response)})}:{code:i.code}),{data:g,error:p}=await Je(this.fetch,"POST",`${this.url}/factors/${i.factorId}/verify`,{body:f,headers:this.headers,jwt:(s=c?.session)===null||s===void 0?void 0:s.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),this._returnResult({data:g,error:p}))})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(i){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var s;const{data:c,error:d}=r;if(d)return this._returnResult({data:null,error:d});const f=await Je(this.fetch,"POST",`${this.url}/factors/${i.factorId}/challenge`,{body:i,headers:this.headers,jwt:(s=c?.session)===null||s===void 0?void 0:s.access_token});if(f.error)return f;const{data:g}=f;if(g.type!=="webauthn")return{data:g,error:null};switch(g.webauthn.type){case"create":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:Fx(g.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:Vx(g.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(i){const{data:r,error:s}=await this._challenge({factorId:i.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:i.factorId,challengeId:r.id,code:i.code})}async _listFactors(){var i;const{data:{user:r},error:s}=await this.getUser();if(s)return{data:null,error:s};const c={all:[],phone:[],totp:[],webauthn:[]};for(const d of(i=r?.factors)!==null&&i!==void 0?i:[])c.all.push(d),d.status==="verified"&&c[d.factor_type].push(d);return{data:c,error:null}}async _getAuthenticatorAssuranceLevel(){var i,r;const{data:{session:s},error:c}=await this.getSession();if(c)return this._returnResult({data:null,error:c});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=Rd(s.access_token);let f=null;d.aal&&(f=d.aal);let g=f;((r=(i=s.user.factors)===null||i===void 0?void 0:i.filter(b=>b.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(g="aal2");const m=d.amr||[];return{data:{currentLevel:f,nextLevel:g,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(i){try{return await this._useSession(async r=>{const{data:{session:s},error:c}=r;return c?this._returnResult({data:null,error:c}):s?await Je(this.fetch,"GET",`${this.url}/oauth/authorizations/${i}`,{headers:this.headers,jwt:s.access_token,xform:d=>({data:d,error:null})}):this._returnResult({data:null,error:new ca})})}catch(r){if(We(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(i,r){try{return await this._useSession(async s=>{const{data:{session:c},error:d}=s;if(d)return this._returnResult({data:null,error:d});if(!c)return this._returnResult({data:null,error:new ca});const f=await Je(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"approve"},xform:g=>({data:g,error:null})});return f.data&&f.data.redirect_url&&fn()&&!r?.skipBrowserRedirect&&window.location.assign(f.data.redirect_url),f})}catch(s){if(We(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(i,r){try{return await this._useSession(async s=>{const{data:{session:c},error:d}=s;if(d)return this._returnResult({data:null,error:d});if(!c)return this._returnResult({data:null,error:new ca});const f=await Je(this.fetch,"POST",`${this.url}/oauth/authorizations/${i}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"deny"},xform:g=>({data:g,error:null})});return f.data&&f.data.redirect_url&&fn()&&!r?.skipBrowserRedirect&&window.location.assign(f.data.redirect_url),f})}catch(s){if(We(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(i,r={keys:[]}){let s=r.keys.find(g=>g.kid===i);if(s)return s;const c=Date.now();if(s=this.jwks.keys.find(g=>g.kid===i),s&&this.jwks_cached_at+tx>c)return s;const{data:d,error:f}=await Je(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return!d.keys||d.keys.length===0||(this.jwks=d,this.jwks_cached_at=c,s=d.keys.find(g=>g.kid===i),!s)?null:s}async getClaims(i,r={}){try{let s=i;if(!s){const{data:x,error:w}=await this.getSession();if(w||!x.session)return this._returnResult({data:null,error:w});s=x.session.access_token}const{header:c,payload:d,signature:f,raw:{header:g,payload:p}}=Rd(s);r?.allowExpired||_x(d.exp);const m=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,r?.keys?{keys:r.keys}:r?.jwks);if(!m){const{error:x}=await this.getUser(s);if(x)throw x;return{data:{claims:d,header:c,signature:f},error:null}}const b=wx(c.alg),S=await crypto.subtle.importKey("jwk",m,b,!0,["verify"]);if(!await crypto.subtle.verify(b,S,f,dx(`${g}.${p}`)))throw new Gd("Invalid JWT signature");return{data:{claims:d,header:c,signature:f},error:null}}catch(s){if(We(s))return this._returnResult({data:null,error:s});throw s}}}Lo.nextInstanceID={};const nv=Lo;class av extends nv{constructor(i){super(i)}}class iv{constructor(i,r,s){var c,d,f;this.supabaseUrl=i,this.supabaseKey=r;const g=J0(i);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",g),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",g),this.storageUrl=new URL("storage/v1",g),this.functionsUrl=new URL("functions/v1",g);const p=`sb-${g.hostname.split(".")[0]}-auth-token`,m={db:H0,realtime:F0,auth:Object.assign(Object.assign({},P0),{storageKey:p}),global:$0},b=K0(s??{},m);this.storageKey=(c=b.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(d=b.global.headers)!==null&&d!==void 0?d:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(S,j)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(j)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((f=b.auth)!==null&&f!==void 0?f:{},this.headers,b.global.fetch),this.fetch=G0(r,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.accessToken&&this.accessToken().then(S=>this.realtime.setAuth(S)).catch(S=>console.warn("Failed to set initial Realtime auth token:",S)),this.rest=new Qb(new URL("rest/v1",g).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new I0(this.storageUrl.href,this.headers,this.fetch,s?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new Gb(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(i){return this.rest.from(i)}schema(i){return this.rest.schema(i)}rpc(i,r={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(i,r,s)}channel(i,r={config:{}}){return this.realtime.channel(i,r)}getChannels(){return this.realtime.getChannels()}removeChannel(i){return this.realtime.removeChannel(i)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var i,r;if(this.accessToken)return await this.accessToken();const{data:s}=await this.auth.getSession();return(r=(i=s.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:i,persistSession:r,detectSessionInUrl:s,storage:c,userStorage:d,storageKey:f,flowType:g,lock:p,debug:m,throwOnError:b},S,j){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new av({url:this.authUrl.href,headers:Object.assign(Object.assign({},x),S),storageKey:f,autoRefreshToken:i,persistSession:r,detectSessionInUrl:s,storage:c,userStorage:d,flowType:g,lock:p,debug:m,throwOnError:b,fetch:j,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(i){return new p0(this.realtimeUrl.href,Object.assign(Object.assign({},i),{params:Object.assign({apikey:this.supabaseKey},i?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,s)=>{this._handleTokenChanged(r,"CLIENT",s?.access_token)})}_handleTokenChanged(i,r,s){(i==="TOKEN_REFRESHED"||i==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):i==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const rv=(l,i,r)=>new iv(l,i,r);function ov(){if(typeof window<"u"||typeof process>"u")return!1;const l=process.version;if(l==null)return!1;const i=l.match(/^v(\d+)\./);return i?parseInt(i[1],10)<=18:!1}ov()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const sv="",lv="";throw new Error("Falta configuracin de Supabase. Asegrate de tener un archivo .env con VITE_SUPABASE_URL y VITE_SUPABASE_ANON_KEY");const _a=rv(sv,lv,{auth:{persistSession:!1}}),F=_a,Xn=Object.freeze(Object.defineProperty({__proto__:null,default:F,supabase:_a},Symbol.toStringTag,{value:"Module"}));async function wa(){try{const{data:l,error:i}=await F.from("empresa").select("*").limit(1).maybeSingle();if(i)throw i;const r=l||null;if(!r)return null;try{const s=r.logo;if(!s)r.logoUrl=null;else if(String(s).startsWith("http"))r.logoUrl=String(s);else{const c="logo";try{const f=(await F.storage.from(c).getPublicUrl(String(s)))?.data?.publicUrl??null;if(f)r.logoUrl=f;else{const g=await F.storage.from(c).createSignedUrl(String(s),3600);r.logoUrl=g?.data?.signedUrl??null}}catch{const f="https://sqwqlvsjtimallidxrsz.supabase.co";let g=String(s);g.startsWith(`${c}/`)&&(g=g.slice(c.length+1)),r.logoUrl=`${f}/storage/v1/object/public/${c}/${encodeURIComponent(g)}`}}}catch{r.logoUrl=null}return r}catch(l){return console.warn("getCompanyData error",l),null}}function cv(){return y.useEffect(()=>{let l=!0;return(async()=>{try{const r=await wa();if(!l||!r||!r.logoUrl)return;const s=r.logoUrl,c=r.nombre||r.comercio||r.name||"SET POS",d=document.querySelector('link[rel="manifest"]');if(d){const p={name:`${c} - Sistema de Punto de Ventas`,short_name:c.substring(0,12),description:"Sistema de punto de ventas y gestin de inventario",start_url:"/",scope:"/",display:"standalone",orientation:"any",background_color:"#ffffff",theme_color:"#1e293b",icons:[{src:s,sizes:"192x192",type:"image/png",purpose:"any maskable"},{src:s,sizes:"512x512",type:"image/png",purpose:"any maskable"}],categories:["business","productivity"],prefer_related_applications:!1},m=new Blob([JSON.stringify(p)],{type:"application/json"}),b=URL.createObjectURL(m);d.setAttribute("href",b)}let f=document.querySelector('link[rel="apple-touch-icon"]');f||(f=document.createElement("link"),f.rel="apple-touch-icon",document.head.appendChild(f)),f.setAttribute("href",s);let g=document.querySelector('link[rel="icon"]');g&&g.setAttribute("href",s),console.log("PWA icons updated with company logo:",s)}catch(r){console.warn("Error updating PWA icons:",r)}})(),()=>{l=!1}},[]),null}const dv=300*1e3,Io="app_current_version",uv=async()=>{try{const l=await fetch(`/version.json?t=${Date.now()}`,{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(!l.ok)return{hasUpdate:!1,versionInfo:null};const i=await l.json(),r=localStorage.getItem(Io);return r?i.version!==r?{hasUpdate:!0,versionInfo:i}:{hasUpdate:!1,versionInfo:i}:(localStorage.setItem(Io,i.version),{hasUpdate:!1,versionInfo:i})}catch(l){return console.debug("Error checking for updates:",l),{hasUpdate:!1,versionInfo:null}}},xm=async l=>{try{if("caches"in window){const i=await caches.keys();await Promise.all(i.map(r=>caches.delete(r))),console.log("All caches cleared")}if("serviceWorker"in navigator){const i=await navigator.serviceWorker.getRegistrations();await Promise.all(i.map(r=>r.unregister())),console.log("Service workers unregistered")}l&&localStorage.setItem(Io,l),window.location.reload()}catch(i){console.error("Error during update:",i),window.location.reload()}};function fv(){const[l,i]=y.useState(!1),[r,s]=y.useState(null),[c,d]=y.useState(!1),f=async()=>{try{const m=await fetch(`/version.json?t=${Date.now()}`,{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(!m.ok){console.debug("Could not fetch version info");return}const b=await m.json(),S=localStorage.getItem(Io);if(console.debug("Version check:",{local:S,remote:b.version}),!S){localStorage.setItem(Io,b.version);return}b.version!==S&&(console.log("New version available:",b.version),s(b),i(!0))}catch(m){console.debug("Error checking for updates:",m)}},g=async()=>{d(!0),await xm(r?.version)},p=()=>{i(!1),r&&localStorage.setItem(`dismissed_version_${r.version}`,"true")};return y.useEffect(()=>{f();const m=setInterval(f,dv);return()=>clearInterval(m)},[]),!l||!r?null:t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
        .version-update-overlay {
          position: fixed;
          inset: 0;
          background: rgba(2, 6, 23, 0.8);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 99999;
          animation: fadeIn 300ms ease-out;
        }
        .version-update-modal {
          background: white;
          border-radius: 16px;
          padding: 28px;
          width: 90%;
          max-width: 480px;
          box-shadow: 0 20px 60px rgba(2, 6, 23, 0.4);
          animation: slideUp 350ms ease-out;
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { 
            opacity: 0;
            transform: translateY(30px) scale(0.95);
          }
          to { 
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        .version-update-icon {
          width: 64px;
          height: 64px;
          margin: 0 auto 20px;
          background: linear-gradient(135deg, #3b82f6, #8b5cf6);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 32px;
          animation: pulse 2s infinite;
        }
        @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }
        .version-update-title {
          font-size: 1.5rem;
          font-weight: 800;
          color: #1e293b;
          text-align: center;
          margin: 0 0 12px 0;
        }
        .version-update-subtitle {
          color: #64748b;
          text-align: center;
          margin-bottom: 20px;
          font-size: 0.95rem;
        }
        .version-update-version {
          background: #f1f5f9;
          padding: 12px 16px;
          border-radius: 8px;
          margin-bottom: 16px;
          text-align: center;
        }
        .version-update-version-label {
          font-size: 0.75rem;
          color: #64748b;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin-bottom: 4px;
        }
        .version-update-version-number {
          font-size: 1.25rem;
          font-weight: 700;
          color: #3b82f6;
        }
        .version-update-changelog {
          background: #fefce8;
          border: 1px solid #fde047;
          padding: 12px;
          border-radius: 8px;
          margin-bottom: 24px;
          font-size: 0.875rem;
          color: #854d0e;
        }
        .version-update-actions {
          display: flex;
          gap: 12px;
        }
        .version-update-btn {
          flex: 1;
          padding: 12px 20px;
          border-radius: 10px;
          font-size: 0.95rem;
          font-weight: 600;
          cursor: pointer;
          border: none;
          transition: all 150ms;
        }
        .version-update-btn-primary {
          background: linear-gradient(135deg, #3b82f6, #2563eb);
          color: white;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .version-update-btn-primary:hover:not(:disabled) {
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }
        .version-update-btn-primary:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }
        .version-update-btn-secondary {
          background: #f1f5f9;
          color: #334155;
          border: 1px solid #cbd5e1;
        }
        .version-update-btn-secondary:hover:not(:disabled) {
          background: #e2e8f0;
        }
        .version-update-spinner {
          display: inline-block;
          width: 16px;
          height: 16px;
          border: 2px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-right: 8px;
        }
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `}),t.jsx("div",{className:"version-update-overlay",children:t.jsxs("div",{className:"version-update-modal",children:[t.jsx("div",{className:"version-update-icon",children:""}),t.jsx("h2",{className:"version-update-title",children:"Nueva versin disponible"}),t.jsx("p",{className:"version-update-subtitle",children:"Hay una actualizacin disponible para mejorar tu experiencia"}),t.jsxs("div",{className:"version-update-version",children:[t.jsx("div",{className:"version-update-version-label",children:"Nueva versin"}),t.jsxs("div",{className:"version-update-version-number",children:["v",r.version]})]}),r.changelog&&t.jsxs("div",{className:"version-update-changelog",children:[" ",r.changelog]}),t.jsxs("div",{className:"version-update-actions",children:[t.jsx("button",{className:"version-update-btn version-update-btn-secondary",onClick:p,disabled:c,children:"Ms tarde"}),t.jsx("button",{className:"version-update-btn version-update-btn-primary",onClick:g,disabled:c,children:c?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"version-update-spinner"}),"Actualizando..."]}):"Actualizar ahora"})]})]})})]})}function hv({onLogin:l}){const[i,r]=y.useState(""),[s,c]=y.useState(""),[d,f]=y.useState(null),[g,p]=y.useState("SET"),[m,b]=y.useState(null);y.useEffect(()=>{S()},[]);async function S(){try{const x=await wa();x&&(p(x.nombre||"SET"),b(x.logoUrl||null))}catch(x){console.error("Error loading company data:",x)}}async function j(x){x.preventDefault(),f(null);const w=i.trim(),v=s.trim();try{console.log("Attempting login for:",w);const{data:E,error:T}=await F.from("users").select("id, username, password, role, nombre_usuario").ilike("username",w).limit(1).maybeSingle();if(T){f("Error de base de datos: "+T.message),console.error("Supabase error:",T);return}if(!E){console.log("User not found in DB"),f("Usuario no encontrado");return}console.log("User found:",E.username);const L=E;if(L.password===v){const R={id:L.id,username:L.username,role:L.role,name:L.nombre_usuario};localStorage.setItem("user",JSON.stringify(R));try{if(L.role==="cajero"){const{data:z}=await F.from("cai").select("*").eq("cajero",L.username).order("id",{ascending:!1}).limit(1);z&&z.length>0&&localStorage.setItem("caiInfo",JSON.stringify(z[0]));const{data:C}=await F.from("ncredito").select("*").eq("cajero",L.username).order("id",{ascending:!1}).limit(1);C&&C.length>0&&localStorage.setItem("ncInfo",JSON.stringify(C[0]))}}catch(z){console.error("Error loading extra user data",z)}f("Inicio de sesin correcto"),typeof l=="function"&&l()}else console.log("Password mismatch. Input:",v,"Stored:",L.password),f("Contrasea incorrecta")}catch(E){console.error("Login exception:",E),f(E.message||"Error desconocido")}}return t.jsx("div",{className:"login-root",children:t.jsxs("div",{className:"login-card",role:"region","aria-label":"login panel",children:[m&&t.jsx("div",{className:"login-logo",children:t.jsx("img",{src:m,alt:"Logo de la empresa"})}),t.jsxs("h3",{className:"login-title",children:["Bienvenido a ",g]}),t.jsx("div",{className:"login-sub",children:"Inicia sesin con tu cuenta"}),t.jsxs("div",{className:"login-inner",children:[t.jsxs("form",{onSubmit:j,children:[t.jsxs("div",{className:"form-field",children:[t.jsx("label",{htmlFor:"username",children:"Usuario"}),t.jsx("input",{id:"username",className:"input",value:i,onChange:x=>r(x.target.value),placeholder:"usuario",required:!0,autoComplete:"username"})]}),t.jsxs("div",{className:"form-field",children:[t.jsx("label",{htmlFor:"password",children:"Contrasea"}),t.jsx("input",{id:"password",className:"input",type:"password",value:s,onChange:x=>c(x.target.value),placeholder:"contrasea",required:!0,autoComplete:"current-password"})]}),t.jsx("div",{children:t.jsx("button",{className:"btn-primary",type:"submit",children:"Entrar"})})]}),d&&t.jsx("p",{className:"login-message",children:d})]})]})})}function Ca({children:l,style:i,className:r}){const[s,c]=y.useState(!1);y.useEffect(()=>{const f=setTimeout(()=>c(!0),10);return()=>clearTimeout(f)},[]);const d={transform:s?"scale(1)":"scale(0.94)",opacity:s?1:0,transition:"transform 180ms cubic-bezier(.2,.9,.2,1), opacity 160ms ease",transformOrigin:"center center"};return t.jsx("div",{className:r,style:{...d,...i},children:l})}function Mn({open:l,onClose:i,width:r=520,children:s,zIndex:c=9999}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:c},onClick:()=>{i&&i()},children:t.jsx(Ca,{children:t.jsx("div",{onClick:d=>d.stopPropagation(),style:{width:r,maxWidth:"95%",background:"white",borderRadius:12,padding:18,boxShadow:"0 12px 40px rgba(2,6,23,0.3)"},children:s})})}):null}function pv({open:l,onClose:i,ncInfo:r,onRefresh:s}){const[c,d]=Dr.useState(!1);return t.jsx(Mn,{open:l,onClose:i,width:520,children:t.jsxs("div",{children:[t.jsx("h3",{style:{marginTop:0},children:"Notas de crdito"}),t.jsxs("div",{style:{color:"#475569",marginTop:8},children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"CAI:"})," ",r?.cai??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Identificador:"})," ",r?.identificador??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Rango desde:"})," ",r?.rango_de??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Rango hasta:"})," ",r?.rango_hasta??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Fecha lmite emisin:"})," ",r?.fecha_vencimiento??r?.fecha_limite_emision??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Secuencia actual:"})," ",r?.secuencia_actual??"-"]})]}),t.jsxs("div",{style:{marginTop:18,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:i,style:{padding:"8px 12px"},children:"Cerrar"}),t.jsx("button",{className:"btn-opaque",style:{padding:"8px 12px"},disabled:c,onClick:async()=>{if(s)try{d(!0),await s()}catch(f){console.debug("Error calling onRefresh from NotasCreditoModal:",f)}finally{d(!1)}},children:c?"Actualizando...":"Actualizar"})]})]})})}function Tn({open:l,title:i="Confirmado",message:r="",onClose:s,onCancel:c,onConfirm:d,confirmLabel:f="Aceptar",cancelLabel:g="Cancelar"}){if(!l)return null;const p=async()=>{try{d&&await d()}catch(m){console.warn("Confirmado:onConfirm error",m)}try{s&&s()}catch{}};return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsxs("div",{style:{width:420,background:"#fff",borderRadius:8,padding:18,boxShadow:"0 4px 20px rgba(2,6,23,0.2)"},children:[t.jsx("h3",{style:{marginTop:0},children:i}),t.jsx("div",{style:{marginTop:8,color:"#334155"},children:r}),t.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:c??s,style:{width:"auto"},children:g}),t.jsx("button",{className:"btn-primary",onClick:p,style:{width:"auto"},children:f})]})]})})}function Ga(){return`${new Intl.DateTimeFormat("sv",{timeZone:"America/Tegucigalpa",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date).replace(" ","T")}-06:00`}function vm(){return new Intl.DateTimeFormat("sv",{timeZone:"America/Tegucigalpa",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date).replace(" ","T")}function pl(){return{hondurasNowISO:Ga,hondurasNowLocalInput:vm,nowDate:()=>new Date(Ga())}}function jm(){return new Intl.DateTimeFormat("en-CA",{timeZone:"America/Tegucigalpa",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)}async function gl(l={},i="factura",r={}){let s=l.comercio||"",c=l.companyRTN||l.rtnEmpresa||l.RTN||"",d=l.direccion||"",f=l.telefono||"",g=l.email||l.EM||"",p=l.logo||l.logoUrl||l.logo_src||null;if(!s||!c||!d||!f||!g||!p)try{const P=await wa();P&&(s=s||P.nombre||P.comercio||s,c=c||P.rtn||c,d=d||P.direccion||P.direccion_fiscal||d,f=f||P.telefono||P.telefono_fijo||f,g=g||P.email||P.correo||g,p=p||P.logoUrl||P.logo||p)}catch{}if(p&&typeof window<"u"&&l.inlineLogo!==!1)try{if(!String(p).startsWith("data:")){const P=await fetch(String(p),{mode:"cors"});if(P.ok){const Se=await P.blob(),J=await new Promise(ae=>{const V=new FileReader;V.onloadend=()=>{ae(typeof V.result=="string"?V.result:null)},V.onerror=()=>{ae(null)},V.readAsDataURL(Se)});J&&(p=J)}}}catch{}let m=l.factura||"",b=l.CAI||l.cai||"",S=l.fechaLimiteEmision||l.fecha_limite_emision||l.fecha_vencimiento||"",j=l.rangoAutorizadoDe||l.rango_desde||"",x=l.rangoAutorizadoHasta||l.rango_hasta||"",w=l.identificador||l.identificadorCAI||"";try{let P=l.caiInfo||null;if(!P&&typeof window<"u"){const Se=window.localStorage.getItem("caiInfo");if(Se)try{P=JSON.parse(Se)}catch{P=null}}if(P&&(b=b||P.cai||P.CAI||"",S=S||P.fecha_vencimiento||P.fecha_limite_emision||"",j=j||P.rango_de||P.rangoDesde||"",x=x||P.rango_hasta||P.rangoHasta||"",w=w||P.identificador||"",!m))try{const Se=P.identificador?String(P.identificador):"",J=P.secuencia_actual!=null?String(P.secuencia_actual):P.rango_de!=null?String(P.rango_de):"",ae=String(J).replace(/[^0-9]/g,"")||"";let V=0;(P.rango_hasta||P.rango_de)&&(V=Math.max(String(P.rango_hasta||P.rango_de).length,ae.length));const ue=ae?String(ae).padStart(V||ae.length||1,"0"):"";m=(Se||"")+(ue||String(Math.floor(Math.random()*9e5)+1e5))}catch{m=String(Math.floor(Math.random()*9e5)+1e5)}}catch{}m||(m=String(Math.floor(Math.random()*9e5)+1e5));const v=l.cliente||(i==="factura"?"Consumidor Final":"Cotizacin Cliente"),E=l.identidad||l.rtnCliente||l.clientRTN||l.rtn||r.identidad||"C/F",T=new Date().toLocaleString(),L=Array.isArray(r.carrito)?r.carrito:[],R=typeof r.subtotal=="number"?r.subtotal:L.reduce((P,Se)=>P+Number(Se.producto&&Se.producto.precio||Se.precio||0)*(Se.cantidad||1),0),z=typeof r.descuento=="number"?r.descuento:0,C=typeof r.exonerado=="number"?r.exonerado:0,O=typeof r.gravado=="number"?r.gravado:R,I=typeof r.exento=="number"?r.exento:0,k=typeof r.isvTotal=="number"?r.isvTotal:0,M=typeof r.imp18Total=="number"?r.imp18Total:0,G=typeof r.impTouristTotal=="number"?r.impTouristTotal:0,K=typeof r.total=="number"?r.total:null,ne=R+(k||0)+(M||0)+(G||0),Y=K??ne,B=Y,A=r.pagos||{},N=typeof A.efectivo=="number"?A.efectivo:typeof r.Efectivo=="number"?r.Efectivo:0,q=typeof A.tarjeta=="number"?A.tarjeta:typeof r.Tarjeta=="number"?r.Tarjeta:0,X=typeof A.transferencia=="number"?A.transferencia:typeof r.Transferencia=="number"?r.Transferencia:0,ge=typeof A.totalPaid=="number"?A.totalPaid:N+q+X;let re;if(typeof A.cambio=="number")re=A.cambio;else if(typeof r.cambio=="number")re=r.cambio;else{const P=Number(ge)-Number(B||0);re=isNaN(P)?0:P>0?P:0}const $=L.map(P=>{const Se=String(P.producto&&(P.producto.nombre||P.producto.descripcion)||P.descripcion||P.nombre||""),J=Number(P.cantidad||0),ae=Number((P.producto&&(P.producto.precio??P.producto.precio_unitario))??P.precio_unitario??P.precio??0),V=!!(P.producto&&P.producto.exento)||!!P.exento,ue=!!(P.producto&&P.producto.aplica_impuesto_18)||!!P.aplica_impuesto_18,de=!!(P.producto&&P.producto.aplica_impuesto_turistico)||!!P.aplica_impuesto_turistico,he=ue?r.tax18Rate??r.tax18??0:r.taxRate??r.tax??0,Te=de?r.taxTouristRate??r.taxTourist??0:0,Oe=(Number(he)||0)+(Number(Te)||0);let Ue=ae;!V&&Oe>0&&(Ue=ae/(1+Oe));const Le=Number(Ue||0).toFixed(2),ze=Ue*J,se=Number(ze||0).toFixed(2);return`<tr><td>${P.producto&&P.producto.sku||P.sku||""} ${Se}</td><td style="text-align:center">${J}</td><td style="text-align:right">L ${Le}</td><td style="text-align:right">L ${se}</td></tr>`}).join(`
`),H=(Number(N)||0)+(Number(X)||0)+(Number(q)||0)-(Number(re)||0),Z=isNaN(H)?0:H,ee=gv(Z);return`
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Factura Detallada</title>
	<style>
		@page { size: letter; margin: 0.5in; }
		* { letter-spacing: 0 !important; word-spacing: 0 !important; margin: 0; padding: 0; line-height: 1.2 !important; box-sizing: border-box; }
		body { font-family: 'Arial', sans-serif; font-size: 10px; color: #000; margin: 0; padding: 0; }
		.factura-container { width: 100%; max-width: 8.5in; margin: 0 auto; padding: 0.25in; }
		.divider { border: none; border-top: 1px solid #ddd; margin: 8px 0; }
		.header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; gap: 12px; }
		.header img { width: 140px; height: auto; object-fit: contain; margin-right: 12px; }
		.header-title { font-size: 28px; color: #0f172a; text-align: right; flex-grow: 1; font-weight: 700 !important; }
		.info-section h3, .info-section p { font-size: 11px; margin-bottom: 3px; }

		/* Tabla: diseo moderno para impresin (igual que cotizacin) */
		.tabla { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 10px; font-size: 10px; box-shadow: 0 2px 6px rgba(2,6,23,0.06); border-radius: 6px; overflow: hidden; }
		.tabla thead tr { background: linear-gradient(180deg,#0f172a,#0b1220); color: #fff; }
		.tabla th { padding: 10px 8px; text-align: left; font-size: 10px; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700 !important; border-bottom: 1px solid rgba(255,255,255,0.08); }
		.tabla td { padding: 10px 8px; font-size: 10px; vertical-align: middle; background: #fff; font-weight: 400 !important; border-bottom: 1px solid #eef2f7; }
		.tabla tbody tr:nth-child(even) td { background: #f8fafc; }
		.tabla td:nth-child(2), .tabla td:nth-child(3), .tabla td:nth-child(4) { text-align: right; }
		.tabla td:first-child { text-align: left; }
		.tabla tfoot td { font-weight: 700 !important; }

		.totals-section { margin-top: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px 0; }
		.totals-section span.label { text-align: left; padding-left: 2px; font-weight: 600 !important; }
		.totals-section span.value { text-align: right; padding-right: 2px; font-weight: 700 !important; }
		.total-final { font-size: 11px; margin-top: 6px; border-top: 1px solid #e6edf3; padding-top: 6px; font-weight: 800 !important; }
		.footer-info { text-align: center; margin-top: 12px; font-size: 10px; color: #374151; }
		.letras { font-size: 11px; margin: 6px 0; text-align: center; }
		.firma-section { margin-top: 16px; display: flex; justify-content: space-around; text-align: center; }
		.copias-info { text-align: center; margin-top: 8px; }
		.final-message { font-size: 10px; text-align: center; margin-top: 10px; color: #374151; }

		@media print {
			.factura-container { box-shadow: none; border-radius: 0; }
			.tabla thead tr { background: #0f172a !important; color: #fff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
			.tabla th, .tabla td { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
		}

		html, body, .factura-container, .header, .header-title, .header-title-container, .tabla, .tabla th, .totals-section, .total-final, .footer-info { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
		.header-title-container { text-align: right; }
		.numero-factura { font-size: 22px; color: #0f172a; margin-top: -3px; font-weight: 700 !important; }
	</style>
</head>
<body>
	<main class="factura-container">

		<header class="header">
    <img src="${p}" alt="Logo del Comercio" />
    <div class="header-title-container">
        <h1 class="header-title">FACTURA</h1>
        <h2 class="numero-factura">No. ${m}</h2>
    </div>
</header>

		<hr class="divider" />

		<section class="info-section">
			<h3>${s}</h3>
			<p>RTN: ${c}</p>
			<p>Direccin: ${d}</p>
			<p>Telfono: ${f}</p>
			<p>Email: ${g}</p>
		</section>
		<hr class="divider" />

		<section class="info-dates">
			<p>Fecha y hora: ${T}</p>
			<p>Factura No: ${m}</p>
			<p>CAI: ${b}</p>
			<p>Fecha lmite de emisin: ${S}</p>
			<p>Rango autorizado: ${w?w+" "+j+" al "+w+" "+x:j+" al "+x}</p>
		</section>
		<hr class="divider" />

		<section class="info-section">
			<p>Cliente: ${v}</p>
			<p>RTN Cliente: ${E}</p>
		</section>
		<hr class="divider" />

		<section class="details-section">
			<table class="tabla">
				<thead>
					<tr>
						<th>Descripcin</th>
						<th style="width: 10%;">Cant</th>
							<th style="width: 15%;">Precio unitario</th>
							<th style="width: 15%;">Total</th>
					</tr>
				</thead>
				<tbody>
					${$} </tbody>
			</table>
		</section>
		<hr class="divider" />

	<section class="totals-section">
    <span class="label">Descuento:</span> <span class="value">L ${z.toFixed(2)}</span>
    <span class="label">Sub Total Exonerado:</span> <span class="value">L ${Number(C).toFixed(2)}</span>
    <span class="label">Sub Total Gravado:</span> <span class="value">L ${Number(O).toFixed(2)}</span>
    <span class="label">Sub Total Exento:</span> <span class="value">L ${Number(I).toFixed(2)}</span>
    <span class="label">Tasa Turstica 4%:</span> <span class="value">L ${Number(G).toFixed(2)}</span>
    <span class="label">ISV 15%:</span> <span class="value">L ${Number(k).toFixed(2)}</span>
    <span class="label">ISV 18%:</span> <span class="value">L ${Number(M).toFixed(2)}</span>
</section>

<section class="transaccion-section"><hr class="divider" />
    <span class="label">TOTAL TRANSACCIN:</span>
    <span class="value">L ${Number(Y).toFixed(2)}</span>
</section>

<hr class="divider" />


		<section class="totals-section total-final">
			<span class="label">**TOTAL FACTURA:**</span> <span class="value">**L ${B.toFixed(2)}**</span>
			<span class="label">Efectivo:</span> <span class="value">L ${Number(N).toFixed(2)}</span>
			<span class="label">Tarjeta:</span> <span class="value">L ${Number(q).toFixed(2)}</span>
			<span class="label">Transferencia:</span> <span class="value">L ${Number(X).toFixed(2)}</span>
			<span class="label">Cambio:</span> <span class="value">L ${Number(re).toFixed(2)}</span>
		</section>
		<hr class="divider" />

		<footer class="footer-info">
			<div class="letras">
				<p>Total Pagado: L ${Z.toFixed(2)}</p>
				<p>*** ${ee} Lempiras ***</p>
			</div>
			<hr class="divider" />
			
			<div class="firma-section">
				<p>Firma del Cliente: ______________________</p>
				<p>Firma del Emisor: ______________________</p>
			</div>
			
			<div class="copias-info">
				<p>Original: Cliente | Copia: Obligado tributario emisor</p>
			</div>
			
			<div class="final-message">
				<h5>Para cualquier reclamo debe presentar su factura</h5>
				<h5>Gracias por su compra!</h5>
				<h5>LA FACTURA ES BENEFICIO DE TODOS EXJALA!</h5>
			</div>
		</footer>

	</main>
</body>
</html>`}function gv(l){if(!isFinite(l))return"";const i=["","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez","once","doce","trece","catorce","quince","dieciseis","diecisiete","dieciocho","diecinueve","veinte"],r=["","","veinte","treinta","cuarenta","cincuenta","sesenta","setenta","ochenta","noventa"],s=["","cien","doscientos","trescientos","cuatrocientos","quinientos","seiscientos","setecientos","ochocientos","novecientos"];function c(b){if(b===0)return"";if(b<21)return i[b];if(b<100){const S=Math.floor(b/10),j=b%10;return r[S]+(j?" y "+i[j]:"")}if(b<1e3){const S=Math.floor(b/100),j=b%100;return(S===1&&j===0?"cien":s[S]||"")+(j?" "+c(j):"")}return""}const d=Math.floor(Math.abs(l));if(d===0)return"cero";const f=[];let g=d;const p=["","mil","milln","mil millones"];let m=0;for(;g>0;){const b=g%1e3;if(b){let S=c(b);m===2&&b===1&&(S="un"),f.unshift(S+(p[m]?" "+p[m]:""))}g=Math.floor(g/1e3),m++}return f.join(" ").trim()}async function mv(l={},i={}){try{if(!l.caiInfo){const c=typeof window<"u"?window.localStorage.getItem("ncInfo"):null;if(c)try{l.caiInfo=JSON.parse(c)}catch{l.caiInfo=c}}}catch{}let s=(await gl(l,"factura",i)).replace(/<h1[^>]*>\s*FACTURA\s*<\/h1>/i,'<h1 class="header-title">NOTA DE CRDITO</h1>');try{s=s.replace(/<section[^>]*class="[^"]*total-final[^"]*"[\s\S]*?<\/section>/i,""),s=s.replace(/<footer[^>]*class="footer-info"[\s\S]*?<\/footer>/i,"")}catch(c){console.debug("nchtmlimp: error cleaning nota de credito html",c)}return s}async function yv(l={},i={}){try{if(!l.caiInfo){const c=typeof window<"u"?window.localStorage.getItem("ncInfo"):null;if(c)try{l.caiInfo=JSON.parse(c)}catch{l.caiInfo=c}}}catch{}let s=(await gl(l,"factura",i)).replace(/<h1[^>]*>\s*FACTURA\s*<\/h1>/i,'<h1 class="header-title">NOTA DE ABONO</h1>');try{s=s.replace(/<section[^>]*class="details-section"[\s\S]*?<\/section>/i,""),s=s.replace(/<section[^>]*class="[^"]*total-final[^"]*"[\s\S]*?<\/section>/i,""),s=s.replace(/<footer[^>]*class="footer-info"[\s\S]*?<\/footer>/i,""),s=s.replace(/<section[^>]*class="transaccion-section"[\s\S]*?<span class="label">[\s\S]*?<\/span>\s*<span class="value">\s*L\s*([^<]+)<\/span>[\s\S]*?<\/section>/i,'<section class="transaccion-section"><hr class="divider" /><span class="label">VALOR NOTA DE ABONO:</span><span class="value">L $1</span></section>')}catch(c){console.debug("nchtmlimp: error cleaning nota de abono html",c)}return s}function bv({onBack:l}){const[i,r]=y.useState(!1),[s,c]=y.useState(()=>{try{const J=localStorage.getItem("ncInfo");if(J)return JSON.parse(J)}catch{}return null}),[d,f]=y.useState([]),[g,p]=y.useState(!0),[m,b]=y.useState(!1),[S,j]=y.useState({venta_id:"",producto_id:"",cantidad:1,motivo:"",tipo_devolucion:"credito"}),[x,w]=y.useState(""),[v,E]=y.useState([]),[T,L]=y.useState(null),[R,z]=y.useState([]),[C,O]=y.useState(!1),[I,k]=y.useState("efectivo"),[M,G]=y.useState(!1),[K,ne]=y.useState(""),[Y,B]=y.useState(!1),[A,N]=y.useState(""),[q,X]=y.useState(""),{hondurasNowISO:ge}=pl();y.useEffect(()=>{re()},[]);async function re(){p(!0);try{const J=localStorage.getItem("user"),ae=J?JSON.parse(J):null,V=ae&&(ae.username||ae.user?.username||ae.name||ae.user?.name)?ae.username||ae.user?.username||ae.name||ae.user?.name:null;let{data:ue,error:de}=await F.from("devoluciones_ventas").select("*").order("id",{ascending:!1});if(de){console.debug("Error loading devoluciones_ventas:",de),f([]);return}let he=Array.isArray(ue)?ue:[];V&&(he=he.filter(Te=>(Te.usuario||"").toLowerCase()===V.toLowerCase())),f(he.map(Te=>({...Te})))}catch(J){console.debug("loadDevoluciones exception",J),f([])}finally{p(!1)}}function U(J){return typeof J=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(J)}async function $(){if(!U(S.venta_id)){N("venta_id debe ser un UUID vlido"),B(!0);return}if(!U(S.producto_id)){N("producto_id debe ser un UUID vlido"),B(!0);return}if(!S.cantidad||Number(S.cantidad)<=0){N("cantidad debe ser mayor que 0"),B(!0);return}const J=localStorage.getItem("user");let ae="usuario";try{const ue=J?JSON.parse(J):null;ae=ue&&(ue.username||ue.user?.username||ue.name||ue.user?.name)?ue.username||ue.user?.username||ue.name||ue.user?.name:ae}catch{}const V={venta_id:S.venta_id,producto_id:S.producto_id,cantidad:Number(S.cantidad),motivo:S.motivo||null,usuario:ae,tipo_devolucion:S.tipo_devolucion||"credito"};try{const{data:ue,error:de}=await F.from("devoluciones_ventas").insert(V).select("*").maybeSingle();if(de){console.debug("Insert devoluciones_ventas error",de),N("Error al guardar devolucin: "+(de.message||JSON.stringify(de))),B(!0);return}const he=ue;f(Te=>[he,...Te]),b(!1),j({venta_id:"",producto_id:"",cantidad:1,motivo:"",tipo_devolucion:"credito"})}catch(ue){console.debug("submitDevolucion exception",ue),N("Error inesperado al guardar devolucin"),B(!0)}}async function H(){if(!x||String(x).trim()===""){N("Ingresa nmero de factura a buscar"),B(!0);return}try{const J=x,{data:ae,error:V}=await F.from("ventas").select("*").eq("factura",J).maybeSingle();if(V){console.debug("Error buscando venta por factura",V),N("Error buscando la factura: "+(V.message||JSON.stringify(V))),B(!0);return}if(!ae||!ae.id){N("Factura no encontrada"),B(!0);return}try{const ze=ae.fecha_venta||null;if(ze){const se=jm(),ve=String(ze);if(ve.startsWith(se)){N("No se permite crear devoluciones para facturas del da actual."),B(!0);return}const $e=new Date(ve),gt=new Date(pl().hondurasNowISO());if(gt.setHours(0,0,0,0),!isNaN($e.getTime())&&$e.getTime()>=gt.getTime()){N("No se permite crear devoluciones para facturas del da actual. Debe realizar una anulacion."),B(!0);return}}}catch(ze){console.debug("Error validando fecha de venta para devoluciones",ze)}try{const{data:ze,error:se}=await F.from("devoluciones_ventas").select("id").eq("venta_id",ae.id).limit(1);if(se){console.debug("Error checking existing devoluciones:",se),N("Error verificando devoluciones existentes: "+(se.message||JSON.stringify(se))),B(!0);return}if(Array.isArray(ze)&&ze.length>0){N("Esta factura ya cuenta con una devolucin registrada. No se puede crear otra devolucin."),B(!0);return}}catch(ze){console.debug("Exception checking devoluciones:",ze),N("Error verificando devoluciones existentes"),B(!0);return}let ue={...ae};try{ae.nombre_cliente&&(ue.cliente_nombre=ae.nombre_cliente),ae.rtn&&(ue.cliente_rtn=ae.rtn);const ze=ae.cliente_id;if(ze&&U(String(ze))){const{data:se,error:ve}=await F.from("clientes").select("id,nombre,rtn").eq("id",ze).maybeSingle();!ve&&se&&(ue.cliente_nombre=ue.cliente_nombre||se.nombre||null,ue.cliente_rtn=ue.cliente_rtn||se.rtn||null)}}catch(ze){console.debug("Error cargando datos de cliente para mostrar en UI",ze)}L(ue);const{data:de,error:he}=await F.from("ventas_detalle").select("id,venta_id,producto_id,cantidad,precio_unitario,subtotal").eq("venta_id",ae.id);if(he){console.debug("Error obteniendo detalles de venta",he),N("Error obteniendo detalles de la factura"),B(!0);return}const Te=Array.isArray(de)?de:[],Oe=Array.from(new Set(Te.map(ze=>ze.producto_id))).filter(Boolean);let Ue={};if(Oe.length>0)try{const{data:ze}=await F.from("inventario").select("id,nombre,sku,tipo").in("id",Oe);Array.isArray(ze)&&ze.forEach(se=>{Ue[String(se.id)]={id:se.id,nombre:se.nombre,sku:se.sku,tipo:se.tipo}})}catch(ze){console.debug("Error cargando datos de productos desde inventario",ze)}const Le=Te.map(ze=>({...ze,nombre:Ue[String(ze.producto_id)]?.nombre||null,sku:Ue[String(ze.producto_id)]?.sku||null,tipo:Ue[String(ze.producto_id)]?.tipo||"producto"}));E(Le),z([])}catch(J){console.debug("buscarFactura exception",J),N("Error inesperado buscando factura"),B(!0)}}function Z(J){const ae=R.find(V=>V.detalle_id===J.id);z(ae?V=>V.filter(ue=>ue.detalle_id!==J.id):V=>[...V,{detalle_id:J.id,producto_id:J.producto_id,nombre:J.nombre||null,sku:J.sku||null,tipo:J.tipo||"producto",cantidad_available:Number(J.cantidad||0),cantidad:Number(J.cantidad||0),precio_unitario:Number(J.precio_unitario||0)}])}function ee(J,ae){z(V=>V.map(ue=>{if(ue.detalle_id!==J)return ue;const de=Number(ue.cantidad_available||0);let he=Number(ae||0);return Number.isNaN(he)&&(he=0),he<0&&(he=0),he>de&&(he=de),{...ue,cantidad:he}}))}async function oe(J="efectivo"){if(!T||!T.id){N("Primero busca una factura vlida"),B(!0);return}if(!R||R.length===0){N("Selecciona al menos un producto"),B(!0);return}const ae=localStorage.getItem("user"),V=ae?JSON.parse(ae):null,ue=V&&(V.id||V.user?.id||V.sub||V.user_id)?V.id||V.user?.id||V.sub||V.user_id:null;if(!ue){N("Necesitas iniciar sesin con un usuario vlido (usuario_id en localStorage)."),B(!0);return}const de=typeof ue=="string"&&/^\d+$/.test(ue)?Number(ue):ue,he=V&&(V.username||V.user?.username||V.name||V.user?.name)?V.username||V.user?.username||V.name||V.user?.name:String(ue);let Te=T;try{const{data:ve,error:$e}=await F.from("ventas").select("id,factura,numero_factura,cliente_id,subtotal,impuesto,total").eq("id",T.id).maybeSingle();if($e)try{console.debug("Error fetching ventaFull:",JSON.stringify($e,null,2))}catch{console.debug("Error fetching ventaFull",$e)}!$e&&ve&&(Te=ve)}catch(ve){console.debug("Exception obteniendo venta completa",ve)}let Oe=null;try{if(Te&&Te.cliente_id)if(!U(String(Te.cliente_id)))Oe=String(Te.cliente_id);else{const{data:ve,error:$e}=await F.from("clientes").select("rtn").eq("id",Te.cliente_id).maybeSingle();if($e)try{console.debug("Error fetching cliente rtn:",JSON.stringify($e,null,2))}catch{console.debug("Error fetching cliente rtn",$e)}!$e&&ve&&(Oe=ve.rtn||null)}}catch(ve){console.debug("Error cargando cliente",ve)}const Ue=R.reduce((ve,$e)=>ve+Number($e.cantidad||0)*Number($e.precio_unitario||$e.precio||0),0);let Le=0;try{const ve=Te&&Te.subtotal?Number(Te.subtotal):0,$e=Te&&Te.impuesto?Number(Te.impuesto):0;Le=ve>0?$e*(Ue/ve):0}catch{Le=0}const ze=Ue+Le,se={venta_id:T.id,cliente_id:Oe,usuario_id:de,usuario:he,cai:null,serie:null,numero_documento:null,tipo_documento:"NC",tipo_devolucion:"credito",motivo:q||null,total:Number(ze).toFixed(2),impuesto:Number(Le).toFixed(2),moneda:"HNL",estado:"pendiente",referencia:Te&&(Te.factura||Te.numero_factura)?Te.factura||Te.numero_factura:null,referencia_externa:null};try{const{data:ve,error:$e}=await F.from("devoluciones_ventas").insert([se]).select("*").maybeSingle();if($e||!ve){console.debug("Error creando header de devolucin",$e),N("Error creando devolucin: "+($e?.message||JSON.stringify($e))),B(!0);return}const gt=ve.id,st=R.map(qe=>({devolucion_id:gt,producto_id:qe.producto_id,cantidad:Number(qe.cantidad),precio_unitario:Number(qe.precio_unitario||0),descuento:0,subtotal:Number((Number(qe.cantidad)*Number(qe.precio_unitario||0)).toFixed(4)),impuesto:0,motivo:q||null})),{data:vt,error:kt}=await F.from("devoluciones_ventas_items").insert(st).select("*");if(kt){console.debug("Error insertando items de devolucin",kt),N("Error guardando items de devolucin: "+(kt?.message||JSON.stringify(kt))),B(!0);return}let Rt=null,ut=s;try{try{const qe=localStorage.getItem("ncInfo");!ut&&qe&&(ut=JSON.parse(qe))}catch{}if(ut&&ut.id){const et=(ut.secuencia_actual!=null?String(ut.secuencia_actual):"").replace(/\D/g,"")||"0",ft=String(Number(et||"0")+1),lt=ut.rango_hasta&&String(ut.rango_hasta).length?String(ut.rango_hasta).length:Math.max(String(et).length,ft.length),bt=ft.padStart(lt,"0");try{const{data:rn,error:Xt}=await F.from("ncredito").update({secuencia_actual:bt}).eq("id",ut.id).select("*").maybeSingle();if(!Xt&&rn){ut=rn;try{localStorage.setItem("ncInfo",JSON.stringify(ut))}catch{}c(ut)}else console.debug("Error actualizando secuencia en ncredito",Xt)}catch(rn){console.debug("Exception updating ncredito sequence",rn)}const ht=ut.identificador||"";Rt=(ht?String(ht):"")+String(ut.secuencia_actual||bt);try{console.debug("Actualizando devolucion header",{devId:gt,cai:ut.cai,numero_documento:Rt,currentNc:ut});const{data:rn,error:Xt}=await F.from("devoluciones_ventas").update({cai:ut.cai||null,numero_documento:Rt}).eq("id",gt).select("*").maybeSingle();if(Xt)try{console.debug("Error actualizando header devolucion con nc info",JSON.stringify(Xt,null,2))}catch{console.debug("Error actualizando header devolucion con nc info",Xt)}else console.debug("Header devolucion actualizado (update returned):",rn);try{const{data:on,error:xn}=await F.from("devoluciones_ventas").select("*").eq("id",gt).maybeSingle();xn?console.debug("Error leyendo devoluciones_ventas post-update",xn):console.debug("Devolucion row after update:",on)}catch(on){console.debug("Exception reading devolucion after update",on)}}catch(rn){console.debug("Exception updating devolucion header with nc info",rn)}}}catch(qe){console.debug("Error incrementando secuencia ncredito",qe)}const mn=R.map(qe=>({producto:{nombre:qe.nombre||"",sku:qe.sku||""},cantidad:Number(qe.cantidad),precio_unitario:Number(qe.precio_unitario||0)})),Ot={carrito:mn,subtotal:mn.reduce((qe,et)=>qe+Number(et.precio_unitario||0)*Number(et.cantidad||0),0)};try{const qe=`devolucion venta: ${T?.factura||""} nc: ${Rt||""}`,et=V&&(V.username||V.user?.username||V.name||V.user?.name)?V.username||V.user?.username||V.name||V.user?.name:String(ue),ft=ge(),lt=R.filter(bt=>(bt.tipo||"producto")!=="servicio").map(bt=>({producto_id:bt.producto_id,cantidad:Number(bt.cantidad||0),tipo_de_movimiento:"ENTRADA",referencia:qe,usuario:et,fecha_salida:ft}));if(lt.length>0){const{data:bt,error:ht}=await F.from("registro_de_inventario").insert(lt).select("id");if(ht)try{console.warn("Error registrando entrada en registro_de_inventario:",JSON.stringify(ht,null,2),{payload:lt})}catch{console.warn("Error registrando entrada en registro_de_inventario (no serializable):",ht)}else console.debug("Registro_de_inventario inserciones (entrada):",bt)}for(const bt of R)if((bt.tipo||"producto")!=="servicio")try{const ht=String(bt.producto_id),rn=Number(bt.cantidad||0);if(rn<=0)continue;const{data:Xt,error:on}=await F.from("inventario").select("stock").eq("id",ht).maybeSingle();if(on){try{console.warn("Error leyendo stock de inventario para producto",ht,JSON.stringify(on,null,2))}catch{console.warn("Error leyendo stock de inventario para producto",ht,on)}continue}if(!Xt||typeof Xt.stock>"u"){console.debug("inventario.stock column not present for product",ht,"- skipping stock update");continue}const xn=Number(Xt.stock||0),qn=xn+rn,{error:fa}=await F.from("inventario").update({stock:qn}).eq("id",ht);fa?console.warn("Error actualizando stock para producto",ht,fa):console.debug("Stock actualizado para producto",ht,"de",xn,"a",qn)}catch(ht){console.warn("Excepcin actualizando stock para producto",ht)}}catch(qe){console.debug("Error registrando entradas en inventario",qe)}try{if(T&&T.id&&Rt){const{data:qe,error:et}=await F.from("ventas").select("observaciones").eq("id",T.id).maybeSingle();if(et)try{console.debug("Error leyendo ventas.observaciones",JSON.stringify(et,null,2))}catch{console.debug("Error leyendo ventas.observaciones",et)}else{const ft=qe&&qe.observaciones?String(qe.observaciones):"",lt=`**Posee devoluciones** nc (${Rt})`;let bt=lt;ft&&ft.trim()!==""&&(ft.includes("Posee devoluciones")?bt=ft+" ; nc ("+Rt+")":bt=ft+" | "+lt);const{error:ht}=await F.from("ventas").update({observaciones:bt}).eq("id",T.id);if(ht)try{console.warn("Error actualizando ventas.observaciones:",JSON.stringify(ht,null,2))}catch{console.warn("Error actualizando ventas.observaciones:",ht)}else console.debug("ventas.observaciones actualizada para venta",T.id)}}}catch(qe){console.debug("Exception actualizando ventas.observaciones",qe)}let Nn={};try{const qe=localStorage.getItem("ncInfo");qe&&(Nn.ncInfo=JSON.parse(qe))}catch{}try{let qe=null;try{if(s&&s.cai)qe=s.cai;else{const et=localStorage.getItem("ncInfo");if(et)try{const ft=JSON.parse(et);ft&&ft.cai&&(qe=ft.cai)}catch{}}}catch{qe=null}if(qe||Rt){const et={};qe&&(et.cai=qe),Rt&&(et.numero_documento=String(Rt));const{data:ft,error:lt}=await F.from("devoluciones_ventas").update(et).eq("id",gt).select("*").maybeSingle();if(lt)try{console.debug("Error guardando cai/numero en devoluciones_ventas antes de imprimir:",JSON.stringify(lt,null,2))}catch{console.debug("Error guardando cai/numero en devoluciones_ventas antes de imprimir",lt)}else console.debug("Guardado cai/numero en devoluciones_ventas (desde ncInfo):",ft)}}catch(qe){console.debug("Exception guardando cai desde ncInfo antes de imprimir",qe)}const bn=await mv(Nn,Ot);if(await P(bn),J==="nota_abono"){const qe=await yv(Nn,Ot);await P(qe)}await re(),z([]),E([]),L(null),w(""),O(!1),ne("Registro exitosos en verfe"),G(!0),X("")}catch(ve){try{console.debug("createDevolucionFromSelection exception",JSON.stringify(ve,null,2))}catch{console.debug("createDevolucionFromSelection exception",ve)}N("Error inesperado al crear devolucin (ver consola)"),B(!0)}}function P(J){return new Promise(ae=>{try{const V=document.createElement("iframe");V.style.position="fixed",V.style.right="0",V.style.bottom="0",V.style.width="0",V.style.height="0",V.style.border="0",document.body.appendChild(V);const ue=V.contentWindow?.document;if(!ue){ae();return}ue.open(),ue.write(J),ue.close();const de=V.contentWindow;setTimeout(()=>{try{de.focus(),de.print()}catch(he){console.debug("print error",he)}setTimeout(()=>{document.body.removeChild(V),ae()},500)},500)}catch(V){console.debug("printHtmlInHiddenIframe exception",V),ae()}})}async function Se(){try{const J=localStorage.getItem("user"),ae=J?JSON.parse(J):null,V=ae&&(ae.username||ae.user?.username||ae.name||ae.user?.name)?ae.username||ae.user?.username||ae.name||ae.user?.name:null;let ue=null;if(V){const{data:de,error:he}=await F.from("ncredito").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual,caja,cajero,usuario_id").eq("cajero",V).order("id",{ascending:!1}).limit(1);!he&&Array.isArray(de)&&de.length>0&&(ue=de[0])}if(ue){try{localStorage.setItem("ncInfo",JSON.stringify(ue))}catch{}c(ue)}}catch(J){console.debug("refreshNcInfo error",J)}}return t.jsxs("div",{style:{padding:28,maxWidth:1200,margin:"32px auto",fontSize:"13px"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[t.jsx("h2",{style:{margin:0,fontSize:"18px"},children:"Devolucin de Caja"}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{onClick:()=>r(!0),className:"btn-primary",style:{padding:"8px 12px"},children:"Info de CAI de notas"}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{padding:"8px 12px"},children:"Volver"})]})]}),t.jsx("section",{style:{background:"white",padding:24,borderRadius:8,boxShadow:"0 1px 6px rgba(2,6,23,0.06)",marginBottom:16},children:t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{className:"input",placeholder:"Nmero de factura",value:x,onChange:J=>w(J.target.value),style:{flex:"1 1 72%",minWidth:340,fontSize:"14px",padding:"10px 12px"}}),t.jsx("button",{className:"btn-primary",onClick:H,style:{padding:"6px 8px",fontSize:"13px",width:96,maxWidth:96,whiteSpace:"nowrap"},children:"Buscar"})]})}),t.jsx(Mn,{open:M,onClose:()=>G(!1),width:420,children:t.jsxs("div",{children:[t.jsx("h3",{style:{marginTop:0},children:"Registro exitoso"}),t.jsx("p",{children:K}),t.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:t.jsx("button",{className:"btn-primary",onClick:()=>G(!1),children:"Cerrar"})})]})}),t.jsx(Mn,{open:C,onClose:()=>O(!1),width:420,children:t.jsxs("div",{children:[t.jsx("h3",{style:{marginTop:0},children:"Tipo de devolucin"}),t.jsx("p",{children:"Elige cmo se procesar la devolucin:"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,marginTop:8},children:[t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"radio",name:"devtype",checked:I==="efectivo",onChange:()=>k("efectivo")}),t.jsx("span",{children:"En efectivo (solo nota de crdito)"})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"radio",name:"devtype",checked:I==="nota_abono",onChange:()=>k("nota_abono")}),t.jsx("span",{children:"Nota de abono (nota de crdito + nota de abono)"})]})]}),t.jsxs("div",{style:{marginTop:10},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Motivo de la devolucin (requerido)"}),t.jsx("textarea",{className:"input",value:q,onChange:J=>X(J.target.value),placeholder:"Describe el motivo de la devolucin",style:{minHeight:80}})]}),t.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>O(!1),children:"Cancelar"}),t.jsx("button",{className:"btn-primary",disabled:q.trim()==="",onClick:()=>oe(I),children:"Confirmar y crear"})]})]})}),t.jsx("section",{style:{background:"white",padding:24,borderRadius:8,boxShadow:"0 1px 6px rgba(2,6,23,0.06)",marginBottom:16},children:t.jsxs("div",{style:{display:"flex",gap:20,alignItems:"flex-start",flexWrap:"wrap"},children:[t.jsxs("div",{style:{flex:"1 1 60%",minWidth:320},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:10,fontSize:"15px"},children:"Buscar factura"}),t.jsx("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},children:t.jsx("div",{style:{color:"#475569"},children:T?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsxs("div",{children:["Venta encontrada:"," ",t.jsx("strong",{children:T.factura})]}),t.jsxs("div",{style:{color:"#475569",fontSize:13},children:[T.fecha_venta?t.jsxs("div",{children:[t.jsx("strong",{children:"Fecha:"})," ",new Date(T.fecha_venta).toLocaleString(void 0,{timeZone:"America/Tegucigalpa"})]}):null,T.cliente_nombre?t.jsxs("div",{children:[t.jsx("strong",{children:"Cliente:"})," ",T.cliente_nombre]}):null,T.cliente_rtn?t.jsxs("div",{children:[t.jsx("strong",{children:"RTN:"})," ",T.cliente_rtn]}):null]})]}):t.jsx("span",{style:{color:"#94a3b8"},children:"Usa el buscador superior para buscar una factura"})})}),v.length>0?t.jsxs("div",{children:[t.jsx("div",{style:{marginBottom:8,color:"#475569"},children:"Productos facturados:"}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Producto","Cantidad facturada","Precio","Subtotal","Accin"].map(J=>t.jsx("th",{style:{padding:"12px 14px",textAlign:J==="Cantidad facturada"?"right":"left",fontWeight:600},children:J},J))})}),t.jsx("tbody",{children:v.map(J=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsxs("td",{style:{padding:"12px 14px"},children:[t.jsx("div",{style:{fontWeight:600},children:J.nombre||String(J.producto_id)}),t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:J.sku?`SKU: ${J.sku}`:""})]}),t.jsx("td",{style:{padding:"12px 14px",textAlign:"right"},children:Number(J.cantidad).toFixed(2)}),t.jsxs("td",{style:{padding:"12px 14px"},children:["L",Number(J.precio_unitario||0).toFixed(2)]}),t.jsxs("td",{style:{padding:"12px 14px"},children:["L",Number(J.subtotal||0).toFixed(2)]}),t.jsx("td",{style:{padding:"12px 14px"},children:t.jsx("button",{className:"btn-primary",onClick:()=>Z(J),style:{padding:"4px 8px",fontSize:"12px",lineHeight:"1"},children:R.find(ae=>ae.detalle_id===J.id)?"Deseleccionar":"Seleccionar"})})]},J.id))})]})})]}):t.jsx("div",{style:{color:"#94a3b8"},children:"Ingresa un nmero de factura y pulsa Buscar factura para ver los productos facturados."})]}),t.jsxs("div",{style:{flex:"0 0 36%",minWidth:320,borderLeft:"1px solid #eef2ff",paddingLeft:12},children:[t.jsx("h4",{style:{marginTop:0,fontSize:"13px"},children:"tems seleccionados"}),R.length>0?t.jsxs("div",{style:{overflowX:"auto"},children:[t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[t.jsx("th",{style:{textAlign:"left",padding:"10px 12px",fontWeight:600},children:"Producto"}),t.jsx("th",{style:{textAlign:"right",padding:"10px 12px",fontWeight:600,width:120},children:"Cantidad"}),t.jsx("th",{style:{textAlign:"left",padding:"10px 12px",fontWeight:600,width:120},children:"Precio"}),t.jsx("th",{style:{textAlign:"left",padding:"10px 12px",fontWeight:600,width:120},children:"Accin"})]})}),t.jsx("tbody",{children:R.map(J=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsxs("td",{style:{padding:"10px 12px"},children:[t.jsx("div",{style:{fontWeight:600},children:J.nombre||J.producto_id}),t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:J.sku?`SKU: ${J.sku}`:""})]}),t.jsx("td",{style:{padding:"10px 12px",textAlign:"right"},children:t.jsx("input",{className:"input",type:"number",value:J.cantidad,min:0,max:J.cantidad_available,onChange:ae=>ee(J.detalle_id,Number(ae.target.value)),style:{width:90,padding:"6px 8px",fontSize:"13px"}})}),t.jsx("td",{style:{padding:"10px 12px"},children:"L"+Number(J.precio_unitario).toFixed(2)}),t.jsx("td",{style:{padding:"10px 12px"},children:t.jsx("button",{className:"btn-opaque",onClick:()=>z(ae=>ae.filter(V=>V.detalle_id!==J.detalle_id)),style:{padding:"6px 8px",fontSize:"13px"},children:"Eliminar"})})]},J.detalle_id))})]}),t.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>{z([])},children:"Limpiar"}),t.jsx("button",{className:"btn-primary",onClick:()=>{O(!0)},children:"Crear devolucin desde seleccin"})]})]}):t.jsx("div",{style:{color:"#94a3b8"},children:"No hay tems seleccionados."})]})]})}),t.jsx(Mn,{open:m,onClose:()=>b(!1),width:620,children:t.jsxs("div",{children:[t.jsx("h3",{style:{marginTop:0},children:"Nueva devolucin"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[t.jsxs("div",{children:[t.jsx("label",{children:"Venta ID (UUID)"}),t.jsx("input",{className:"input",value:S.venta_id,onChange:J=>j(ae=>({...ae,venta_id:J.target.value})),placeholder:"uuid de la venta"})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Producto ID (UUID)"}),t.jsx("input",{className:"input",value:S.producto_id,onChange:J=>j(ae=>({...ae,producto_id:J.target.value})),placeholder:"uuid del producto"})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Cantidad"}),t.jsx("input",{className:"input",type:"number",value:S.cantidad,onChange:J=>j(ae=>({...ae,cantidad:Number(J.target.value)}))})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Tipo"}),t.jsxs("select",{className:"input",value:S.tipo_devolucion,onChange:J=>j(ae=>({...ae,tipo_devolucion:J.target.value})),children:[t.jsx("option",{value:"credito",children:"Crdito"}),t.jsx("option",{value:"devolucion",children:"Devolucin"})]})]}),t.jsxs("div",{style:{gridColumn:"1 / -1"},children:[t.jsx("label",{children:"Motivo (opcional)"}),t.jsx("textarea",{className:"input",value:S.motivo,onChange:J=>j(ae=>({...ae,motivo:J.target.value}))})]})]}),t.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>b(!1),style:{padding:"8px 12px"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:$,style:{padding:"8px 12px"},children:"Guardar"})]})]})}),t.jsx(pv,{open:i,onClose:()=>r(!1),ncInfo:s,onRefresh:Se}),t.jsx(Tn,{open:M,title:"xito",message:K||"Operacin completada",onClose:()=>G(!1)}),t.jsx(Tn,{open:Y,title:"Error",message:A,onClose:()=>B(!1)})]})}function xv({open:l,onClose:i,onSelect:r}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:12e3},children:t.jsxs("div",{style:{width:420,maxWidth:"96%",background:"#fff",borderRadius:10,padding:18,boxShadow:"0 12px 36px rgba(2,6,23,0.2)"},children:[t.jsx("h3",{style:{marginTop:0},children:"Qu tipo de movimiento?"}),t.jsx("p",{style:{marginTop:6,color:"#475569"},children:"Seleccione si este movimiento es un ingreso o un egreso."}),t.jsxs("div",{style:{display:"flex",gap:10,marginTop:12,justifyContent:"flex-end"},children:[t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent",color:"#0b1724",border:"1px solid rgba(16,24,40,0.06)"},children:"Cancelar"}),t.jsx("button",{onClick:()=>r("egreso"),className:"btn-opaque",style:{background:"#ef4444",color:"white"},children:"Egreso"}),t.jsx("button",{onClick:()=>r("ingreso"),className:"btn-opaque",style:{background:"#16a34a",color:"white"},children:"Ingreso"})]})]})}):null}function vv({open:l,onClose:i,tipo:r,onSubmit:s}){const[c,d]=y.useState({concepto:"",monto:"",referencia:""});return y.useEffect(()=>{l||d({concepto:"",monto:"",referencia:""})},[l]),l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:13e3},children:t.jsxs("div",{style:{width:520,maxWidth:"96%",background:"#fff",borderRadius:10,padding:18,boxShadow:"0 12px 36px rgba(2,6,23,0.2)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h3",{style:{margin:0},children:r==="ingreso"?"Nuevo ingreso":"Nuevo egreso"}),t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent"},children:"Cerrar"})]}),t.jsx("p",{style:{marginTop:8,color:"#475569"},children:"Complete los datos del movimiento. Fecha y usuario se guardan automticamente."}),t.jsxs("div",{style:{marginTop:8,display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[t.jsxs("label",{style:{display:"block"},children:[t.jsx("div",{style:{fontSize:13,color:"#475569",marginBottom:6},children:"Concepto"}),t.jsx("input",{className:"input",value:c.concepto,onChange:f=>d(g=>({...g,concepto:f.target.value}))})]}),t.jsxs("label",{style:{display:"block"},children:[t.jsx("div",{style:{fontSize:13,color:"#475569",marginBottom:6},children:"Monto"}),t.jsx("input",{className:"input",type:"number",step:"0.01",value:c.monto,onChange:f=>d(g=>({...g,monto:f.target.value===""?"":Number(f.target.value)}))})]}),t.jsxs("label",{style:{gridColumn:"1 / -1",display:"block"},children:[t.jsx("div",{style:{fontSize:13,color:"#475569",marginBottom:6},children:"Referencia (opcional)"}),t.jsx("input",{className:"input",value:c.referencia,onChange:f=>d(g=>({...g,referencia:f.target.value}))})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent",color:"#0b1724",border:"1px solid rgba(16,24,40,0.06)"},children:"Cancelar"}),t.jsx("button",{onClick:()=>{if(!c.concepto||c.monto===""||Number(c.monto)<=0)return alert("Complete concepto y monto vlido");s(c)},className:"btn-opaque",style:{background:r==="ingreso"?"#16a34a":"#ef4444",color:"white"},children:r==="ingreso"?"Registrar ingreso":"Registrar egreso"})]})]})}):null}function iu(){const[l,i]=y.useState(null),[r,s]=y.useState(!0),[c,d]=y.useState(null),{hondurasNowISO:f}=pl(),g=()=>{try{const S=localStorage.getItem("user");if(!S)return null;const j=JSON.parse(S);return j.username||j.user?.username||j.name||j.user?.name||null}catch{return null}},p=y.useCallback(async()=>{s(!0),d(null);try{const S=g();if(!S){i(null),s(!1);return}const{data:j,error:x}=await F.from("caja_sesiones").select("*").eq("usuario",S).eq("estado","abierta").order("id",{ascending:!1}).limit(1).maybeSingle();if(x)throw x;i(j)}catch(S){console.error("Error fetching active session:",S),d(S.message||"Error cargando sesin de caja")}finally{s(!1)}},[]),m=async S=>{try{const j=g();if(!j)throw new Error("No hay usuario logueado");if(l)throw new Error("Ya existe una sesin abierta");const x={usuario:j,fecha_apertura:f(),monto_inicial:S,total_ingresos:0,total_egresos:0,estado:"abierta"},{data:w,error:v}=await F.from("caja_sesiones").insert([x]).select("*").single();if(v)throw v;i(w);try{if(typeof window<"u"){try{window.dispatchEvent(new Event("app:refresh"))}catch{}setTimeout(()=>{try{window.location.reload()}catch{}},300)}}catch{}return w}catch(j){throw console.error("Error starting session:",j),j}},b=async S=>{try{if(!l)throw new Error("No hay sesin activa para cerrar");const j={...S,fecha_cierre:f(),estado:"cerrada"},{data:x,error:w}=await F.from("caja_sesiones").update(j).eq("id",l.id).select("*").single();if(w)throw w;i(null);try{if(typeof window<"u"){try{window.dispatchEvent(new Event("app:refresh"))}catch{}setTimeout(()=>{try{window.location.reload()}catch{}},300)}}catch{}return x}catch(j){throw console.error("Error closing session:",j),j}};return y.useEffect(()=>{p()},[p]),{session:l,loading:r,error:c,refreshSession:p,startSession:m,closeSession:b}}async function jv(l){try{const i=await wa(),r=i?.nombre||i?.name||i?.razon_social||i?.empresa||"",s=i?.rtn||i?.RTN||i?.rut||"",c=i?.correo||i?.email||i?.mail||"",f=`
      <html>
        <head>
          <title>Recibo - ${l.concepto}</title>
          <meta charset="utf-8" />
          <style>
      body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#0f1724; padding:18px}
      .header{display:flex;flex-direction:column;align-items:center;margin-bottom:12px}
      .company{font-size:14px;font-weight:700}
      .meta{font-size:12px;color:#475569}
      .line{height:1px;background:#e6eef6;margin:12px 0}
      table{width:100%;border-collapse:collapse}
      td{padding:6px 0;font-size:14px}
      .right{text-align:right}
      .total{font-weight:700;font-size:16px}
    </style>
        </head>
        <body>
          <div class="header">
            <div class="company">${Ar(String(r||""))}</div>
            <div class="meta">RTN: ${Ar(String(s||"-"))} ${c?" "+Ar(String(c)):""}</div>
            <div style="height:8px"></div>
            <div class="meta">${new Date(l.fecha).toLocaleString()}</div>
          </div>
          <div class="line"></div>
          <table>
            <tbody>
              <tr><td><strong>ID</strong></td><td class="right">${l.id??"-"}</td></tr>
              <tr><td><strong>Tipo</strong></td><td class="right">${l.tipo??"-"}</td></tr>
              <tr><td><strong>Concepto</strong></td><td class="right">${Ar(String(l.concepto))}</td></tr>
              <tr><td><strong>Referencia</strong></td><td class="right">${Ar(String(l.referencia??"-"))}</td></tr>
            </tbody>
          </table>
          <div class="line"></div>
          <table>
            <tr><td class="total">Total</td><td class="right total">L${Number(l.monto).toFixed(2)}</td></tr>
          </table>
          <div style="height:22px"></div>
          <div style="font-size:12px;color:#64748b">Usuario: ${Ar(String(l.usuario??"-"))}</div>
          <div style="height:8px"></div>
          <div style="font-size:12px;color:#94a3b8">Gracias por usar el sistema</div>
        </body>
      </html>
    `,g=document.createElement("iframe");g.style.position="fixed",g.style.right="0",g.style.bottom="0",g.style.width="0",g.style.height="0",g.style.border="0",g.style.overflow="hidden",document.body.appendChild(g);const p=g.contentWindow?.document||g.contentDocument;if(!p)throw document.body.removeChild(g),new Error("No se pudo acceder al documento del iframe");p.open(),p.write(f),p.close(),setTimeout(()=>{try{g.contentWindow?.focus(),g.contentWindow?.print()}catch(m){console.warn("Error printing recibo via iframe",m)}finally{setTimeout(()=>{try{document.body.removeChild(g)}catch{}},1e3)}},250)}catch(i){console.error("printMovimientoReceipt error",i)}}function Ar(l){return l.replace(/[&<>"']/g,i=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[i])}function Sv({onBack:l}){const{session:i}=iu(),[r,s]=y.useState([]),[c,d]=y.useState(!0),[f,g]=y.useState(null),[p,m]=y.useState(""),[b,S]=y.useState(""),[j,x]=y.useState(""),[w,v]=y.useState(()=>vm()),[E,T]=y.useState(()=>{try{const ne=localStorage.getItem("user");if(ne){const Y=JSON.parse(ne),B=Y&&(Y.id||Y.user?.id||Y.sub||Y.user_id);if(B)return String(B);const A=Y&&(Y.username||Y.user?.username||Y.name||Y.user?.name);if(A)return String(A)}}catch{}return""}),[L,R]=y.useState("ingreso"),[z,C]=y.useState(!1),[O,I]=y.useState(!1),[k,M]=y.useState("");y.useEffect(()=>{(async()=>{const ne=["caja_movimientos","caja_movimiento"],Y=["usuario","user"];let B=!1;for(const A of ne)try{const N=await F.from(A).select("id").limit(1).maybeSingle();if(N.error){console.debug("Probe error for",A,N.error);continue}let q=[],X=null;for(const U of Y)try{const H=await F.from(A).select("id, tipo_movimiento, monto, concepto, referencia, usuario, fecha").order("id",{ascending:!1}).eq(U,E);if(H.error){console.debug("Filtered select error on",A,"key",U,H.error);continue}q=Array.isArray(H.data)?H.data:[],X=U;break}catch($){console.debug("Exception selecting with key",U,"on",A,$);continue}if(q.length===0){const{data:U,error:$}=await F.from(A).select("id, tipo_movimiento, monto, concepto, referencia, usuario, fecha").order("id",{ascending:!1});if($){console.debug("caja table select error for",A,$);continue}q=Array.isArray(U)?U:[]}const ge=q.map(U=>({id:U.id,concepto:U.concepto||U.motivo||U.descripcion||"",referencia:U.referencia||null,monto:Number(U.monto??0),fecha:(U.fecha||new Date).toString(),usuario:U.usuario||U.user||"",tipo:U.tipo_movimiento||U.tipo||"ingreso"})),re=X?ge:ge.filter(U=>(U.usuario||"").toLowerCase()===(E||"").toLowerCase());try{if(i&&i.fecha_apertura){let U=i.fecha_apertura;U&&!U.includes("Z")&&!U.includes("+")&&!U.match(/-\d\d:\d\d$/)&&(U=`${U}-06:00`);const $=U?new Date(U):null;if($){const H=re.filter(Z=>{try{return new Date(Z.fecha)>=$}catch{return!1}});s(H)}else s(re)}else{const U=jm(),$=re.filter(H=>{try{return new Date(H.fecha).toLocaleDateString("en-CA",{timeZone:"America/Tegucigalpa"})===U}catch{return!1}});s($)}}catch{s(re)}g(A),B=!0;break}catch(N){console.debug("Error probing table",A,N)}B||(console.warn("No se encontr tabla caja_movimientos/caja_movimiento o hubo errores en la consulta"),s([])),d(!1)})()},[i,E]);async function G(ne){const{concepto:Y,referencia:B,monto:A,tipo:N}=ne;try{const q=H=>typeof H=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(H),X=(()=>{try{return E?q(E)?E:/^\d+$/.test(E)?Number(E):null:null}catch{return null}})(),ge={concepto:Y||null,referencia:B||null,monto:Number(A),fecha:Ga(),...X!==null?{usuario:X}:{}},re=f?[f,"caja_movimientos","caja_movimiento"]:["caja_movimientos","caja_movimiento"];let U=null;for(const H of re){const Z=[{...ge,tipo_movimiento:N},{...ge,tipo:N},{...ge}];for(const ee of Z)try{const oe=await F.from(H).insert(ee).select("*").maybeSingle();if(oe.error){console.debug("Insert error on",H,ee,oe.error);continue}U=oe.data||oe,g(H);break}catch(oe){console.debug("Insert exception on",H,oe);continue}if(U)break}if(!U)throw new Error("No se pudo insertar en ninguna tabla de caja (intente verificar esquema en la base)");const $={id:U.id,concepto:U.concepto||U.motivo||U.descripcion||Y||"",referencia:U.referencia||B||null,monto:Number(U.monto||A||0),fecha:U.fecha?String(U.fecha):Ga(),usuario:U.usuario||E,tipo:U.tipo_movimiento||U.tipo||N};return s(H=>[$,...H]),$}catch(q){throw console.warn("Error insertando en caja_movimientos/caja_movimiento:",q),q}}const K=k.trim()===""?r:r.filter(ne=>(ne.referencia||"").toLowerCase().includes(k.toLowerCase()));return t.jsxs("div",{style:{padding:20,width:"100%",maxWidth:"100%",margin:"24px 12px"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[t.jsx("h2",{style:{margin:0},children:"Movimientos de caja"}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{onClick:()=>C(!0),className:"btn-primary",style:{padding:"8px 12px"},children:"Registrar movimiento"}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{padding:"8px 12px"},children:"Volver"})]})]}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1fr) 360px",gap:16},children:t.jsxs("section",{style:{background:"#ffffff",padding:20,borderRadius:10,boxShadow:"0 2px 8px rgba(0,0,0,0.06)",border:"1px solid #f1f5f9"},children:[t.jsx("h3",{style:{margin:0,marginBottom:16,color:"#1e293b"},children:"Registros de Movimientos"}),t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:16},children:[t.jsx("input",{placeholder:"Buscar por referencia...",value:k,onChange:ne=>M(ne.target.value),style:{flex:1,padding:"10px 12px",borderRadius:6,border:"1px solid #cbd5e1",outline:"none",fontSize:14}}),t.jsx("div",{style:{minWidth:160,display:"flex",justifyContent:"flex-end",fontSize:13,color:"#475569"},children:"Los movimientos solo se generaran con efectivo"})]}),c?t.jsx("p",{style:{color:"#64748b"},children:"Cargando..."}):t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[t.jsx("thead",{children:t.jsx("tr",{style:{background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:["Concepto","Referencia","Monto","Fecha y hora","Usuario","Tipo"].map(ne=>t.jsx("th",{style:{textAlign:ne==="Monto"?"right":"left",padding:"10px 12px",fontWeight:600,color:"#475569"},children:ne},ne))})}),t.jsx("tbody",{children:K.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{padding:20,textAlign:"center",color:"#94a3b8",fontStyle:"italic"},children:"No hay registros"})}):K.map(ne=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:"10px 12px"},children:ne.concepto}),t.jsx("td",{style:{padding:"10px 12px"},children:ne.referencia??""}),t.jsxs("td",{style:{padding:"10px 12px",textAlign:"right"},children:["L",ne.monto.toFixed(2)]}),t.jsx("td",{style:{padding:"10px 12px"},children:new Date(ne.fecha).toLocaleString()}),t.jsx("td",{style:{padding:"10px 12px"},children:ne.usuario}),t.jsx("td",{style:{padding:"10px 12px"},children:ne.tipo??""})]},ne.id))})]})})]})}),t.jsx(xv,{open:z,onClose:()=>C(!1),onSelect:ne=>{R(ne),C(!1),I(!0)}}),t.jsx(vv,{open:O,onClose:()=>I(!1),tipo:L,onSubmit:async ne=>{try{const Y=await G({concepto:ne.concepto,referencia:ne.referencia,monto:Number(ne.monto),tipo:L});try{jv({id:Y.id,concepto:Y.concepto,referencia:Y.referencia,monto:Y.monto,fecha:Y.fecha,usuario:Y.usuario,tipo:Y.tipo})}catch(B){console.warn("No se pudo imprimir automticamente",B)}I(!1)}catch(Y){alert("Error guardando movimiento: "+(Y&&(Y.message||JSON.stringify(Y))))}}})]})}async function ru(l={},i="cotizacion",r={}){let s=l.comercio||"",c=l.companyRTN||l.rtnEmpresa||l.RTN||"",d=l.direccion||"",f=l.telefono||"",g=l.email||l.EM||"",p=l.logo||l.logoUrl||l.logo_src||null;if(!s||!c||!d||!f||!g||!p)try{const re=await wa();re&&(s=s||re.nombre||re.comercio||s,c=c||re.rtn||c,d=d||re.direccion||re.direccion_fiscal||d,f=f||re.telefono||re.telefono_fijo||f,g=g||re.email||re.correo||g,p=p||re.logoUrl||re.logo||p)}catch{}if(p&&typeof window<"u"&&l.inlineLogo!==!1)try{if(!String(p).startsWith("data:")){const re=await fetch(String(p),{mode:"cors"});if(re.ok){const U=await re.blob(),$=await new Promise(H=>{const Z=new FileReader;Z.onloadend=()=>{H(typeof Z.result=="string"?Z.result:null)},Z.onerror=()=>{H(null)},Z.readAsDataURL(U)});$&&(p=$)}}}catch{}let m=l.cotizacion||l.numero_cotizacion||l.numeroCotizacion||l.numero||l.Nmero||"";const b=l.cliente||"Cotizacin Cliente",S=l.identidad||l.rtn||r.identidad||"C/F",j=Array.isArray(r.carrito)?r.carrito:[],x=typeof r.subtotal=="number"?r.subtotal:j.reduce((re,U)=>re+Number(U.producto&&U.producto.precio||U.precio||0)*(U.cantidad||1),0),w=typeof r.descuento=="number"?r.descuento:0,v=typeof r.exonerado=="number"?r.exonerado:0,E=typeof r.gravado=="number"?r.gravado:x,T=typeof r.exento=="number"?r.exento:0,L=typeof r.isvTotal=="number"?r.isvTotal:0,R=typeof r.imp18Total=="number"?r.imp18Total:0,z=typeof r.impTouristTotal=="number"?r.impTouristTotal:0,C=typeof r.total=="number"?r.total:null,O=x+(L||0)+(R||0)+(z||0),I=C??O,k=I,M=r.pagos||{},G=typeof M.efectivo=="number"?M.efectivo:typeof r.Efectivo=="number"?r.Efectivo:0,K=typeof M.tarjeta=="number"?M.tarjeta:typeof r.Tarjeta=="number"?r.Tarjeta:0,ne=typeof M.transferencia=="number"?M.transferencia:typeof r.Transferencia=="number"?r.Transferencia:0,Y=typeof M.totalPaid=="number"?M.totalPaid:G+K+ne;let B;if(typeof M.cambio=="number")B=M.cambio;else if(typeof r.cambio=="number")B=r.cambio;else{const re=Number(Y)-Number(k||0);B=isNaN(re)?0:re>0?re:0}const N=j.map(re=>{const U=String(re.producto&&(re.producto.nombre||re.producto.descripcion)||re.descripcion||re.nombre||""),$=Number(re.cantidad||0),H=Number((re.producto&&(re.producto.precio??re.producto.precio_unitario))??re.precio_unitario??re.precio??0),Z=!!(re.producto&&re.producto.exento)||!!re.exento,ee=!!(re.producto&&re.producto.aplica_impuesto_18)||!!re.aplica_impuesto_18,oe=!!(re.producto&&re.producto.aplica_impuesto_turistico)||!!re.aplica_impuesto_turistico,P=ee?r.tax18Rate??r.tax18??0:r.taxRate??r.tax??0,Se=oe?r.taxTouristRate??r.taxTourist??0:0,J=(Number(P)||0)+(Number(Se)||0);let ae=H;!Z&&J>0&&(ae=H/(1+J));const V=Number(ae||0).toFixed(2),ue=ae*$,de=Number(ue||0).toFixed(2);return`<tr><td>${re.producto&&re.producto.sku||re.sku||""} ${U}</td><td style="text-align:center">${$}</td><td style="text-align:right">L ${V}</td><td style="text-align:right">L ${de}</td></tr>`}).join(`
`),q=(Number(G)||0)+(Number(ne)||0)+(Number(K)||0)-(Number(B)||0),X=isNaN(q)?0:q;return _v(X),`<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cotizacin Detallada</title>
  <style>
    @page { size: letter; margin: 0.5in; }
    * { letter-spacing: 0 !important; word-spacing: 0 !important; margin: 0; padding: 0; line-height: 1.2 !important; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; font-size: 10px; color: #000; margin: 0; padding: 0; }
    .factura-container { width: 100%; max-width: 8.5in; margin: 0 auto; padding: 0.25in; }
    .divider { border: none; border-top: 1px solid #ddd; margin: 8px 0; }
    .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; gap: 12px; }
    .header img { width: 140px; height: auto; object-fit: contain; margin-right: 12px; }
    .header-title { font-size: 28px; color: #0f172a; text-align: right; flex-grow: 1; font-weight: 700 !important; }
    .info-section h3, .info-section p { font-size: 11px; margin-bottom: 3px; }

    /* Tabla: diseo moderno para impresin */
    .tabla { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 10px; font-size: 10px; box-shadow: 0 2px 6px rgba(2,6,23,0.06); border-radius: 6px; overflow: hidden; }
    .tabla thead tr { background: linear-gradient(180deg,#0f172a,#0b1220); color: #fff; }
    .tabla th { padding: 10px 8px; text-align: left; font-size: 10px; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700 !important; border-bottom: 1px solid rgba(255,255,255,0.08); }
    .tabla td { padding: 10px 8px; font-size: 10px; vertical-align: middle; background: #fff; font-weight: 400 !important; border-bottom: 1px solid #eef2f7; }
    .tabla tbody tr:nth-child(even) td { background: #f8fafc; }
    .tabla td:nth-child(2), .tabla td:nth-child(3), .tabla td:nth-child(4) { text-align: right; }
    .tabla td:first-child { text-align: left; }
    .tabla tfoot td { font-weight: 700 !important; }

    .totals-section { margin-top: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px 0; }
    .totals-section span.label { text-align: left; padding-left: 2px; font-weight: 600 !important; }
    .totals-section span.value { text-align: right; padding-right: 2px; font-weight: 700 !important; }
    .total-final { font-size: 11px; margin-top: 6px; border-top: 1px solid #e6edf3; padding-top: 6px; font-weight: 800 !important; }
    .footer-info { text-align: center; margin-top: 12px; font-size: 10px; color: #374151; }
    .letras { font-size: 11px; margin: 6px 0; text-align: center; }
    .firma-section { margin-top: 16px; display: flex; justify-content: space-around; text-align: center; }
    .copias-info { text-align: center; margin-top: 8px; }
    .final-message { font-size: 10px; text-align: center; margin-top: 10px; color: #374151; }

    @media print {
      .factura-container { box-shadow: none; border-radius: 0; }
      .tabla thead tr { background: #0f172a !important; color: #fff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .tabla th, .tabla td { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }

    html, body, .factura-container, .header, .header-title, .header-title-container, .tabla, .tabla th, .totals-section, .total-final, .footer-info { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
    .header-title-container { text-align: right; }
    .numero-factura { font-size: 22px; color: #0f172a; margin-top: -3px; font-weight: 700 !important; }
  </style>
</head>
<body>
  <main class="factura-container">

    <header class="header">
      <img src="${p}" alt="Logo del Comercio" />
      <div class="header-title-container">
        <h1 class="header-title">COTIZACIN</h1>
        <h2 class="numero-factura">No. ${m||""}</h2>
      </div>
    </header>

    <hr class="divider" />

    <section class="info-section">
      <h3>${s}</h3>
      <p>RTN: ${c}</p>
      <p>Direccin: ${d}</p>
      <p>Telfono: ${f}</p>
      <p>Email: ${g}</p>
    </section>
    <hr class="divider" />

    <section class="info-section">
      <p>Cliente: ${b}</p>
      <p>RTN Cliente: ${S}</p>
    </section>
    <hr class="divider" />

    <section class="details-section">
      <table class="tabla">
        <thead>
          <tr>
            <th>Descripcin</th>
            <th style="width: 10%;">Cant</th>
            <th style="width: 15%;">Precio unitario</th>
            <th style="width: 15%;">Total</th>
          </tr>
        </thead>
        <tbody>
          ${N} </tbody>
      </table>
    </section>
    <hr class="divider" />

  <section class="totals-section">
    <span class="label">Descuento:</span> <span class="value">L ${w.toFixed(2)}</span>
    <span class="label">Sub Total Exonerado:</span> <span class="value">L ${Number(v).toFixed(2)}</span>
    <span class="label">Sub Total Gravado:</span> <span class="value">L ${Number(E).toFixed(2)}</span>
    <span class="label">Sub Total Exento:</span> <span class="value">L ${Number(T).toFixed(2)}</span>
    <span class="label">Tasa Turstica 4%:</span> <span class="value">L ${Number(z).toFixed(2)}</span>
    <span class="label">ISV 15%:</span> <span class="value">L ${Number(L).toFixed(2)}</span>
    <span class="label">ISV 18%:</span> <span class="value">L ${Number(R).toFixed(2)}</span>
  </section>

  <section class="transaccion-section"><hr class="divider" />
    <span class="label">TOTAL TRANSACCIN:</span>
    <span class="value">L ${Number(I).toFixed(2)}</span>
  </section>

  <hr class="divider" />

    <section class="totals-section total-final">
      <span class="label">**TOTAL COTIZACIN:**</span> <span class="value">**L ${k.toFixed(2)}**</span>
     </section>
    <hr class="divider" />

    <footer class="footer-info">
      
      <div class="final-message">
     <h5 >
  Cotizacin sujeta a cambios.
</h5>
        <h5>Gracias por su preferencia!</h5>
      </div>
    </footer>

  </main>
</body>
</html>`}function _v(l){if(!isFinite(l))return"";const i=["","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez","once","doce","trece","catorce","quince","dieciseis","diecisiete","dieciocho","diecinueve","veinte"],r=["","","veinte","treinta","cuarenta","cincuenta","sesenta","setenta","ochenta","noventa"],s=["","cien","doscientos","trescientos","cuatrocientos","quinientos","seiscientos","setecientos","ochocientos","novecientos"];function c(b){if(b===0)return"";if(b<21)return i[b];if(b<100){const S=Math.floor(b/10),j=b%10;return r[S]+(j?" y "+i[j]:"")}if(b<1e3){const S=Math.floor(b/100),j=b%100;return(S===1&&j===0?"cien":s[S]||"")+(j?" "+c(j):"")}return""}const d=Math.floor(Math.abs(l));if(d===0)return"cero";const f=[];let g=d;const p=["","mil","milln","mil millones"];let m=0;for(;g>0;){const b=g%1e3;if(b){let S=c(b);m===2&&b===1&&(S="un"),f.unshift(S+(p[m]?" "+p[m]:""))}g=Math.floor(g/1e3),m++}return f.join(" ").trim()}function wv({onBack:l}){const[i,r]=y.useState([]),[s,c]=y.useState(!1),[d,f]=y.useState(null),[g,p]=y.useState([]),[m,b]=y.useState(!1),[S,j]=y.useState(!1),[x,w]=y.useState(null),[v,E]=y.useState(!1),[T,L]=y.useState(null),[R,z]=y.useState(!1),[C,O]=y.useState(!1),[I,k]=y.useState(""),M=async()=>{c(!0);try{const{data:$,error:H}=await F.from("cotizaciones").select("*").order("fecha_cotizacion",{ascending:!1});if(H)throw H;const Z=Array.isArray($)?$:[],ee=Array.from(new Set(Z.map(Se=>Se.cliente_id).filter(Boolean)));let oe={};if(ee.length>0)try{const{data:Se}=await F.from("clientes").select("id,nombre").in("id",ee);if(Array.isArray(Se))for(const J of Se)oe[String(J.id)]=J.nombre||""}catch(Se){console.warn("Error cargando nombres de clientes:",Se)}const P=Z.map(Se=>({...Se,cliente_nombre:oe[String(Se.cliente_id)]||null}));r(P)}catch($){console.warn("Error cargando cotizaciones:",$),r([])}c(!1)};y.useEffect(()=>{M()},[]);const[G,K]=y.useState(null),[ne,Y]=y.useState(null),[B,A]=y.useState(""),N=async $=>{f($);try{const{data:H,error:Z}=await F.from("cotizaciones").select("*").eq("id",$).maybeSingle();if(Z&&console.warn("Error cargando cabecera de cotizacion",Z),K(H||null),H&&H.cliente_id)try{const{data:P}=await F.from("clientes").select("id,nombre").eq("id",H.cliente_id).maybeSingle();Y(P?.nombre||null)}catch{Y(null)}else Y(null);const{data:ee,error:oe}=await F.from("cotizaciones_detalle").select("*").eq("cotizacion_id",$);if(oe)throw oe;p(Array.isArray(ee)?ee:[]),b(!0)}catch(H){console.warn("Error cargando detalles de cotizacion",H),p([])}},q=async $=>{try{const{data:H,error:Z}=await F.from("cotizaciones_detalle").select("*").eq("cotizacion_id",$.id),ee=Array.isArray(H)?H:[],oe={header:$,detalles:ee};try{localStorage.setItem("cotizacion_to_load",JSON.stringify(oe))}catch(P){console.warn("No se pudo escribir localStorage",P)}try{window.dispatchEvent(new CustomEvent("cotizacion:load",{detail:oe}))}catch{}l()}catch(H){console.warn("Error cargando detalles para editar",H)}},X=async $=>{L($),E(!0)},ge=async()=>{if(T!=null)try{const{error:$}=await F.from("cotizaciones_detalle").delete().eq("cotizacion_id",T);$&&console.warn("Error eliminando detalles:",$);const{error:H}=await F.from("cotizaciones").delete().eq("id",T);if(H)throw H;await M(),E(!1),z(!0)}catch($){console.warn("Error eliminando cotizacion:",$),k($?.message||String($)),O(!0)}},re=async $=>{try{const{data:H,error:Z}=await F.from("cotizaciones").select("*").eq("id",$).maybeSingle();if(Z||!H){console.warn("Error fetching cotizacion header for reprint",Z);return}const{data:ee,error:oe}=await F.from("cotizaciones_detalle").select("*").eq("cotizacion_id",$);if(oe){console.warn("Error fetching cotizacion detalles for reprint",oe);return}const P=Array.isArray(ee)?ee.map(V=>({producto:{sku:V.sku||""},descripcion:V.descripcion||V.nombre||"",cantidad:Number(V.cantidad||1),precio_unitario:Number(V.precio_unitario||V.precio||0),subtotal:Number(V.subtotal||0),total:Number(V.total||0)})):[],Se={cliente:H.cliente||null,rtn:H.rtn||null,cotizacion:H.numero_cotizacion||H.Nmero||null},J={carrito:P,subtotal:Number(H.subtotal||0),isvTotal:Number(H.isv||H.impuesto||0),imp18Total:Number(H.impuesto_18||0),impTouristTotal:Number(H.impuesto_turistico||0),total:Number(H.total||0)},ae=await ru(Se,"cotizacion",J);try{const V=document.createElement("iframe");V.style.position="fixed",V.style.right="0",V.style.bottom="0",V.style.width="0",V.style.height="0",V.style.border="0",V.style.overflow="hidden",V.setAttribute("aria-hidden","true"),document.body.appendChild(V);const ue=V.contentWindow,de=V.contentDocument||V.contentWindow?.document;if(!de||!ue)try{document.body.removeChild(V)}catch{}else{de.open(),de.write(ae),de.close();const he=()=>{try{ue.focus(),ue.print()}catch(Oe){console.warn("Error during iframe print (reprint):",Oe)}setTimeout(()=>{try{document.body.removeChild(V)}catch{}},800)},Te=()=>{try{const Oe=de.images;if(Oe&&Oe.length>0){let Ue=0;for(let Le=0;Le<Oe.length;Le++){const ze=Oe[Le];ze.complete?Ue++:(ze.addEventListener("load",()=>{Ue++,Ue===Oe.length&&he()}),ze.addEventListener("error",()=>{Ue++,Ue===Oe.length&&he()}))}Ue===Oe.length&&he()}else he()}catch{try{ue.addEventListener("load",he)}catch{}setTimeout(he,1e3)}};try{de.readyState==="complete"?Te():(ue.addEventListener("load",Te),setTimeout(Te,1500))}catch{setTimeout(Te,800)}}}catch(V){console.warn("Reprint direct failed, opening new window fallback",V);const ue=window.open("","_blank");ue&&(ue.document.open(),ue.document.write(ae),ue.document.close(),setTimeout(()=>{try{ue.print(),ue.close()}catch{}},800))}}catch(H){console.warn("Error reprinting cotizacion",H)}},U=async()=>{if(x)try{const $={cliente:x.cliente||null,rtn:x.rtn||null,nota:x.nota||null,subtotal:Number(x.subtotal||0),isv:Number(x.isv||0),impuesto_18:Number(x.impuesto_18||0),impuesto_turistico:Number(x.impuesto_turistico||0),total:Number(x.total||0)},{error:H}=await F.from("cotizaciones").update($).eq("id",x.id);if(H&&console.warn("Error actualizando cotizacion:",H),x.id){const{error:Z}=await F.from("cotizaciones_detalle").delete().eq("cotizacion_id",x.id);Z&&console.warn("Error borrando detalles antiguos:",Z);const ee=g.map(P=>({...P,cotizacion_id:x.id})),{error:oe}=await F.from("cotizaciones_detalle").insert(ee);oe&&console.warn("Error insertando detalles actualizados:",oe)}j(!1),M()}catch($){console.warn("Error guardando cotizacion editada:",$)}};return t.jsxs("div",{style:{padding:28,maxWidth:1200,margin:"32px auto",fontSize:"13px"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsx("h2",{style:{margin:0,fontSize:"24px",fontWeight:700,color:"#1e293b"},children:"Cotizaciones Guardadas"}),t.jsxs("div",{style:{display:"flex",gap:12},children:[t.jsxs("button",{onClick:M,className:"btn-opaque",style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refrescar"]}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{display:"flex",alignItems:"center",gap:6},children:" Volver"})]})]}),t.jsx("section",{style:{background:"white",padding:32,borderRadius:16,boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01)",marginBottom:24},children:t.jsx("div",{style:{maxWidth:600,margin:"0 auto"},children:t.jsxs("div",{style:{position:"relative",display:"flex",gap:12},children:[t.jsxs("div",{style:{position:"relative",flex:1},children:[t.jsx("div",{style:{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)",color:"#94a3b8"},children:t.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{placeholder:"Buscar por nmero, cliente o usuario...",value:B,onChange:$=>A($.target.value),className:"input",style:{paddingLeft:42,height:48,fontSize:"15px",borderRadius:12}})]}),B&&t.jsx("button",{onClick:()=>A(""),className:"btn-opaque",style:{height:48,borderRadius:12},children:"Limpiar"})]})})}),t.jsx("section",{style:{background:"white",borderRadius:12,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:s?t.jsx("div",{style:{padding:40,textAlign:"center",color:"#64748b"},children:"Cargando..."}):i.length===0?t.jsx("div",{style:{padding:40,textAlign:"center",color:"#64748b"},children:"No hay cotizaciones guardadas."}):t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{textAlign:"left",background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569"},children:"Nmero"}),t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569"},children:"Fecha"}),t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569"},children:"Usuario"}),t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569"},children:"Cliente"}),t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569"},children:"Total"}),t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569"},children:"Estado"}),t.jsx("th",{style:{padding:"16px 24px",fontWeight:600,color:"#475569",textAlign:"right"},children:"Acciones"})]})}),t.jsx("tbody",{children:i.filter($=>{if(!B)return!0;const H=B.toLowerCase(),Z=($.numero_cotizacion||$.Nmero||"").toLowerCase(),ee=($.cliente_nombre||"")?.toLowerCase(),oe=($.usuario||"").toLowerCase();return Z.includes(H)||ee.includes(H)||oe.includes(H)}).map($=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:"16px 24px",fontWeight:500,color:"#1e293b"},children:$.numero_cotizacion||$.Nmero||""}),t.jsx("td",{style:{padding:"16px 24px",color:"#64748b"},children:$.fecha_cotizacion?new Date($.fecha_cotizacion).toLocaleString():""}),t.jsx("td",{style:{padding:"16px 24px",color:"#64748b"},children:$.usuario||""}),t.jsx("td",{style:{padding:"16px 24px",color:"#64748b"},children:$.cliente_nombre||($.cliente_id?String($.cliente_id):"Consumidor Final")}),t.jsxs("td",{style:{padding:"16px 24px",fontWeight:600,color:"#1e293b"},children:["L ",Number($.total||0).toFixed(2)]}),t.jsx("td",{style:{padding:"16px 24px"},children:t.jsx("span",{style:{padding:"4px 10px",borderRadius:9999,fontSize:"12px",fontWeight:600,background:String($.estado||"").toLowerCase()==="aceptada"?"#dcfce7":"#f1f5f9",color:String($.estado||"").toLowerCase()==="aceptada"?"#166534":"#475569"},children:$.estado||"Pendiente"})}),t.jsx("td",{style:{padding:"16px 24px",textAlign:"right"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{onClick:()=>N($.id),className:"btn-opaque",style:{padding:"6px 12px",fontSize:"12px"},children:"Ver"}),t.jsx("button",{onClick:()=>re($.id),className:"btn-opaque",style:{padding:"6px 12px",fontSize:"12px"},children:"Imprimir"}),String($.estado||"").toLowerCase()==="aceptada"?t.jsx("button",{className:"btn-opaque",style:{padding:"6px 12px",fontSize:"12px",opacity:.5,cursor:"not-allowed"},disabled:!0,children:"Editar"}):t.jsx("button",{onClick:()=>q($),className:"btn-opaque",style:{padding:"6px 12px",fontSize:"12px"},children:"Editar"}),t.jsx("button",{onClick:()=>X($.id),className:"btn-opaque",style:{padding:"6px 12px",fontSize:"12px",background:"#fee2e2",color:"#ef4444"},children:"Eliminar"})]})})]},$.id))})]})}),m&&t.jsx(Mn,{open:m,onClose:()=>{b(!1),p([]),f(null)},width:880,children:t.jsxs("div",{style:{padding:"0 8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("h3",{style:{margin:0,fontSize:"20px",color:"#1e293b"},children:["Detalle de Cotizacin #",d]}),t.jsx("button",{onClick:()=>{b(!1),p([]),f(null)},className:"btn-opaque",children:"Cerrar"})]}),G&&t.jsx("div",{style:{background:"#f8fafc",padding:20,borderRadius:12,marginBottom:24},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16,marginBottom:16},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:4},children:"NMERO"}),t.jsx("div",{style:{fontWeight:600,color:"#1e293b"},children:G.numero_cotizacion||G.Nmero||""})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:4},children:"FECHA"}),t.jsx("div",{style:{fontWeight:600,color:"#1e293b"},children:G.fecha_cotizacion?new Date(G.fecha_cotizacion).toLocaleString():""})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:4},children:"CLIENTE"}),t.jsx("div",{style:{fontWeight:600,color:"#1e293b"},children:ne??(G.cliente_id?String(G.cliente_id):"Consumidor Final")})]}),t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:4},children:"USUARIO"}),t.jsx("div",{style:{fontWeight:600,color:"#1e293b"},children:G.usuario})]})]})}),t.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:8,overflow:"hidden",marginBottom:24},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{textAlign:"left",background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600},children:"DESCRIPCIN"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600,textAlign:"right"},children:"CANTIDAD"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600,textAlign:"right"},children:"PRECIO U."}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600,textAlign:"right"},children:"SUBTOTAL"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600,textAlign:"right"},children:"TOTAL"})]})}),t.jsx("tbody",{children:g.map(($,H)=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:"12px 16px",color:"#1e293b"},children:$.descripcion}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",color:"#64748b"},children:$.cantidad}),t.jsxs("td",{style:{padding:"12px 16px",textAlign:"right",color:"#64748b"},children:["L ",Number($.precio_unitario||0).toFixed(2)]}),t.jsxs("td",{style:{padding:"12px 16px",textAlign:"right",color:"#64748b"},children:["L"," ",Number($.subtotal||($.precio_unitario||0)*($.cantidad||0)).toFixed(2)]}),t.jsxs("td",{style:{padding:"12px 16px",textAlign:"right",fontWeight:600,color:"#1e293b"},children:["L"," ",Number($.total||($.subtotal||0)-($.descuento||0)).toFixed(2)]})]},H))})]})}),G&&t.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:t.jsxs("div",{style:{width:280,background:"#f8fafc",padding:16,borderRadius:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{style:{color:"#64748b"},children:"Subtotal:"}),t.jsxs("span",{style:{fontWeight:500},children:["L ",Number(G.subtotal||0).toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx("span",{style:{color:"#64748b"},children:"Impuesto:"}),t.jsxs("span",{style:{fontWeight:500},children:["L ",Number(G.impuesto||0).toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:8,borderTop:"1px solid #e2e8f0"},children:[t.jsx("span",{style:{fontWeight:700,color:"#1e293b"},children:"Total:"}),t.jsxs("span",{style:{fontWeight:700,color:"#1e293b",fontSize:"16px"},children:["L ",Number(G.total||0).toFixed(2)]})]})]})})]})}),t.jsx(Tn,{open:v,title:"Confirmar eliminacin",message:"Eliminar esta cotizacin? Esta accin no se puede deshacer.",onClose:()=>E(!1),onCancel:()=>E(!1),onConfirm:async()=>{await ge()}}),t.jsx(Tn,{open:R,title:"Eliminado",message:"Cotizacin eliminada correctamente",onClose:()=>z(!1)}),t.jsx(Tn,{open:C,title:"Error",message:I,onClose:()=>O(!1)}),S&&x&&t.jsx(Mn,{open:S,onClose:()=>{j(!1),p([]),w(null)},width:880,children:t.jsxs("div",{style:{padding:"0 8px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsxs("h3",{style:{margin:0,fontSize:"20px",color:"#1e293b"},children:["Editar Cotizacin #",x.id]}),t.jsx("button",{onClick:()=>{j(!1),p([]),w(null)},className:"btn-opaque",children:"Cerrar"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6,fontWeight:500,color:"#475569"},children:"Cliente"}),t.jsx("input",{value:x.cliente||"",onChange:$=>w({...x,cliente:$.target.value}),className:"input"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6,fontWeight:500,color:"#475569"},children:"RTN"}),t.jsx("input",{value:x.rtn||"",onChange:$=>w({...x,rtn:$.target.value}),className:"input"})]})]}),t.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:8,overflow:"hidden",marginBottom:24},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{textAlign:"left",background:"#f8fafc",borderBottom:"1px solid #e2e8f0"},children:[t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600},children:"SKU"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600},children:"NOMBRE"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600},children:"CANTIDAD"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600},children:"PRECIO"}),t.jsx("th",{style:{padding:"12px 16px",fontSize:"12px",color:"#64748b",fontWeight:600},children:"SUBTOTAL"})]})}),t.jsx("tbody",{children:g.map(($,H)=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:"12px 16px"},children:$.sku}),t.jsx("td",{style:{padding:"12px 16px"},children:$.nombre}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("input",{type:"number",value:$.cantidad||0,onChange:Z=>{const ee=Number(Z.target.value||0),oe=[...g];oe[H]={...oe[H],cantidad:ee},p(oe)},className:"input",style:{width:80,padding:"4px 8px"}})}),t.jsx("td",{style:{padding:"12px 16px"},children:t.jsx("input",{type:"number",value:$.precio_unitario||0,onChange:Z=>{const ee=Number(Z.target.value||0),oe=[...g];oe[H]={...oe[H],precio_unitario:ee},p(oe)},className:"input",style:{width:100,padding:"4px 8px"}})}),t.jsxs("td",{style:{padding:"12px 16px"},children:["L"," ",Number(($.precio_unitario||0)*($.cantidad||0)).toFixed(2)]})]},H))})]})}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:12},children:[t.jsx("button",{onClick:()=>{j(!1),p([]),w(null)},className:"btn-opaque",children:"Cancelar"}),t.jsx("button",{onClick:U,className:"btn-primary",children:"Guardar cambios"})]})]})})]})}function Cv({onBack:l}){return t.jsxs("div",{style:{padding:20,maxWidth:1e3,margin:"24px auto"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[t.jsx("h2",{style:{margin:0},children:"Pedidos en Lnea"}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{padding:"8px 12px"},children:"Volver"})]}),t.jsxs("section",{style:{background:"white",padding:16,borderRadius:8,boxShadow:"0 1px 6px rgba(2,6,23,0.06)"},children:[t.jsx("p",{children:"Aqu se mostrarn los pedidos recibidos por canales en lnea. Placeholder de ejemplo."}),t.jsx("p",{style:{color:"#6b7280"},children:"Integrar con API de pedidos cuando est disponible."})]})]})}function Ev(l,i){const[r,s]=y.useState({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0}),[c,d]=y.useState(!1),f=y.useCallback(async()=>{if(!l){s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0});return}d(!0);try{let g=l;g&&!g.includes("Z")&&!g.includes("+")&&!g.match(/-\d\d:\d\d$/)&&(g=`${g}-06:00`);const p=g?new Date(g).toISOString():null;let m=F.from("devoluciones_ventas").select("total, tipo_devolucion");p&&(m=m.gte("fecha_devolucion",p)),i&&(m=m.eq("usuario",i));const{data:b,error:S}=await m;if(S){console.debug("useDevolucionesTotales: error fetching devoluciones_ventas",S),s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0});return}const j={efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0};Array.isArray(b)&&b.forEach(x=>{const w=Number(x.total||0),v=(x.tipo_devolucion||"").toLowerCase();let E=null;v.includes("efectivo")||v==="devolucion"?E="efectivo":v.includes("tarjeta")?E="tarjeta":v.includes("transferencia")?E="transferencia":v.includes("dolar")&&(E="dolares"),E||(E="efectivo"),j[E]+=w,j.total+=w}),s(j)}catch(g){console.debug("useDevolucionesTotales: exception",g),s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0})}finally{d(!1)}},[l,i]);return y.useEffect(()=>{f()},[f]),{totals:r,loading:c,reload:f}}function Tv(l,i){const[r,s]=y.useState({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0}),[c,d]=y.useState(!1),f=y.useCallback(async()=>{if(!l||!i){s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0});return}d(!0);let g=l;g&&!g.includes("Z")&&!g.includes("+")&&!g.match(/-\d\d:\d\d$/)&&(g=`${g}-06:00`);const p=g?new Date(g).toISOString():null;try{const{data:m,error:b}=await F.from("ventas").select("id").eq("usuario",i).gte("fecha_venta",p);if(b){console.debug("usePagosTotals: error fetching ventas",b),s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0});return}const S=Array.isArray(m)&&m.length>0?m.map(v=>String(v.id)):[];if(S.length===0){s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0});return}const{data:j,error:x}=await F.from("pagos").select("monto, tipo").in("venta_id",S);if(x){console.debug("usePagosTotals: error fetching pagos",x),s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0});return}const w={efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0};Array.isArray(j)&&j.forEach(v=>{const E=Number(v.monto||0),T=(v.tipo||"").toLowerCase();let L=null;T.includes("efectivo")||T==="cash"?L="efectivo":T.includes("tarjeta")||T==="card"?L="tarjeta":T.includes("transferencia")||T==="transfer"?L="transferencia":(T.includes("dolar")||T.includes("usd"))&&(L="dolares"),L||(L="efectivo"),w[L]+=E,w.total+=E}),s(w)}catch(m){console.debug("usePagosTotals: exception",m),s({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0})}finally{d(!1)}},[l,i]);return y.useEffect(()=>{f()},[f]),{totals:r,loading:c,reload:f}}function Nv(l,i,r){const[s,c]=y.useState([]),[d,f]=y.useState(!1),[g,p]=y.useState(null),m=y.useCallback(async()=>{f(!0),p(null);try{if(!l){c([]);return}let b=l;b&&!b.includes("Z")&&!b.includes("+")&&!b.match(/-\d\d:\d\d$/)&&(b=`${b}-06:00`);const S=b?new Date(b).toISOString():null;let j=F.from("ventas").select("id").ilike("estado","%anulad%");S&&(j=j.gte("fecha_venta",S)),r&&(j=j.eq("usuario",r));const{data:x,error:w}=await j;if(w)throw w;const v=Array.isArray(x)?x.map(O=>O.id).filter(Boolean):[];if(v.length===0){c([]);return}const E=v.every(O=>!Number.isNaN(Number(O)))?v.map(O=>Number(O)):v.map(O=>String(O));let T=F.from("pagos").select("tipo, monto, valor_moneda, created_at").in("venta_id",E);if(S&&(T=T.gte("created_at",S)),r&&(i||i===0)){const O=Number(i);Number.isNaN(O)?T=T.eq("usuario_nombre",r):T=T.or(`usuario_nombre.eq.${r},usuario_id.eq.${O}`)}else r?T=T.eq("usuario_nombre",r):i!=null&&i!==""&&(T=T.eq("usuario_id",i));const{data:L,error:R}=await T;if(R)throw R;const z={};Array.isArray(L)&&L.forEach(O=>{const I=(O.tipo||"desconocido").toString();let k=Number(O.monto||0);try{const M=I.toLowerCase();if(M.includes("dolar")||M.includes("usd")){const K=(O.valor_moneda||"").toString().match(/=\s*([0-9.,]+)/);if(K&&K[1]){const ne=Number(String(K[1]).replace(/,/g,"."))||0;ne>0&&(k=Number((k/ne).toFixed(6)))}}}catch{}z[I]=(z[I]||0)+k});const C=Object.keys(z).sort().map(O=>({tipo:O,total_monto:z[O]}));c(C)}catch(b){p(b),c([])}finally{f(!1)}},[l,i,r]);return y.useEffect(()=>{m()},[m]),{data:s,loading:d,error:g,reload:m}}function Av(l){const[i,r]=y.useState([]),[s,c]=y.useState(!1),[d,f]=y.useState(null),g=y.useCallback(async()=>{c(!0),f(null);try{if(!l){r([]);return}let p=null,m=null;try{const T=typeof window<"u"?localStorage.getItem("user"):null;if(T){const L=JSON.parse(T);p=L.username||L.user?.username||L.name||L.user?.name||null,m=L.id||L.user?.id||L.sub||L.user_id||null}}catch(T){console.error("Error parsing user from localStorage",T)}let b=l;b&&!b.includes("Z")&&!b.includes("+")&&!b.match(/-\d\d:\d\d$/)&&(b=`${b}-06:00`);const S=b?new Date(b).toISOString():null;let j=F.from("pagos").select("tipo, monto, valor_moneda, created_at").gte("created_at",S);p&&m?j=j.or(`usuario_nombre.eq.${p},usuario_id.eq.${m}`):p?j=j.eq("usuario_nombre",p):m&&(j=j.eq("usuario_id",m));const{data:x,error:w}=await j;if(w){f(w),r([]);return}const v={};Array.isArray(x)&&x.forEach(T=>{const L=(T.tipo||"desconocido").toString();let R=Number(T.monto||0);try{const z=L.toLowerCase();if(z.includes("dolar")||z.includes("usd")){const O=(T.valor_moneda||"").toString().match(/=\s*([0-9.,]+)/);if(O&&O[1]){const I=Number(String(O[1]).replace(/,/g,"."))||0;I>0&&(R=Number((R/I).toFixed(6)))}}}catch{}v[L]=(v[L]||0)+R});const E=Object.keys(v).sort().map(T=>({tipo:T,total_monto:v[T]}));r(E)}catch(p){f(p),r([])}finally{c(!1)}},[l]);return y.useEffect(()=>{g()},[g]),{data:i,loading:s,error:d,reload:g}}function zv(l,i){const[r,s]=y.useState([]),[c,d]=y.useState(!1),[f,g]=y.useState(null),p=y.useCallback(async()=>{d(!0),g(null);try{if(!l||!i){s([]);return}let m=l;m&&!m.includes("Z")&&!m.includes("+")&&!m.match(/-\d\d:\d\d$/)&&(m=`${m}-06:00`);const b=m?new Date(m).toISOString():null,{data:S,error:j}=await F.from("caja_movimientos").select("tipo_movimiento, monto").gte("fecha",b).eq("usuario",i);if(j){g(j),s([]);return}const x={};Array.isArray(S)&&S.forEach(v=>{const E=(v.tipo_movimiento||"desconocido").toString(),T=Number(v.monto||0);x[E]=(x[E]||0)+T});const w=Object.keys(x).sort().map(v=>({tipo_movimiento:v,total_monto:x[v]}));s(w)}catch(m){g(m),s([])}finally{d(!1)}},[l,i]);return y.useEffect(()=>{p()},[p]),{data:r,loading:c,error:f,reload:p}}function kv(l,i,r){const[s,c]=y.useState(null),[d,f]=y.useState(!1),[g,p]=y.useState(null),m=y.useCallback(async()=>{f(!0),p(null);try{let b=F.from("devoluciones_ventas").select("total,fecha_devolucion,usuario,usuario_id");if(l&&(b=b.eq("usuario",l)),i!==null&&typeof i<"u"&&(b=b.eq("usuario_id",String(i))),r){let v=r;v&&!v.includes("Z")&&!v.includes("+")&&!v.match(/-\d\d:\d\d$/)&&(v=`${v}-06:00`);const E=v?new Date(v).toISOString():null;E&&(b=b.gte("fecha_devolucion",E))}const{data:S,error:j}=await b;if(j){p(j),c(null);return}const x=Array.isArray(S)?S:[],w=x.reduce((v,E)=>v+(Number(E.total||0)||0),0);c({total_devoluciones:w,rows:x})}catch(b){p(b),c(null)}finally{f(!1)}},[l,i,r]);return y.useEffect(()=>{if(!l||!r){c(null);return}m()},[m,l,r]),{data:s,loading:d,error:g,reload:m}}function Rv({onBack:l}){const{session:i,loading:r,startSession:s,closeSession:c}=iu(),[d,f]=y.useState(!1),[g,p]=y.useState(""),[m,b]=y.useState(!1),[S,j]=y.useState(!1),[x,w]=y.useState(!1),[v,E]=y.useState(!1),[T,L]=y.useState(""),[R,z]=y.useState({efectivo:"",dolares:"",tarjeta:"",transferencia:""}),[C,O]=y.useState({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0}),[I,k]=y.useState({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0}),[M,G]=y.useState({efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0}),[K,ne]=y.useState(0),[Y,B]=y.useState(0),{totals:A,reload:N}=Ev(i?.fecha_apertura??null,i?.usuario??null),{totals:q,loading:X,reload:ge}=Tv(i?.fecha_apertura??null,i?.usuario??null),re=i?.fecha_apertura??null,{reload:U}=Av(re),{data:$,reload:H}=zv(re,i?.usuario??null);let Z=null;try{const se=typeof window<"u"?localStorage.getItem("user"):null;if(se){const ve=JSON.parse(se);Z=ve&&(ve.id||ve.user?.id||ve.sub||ve.user_id)?ve.id||ve.user?.id||ve.sub||ve.user_id:null}}catch{Z=null}const{data:ee,reload:oe}=Nv(re,Z,i?.usuario??null);kv(i?.usuario??null,Z,i?.fecha_apertura??null),Dr.useEffect(()=>{try{console.debug("usePagosTotals values",{pagosTotals:q,pagosLoading:X})}catch{}},[q,X]),y.useEffect(()=>{i&&P()},[i]);const P=async()=>{if(i){f(!0);try{const se=[];typeof ge=="function"&&se.push(ge()),typeof U=="function"&&se.push(U()),typeof H=="function"&&se.push(H()),typeof N=="function"&&se.push(N()),typeof oe=="function"&&se.push(oe()),await Promise.allSettled(se);const ve=i.usuario;let $e=i.fecha_apertura;$e&&!$e.includes("Z")&&!$e.includes("+")&&!$e.match(/-\d\d:\d\d$/)&&($e=`${$e}-06:00`);const gt=$e?new Date($e).toISOString():null,{data:st,error:vt}=await F.from("ventas").select("id").eq("usuario",ve).gte("fecha_venta",gt);vt&&console.error("Error fetching ventas for ids:",vt);const kt={efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0},Rt={efectivo:0,tarjeta:0,transferencia:0,dolares:0,total:0};if(st&&st.length>0){const bn=st.map(ft=>String(ft.id)),{data:qe,error:et}=await F.from("pagos").select("monto, tipo").in("venta_id",bn);et&&console.error("Error fetching pagos:",et),qe&&qe.forEach(ft=>{const lt=Number(ft.monto||0),bt=(ft.tipo||"").toLowerCase();let ht=null;bt.includes("efectivo")||bt==="cash"?ht="efectivo":bt.includes("tarjeta")||bt==="card"?ht="tarjeta":bt.includes("transferencia")||bt==="transfer"?ht="transferencia":(bt.includes("dolar")||bt==="usd")&&(ht="dolares"),ht&&(lt>=0?(kt[ht]+=lt,kt.total+=lt):(Rt[ht]+=Math.abs(lt),Rt.total+=Math.abs(lt)))})}O(kt),k(Rt);let ut=[];const mn=["caja_movimientos"];for(const bn of mn){const{data:qe,error:et}=await F.from(bn).select("monto, tipo_movimiento").eq("usuario",ve).gte("fecha",$e);if(!et&&qe){ut=qe;break}}let Ot=0,Nn=0;ut.forEach(bn=>{const qe=(bn.tipo_movimiento||"").toLowerCase(),et=Number(bn.monto||0);qe==="ingreso"&&(Ot+=et),qe==="egreso"&&(Nn+=et)}),ne(Ot),B(Nn);try{A&&G(A)}catch(bn){console.debug("Error syncing devoluciones from hook",bn)}}catch(se){console.error("Error calculating totals:",se)}finally{f(!1)}}},Se=async()=>{if(g===""||Number(g)<0)return alert("Ingrese un monto inicial vlido");try{await s(Number(g))}catch(se){alert(se.message)}},J=se=>new Intl.NumberFormat("es-HN",{style:"currency",currency:"HNL"}).format(se).replace("HNL","L");if(r)return t.jsx("div",{style:{padding:20},children:"Cargando sesin..."});if(!i)return t.jsxs("div",{style:{padding:20,maxWidth:500,margin:"40px auto",textAlign:"center"},children:[t.jsx("h2",{children:"No hay sesin de caja activa"}),t.jsx("p",{children:"Para comenzar a vender y registrar movimientos, debes abrir una sesin de caja."}),t.jsxs("div",{style:{marginTop:20,background:"white",padding:20,borderRadius:8,boxShadow:"0 1px 4px rgba(0,0,0,0.1)"},children:[t.jsx("label",{style:{display:"block",marginBottom:10,textAlign:"left",fontWeight:600},children:"Monto Inicial (L)"}),t.jsx("input",{type:"number",className:"input",value:g,onChange:se=>p(Number(se.target.value)),placeholder:"0.00",style:{width:"100%",marginBottom:16}}),t.jsx("button",{className:"btn-primary",style:{width:"100%"},onClick:Se,children:"Abrir Caja"})]}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{marginTop:20},children:"Volver"})]});const ae=C.efectivo-I.efectivo;(i.monto_inicial||0)+ae+K-Y-M.efectivo;const V=["efectivo","dolares","tarjeta","transferencia"],ue=(se="")=>{const ve=se.toLowerCase();return ve.includes("efect")?"efectivo":ve.includes("dolar")||ve.includes("usd")?"dolares":ve.includes("tarj")?"tarjeta":ve.includes("transfer")?"transferencia":"efectivo"},de={efectivo:Number(q&&q.efectivo||0),dolares:Number(q&&q.dolares||0),tarjeta:Number(q&&q.tarjeta||0),transferencia:Number(q&&q.transferencia||0)},he={efectivo:0,dolares:0,tarjeta:0,transferencia:0},Te={efectivo:0,dolares:0,tarjeta:0,transferencia:0};Array.isArray($)&&$.forEach(se=>{const ve=String(se.tipo_movimiento||"").toLowerCase(),$e=ue(ve),gt=Number(se.total_monto||se.monto||0),st=ve.includes("egreso")||ve.includes("salida")||ve.includes("salir")||ve.includes("retirada"),vt=ve.includes("ingreso")||ve.includes("entrada")||!st;st?Te[$e]=(Te[$e]||0)+gt:vt&&(he[$e]=(he[$e]||0)+gt)});const Oe={efectivo:0,dolares:0,tarjeta:0,transferencia:0};Array.isArray(ee)&&ee.forEach(se=>{const ve=String(se.tipo||"").toLowerCase(),$e=ue(ve),gt=Number(se.total_monto||0);Oe[$e]=(Oe[$e]||0)+gt});const Ue={efectivo:0,dolares:0,tarjeta:0,transferencia:0};A&&(Ue.efectivo=Number(A.efectivo||0),Ue.dolares=Number(A.dolares||0),Ue.tarjeta=Number(A.tarjeta||0),Ue.transferencia=Number(A.transferencia||0));const Le=se=>(de[se]||0)+(he[se]||0)-((Te[se]||0)+(Oe[se]||0)+(Ue[se]||0)),ze=async()=>{j(!0),await new Promise(vt=>setTimeout(vt,1200));const se={efectivo:Le("efectivo"),dolares:Le("dolares"),tarjeta:Le("tarjeta"),transferencia:Le("transferencia")},ve={efectivo:Number(R.efectivo)||0,dolares:Number(R.dolares)||0,tarjeta:Number(R.tarjeta)||0,transferencia:Number(R.transferencia)||0},$e=Object.values(se).reduce((vt,kt)=>vt+kt,0),gt=Object.values(ve).reduce((vt,kt)=>vt+kt,0),st=gt-$e;try{const vt=await wa();await c({total_ingresos:C.total+K,total_egresos:Y+M.total,saldo_final:gt,efectivo_obtenido:se.efectivo,dolares_obtenido:se.dolares,tarjeta_obtenido:se.tarjeta,transferencia_obtenido:se.transferencia,efectivo_registrado:ve.efectivo,dolares_registrado:ve.dolares,tarjeta_registrado:ve.tarjeta,transferencia_registrado:ve.transferencia,diferencia:st});const kt=vt?.logoUrl?`<img src="${vt.logoUrl}" class="logo" alt="Logo" />`:"",Rt=new Date,ut=`
        <html>
        <head>
          <title>Reporte de Cierre de Caja</title>
          <style>
            body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; padding: 40px; color: #333; max-width: 800px; margin: 0 auto; }
            .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px; }
            .logo { max-height: 80px; margin-bottom: 10px; }
            .company-name { font-size: 24px; font-weight: bold; margin: 5px 0; color: #2c3e50; }
            .info { font-size: 13px; color: #7f8c8d; margin-bottom: 2px; }
            .title { text-align: center; font-size: 20px; font-weight: bold; margin: 30px 0; text-transform: uppercase; letter-spacing: 1px; border: 1px solid #333; padding: 10px; }
            .session-info { margin-bottom: 30px; font-size: 14px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 30px; font-size: 13px; }
            th, td { border: 1px solid #e0e0e0; padding: 10px; text-align: right; }
            th { background-color: #f8f9fa; font-weight: bold; text-align: center; color: #2c3e50; }
            .text-left { text-align: left; }
            .totals { margin-top: 30px; border-top: 2px solid #333; padding-top: 20px; }
            .total-row { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 8px; font-size: 14px; }
            .final-balance { font-size: 18px; margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px; }
            .signatures { margin-top: 80px; display: flex; justify-content: space-between; }
            .sig-line { border-top: 1px solid #333; width: 40%; text-align: center; padding-top: 10px; font-size: 13px; }
            @media print {
              body { padding: 0; }
              .no-print { display: none; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            ${kt}
            <div class="company-name">${vt?.nombre_empresa||"Nombre Empresa"}</div>
            <div class="info">${vt?.direccion||""}</div>
            <div class="info">RTN: ${vt?.rtn||"N/A"} | Tel: ${vt?.telefono||""}</div>
            <div class="info">${vt?.email||""}</div>
          </div>

          <div class="title">Reporte de Cierre de Caja</div>

          <div class="session-info">
            <div><strong>Cajero:</strong> ${i.usuario}</div>
            <div><strong>ID Sesin:</strong> #${i.id}</div>
            <div><strong>Apertura:</strong> ${new Date(i.fecha_apertura).toLocaleString()}</div>
            <div><strong>Cierre:</strong> ${Rt.toLocaleString()}</div>
            <div><strong>Monto Inicial:</strong> ${J(i.monto_inicial)}</div>
          </div>

          <table>
            <thead>
              <tr>
                <th class="text-left">Medio de Pago</th>
                <th>Sistema (Calc)</th>
                <th>Registrado (Real)</th>
                <th>Diferencia</th>
              </tr>
            </thead>
            <tbody>
              ${V.map(Ot=>`
                <tr>
                  <td class="text-left" style="text-transform: capitalize">${Ot}</td>
                  <td>${J(se[Ot])}</td>
                  <td>${J(ve[Ot])}</td>
                  <td style="color: ${ve[Ot]-se[Ot]<0?"red":"black"}">${J(ve[Ot]-se[Ot])}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>

          <div class="totals">
            <div class="total-row">
              <span>Total Ingresos (Sistema):</span>
              <span>${J(C.total+K)}</span>
            </div>
            <div class="total-row">
              <span>Total Egresos (Sistema):</span>
              <span>${J(Y+M.total)}</span>
            </div>
            <div class="total-row final-balance">
              <span>Saldo Final Registrado:</span>
              <span>${J(gt)}</span>
            </div>
             <div class="total-row" style="color: ${st<0?"red":"black"}">
              <span>Diferencia Total:</span>
              <span>${J(st)}</span>
            </div>
          </div>

          <div class="signatures">
            <div class="sig-line">Firma Cajero</div>
            <div class="sig-line">Firma Supervisor</div>
          </div>

          <script>
            // Wait for images to load before printing
            window.onload = function() { 
              setTimeout(function() {
                window.print(); 
                // Optional: window.close(); 
              }, 500);
            }
          <\/script>
        </body>
        </html>
      `,mn=window.open("","_blank");mn&&(mn.document.write(ut),mn.document.close()),j(!1),b(!1),w(!0)}catch(vt){j(!1),L(vt?.message||String(vt)),E(!0)}};return t.jsxs("div",{style:{padding:20,maxWidth:1e3,margin:"24px auto"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{margin:0},children:"Datos de caja "}),t.jsxs("div",{style:{color:"#64748b",fontSize:14},children:["Sesin iniciada el:"," ",new Date(i.fecha_apertura).toLocaleString()," por"," ",t.jsx("strong",{children:i.usuario})]})]}),t.jsxs("div",{style:{display:"flex",gap:10},children:[t.jsx("button",{onClick:P,className:"btn-opaque",disabled:d,children:d?"Calculando...":"Actualizar datos"}),t.jsx("button",{onClick:l,className:"btn-opaque",children:"Volver"})]})]}),t.jsxs("section",{style:{marginBottom:20},children:[t.jsx("h3",{style:{margin:"8px 0"},children:"Resumen Parcial - Corte de Caja"}),t.jsx("div",{style:{background:"white",borderRadius:8,padding:12,boxShadow:"0 4px 18px rgba(2,6,23,0.08)"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Inter, system-ui, -apple-system"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left",padding:"12px 16px",color:"#0f172a"},children:"Medio / Columna"}),t.jsx("th",{style:{textAlign:"right",padding:"12px 16px",color:"#0f172a"},children:"Pagos"}),t.jsx("th",{style:{textAlign:"right",padding:"12px 16px",color:"#0f172a"},children:"Ingresos"}),t.jsx("th",{style:{textAlign:"right",padding:"12px 16px",color:"#0f172a"},children:"Egresos"}),t.jsx("th",{style:{textAlign:"right",padding:"12px 16px",color:"#0f172a"},children:"Anulaciones"}),t.jsx("th",{style:{textAlign:"right",padding:"12px 16px",color:"#0f172a"},children:"Devoluciones"})]})}),t.jsx("tbody",{children:V.map(se=>t.jsxs("tr",{style:{borderTop:"1px solid #eef2f7"},children:[t.jsx("td",{style:{padding:"12px 16px",fontWeight:700,color:"#0b1220",textTransform:"capitalize"},children:se}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",color:"#0ea5e9"},children:J(de[se]||0)}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",color:"#10b981"},children:J(he[se]||0)}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",color:"#ef4444"},children:J(Te[se]||0)}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",color:"#f50b0bff"},children:J(Oe[se]||0)}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",color:"#f10606ff"},children:J(Ue[se]||0)})]},se))}),t.jsx("tfoot",{children:t.jsxs("tr",{style:{borderTop:"2px solid #e6eef7"},children:[t.jsx("td",{style:{padding:"12px 16px",fontWeight:800},children:"Totales"}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",fontWeight:700},children:J(Object.values(de).reduce((se,ve)=>se+ve,0))}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",fontWeight:700},children:J(Object.values(he).reduce((se,ve)=>se+ve,0))}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",fontWeight:700},children:J(Object.values(Te).reduce((se,ve)=>se+ve,0))}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",fontWeight:700},children:J(Object.values(Oe).reduce((se,ve)=>se+ve,0))}),t.jsx("td",{style:{padding:"12px 16px",textAlign:"right",fontWeight:700},children:J(Object.values(Ue).reduce((se,ve)=>se+ve,0))})]})})]})})]}),t.jsxs("section",{style:{marginBottom:20},children:[t.jsx("h3",{style:{margin:"8px 0",fontSize:14}}),t.jsxs("div",{style:{display:"flex",gap:20,alignItems:"flex-start"},children:[t.jsx("div",{style:{background:"white",borderRadius:6,padding:8,boxShadow:"0 2px 8px rgba(2,6,23,0.06)",maxWidth:400,flex:"0 0 400px"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Inter, system-ui, -apple-system",fontSize:12},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left",padding:"6px 8px",color:"#0f172a"},children:"Resumen actual--Medio de Pago"}),t.jsx("th",{style:{textAlign:"right",padding:"6px 8px",color:"#0f172a"},children:"Total Neto"})]})}),t.jsx("tbody",{children:V.map(se=>{const ve=(de[se]||0)+(he[se]||0)-((Te[se]||0)+(Oe[se]||0)+(Ue[se]||0));return t.jsxs("tr",{style:{borderTop:"1px solid #eef2f7"},children:[t.jsx("td",{style:{padding:"6px 8px",fontWeight:600,color:"#0b1220",textTransform:"capitalize"},children:se}),t.jsx("td",{style:{padding:"6px 8px",textAlign:"right",fontWeight:600,color:ve>=0?"#10b981":"#ef4444"},children:J(ve)})]},se)})})]})}),t.jsx("button",{className:"btn-primary",style:{fontSize:14,padding:"12px 24px",height:"fit-content",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.2)"},onClick:()=>b(!0),children:"Registrar Corte Total"})]})]}),m&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{background:"white",padding:24,borderRadius:12,width:400,boxShadow:"0 4px 20px rgba(0,0,0,0.2)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:16},children:"Ingreso de valores"}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,fontWeight:600,marginBottom:4},children:"Efectivo en Caja"}),t.jsx("input",{type:"number",className:"input",style:{width:"100%"},value:R.efectivo,onChange:se=>z({...R,efectivo:se.target.value}),placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,fontWeight:600,marginBottom:4},children:"Dlares en Caja"}),t.jsx("input",{type:"number",className:"input",style:{width:"100%"},value:R.dolares,onChange:se=>z({...R,dolares:se.target.value}),placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,fontWeight:600,marginBottom:4},children:"Total Tarjeta (Voucher)"}),t.jsx("input",{type:"number",className:"input",style:{width:"100%"},value:R.tarjeta,onChange:se=>z({...R,tarjeta:se.target.value}),placeholder:"0.00"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,fontWeight:600,marginBottom:4},children:"Total Transferencias"}),t.jsx("input",{type:"number",className:"input",style:{width:"100%"},value:R.transferencia,onChange:se=>z({...R,transferencia:se.target.value}),placeholder:"0.00"})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:10,marginTop:24},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>b(!1),disabled:S,children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:ze,disabled:S,children:S?"Cerrando...":"Registrar Cierre"})]})]})}),S&&t.jsxs("div",{style:{position:"fixed",inset:0,background:"rgba(255,255,255,0.8)",zIndex:2e3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("div",{style:{width:40,height:40,border:"4px solid #e2e8f0",borderTopColor:"#0f172a",borderRadius:"50%",animation:"spin 1s linear infinite"}}),t.jsx("div",{style:{marginTop:16,fontWeight:600,color:"#0f172a"},children:"Procesando Cierre..."}),t.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]}),t.jsx(Tn,{open:x,title:"Cierre exitoso",message:"La caja se cerr correctamente. Se actualizarn los datos del sistema.",onClose:async()=>{w(!1);try{const se=[];typeof ge=="function"&&se.push(ge()),typeof U=="function"&&se.push(U()),typeof H=="function"&&se.push(H()),typeof N=="function"&&se.push(N()),typeof oe=="function"&&se.push(oe()),await Promise.allSettled(se)}catch{}try{l()}catch{}setTimeout(()=>{try{window.location.reload()}catch{}},400)}}),t.jsx(Tn,{open:v,title:"Error al cerrar caja",message:T,onClose:()=>E(!1)})]})}async function Ov(l={},i={}){let r=l.comercio||"",s=l.companyRTN||l.rtnEmpresa||l.RTN||"",c=l.direccion||"",d=l.telefono||"",f=l.email||l.EM||"",g=l.logo||l.logoUrl||l.logo_src||null;if(!r||!s||!c||!d||!f||!g)try{const R=await wa();R&&(r=r||R.nombre||R.comercio||r,s=s||R.rtn||s,c=c||R.direccion||R.direccion_fiscal||c,d=d||R.telefono||R.telefono_fijo||d,f=f||R.email||R.correo||f,g=g||R.logoUrl||R.logo||g)}catch{}if(g&&typeof window<"u"&&l.inlineLogo!==!1)try{if(!String(g).startsWith("data:")){const R=await fetch(String(g),{mode:"cors"});if(R.ok){const z=await R.blob(),C=await new Promise(O=>{const I=new FileReader;I.onloadend=()=>{O(typeof I.result=="string"?I.result:null)},I.onerror=()=>{O(null)},I.readAsDataURL(z)});C&&(g=C)}}}catch{}let p=l.factura||"",m=l.CAI||l.cai||"";l.fechaLimiteEmision||l.fecha_limite_emision||l.fecha_vencimiento,l.rangoAutorizadoDe||l.rango_desde,l.rangoAutorizadoHasta||l.rango_hasta,l.identificador||l.identificadorCAI;const b=l.cliente||"Consumidor Final",S=l.identidad||l.rtnCliente||l.clientRTN||l.rtn||i.identidad||"C/F",j=new Date().toLocaleString(),x=l.fechaAnulacion||j,w=Array.isArray(i.carrito)?i.carrito:[];typeof i.subtotal=="number"&&i.subtotal,typeof i.isvTotal=="number"&&i.isvTotal;const v=typeof i.total=="number"?i.total:0,T=w.map(R=>{const z=String(R.producto&&(R.producto.nombre||R.producto.descripcion)||R.descripcion||R.nombre||""),C=Number(R.cantidad||0),O=Number((R.producto&&(R.producto.precio??R.producto.precio_unitario))??R.precio_unitario??R.precio??0),I=O*C,k=Number(I||0).toFixed(2);return`<tr><td>${R.producto&&R.producto.sku||R.sku||""} ${z}</td><td style="text-align:center">${C}</td><td style="text-align:right">L ${Number(O).toFixed(2)}</td><td style="text-align:right">L ${k}</td></tr>`}).join(`
`);return`
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Comprobante de Anulacin</title>
	<style>
		@page { size: letter; margin: 0.5in; }
		* { letter-spacing: 0 !important; word-spacing: 0 !important; margin: 0; padding: 0; line-height: 1.2 !important; box-sizing: border-box; }
		body { font-family: 'Arial', sans-serif; font-size: 10px; color: #000; margin: 0; padding: 0; }
		.factura-container { width: 100%; max-width: 8.5in; margin: 0 auto; padding: 0.25in; }
		.divider { border: none; border-top: 1px solid #ddd; margin: 8px 0; }
		.header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; gap: 12px; }
		.header img { width: 140px; height: auto; object-fit: contain; margin-right: 12px; }
		.header-title { font-size: 24px; color: #ef4444; text-align: right; flex-grow: 1; font-weight: 700 !important; text-transform: uppercase; }
		.info-section h3, .info-section p { font-size: 11px; margin-bottom: 3px; }

		.tabla { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 10px; font-size: 10px; box-shadow: 0 2px 6px rgba(2,6,23,0.06); border-radius: 6px; overflow: hidden; }
		.tabla thead tr { background: #ef4444; color: #fff; }
		.tabla th { padding: 10px 8px; text-align: left; font-size: 10px; text-transform: uppercase; letter-spacing: 0.6px; font-weight: 700 !important; border-bottom: 1px solid rgba(255,255,255,0.08); }
		.tabla td { padding: 10px 8px; font-size: 10px; vertical-align: middle; background: #fff; font-weight: 400 !important; border-bottom: 1px solid #eef2f7; }
		.tabla tbody tr:nth-child(even) td { background: #f8fafc; }
		.tabla td:nth-child(2), .tabla td:nth-child(3), .tabla td:nth-child(4) { text-align: right; }
		.tabla td:first-child { text-align: left; }

		.totals-section { margin-top: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 4px 0; }
		.totals-section span.label { text-align: left; padding-left: 2px; font-weight: 600 !important; }
		.totals-section span.value { text-align: right; padding-right: 2px; font-weight: 700 !important; }
		.total-final { font-size: 11px; margin-top: 6px; border-top: 1px solid #e6edf3; padding-top: 6px; font-weight: 800 !important; }
		.footer-info { text-align: center; margin-top: 12px; font-size: 10px; color: #374151; }
        .watermark { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 100px; color: rgba(239, 68, 68, 0.1); font-weight: bold; z-index: -1; pointer-events: none; }

		@media print {
			.factura-container { box-shadow: none; border-radius: 0; }
			.tabla thead tr { background: #ef4444 !important; color: #fff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .header-title { color: #ef4444 !important; }
		}
        .numero-factura { font-size: 18px; color: #0f172a; margin-top: -3px; font-weight: 700 !important; }
	</style>
</head>
<body>
    <div class="watermark">ANULADA</div>
	<main class="factura-container">

		<header class="header">
            <img src="${g}" alt="Logo del Comercio" />
            <div class="header-title-container" style="text-align: right;">
                <h1 class="header-title">COMPROBANTE DE ANULACIN</h1>
                <h2 class="numero-factura">Ref. Factura: ${p}</h2>
            </div>
        </header>

		<hr class="divider" />

		<section class="info-section">
			<h3>${r}</h3>
			<p>RTN: ${s}</p>
			<p>Direccin: ${c}</p>
			<p>Telfono: ${d}</p>
			<p>Email: ${f}</p>
		</section>
		<hr class="divider" />

		<section class="info-dates">
			<p><strong>Fecha de Anulacin: ${x}</strong></p>
			<p>Factura Original No: ${p}</p>
			<p>CAI Original: ${m}</p>
		</section>
		<hr class="divider" />

		<section class="info-section">
			<p>Cliente: ${b}</p>
			<p>RTN Cliente: ${S}</p>
		</section>
		<hr class="divider" />

		<section class="details-section">
			<table class="tabla">
				<thead>
					<tr>
						<th>Descripcin</th>
						<th style="width: 10%;">Cant</th>
						<th style="width: 15%;">Precio</th>
						<th style="width: 15%;">Total</th>
					</tr>
				</thead>
				<tbody>
					${T} 
                </tbody>
			</table>
		</section>
		<hr class="divider" />

        <section class="totals-section total-final">
            <span class="label">**TOTAL ANULADO:**</span> <span class="value">**L ${Number(v).toFixed(2)}**</span>
        </section>
		<hr class="divider" />

		<footer class="footer-info">
			<div class="final-message">
				<h5>Este documento certifica la anulacin de la factura mencionada.</h5>
			</div>
		</footer>

	</main>
</body>
</html>`}function Sm({onBack:l}){const[i,r]=y.useState(""),[s,c]=y.useState(!1),[d,f]=y.useState(null),[g,p]=y.useState(!1),[m,b]=y.useState(!1),[S,j]=y.useState(!1),[x,w]=y.useState(!1),[v,E]=y.useState(""),T=async()=>{if(!i.trim()){E("Por favor ingresa un nmero de factura"),w(!0);return}c(!0);try{const{data:z,error:C}=await F.from("ventas").select("*").eq("factura",i.trim()).maybeSingle();if(C)throw C;if(!z){E("Factura no encontrada"),w(!0),c(!1);return}try{if(z.estado&&String(z.estado).toLowerCase()==="anulado"){E("Esta factura ya est anulada. No se puede anular nuevamente."),w(!0),c(!1);return}}catch{}try{const{data:M,error:G}=await F.from("devoluciones_ventas").select("id").eq("venta_id",z.id).limit(1);if(G)console.debug("Error checking devoluciones for anulacion:",G);else if(Array.isArray(M)&&M.length>0){E("La factura ya posee devoluciones registradas. No se puede anular."),w(!0),c(!1);return}}catch(M){console.debug("Exception checking devoluciones for anulacion:",M)}const{data:O,error:I}=await F.from("ventas_detalle").select("*").eq("venta_id",z.id);if(I)throw I;const k=await Promise.all((O||[]).map(async M=>{const{data:G}=await F.from("inventario").select("nombre, sku").eq("id",M.producto_id).maybeSingle();return{...M,nombre_producto:G?.nombre||"Producto desconocido",sku:G?.sku||""}}));f({...z,items:k}),p(!0)}catch(z){console.error("Error buscando factura:",z),E("Error al buscar la factura: "+(z.message||"Error desconocido")),w(!0)}finally{c(!1)}},L=()=>{b(!0)},R=async()=>{if(!(!d||!d.id)){c(!0);try{const z=new Date().toLocaleString("es-HN"),C=d.observaciones||"",O=C?`${C} | anulado el dia (${z})`:`anulado el dia (${z})`,{error:I}=await F.from("ventas").update({estado:"Anulado",observaciones:O}).eq("id",d.id);if(I)throw I;const k=localStorage.getItem("user"),M=k?JSON.parse(k):null,G=M&&(M.username||M.user?.username||M.name||M.user?.name)?M.username||M.user?.username||M.name||M.user?.name:"sistema",K=d.items.map(A=>({producto_id:A.producto_id,cantidad:A.cantidad,tipo_de_movimiento:"ENTRADA",referencia:`Anulacin Factura #${d.factura}`,usuario:G,fecha_salida:new Date().toISOString()})),{error:ne}=await F.from("registro_de_inventario").insert(K);ne?(console.error("Error registrando inventario:",ne),E("La factura se anul, pero hubo un error registrando el reingreso al inventario. Por favor verifique manualmente."),w(!0)):j(!0);const Y=await Ov({factura:d.factura,CAI:d.cai,cliente:d.nombre_cliente,identidad:d.rtn,fechaAnulacion:z},{carrito:d.items.map(A=>({producto:{nombre:A.nombre_producto,sku:A.sku},cantidad:A.cantidad,precio:A.precio_unitario})),total:d.total}),B=window.open("","_blank");B&&(B.document.write(Y),B.document.close(),B.focus(),setTimeout(()=>{B.print(),B.close()},500)),b(!1),p(!1),f(null),r("")}catch(z){console.error("Error anulando factura:",z),alert("Error al anular la factura: "+(z.message||"Error desconocido"))}finally{c(!1)}}};return t.jsxs("div",{style:{padding:28,maxWidth:1200,margin:"32px auto",fontSize:"13px"},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsx("h2",{style:{margin:0,fontSize:"24px",fontWeight:700,color:"#1e293b"},children:"Anulacin de Factura"}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{padding:"8px 16px",display:"flex",alignItems:"center",gap:6},children:" Volver"})]}),t.jsx("section",{style:{background:"white",padding:40,borderRadius:16,boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01)"},children:t.jsxs("div",{style:{maxWidth:540,margin:"0 auto"},children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:24},children:[t.jsx("h3",{style:{margin:"0 0 8px 0",color:"#1e293b",fontSize:"18px",fontWeight:600},children:"Buscar Factura para Anular"}),t.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"14px"},children:"Ingresa el nmero de factura completo para ver sus detalles."})]}),t.jsxs("div",{style:{position:"relative",display:"flex",gap:12,alignItems:"stretch"},children:[t.jsxs("div",{style:{position:"relative",flex:1},children:[t.jsx("div",{style:{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)",color:"#94a3b8"},children:t.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",value:i,onChange:z=>r(z.target.value),placeholder:"Ej: 000-001-01-00000001",className:"input",style:{paddingLeft:42,height:48,fontSize:"15px",borderRadius:12},onKeyDown:z=>z.key==="Enter"&&T()})]}),t.jsx("button",{onClick:T,disabled:s,className:"btn-primary",style:{width:"auto",padding:"0 24px",height:48,borderRadius:12,display:"flex",alignItems:"center",gap:8,fontSize:"15px"},children:s?t.jsx(t.Fragment,{children:"Buscando..."}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"Buscar"}),t.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})]})}),d&&t.jsx(Mn,{open:g,onClose:()=>p(!1),width:800,children:t.jsxs("div",{style:{padding:"0 8px"},children:[t.jsxs("div",{style:{borderBottom:"1px solid #e2e8f0",paddingBottom:16,marginBottom:20},children:[t.jsxs("h3",{style:{margin:"0 0 8px 0",fontSize:"20px",color:"#1e293b"},children:["Detalles de Factura #",d.factura]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:16,fontSize:"14px",color:"#475569"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Fecha:"}),t.jsx("br",{}),new Date(d.created_at).toLocaleString()]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Cliente:"}),t.jsx("br",{}),d.nombre_cliente||"Consumidor Final"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"RTN:"}),t.jsx("br",{}),d.rtn||"N/A"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Estado:"}),t.jsx("br",{}),t.jsx("span",{style:{color:d.estado==="Anulado"?"#ef4444":"#10b981",fontWeight:600},children:d.estado||"Pagada"})]})]})]}),t.jsx("div",{style:{marginBottom:24},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"2px solid #e2e8f0"},children:[t.jsx("th",{style:{textAlign:"left",padding:"12px",color:"#475569"},children:"Producto"}),t.jsx("th",{style:{textAlign:"right",padding:"12px",color:"#475569"},children:"Cant."}),t.jsx("th",{style:{textAlign:"right",padding:"12px",color:"#475569"},children:"Precio"}),t.jsx("th",{style:{textAlign:"right",padding:"12px",color:"#475569"},children:"Total"})]})}),t.jsx("tbody",{children:d.items.map((z,C)=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsxs("td",{style:{padding:"12px"},children:[t.jsx("div",{style:{fontWeight:500,color:"#1e293b"},children:z.nombre_producto}),z.sku&&t.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["SKU: ",z.sku]})]}),t.jsx("td",{style:{textAlign:"right",padding:"12px"},children:z.cantidad}),t.jsxs("td",{style:{textAlign:"right",padding:"12px"},children:["L ",Number(z.precio_unitario).toFixed(2)]}),t.jsxs("td",{style:{textAlign:"right",padding:"12px",fontWeight:500},children:["L ",Number(z.subtotal).toFixed(2)]})]},C))})]})}),t.jsxs("div",{style:{background:"#f8fafc",padding:16,borderRadius:8,display:"flex",flexDirection:"column",gap:8,alignItems:"flex-end"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:200},children:[t.jsx("span",{style:{color:"#64748b"},children:"Subtotal:"}),t.jsxs("span",{style:{fontWeight:500},children:["L ",Number(d.subtotal).toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:200},children:[t.jsx("span",{style:{color:"#64748b"},children:"Impuesto:"}),t.jsxs("span",{style:{fontWeight:500},children:["L ",Number(d.impuesto).toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:200,borderTop:"1px solid #cbd5e1",paddingTop:8,marginTop:4},children:[t.jsx("span",{style:{fontWeight:700,color:"#1e293b"},children:"Total:"}),t.jsxs("span",{style:{fontWeight:700,color:"#1e293b",fontSize:"16px"},children:["L ",Number(d.total).toFixed(2)]})]})]}),t.jsxs("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:12},children:[t.jsx("button",{onClick:()=>p(!1),className:"btn-opaque",style:{padding:"10px 20px"},children:"Cerrar"}),d.estado!=="Anulado"&&t.jsx("button",{className:"btn-primary",style:{padding:"10px 20px",background:"#ef4444",borderColor:"#ef4444"},onClick:L,children:"Anular Factura"})]})]})}),t.jsx(Tn,{open:S,title:"Anulacin",message:"Factura anulada correctamente.",onClose:()=>j(!1)}),t.jsx(Tn,{open:x,title:"Error",message:v,onClose:()=>w(!1)}),t.jsx(Mn,{open:m,onClose:()=>b(!1),width:400,children:t.jsxs("div",{style:{textAlign:"center",padding:"16px 8px"},children:[t.jsx("div",{style:{fontSize:"48px",marginBottom:16},children:""}),t.jsx("h3",{style:{margin:"0 0 12px 0",color:"#1e293b"},children:"Ests seguro?"}),t.jsxs("p",{style:{color:"#64748b",marginBottom:24},children:["Esta accin marcar la factura como ",t.jsx("strong",{children:"Anulada"})," y registrar la fecha de anulacin. Esta accin no se puede deshacer fcilmente."]}),t.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[t.jsx("button",{onClick:()=>b(!1),className:"btn-opaque",style:{padding:"10px 24px"},children:"Cancelar"}),t.jsx("button",{onClick:R,className:"btn-primary",style:{padding:"10px 24px",background:"#ef4444",borderColor:"#ef4444"},disabled:s,children:s?"Anulando...":"S, anular"})]})]})})]})}function Dv({open:l,onClose:i,onSelect:r}){const[s,c]=y.useState(""),[d,f]=y.useState(!1),[g,p]=y.useState([]);return y.useEffect(()=>{if(!l)return;let m=!0;return(async()=>{f(!0);try{const{data:b,error:S}=await F.from("clientes").select("id,nombre,rtn,telefono,correo_electronico,tipo_cliente,exonerado").order("id",{ascending:!1}).limit(100);if(S)throw S;m&&p(Array.isArray(b)?b:[])}catch(b){console.warn("Error cargando clientes:",b)}finally{m&&f(!1)}})(),()=>{m=!1}},[l]),y.useEffect(()=>{if(!l)return;const m=setTimeout(async()=>{f(!0);try{const b=String(s||"").trim();let S;if(b===""?S=await F.from("clientes").select("id,nombre,rtn,telefono,correo_electronico,tipo_cliente,exonerado").order("id",{ascending:!1}).limit(100):S=await F.from("clientes").select("id,nombre,rtn,telefono,correo_electronico,tipo_cliente,exonerado").or(`nombre.ilike.%${b}%,rtn.ilike.%${b}%`).order("id",{ascending:!1}).limit(100),S.error)throw S.error;p(Array.isArray(S.data)?S.data:[])}catch(b){console.warn("Error buscando clientes:",b)}finally{f(!1)}},250);return()=>clearTimeout(m)},[s,l]),l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:820,maxWidth:"95%",maxHeight:"80vh",overflow:"auto",background:"white",borderRadius:10,padding:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h3",{style:{margin:0},children:"Buscar Cliente"}),t.jsx("button",{onClick:i,className:"btn-opaque",children:"Cerrar"})]}),t.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{value:s,onChange:m=>c(m.target.value),placeholder:"Buscar por nombre o RTN...",style:{flex:1,padding:8,borderRadius:6,border:"1px solid #e2e8f0"}}),t.jsx("div",{style:{minWidth:100,textAlign:"right"},children:d?"Cargando...":`${g.length} encontrados`})]}),t.jsx("div",{style:{marginTop:12},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{style:{background:"#f1f5f9"},children:t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left",padding:8},children:"RTN"}),t.jsx("th",{style:{textAlign:"left",padding:8},children:"Nombre / Razn social"}),t.jsx("th",{style:{textAlign:"left",padding:8},children:"Telfono"}),t.jsx("th",{style:{textAlign:"left",padding:8},children:"Correo"}),t.jsx("th",{style:{padding:8}})]})}),t.jsxs("tbody",{children:[g.map(m=>t.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[t.jsx("td",{style:{padding:8},children:m.rtn}),t.jsx("td",{style:{padding:8},children:m.nombre}),t.jsx("td",{style:{padding:8},children:m.telefono}),t.jsx("td",{style:{padding:8},children:m.correo_electronico}),t.jsx("td",{style:{padding:8},children:t.jsx("button",{onClick:()=>{r(m),i()},className:"btn-opaque",children:"Seleccionar"})})]},String(m.id))),g.length===0&&!d&&t.jsx("tr",{children:t.jsx("td",{colSpan:5,style:{padding:16,textAlign:"center",color:"#64748b"},children:"No hay clientes"})})]})]})})]})})}):null}function Bv({open:l,onClose:i,totalDue:r,onConfirm:s,exchangeRate:c}){const[d,f]=y.useState([]),[g,p]=y.useState("efectivo"),[m,b]=y.useState(""),[S,j]=y.useState(""),[x,w]=y.useState(""),[v,E]=y.useState(""),[T,L]=y.useState(""),[R,z]=y.useState(""),[C,O]=y.useState(0),[I,k]=y.useState(null),[M,G]=y.useState(!1);y.useEffect(()=>{l||(f([]),p("efectivo"),b(""),j(""),w(""),E(""),L(""),z(""),k(null),G(!1))},[l]);const K=H=>{try{const Z=String(H??"").replace(",",".").trim();if(Z===""||Z==="-")return 0;const ee=parseFloat(Z);return Number.isFinite(ee)?ee:0}catch{return 0}},ne=()=>{const H=K(m);if(H<=0)return;const Z={id:String(Date.now())+Math.random().toString(36).slice(2,7),tipo:g,monto:Number(H.toFixed(2)),usd_monto:g==="dolares"?Number((C||0).toFixed(2)):void 0,banco:S||void 0,tarjeta:x||void 0,factura:v||void 0,autorizador:T||void 0,referencia:R||void 0};f(ee=>[...ee,Z]),b(""),j(""),w(""),E(""),L(""),z("")},Y=H=>{f(Z=>Z.filter(ee=>ee.id!==H))},B=d.filter(H=>H.tipo==="efectivo").reduce((H,Z)=>H+Z.monto,0),A=d.filter(H=>H.tipo==="tarjeta").reduce((H,Z)=>H+Z.monto,0),N=d.filter(H=>H.tipo==="transferencia").reduce((H,Z)=>H+Z.monto,0),q=d.filter(H=>H.tipo==="dolares").reduce((H,Z)=>H+Z.monto,0),X=Number((B+A+N+q).toFixed(2)),ge=Number((r-X).toFixed(2)),re=X>=r&&X>0,U=H=>new Intl.NumberFormat("es-HN",{style:"currency",currency:"HNL"}).format(H).replace("HNL","L"),$=()=>{(async()=>{const H=[];B>0&&H.push(`efectivo:(${B.toFixed(2)})`),A>0&&H.push(`tarjeta:(${A.toFixed(2)})`),N>0&&H.push(`transferencia:(${N.toFixed(2)})`);const Z=H.join(",");try{G(!0),await new Promise(ee=>setTimeout(ee,1500)),await s({efectivo:B,tarjeta:A,transferencia:N,totalPaid:X,tipoPagoString:Z,pagos:d})}catch(ee){console.warn("Error en handleConfirm:",ee)}finally{try{G(!1)}catch{}try{i()}catch{}}})()};return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:11e3},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:1100,maxWidth:"99%",background:"white",borderRadius:10,padding:16,maxHeight:"94vh",overflow:"auto"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h3",{style:{margin:0},children:"Registrar Pago"}),t.jsx("button",{onClick:i,className:"btn-opaque",children:"Cerrar"})]}),t.jsxs("div",{style:{marginTop:10,display:"grid",gridTemplateColumns:"1fr 420px",gap:14,fontSize:13},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:8},children:["Total a pagar: ",t.jsx("strong",{children:U(r)})]}),t.jsx("div",{style:{border:"1px solid #e6edf3",borderRadius:8,padding:6,marginBottom:12,fontSize:13},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{textAlign:"left",borderBottom:"1px solid #efefef"},children:[t.jsx("th",{children:"Tipo"}),t.jsx("th",{children:"Monto"}),t.jsx("th",{children:"Detalles"}),t.jsx("th",{})]})}),t.jsxs("tbody",{children:[d.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:4,style:{padding:12,color:"#666"},children:"No hay pagos registrados"})}),d.map(H=>t.jsxs("tr",{style:{borderBottom:"1px solid #f5f5f5"},children:[t.jsx("td",{style:{padding:"6px 4px"},children:H.tipo}),t.jsx("td",{style:{padding:"6px 4px"},children:U(H.monto)}),t.jsxs("td",{style:{padding:"6px 4px",fontSize:12},children:[H.tipo==="efectivo"&&t.jsx("span",{children:""}),H.tipo==="tarjeta"&&t.jsxs("span",{children:[H.banco||"-"," / ",H.tarjeta||"-"," /"," ",H.factura||"-"]}),H.tipo==="transferencia"&&t.jsxs("span",{children:[H.banco||"-"," / ",H.referencia||"-"]})]}),t.jsx("td",{style:{padding:"8px 4px",textAlign:"right"},children:t.jsx("button",{onClick:()=>k(H.id),className:"btn-opaque","aria-label":"Eliminar pago",title:"Eliminar pago",style:{background:"transparent",border:"none",padding:6,cursor:"pointer",color:"#ef4444"},children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",focusable:"false",children:[t.jsx("polyline",{points:"3 6 5 6 21 6"}),t.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),t.jsx("path",{d:"M10 11v6"}),t.jsx("path",{d:"M14 11v6"}),t.jsx("path",{d:"M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"})]})})})]},H.id))]})]})}),t.jsxs("div",{style:{display:"flex",gap:10,marginBottom:8,fontSize:13},children:[t.jsxs("div",{style:{padding:6,borderRadius:6,border:"1px solid #e6edf3",minWidth:140},children:[t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Efectivo"}),t.jsx("div",{style:{fontWeight:600},children:U(B)})]}),t.jsxs("div",{style:{padding:6,borderRadius:6,border:"1px solid #e6edf3",minWidth:140},children:[t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Tarjeta"}),t.jsx("div",{style:{fontWeight:600},children:U(A)})]}),t.jsxs("div",{style:{padding:6,borderRadius:6,border:"1px solid #e6edf3",minWidth:140},children:[t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Transferencia"}),t.jsx("div",{style:{fontWeight:600},children:U(N)})]}),t.jsxs("div",{style:{marginLeft:"auto",textAlign:"right"},children:[t.jsx("div",{style:{fontSize:12,color:"#666"},children:"Total ingresado"}),t.jsx("div",{style:{fontWeight:700},children:U(X)}),t.jsx("div",{style:{marginTop:6,color:ge>0?"#ef4444":"#16a34a"},children:ge>0?`Falta ${U(ge)}`:`Cambio ${U(Math.abs(ge))}`})]})]})]}),t.jsxs("div",{style:{border:"1px solid #e6edf3",borderRadius:8,padding:10,fontSize:13},children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Tipo de pago"}),t.jsxs("select",{value:g,onChange:H=>{p(H.target.value),b(""),O(0),j(""),w(""),E(""),L(""),z("")},style:{width:"100%",padding:6,borderRadius:6,fontSize:13},children:[t.jsx("option",{value:"efectivo",children:"Efectivo"}),t.jsx("option",{value:"tarjeta",children:"Tarjeta"}),t.jsx("option",{value:"transferencia",children:"Transferencia"}),t.jsx("option",{value:"dolares",children:"Dlares"})]})]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Monto"}),g==="dolares"?t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"$"}),t.jsx("input",{type:"number",min:0,step:"0.01",value:C,onChange:H=>{const Z=K(H.target.value);O(Z);const ee=Number((Z*c).toFixed(2));b(String(ee))},style:{width:"100%",padding:6,borderRadius:6,fontSize:13}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"L (convertido)"}),t.jsx("input",{type:"number",min:0,step:"0.01",value:m,readOnly:!0,style:{width:"100%",padding:6,borderRadius:6,fontSize:13,background:"#f9fafb"}})]})]}):t.jsx("input",{type:"number",min:0,step:"0.01",value:m,onChange:H=>b(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13}})]}),g==="dolares"&&t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Tipo de cambio (Lps por $)"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("div",{style:{fontSize:14,fontWeight:600},children:[c.toFixed(2)," L"]}),t.jsx("div",{style:{fontSize:13,color:"#666"},children:"(Editable en el encabezado de Punto de Ventas)"})]})]}),g==="efectivo"&&t.jsx("div",{style:{fontSize:13,color:"#444",marginBottom:8},children:'Pago en efectivo: solo indique el monto y presione "Agregar".'}),g==="tarjeta"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Banco"}),t.jsxs("select",{value:S,onChange:H=>j(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13},children:[t.jsx("option",{value:"",children:"-- Seleccionar banco --"}),t.jsx("option",{value:"BAC Honduras",children:"BAC Honduras "}),t.jsx("option",{value:"Banco Atlntida",children:"Banco Atlntida"}),t.jsxs("option",{value:"Banco de Occidente",children:["Banco de Occidente"," "]}),t.jsx("option",{value:"Banco Ficohsa",children:"Banco Ficohsa"}),t.jsx("option",{value:"Banco Banpas",children:"Banco Banpas "}),t.jsxs("option",{value:"Banco Davivienda",children:["Banco Davivienda"," "]}),t.jsx("option",{value:"Banco Promrica",children:"Banco Promrica"}),t.jsx("option",{value:"Banco Lafise",children:"Banco Lafise"}),t.jsx("option",{value:"Banco Ficensa",children:"Banco Ficensa"}),t.jsxs("option",{value:"Banco de los Trabajadores",children:["Banco de los Trabajadores"," "]}),t.jsx("option",{value:"Banco Azteca",children:"Banco Azteca"}),t.jsx("option",{value:"Banrural Honduras",children:"Banrural Honduras"}),t.jsx("option",{value:"Banco Hondureo del Caf",children:"Banco Hondureo del Caf"})]})]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Tarjeta (ltimos 4)"}),t.jsx("input",{value:x,onChange:H=>w(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13}})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Factura"}),t.jsx("input",{value:v,onChange:H=>E(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Autorizador"}),t.jsx("input",{value:T,onChange:H=>L(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13}})]})]})]}),g==="transferencia"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Banco"}),t.jsxs("select",{value:S,onChange:H=>j(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13},children:[t.jsx("option",{value:"",children:"-- Seleccionar banco --"}),t.jsx("option",{value:"BAC Honduras",children:"BAC Honduras  (Banco de Amrica Central Honduras)"}),t.jsx("option",{value:"Banco Atlntida",children:"Banco Atlntida"}),t.jsx("option",{value:"Banco de Occidente",children:"Banco de Occidente  Banocc"}),t.jsx("option",{value:"Banco Ficohsa",children:"Banco Ficohsa"}),t.jsx("option",{value:"Banco Banpas",children:"Banco Banpas  (Banco del Pas)"}),t.jsx("option",{value:"Banco Davivienda",children:"Banco Davivienda  Davi"}),t.jsx("option",{value:"Banco Promrica",children:"Banco Promrica"}),t.jsx("option",{value:"Banco Lafise",children:"Banco Lafise"}),t.jsx("option",{value:"Banco Ficensa",children:"Banco Ficensa"}),t.jsx("option",{value:"Banco de los Trabajadores",children:"Banco de los Trabajadores  BanTrab"}),t.jsx("option",{value:"Banco Azteca",children:"Banco Azteca"}),t.jsx("option",{value:"Banrural Honduras",children:"Banrural Honduras"}),t.jsx("option",{value:"Banco Hondureo del Caf",children:"Banco Hondureo del Caf"})]})]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Referencia"}),t.jsx("input",{value:R,onChange:H=>z(H.target.value),style:{width:"100%",padding:6,borderRadius:6,fontSize:13}})]})]}),t.jsxs("div",{style:{display:"flex",gap:8,marginTop:10},children:[t.jsx("button",{onClick:ne,className:"btn-opaque",style:{background:"#0ea5a4",color:"white",padding:"6px 10px",borderRadius:6,fontSize:13},children:"Agregar"}),t.jsx("button",{onClick:()=>{b(String((r-X).toFixed(2)))},className:"btn-opaque",style:{background:"transparent",fontSize:13},children:"Exacto"})]})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent",fontSize:13,padding:"6px 10px"},children:"Cancelar"}),t.jsx("button",{onClick:$,className:"btn-opaque",disabled:!re,style:{background:re?"#16a34a":"gray",color:"white",fontSize:13,padding:"6px 12px"},children:"Registrar y guardar venta"})]}),I&&t.jsx("div",{role:"dialog","aria-modal":"true",onClick:()=>k(null),style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:12e3},children:t.jsxs("div",{onClick:H=>H.stopPropagation(),style:{width:360,background:"white",borderRadius:8,padding:14,boxShadow:"0 10px 30px rgba(0,0,0,0.15)",position:"relative"},children:[t.jsx("button",{"aria-label":"Cerrar",title:"Cerrar",onClick:()=>k(null),style:{position:"absolute",right:8,top:8,background:"transparent",border:"none",padding:6,cursor:"pointer",color:"#666"},children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),t.jsx("div",{style:{fontWeight:700,marginBottom:6},children:"Confirmar eliminacin"}),t.jsx("div",{style:{marginBottom:12},children:"Eliminar este pago? Esta accin no se puede deshacer."}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{onClick:()=>k(null),className:"btn-opaque",style:{background:"transparent",padding:"6px 10px"},children:"Cancelar"}),t.jsx("button",{onClick:()=>{I&&(Y(I),k(null))},className:"btn-opaque",style:{background:"#ef4444",color:"white",padding:"6px 10px"},children:"Eliminar"})]})]})}),M&&t.jsx("div",{role:"status","aria-live":"polite",style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:12500,background:"rgba(2,6,23,0.6)"},children:t.jsxs("div",{style:{background:"rgba(255,255,255,0.98)",padding:18,borderRadius:10,display:"flex",flexDirection:"column",alignItems:"center",gap:12,boxShadow:"0 10px 30px rgba(0,0,0,0.25)"},children:[t.jsx("svg",{width:"56",height:"56",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:t.jsxs("g",{transform:"translate(0,0)",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#e6edf3",strokeWidth:"3",fill:"none"}),t.jsx("path",{d:"M22 12a10 10 0 0 1-10 10",stroke:"#0ea5a4",strokeWidth:"3",strokeLinecap:"round",children:t.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 12 12",to:"360 12 12",dur:"1s",repeatCount:"indefinite"})})]})}),t.jsx("div",{style:{fontSize:15,fontWeight:700},children:"Generando factura"})]})})]})})}):null}function Uv({productos:l,imageUrls:i,agregarAlCarrito:r,openUbicacion:s,thStyle:c,tdStyle:d,skuStyle:f}){return t.jsx("div",{style:{maxHeight:"70vh",overflowY:"auto",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.08)"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",background:"white"},children:[t.jsx("thead",{style:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",position:"sticky",top:0,zIndex:10,boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:t.jsxs("tr",{children:[t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9"},children:t.jsx("span",{title:"Ubicacin",children:""})}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9"},children:"Imagen"}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9"},children:"SKU"}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9",textAlign:"left"},children:"Producto"}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9"},children:"Categora"}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9",textAlign:"right"},children:"Precio"}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9",textAlign:"center"},children:"Stock"}),t.jsx("th",{style:{...c,color:"white",padding:"12px 10px",fontSize:12,fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",borderBottom:"2px solid #0ea5e9",textAlign:"center"},children:"Accin"})]})}),t.jsx("tbody",{children:l.length===0?t.jsx("tr",{children:t.jsxs("td",{colSpan:8,style:{textAlign:"center",padding:60,color:"#94a3b8",fontSize:"1rem",background:"#fafbfc"},children:[t.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),t.jsx("div",{style:{fontWeight:500},children:"No se encontraron productos"}),t.jsx("div",{style:{fontSize:14,marginTop:8,color:"#cbd5e1"},children:"Intenta ajustar los filtros de bsqueda"})]})}):l.map((g,p)=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",transition:"all 0.15s ease",background:p%2===0?"white":"#fafbfc"},onMouseEnter:m=>{m.currentTarget.style.background="#f0f9ff",m.currentTarget.style.transform="scale(1.005)"},onMouseLeave:m=>{m.currentTarget.style.background=p%2===0?"white":"#fafbfc",m.currentTarget.style.transform="scale(1)"},children:[t.jsx("td",{style:{...d,padding:"10px",textAlign:"center"},children:t.jsx("button",{type:"button",onClick:()=>s(g.sku||""),title:"Ver ubicacin",className:"btn-opaque",style:{padding:"5px 8px",borderRadius:6,fontSize:14,background:"#f1f5f9",border:"1px solid #e2e8f0",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:m=>{m.currentTarget.style.background="#0ea5e9",m.currentTarget.style.transform="scale(1.1)"},onMouseLeave:m=>{m.currentTarget.style.background="#f1f5f9",m.currentTarget.style.transform="scale(1)"},children:""})}),t.jsx("td",{style:{...d,padding:"10px",textAlign:"center"},children:i[String(g.id)]?t.jsx("img",{src:encodeURI(i[String(g.id)]),alt:String(g.nombre||""),style:{width:40,height:40,objectFit:"cover",borderRadius:6,border:"2px solid #e2e8f0",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},onError:m=>{m.currentTarget.src=""}}):g.imagen?t.jsx("img",{src:String(g.imagen),alt:String(g.nombre||""),style:{width:40,height:40,objectFit:"cover",borderRadius:6,border:"2px solid #e2e8f0",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},onError:m=>{m.currentTarget.src=""}}):t.jsx("div",{style:{width:40,height:40,borderRadius:6,background:"#f1f5f9",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:""})}),t.jsx("td",{style:{...d,padding:"10px"},children:t.jsx("code",{style:{...f,background:"#f1f5f9",padding:"3px 7px",borderRadius:5,fontSize:11,fontWeight:600,color:"#475569",border:"1px solid #e2e8f0"},children:g.sku})}),t.jsx("td",{style:{...d,padding:"10px"},children:t.jsx("div",{style:{fontWeight:600,color:"#1e293b",fontSize:13},children:g.nombre})}),t.jsx("td",{style:{...d,padding:"10px",textAlign:"center"},children:t.jsx("span",{style:{color:"#64748b",fontSize:12,background:"#f8fafc",padding:"3px 8px",borderRadius:5,display:"inline-block"},children:g.categoria||"-"})}),t.jsx("td",{style:{...d,padding:"10px",textAlign:"right"},children:t.jsxs("span",{style:{fontWeight:700,color:"#059669",fontSize:14},children:["L",Number(g.precio||0).toFixed(2)]})}),t.jsx("td",{style:{...d,padding:"10px",textAlign:"center"},children:(()=>{if(String(g.categoria||"").toUpperCase().includes("SERVICIO"))return t.jsx("span",{style:{color:"#64748b",fontSize:12,fontStyle:"italic"},children:"N/A"});const b=Number(g.stock||0),S=b>10?"#16a34a":b>0?"#d97706":"#dc2626",j=b>10?"#f0fdf4":b>0?"#fef3c7":"#fef2f2";return t.jsx("span",{style:{color:S,fontWeight:700,fontSize:13,background:j,padding:"3px 10px",borderRadius:5,display:"inline-block",minWidth:35,border:`1px solid ${S}20`},children:b})})()}),t.jsx("td",{style:{...d,padding:"10px",textAlign:"center"},children:(()=>{const m=Number(g.stock||0),b=Number(g.precio||0),S=g.tipo==="servicio",j=b<=0||!S&&m<1,x=j?b<=0?"Sin precio":"Agotado":"+ Agregar";return t.jsx("button",{onClick:()=>r(g),disabled:j,className:"btn-opaque",style:{padding:"7px 14px",borderRadius:7,fontSize:12,fontWeight:600,background:j?"#f1f5f9":"#0ea5e9",color:j?"#94a3b8":"white",border:j?"1px solid #e2e8f0":"none",cursor:j?"not-allowed":"pointer",transition:"all 0.15s ease",boxShadow:j?"none":"0 2px 4px rgba(14, 165, 233, 0.3)"},title:j?b<=0?"El producto no tiene precio vlido":"No hay stock disponible":S?"Agregar servicio al carrito":"Agregar al carrito",onMouseEnter:w=>{j||(w.currentTarget.style.background="#0284c7",w.currentTarget.style.transform="translateY(-2px)",w.currentTarget.style.boxShadow="0 4px 8px rgba(14, 165, 233, 0.4)")},onMouseLeave:w=>{j||(w.currentTarget.style.background="#0ea5e9",w.currentTarget.style.transform="translateY(0)",w.currentTarget.style.boxShadow="0 2px 4px rgba(14, 165, 233, 0.3)")},children:x})})()})]},g.id))})]})})}function Lv({carrito:l,actualizarCantidad:i,eliminarDelCarrito:r,vaciarCarrito:s,subtotal:c,perItemTaxes:d,taxRate:f,tax18Rate:g,taxTouristRate:p,total:m,openSelector:b,btnStyle:S}){return t.jsxs("div",{style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:16,padding:20,boxShadow:"0 8px 24px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08)",height:"fit-content",position:"sticky",top:16,alignSelf:"start",border:"1px solid #e2e8f0"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,paddingBottom:12,borderBottom:"2px solid #e2e8f0"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[t.jsx("span",{style:{fontSize:24},children:""}),t.jsx("h3",{style:{margin:0,fontSize:"1.2rem",fontWeight:700,color:"#1e293b"},children:"Carrito"}),l.length>0&&t.jsx("span",{style:{background:"linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",color:"white",padding:"2px 10px",borderRadius:12,fontSize:13,fontWeight:700},children:l.length})]}),l.length>0&&t.jsx("button",{onClick:s,className:"btn-opaque",style:{background:"#fef2f2",color:"#dc2626",fontSize:"0.85rem",padding:"6px 12px",borderRadius:8,fontWeight:600,border:"1px solid #fecaca",transition:"all 0.2s ease"},onMouseEnter:j=>{j.currentTarget.style.background="#dc2626",j.currentTarget.style.color="white"},onMouseLeave:j=>{j.currentTarget.style.background="#fef2f2",j.currentTarget.style.color="#dc2626"},children:" Vaciar"})]}),l.length>0&&t.jsxs("div",{style:{background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",border:"2px solid #0ea5e9",borderRadius:12,padding:16,marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.5rem",fontWeight:800,marginBottom:12,color:"#0c4a6e",paddingBottom:12,borderBottom:"2px dashed #0ea5e9"},children:[t.jsx("span",{children:"TOTAL:"}),t.jsxs("span",{children:["L",m.toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:600,fontSize:14,color:"#475569",marginBottom:6},children:[t.jsx("span",{children:"Subtotal:"}),t.jsxs("span",{children:["L",c.toFixed(2)]})]}),t.jsxs("div",{style:{fontSize:13,color:"#64748b",marginTop:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsxs("span",{children:["ISV (",f*100,"%):"]}),t.jsxs("strong",{style:{color:"#475569"},children:["L",Number(d.reduce((j,x)=>j+(x.isv||0),0)).toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsx("span",{children:"Impuesto 18%:"}),t.jsxs("strong",{style:{color:"#475569"},children:["L",Number(d.reduce((j,x)=>j+(x.imp18||0),0)).toFixed(2)]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs("span",{children:["Imp. Turstico (",p*100,"%):"]}),t.jsxs("strong",{style:{color:"#475569"},children:["L",Number(d.reduce((j,x)=>j+(x.tur||0),0)).toFixed(2)]})]})]}),t.jsxs("details",{style:{marginTop:12},children:[t.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#0284c7",fontWeight:600,padding:"6px 0",userSelect:"none"},children:" Ver desglose detallado"}),t.jsx("div",{style:{marginTop:8,fontSize:11},children:d.map(j=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"6px 8px",borderBottom:"1px dashed #bae6fd",background:"white",borderRadius:4,marginBottom:4},children:[t.jsx("div",{style:{color:"#0f172a",fontWeight:600},children:j.nombre}),t.jsxs("div",{style:{color:"#64748b",fontSize:10},children:["ISV: L",j.isv.toFixed(2),"  18%: L",j.imp18.toFixed(2),"  Tur: L",j.tur.toFixed(2)]})]},String(j.id)))})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginTop:16},children:[t.jsx("button",{onClick:()=>b("cotizacion"),className:"btn-opaque",style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",color:"white",padding:"12px 16px",borderRadius:10,fontWeight:700,fontSize:14,border:"none",boxShadow:"0 4px 8px rgba(245, 158, 11, 0.3)",transition:"all 0.2s ease"},onMouseEnter:j=>{j.currentTarget.style.transform="translateY(-2px)",j.currentTarget.style.boxShadow="0 6px 12px rgba(245, 158, 11, 0.4)"},onMouseLeave:j=>{j.currentTarget.style.transform="translateY(0)",j.currentTarget.style.boxShadow="0 4px 8px rgba(245, 158, 11, 0.3)"},children:" Cotizacin"}),t.jsx("button",{onClick:()=>b("factura"),className:"btn-opaque",style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"white",padding:"12px 16px",borderRadius:10,fontWeight:700,fontSize:14,border:"none",boxShadow:"0 4px 8px rgba(16, 185, 129, 0.3)",transition:"all 0.2s ease"},onMouseEnter:j=>{j.currentTarget.style.transform="translateY(-2px)",j.currentTarget.style.boxShadow="0 6px 12px rgba(16, 185, 129, 0.4)"},onMouseLeave:j=>{j.currentTarget.style.transform="translateY(0)",j.currentTarget.style.boxShadow="0 4px 8px rgba(16, 185, 129, 0.3)"},children:" Facturar"})]})]}),l.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:"#94a3b8",background:"#f8fafc",borderRadius:12,border:"2px dashed #e2e8f0"},children:[t.jsx("div",{style:{fontSize:48,marginBottom:12},children:""}),t.jsx("div",{style:{fontWeight:600,fontSize:16,marginBottom:4},children:"Carrito vaco"}),t.jsx("div",{style:{fontSize:13},children:"Agrega productos para comenzar"})]}):t.jsx("div",{style:{maxHeight:"40vh",overflowY:"auto",paddingRight:4},children:l.map((j,x)=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",marginBottom:8,background:x%2===0?"white":"#f8fafc",borderRadius:10,border:"1px solid #e2e8f0",transition:"all 0.2s ease"},onMouseEnter:w=>{w.currentTarget.style.background="#f0f9ff",w.currentTarget.style.borderColor="#0ea5e9",w.currentTarget.style.transform="scale(1.02)"},onMouseLeave:w=>{w.currentTarget.style.background=x%2===0?"white":"#f8fafc",w.currentTarget.style.borderColor="#e2e8f0",w.currentTarget.style.transform="scale(1)"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontWeight:600,fontSize:"0.9rem",color:"#1e293b",marginBottom:4},children:j.producto.nombre}),t.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[t.jsx("code",{style:{background:"#f1f5f9",padding:"2px 6px",borderRadius:4,fontSize:11,fontWeight:600},children:j.producto.sku}),t.jsxs("span",{style:{marginLeft:8},children:["L",Number(j.producto.precio||0).toFixed(2)," c/u"]})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("button",{onClick:()=>i(j.producto.id,-1),style:{...S,background:"#f1f5f9",color:"#475569",width:28,height:28,borderRadius:6,fontWeight:700,fontSize:16,border:"1px solid #e2e8f0"},onMouseEnter:w=>{w.currentTarget.style.background="#0ea5e9",w.currentTarget.style.color="white"},onMouseLeave:w=>{w.currentTarget.style.background="#f1f5f9",w.currentTarget.style.color="#475569"},children:""}),t.jsx("span",{style:{minWidth:32,textAlign:"center",fontWeight:700,fontSize:15,color:"#1e293b"},children:j.cantidad}),t.jsx("button",{onClick:()=>i(j.producto.id,1),style:{...S,background:"#f1f5f9",color:"#475569",width:28,height:28,borderRadius:6,fontWeight:700,fontSize:16,border:"1px solid #e2e8f0"},onMouseEnter:w=>{w.currentTarget.style.background="#0ea5e9",w.currentTarget.style.color="white"},onMouseLeave:w=>{w.currentTarget.style.background="#f1f5f9",w.currentTarget.style.color="#475569"},children:"+"}),t.jsx("button",{onClick:()=>r(j.producto.id),style:{...S,background:"#fef2f2",color:"#dc2626",width:28,height:28,borderRadius:6,fontWeight:700,fontSize:18,border:"1px solid #fecaca"},onMouseEnter:w=>{w.currentTarget.style.background="#dc2626",w.currentTarget.style.color="white"},onMouseLeave:w=>{w.currentTarget.style.background="#fef2f2",w.currentTarget.style.color="#dc2626"},children:""})]})]},j.producto.id))})]})}function Iv({userName:l,userRole:i,userId:r,caiInfo:s,onOpenDatosFactura:c,onLogout:d,onNavigate:f,onPrintFormatChange:g,onOpenCajaConfig:p,printFormat:m}){const[b,S]=y.useState(!1),[j,x]=y.useState(!1),w=y.useRef(null),[v,E]=y.useState(null),[T,L]=y.useState(null),[R,z]=y.useState(null);return y.useEffect(()=>{try{const C=localStorage.getItem("user");if(C){const O=JSON.parse(C),I=O?.name||O?.full_name||O?.user?.name||O?.user?.full_name||O?.user?.user_metadata?.full_name||O?.user?.user_metadata?.name||O?.username||null;I&&z(String(I))}}catch{}},[l]),y.useEffect(()=>{function C(O){w.current&&!w.current.contains(O.target)&&S(!1)}return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[]),y.useEffect(()=>{let C=!0;return(async()=>{try{const O=await wa();if(!C||!O)return;const I=O.nombre||O.comercio||O.name||null,k=O.logoUrl||O.logo||null;I&&E(String(I)),k&&L(String(k))}catch{}})(),()=>{C=!1}},[]),t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
        .pv-zoom-modal { animation: pv-zoom-in 220ms ease-out both; transform-origin: center; }
        @keyframes pv-zoom-in {
          from { opacity: 0; transform: scale(0.96) translateY(-6px); }
          to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .pv-backdrop { background: rgba(2,6,23,0.6); }
        .pv-logout-title { font-size: 1.05rem; font-weight: 800; }
        .pv-logout-body { color: #334155; margin-top: 6px; margin-bottom: 10px; }
        
        /* Responsivo para tablets */
        @media (max-width: 1024px) {
          .pv-header {
            position: sticky !important;
            top: 0 !important;
            z-index: 100 !important;
            padding: 10px 14px !important;
          }
          .pv-header-title {
            font-size: 0.9rem !important;
          }
          .pv-header-username {
            font-size: 0.8rem !important;
          }
          .pv-header-logo {
            width: 32px !important;
            height: 32px !important;
          }
        }
        @media (max-width: 768px) {
          .pv-header {
            padding: 8px 12px !important;
          }
          .pv-header-title {
            font-size: 0.85rem !important;
          }
          .pv-header-center {
            display: none !important;
          }
        }
      `}),t.jsxs("header",{className:"pv-header",style:{background:"#1e293b",color:"white",padding:"14px 20px",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",position:"sticky",top:0,zIndex:100},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[T?t.jsx("img",{src:T,alt:"logo",className:"pv-header-logo",style:{width:40,height:40,objectFit:"contain",borderRadius:6}}):null,t.jsx("div",{className:"pv-header-title",style:{margin:0,fontSize:"1.05rem",fontWeight:700},children:v||"Punto de Ventas"})]}),t.jsx("div",{className:"pv-header-center",style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",pointerEvents:"none"},children:t.jsx("div",{className:"pv-header-username",style:{fontSize:"0.95rem",color:"#e2e8f0",fontWeight:500},children:R||(l?`${l}`:"")})}),t.jsxs("div",{style:{position:"relative"},ref:w,children:[t.jsx("button",{onClick:()=>S(C=>!C),"aria-expanded":b,className:"btn-opaque",style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:8},children:"Menu "}),b&&t.jsxs("div",{style:{position:"absolute",right:0,marginTop:8,background:"white",color:"#0b1724",borderRadius:8,boxShadow:"0 8px 24px rgba(2,6,23,0.16)",minWidth:220,zIndex:60,overflow:"hidden"},children:[t.jsx("button",{onClick:()=>{S(!1),c&&c()},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Datos de factura"}),t.jsx("button",{onClick:()=>{S(!1),p&&p()},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Configuracin de caja"}),t.jsx("button",{onClick:()=>{S(!1),f("CotizacionesGuardadas")},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Cotizaciones guardadas"}),t.jsx("button",{onClick:()=>{S(!1),f("PedidosEnLinea")},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Pedidos en lnea"}),t.jsx("button",{onClick:()=>{S(!1),f("IngresoEfectivo")},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Movimientos de caja"}),t.jsx("button",{onClick:()=>{S(!1),f("DevolucionCaja")},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Devolucin de caja"}),t.jsx("button",{onClick:()=>{S(!1),f("CorteCajaParcial")},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Corte de caja"}),t.jsx("button",{onClick:()=>{S(!1),f("AnulacionFactura")},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Anulacin de factura"}),t.jsx("button",{onClick:()=>{S(!1),x(!0)},className:"btn-opaque",style:{width:"100%",background:"transparent",color:"#0b1724",padding:"10px 12px",textAlign:"left"},children:"Cerrar Sesin"})]}),j&&t.jsx("div",{role:"dialog","aria-modal":"true",className:"pv-backdrop",style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:12e3},onClick:()=>x(!1),children:t.jsxs("div",{onClick:C=>C.stopPropagation(),className:"pv-zoom-modal",style:{width:380,background:"white",borderRadius:10,padding:18,boxShadow:"0 18px 40px rgba(2,6,23,0.35)"},children:[t.jsx("div",{style:{display:"flex",alignItems:"center",gap:12},children:t.jsxs("div",{children:[t.jsx("div",{className:"pv-logout-title",children:"Confirmar cierre de sesin"}),t.jsx("div",{className:"pv-logout-body",children:" Deseas continuar?"})]})}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[t.jsx("button",{onClick:()=>x(!1),className:"btn-opaque",style:{background:"transparent",padding:"8px 12px",borderRadius:8},children:"Cancelar"}),t.jsx("button",{onClick:()=>{x(!1);try{d()}catch{}},className:"btn-opaque",style:{background:"#ef4444",color:"white",padding:"8px 12px",borderRadius:8},children:"Cerrar sesin"})]})]})})]})]})]})}function Mv({open:l,onClose:i,printFormat:r,onPrintFormatChange:s,exchangeRate:c,onExchangeRateChange:d}){const[f,g]=y.useState(c||0),[p,m]=y.useState(r||"carta");if(y.useEffect(()=>{g(c||0)},[c,l]),y.useEffect(()=>{m(r||"carta")},[r,l]),!l)return null;const b=()=>{try{s(p)}catch{}try{d(Number((f||0).toFixed(2)))}catch{}i()};return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:12e3},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:420,background:"white",borderRadius:10,padding:16,boxShadow:"0 8px 30px rgba(0,0,0,0.2)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[t.jsx("h4",{style:{margin:0},children:"Configuracin de caja"}),t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent",color:"#0b1724",border:"1px solid rgba(16,24,40,0.06)",padding:"6px 10px"},children:"Cerrar"})]}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{display:"block",marginBottom:8},children:"Impresin"}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{onClick:()=>m("carta"),className:"btn-opaque",style:{padding:"6px 10px",background:p==="carta"?"#0ea5e9":"transparent",color:p==="carta"?"white":"#0b1724"},children:"Carta"}),t.jsx("button",{onClick:()=>m("cinta"),className:"btn-opaque",style:{padding:"6px 10px",background:p==="cinta"?"#0ea5e9":"transparent",color:p==="cinta"?"white":"#0b1724"},children:"Cinta"})]})]}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{display:"block",marginBottom:8},children:"Tipo de cambio Lps / $"}),t.jsx("input",{type:"number",min:0,step:"0.01",value:f,onChange:S=>g(Number(S.target.value||0)),style:{width:"100%",padding:8,borderRadius:6,border:"1px solid #e6edf3"}})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:8},children:[t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent",color:"#0b1724",border:"1px solid rgba(16,24,40,0.06)",padding:"8px 12px"},children:"Cancelar"}),t.jsx("button",{onClick:b,className:"btn-opaque",style:{background:"#16a34a",color:"white"},children:"Guardar"})]})]})})})}function qv({open:l,onClose:i,caiInfo:r,onRefresh:s}){const[c,d]=Dr.useState(!1);return t.jsx(Mn,{open:l,onClose:i,width:520,children:t.jsxs("div",{children:[t.jsx("h3",{style:{marginTop:0},children:"Datos de factura"}),t.jsxs("div",{style:{color:"#475569",marginTop:8},children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"CAI:"})," ",r?.cai??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Identificador:"})," ",r?.identificador??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Rango desde:"})," ",r?.rango_de??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Rango hasta:"})," ",r?.rango_hasta??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Fecha lmite emisin:"})," ",r?.fecha_vencimiento??r?.fecha_limite_emision??"-"]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Secuencia actual:"})," ",r?.secuencia_actual??"-"]})]}),t.jsxs("div",{style:{marginTop:18,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:i,style:{padding:"8px 12px"},children:"Cerrar"}),t.jsx("button",{className:"btn-opaque",style:{padding:"8px 12px"},disabled:c,onClick:async()=>{if(s)try{d(!0),await s()}catch(f){console.debug("Error calling onRefresh from DatosFacturaModal:",f)}finally{d(!1)}},children:c?"Actualizando...":"Actualizar"})]})]})})}function $v({open:l,selectedEntrada:i,onClose:r,imageUrls:s}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:520,maxWidth:"95%",background:"white",borderRadius:10,padding:18,boxShadow:"0 12px 40px rgba(2,6,23,0.3)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:i?i.producto:"Ubicacin"}),t.jsx("button",{onClick:r,className:"btn-opaque",style:{padding:"6px 10px"},children:"Cerrar"})]}),i?t.jsx("div",{children:t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[(()=>{const c=i.id?s[String(i.id)]??i.imagen:i.imagen;return c?t.jsx("img",{src:encodeURI(String(c)),alt:i.producto,style:{width:320,height:200,objectFit:"cover",borderRadius:8,flexShrink:0},onError:d=>{d.currentTarget.src=""}}):t.jsx("div",{style:{width:320,height:200,background:"#f1f5f9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:"Sin imagen"})})(),t.jsxs("div",{style:{flex:1},children:[t.jsxs("p",{style:{margin:"6px 0"},children:[t.jsx("strong",{children:"SKU:"})," ",i.sku]}),t.jsxs("p",{style:{margin:"6px 0"},children:[t.jsx("strong",{children:"Descripcin:"})," ",i.descripcion]}),t.jsxs("div",{style:{marginTop:8,padding:8,borderRadius:8,background:"#f8fafc"},children:[t.jsxs("p",{style:{margin:0},children:[t.jsx("strong",{children:"Seccin:"})," ",i.ubicacion?.seccion]}),t.jsxs("p",{style:{margin:0},children:[t.jsx("strong",{children:"Bloque:"})," ",i.ubicacion?.bloque]}),t.jsxs("p",{style:{margin:0},children:[t.jsx("strong",{children:"Estante:"})," ",i.ubicacion?.estante]})]}),t.jsx("p",{style:{marginTop:8,color:"#6b7280"},children:t.jsxs("small",{children:["Cantidad: ",i.cantidad]})})]})]})}):t.jsx("div",{children:t.jsx("p",{children:"No se encontr informacin de ubicacin para este artculo."})})]})})}):null}function Hv({open:l,onClose:i,onCancel:r,onSave:s}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:520,maxWidth:"95%",background:"white",borderRadius:12,padding:20,boxShadow:"0 18px 50px rgba(2,6,23,0.35)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:"Guardar cotizacin"}),t.jsx("button",{onClick:i,className:"btn-opaque",style:{padding:"6px 10px"},children:"Cerrar"})]}),t.jsx("p",{style:{color:"#475569"},children:"Desea guardar esta cotizacin en el sistema al finalizar el flujo?"}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[t.jsx("button",{onClick:r,className:"btn-opaque",style:{background:"transparent",color:"#111"},children:"No, cerrar"}),t.jsx("button",{onClick:async()=>{await s()},className:"btn-opaque",style:{background:"#2563eb",color:"white"},children:"S, guardar"})]})]})})}):null}function Pv({open:l,onClose:i,doFacturaClienteFinal:r,doFacturaClienteNormal:s,doFacturaClienteJuridico:c,carritoLength:d,subtotal:f,taxRate:g,taxableSubtotal:p}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx(Ca,{children:t.jsx("div",{style:{width:640,maxWidth:"95%",background:"white",borderRadius:12,padding:20,boxShadow:"0 18px 50px rgba(2,6,23,0.35)",display:"flex",gap:16,alignItems:"stretch"},children:t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:"Seleccionar tipo de cliente"}),t.jsx("button",{onClick:i,className:"btn-opaque",style:{padding:"6px 10px"},children:"Cerrar"})]}),t.jsxs("div",{style:{display:"flex",gap:12,marginTop:12},children:[t.jsxs("div",{onClick:r,role:"button",tabIndex:0,style:{flex:1,borderRadius:10,padding:14,cursor:"pointer",boxShadow:"0 6px 18px rgba(2,6,23,0.08)",border:"1px solid #e6edf3",display:"flex",flexDirection:"column",gap:8},children:[t.jsx("div",{style:{fontSize:28},children:""}),t.jsx("div",{style:{fontWeight:700},children:"Cliente Final"}),t.jsx("div",{style:{color:"#64748b",fontSize:13},children:"Consumidor final"})]}),t.jsxs("div",{onClick:s,role:"button",tabIndex:0,style:{flex:1,borderRadius:10,padding:14,cursor:"pointer",boxShadow:"0 6px 18px rgba(2,6,23,0.08)",border:"1px solid #e6edf3",display:"flex",flexDirection:"column",gap:8},children:[t.jsx("div",{style:{fontSize:28},children:""}),t.jsx("div",{style:{fontWeight:700},children:"Cliente Normal"}),t.jsx("div",{style:{color:"#64748b",fontSize:13},children:"Ingresar datos del cliente"})]}),t.jsxs("div",{onClick:c,role:"button",tabIndex:0,style:{flex:1,borderRadius:10,padding:14,cursor:"pointer",boxShadow:"0 6px 18px rgba(2,6,23,0.08)",border:"1px solid #e6edf3",display:"flex",flexDirection:"column",gap:8},children:[t.jsx("div",{style:{fontSize:28},children:""}),t.jsx("div",{style:{fontWeight:700},children:"Cliente Jurdico"}),t.jsx("div",{style:{color:"#64748b",fontSize:13},children:"Razn social / RTN"})]})]})]})})})}):null}function Fv({open:l,onClose:i,clienteTipo:r,clienteRTN:s,clienteNombre:c,clienteTelefono:d,clienteCorreo:f,clienteExonerado:g,clienteSearchOpen:p,setClienteSearchOpen:m,onRTNChange:b,onNombreChange:S,onTelefonoChange:j,onCorreoChange:x,onExoneradoChange:w,onCreateCliente:v,onCancel:E,onOpenCreateCliente:T,onOpenPayment:L,paymentDone:R,submitClienteNormal:z}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:600,maxWidth:"95%",background:"white",borderRadius:12,padding:20,boxShadow:"0 18px 50px rgba(2,6,23,0.35)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:r==="juridico"?"Datos del Cliente (Jurdico)":"Datos del Cliente"}),t.jsx("button",{onClick:i,className:"btn-opaque",style:{padding:"6px 10px"},children:"Cerrar"})]}),t.jsx("p",{style:{color:"#475569",marginTop:6},children:r==="juridico"?"Ingrese nmero de identificacin (RTN) y razn social del cliente jurdico. Estos datos se incluirn en la factura.":"Ingrese nmero de identificacin (RTN) y nombre completo del cliente. Estos datos se incluirn en la factura."}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsx("label",{style:{fontSize:13,color:"#334155"},children:"RTN o Identificacin"}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("input",{value:s,onChange:C=>b(C.target.value),placeholder:"00000000000000",style:{flex:1,padding:10,borderRadius:8,border:"1px solid #e2e8f0"}}),r==="juridico"&&t.jsx("button",{onClick:()=>m(!0),className:"btn-opaque",style:{padding:"8px 10px"},children:"Buscar"})]})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsx("label",{style:{fontSize:13,color:"#334155"},children:r==="juridico"?"Razn social":"Nombre completo"}),t.jsx("input",{value:c,onChange:C=>S(C.target.value),placeholder:r==="juridico"?"Razn social de la empresa":"Nombre del cliente",style:{padding:10,borderRadius:8,border:"1px solid #e2e8f0"}})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[t.jsx(Dv,{open:p,onClose:()=>m(!1),onSelect:C=>{try{if(C&&typeof C=="object"){const O=C.rtn||"",I=C.nombre||"",k=C.telefono||"",M=C.correo_electronico||"",G=!!C.exonerado;try{b(String(O||""))}catch{}try{S(String(I||""))}catch{}try{j(String(k||""))}catch{}try{x(String(M||""))}catch{}try{w(!!G)}catch{}}}catch{}m(!1)}}),t.jsx("button",{onClick:E,className:"btn-opaque",style:{background:"transparent",color:"#111"},children:"Cancelar"}),t.jsx("button",{onClick:T,className:"btn-opaque",style:{background:"transparent",color:"#0b5cff"},children:"Crear cliente"}),R?t.jsx("button",{onClick:z,className:"btn-opaque",disabled:!c||!s,style:{opacity:!c||!s?.6:1},children:"Generar Factura"}):t.jsx("button",{onClick:L,className:"btn-opaque",disabled:!c||!s,style:{opacity:!c||!s?.6:1},children:"Realizar pago"})]})]})})}):null}function _m({open:l,onClose:i,clienteRTN:r,clienteNombre:s,clienteTelefono:c,clienteCorreo:d,clienteExonerado:f,onChangeRTN:g,onChangeNombre:p,onChangeTelefono:m,onChangeCorreo:b,onChangeExonerado:S,onCreate:j}){return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:680,maxWidth:"95%",background:"white",borderRadius:12,padding:20,boxShadow:"0 18px 50px rgba(2,6,23,0.35)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[t.jsx("h3",{style:{margin:0},children:"Crear Cliente Jurdico"}),t.jsx("button",{onClick:i,className:"btn-opaque",style:{padding:"6px 10px"},children:"Cerrar"})]}),t.jsxs("p",{style:{color:"#475569",marginTop:6},children:["Complete los datos del cliente jurdico. El campo tipo se fijar a ",t.jsx("strong",{children:"juridico"}),"."]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsx("label",{style:{fontSize:13,color:"#334155"},children:"RTN"}),t.jsx("input",{value:r,onChange:x=>g(x.target.value),placeholder:"00000000000000",style:{padding:10,borderRadius:8,border:"1px solid #e2e8f0"}})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsx("label",{style:{fontSize:13,color:"#334155"},children:"Razn social"}),t.jsx("input",{value:s,onChange:x=>p(x.target.value),placeholder:"Razn social",style:{padding:10,borderRadius:8,border:"1px solid #e2e8f0"}})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsx("label",{style:{fontSize:13,color:"#334155"},children:"Telfono"}),t.jsx("input",{value:c,onChange:x=>m(x.target.value),placeholder:"Telfono",style:{padding:10,borderRadius:8,border:"1px solid #e2e8f0"}})]}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[t.jsx("label",{style:{fontSize:13,color:"#334155"},children:"Correo electrnico"}),t.jsx("input",{value:d,onChange:x=>b(x.target.value),placeholder:"correo@ejemplo.com",style:{padding:10,borderRadius:8,border:"1px solid #e2e8f0"}})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[t.jsx("input",{id:"exon",type:"checkbox",checked:f,onChange:x=>S(x.target.checked)}),t.jsx("label",{htmlFor:"exon",children:"Exonerado"})]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:14},children:[t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent",color:"#111"},children:"Cancelar"}),t.jsx("button",{onClick:async()=>{await j()},className:"btn-opaque",style:{opacity:!s||!r?.6:1},disabled:!s||!r,children:"Crear cliente"})]})]})})}):null}function Vv({open:l,onClose:i,carritoLength:r,subtotal:s,saveCotizacion:c,finalizePrint:d}){const[f,g]=y.useState("final"),[p,m]=y.useState(""),[b,S]=y.useState(""),[j,x]=y.useState(!1),[w,v]=y.useState(null),[E,T]=y.useState(!1);if(!l)return null;const L=O=>{g(O),v(null),O==="final"?(m("99999999999999"),S("Consumidor Final")):(m(""),S(""))},R=async()=>{if(p){x(!0);try{const{data:O,error:I}=await F.from("clientes").select("*").eq("rtn",p).maybeSingle();!I&&O?(v(O),S(O.nombre||"")):v(null)}catch{v(null)}finally{x(!1)}}},z=async()=>{if(!(!p||!b)){T(!0);try{const O={rtn:p,nombre:b,tipo_cliente:"juridico"},{data:I,error:k}=await F.from("clientes").insert([O]).select().maybeSingle();!k&&I&&v(I)}catch(O){console.warn("Error creando cliente juridico",O)}finally{T(!1)}}},C=async()=>{if(r===0)return;T(!0);let O=b,I=p||null;f==="final"&&(O="Consumidor Final",I="99999999999999");try{await new Promise(M=>setTimeout(M,1200));const k=await c({cliente:O,rtn:I});try{const M=k&&k.numero?k.numero:null;await d(O,I,M)}catch(M){console.warn("Error during finalizePrint after cotizacion save",M)}i()}catch(k){console.warn("Error generando cotizacion",k)}finally{T(!1)}};return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2,6,23,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:t.jsx(Ca,{children:t.jsxs("div",{style:{width:640,maxWidth:"95%",background:"white",borderRadius:12,padding:20,boxShadow:"0 18px 50px rgba(2,6,23,0.35)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h3",{style:{margin:0},children:"Generar Cotizacin"}),t.jsx("button",{onClick:i,className:"btn-opaque",children:"Cerrar"})]}),t.jsxs("div",{style:{marginTop:12},children:[t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsxs("label",{style:{flex:1},children:[t.jsx("input",{type:"radio",checked:f==="final",onChange:()=>L("final")})," Consumidor Final"]}),t.jsxs("label",{style:{flex:1},children:[t.jsx("input",{type:"radio",checked:f==="normal",onChange:()=>L("normal")})," Cliente Normal"]}),t.jsxs("label",{style:{flex:1},children:[t.jsx("input",{type:"radio",checked:f==="juridico",onChange:()=>L("juridico")})," Jurdico"]})]}),t.jsxs("div",{style:{marginTop:12},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[t.jsxs("div",{children:[t.jsx("label",{children:"RTN o Identificacin"}),t.jsx("input",{value:p,onChange:O=>m(O.target.value),placeholder:f==="final"?"99999999999999":"00000000000000",style:{width:"100%",padding:8,marginTop:6}})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Razn social / Nombre"}),t.jsx("input",{value:b,onChange:O=>S(O.target.value),placeholder:f==="juridico"?"Razn social de la empresa":"Nombre del cliente",style:{width:"100%",padding:8,marginTop:6}})]})]}),f==="juridico"&&t.jsxs("div",{style:{marginTop:8,display:"flex",gap:8},children:[t.jsx("button",{onClick:R,className:"btn-opaque",disabled:j,children:j?"Buscando...":"Buscar"}),t.jsx("button",{onClick:z,className:"btn-opaque",disabled:E||!p||!b,children:E?"Creando...":"Crear Cliente"})]}),w&&t.jsxs("div",{style:{marginTop:10,padding:8,background:"#f8fafc",borderRadius:8},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Encontrado:"})," ",w.nombre]}),t.jsxs("div",{children:["RTN: ",w.rtn]})]})]}),t.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{onClick:i,className:"btn-opaque",style:{background:"transparent"},children:"Cancelar"}),t.jsx("button",{onClick:C,className:"btn-opaque",disabled:E||r===0,children:E?"Generando cotizacin (1.2s)...":"Generar Cotizacin"})]})]})]})})})}async function jg(l={},i="factura",r={}){let s=l.comercio||"",c=l.companyRTN||l.rtnEmpresa||l.RTN||"",d=l.direccion||"",f=l.telefono||"",g=l.email||l.EM||"",p=l.logo||l.logoUrl||l.logo_src||null;if(!s||!c||!d||!f||!g||!p)try{const P=await wa();P&&(s=s||P.nombre||P.comercio||s,c=c||P.rtn||c,d=d||P.direccion||P.direccion_fiscal||d,f=f||P.telefono||P.telefono_fijo||f,g=g||P.email||P.correo||g,p=p||P.logoUrl||P.logo||p)}catch{}if(p&&typeof window<"u"&&l.inlineLogo!==!1)try{if(!String(p).startsWith("data:")){const P=await fetch(String(p),{mode:"cors"});if(P.ok){const Se=await P.blob(),J=await new Promise(ae=>{const V=new FileReader;V.onloadend=()=>{ae(typeof V.result=="string"?V.result:null)},V.onerror=()=>{ae(null)},V.readAsDataURL(Se)});J&&(p=J)}}}catch{}let m=l.factura||"",b=l.CAI||l.cai||"",S=l.fechaLimiteEmision||l.fecha_limite_emision||l.fecha_vencimiento||"",j=l.rangoAutorizadoDe||l.rango_desde||"",x=l.rangoAutorizadoHasta||l.rango_hasta||"",w=l.identificador||l.identificadorCAI||"";try{let P=l.caiInfo||null;if(!P&&typeof window<"u"){const Se=window.localStorage.getItem("caiInfo");if(Se)try{P=JSON.parse(Se)}catch{P=null}}if(P&&(b=b||P.cai||P.CAI||"",S=S||P.fecha_vencimiento||P.fecha_limite_emision||"",j=j||P.rango_de||P.rangoDesde||"",x=x||P.rango_hasta||P.rangoHasta||"",w=w||P.identificador||"",!m))try{const Se=P.identificador?String(P.identificador):"",J=P.secuencia_actual!=null?String(P.secuencia_actual):P.rango_de!=null?String(P.rango_de):"",ae=String(J).replace(/[^0-9]/g,"")||"";let V=0;(P.rango_hasta||P.rango_de)&&(V=Math.max(String(P.rango_hasta||P.rango_de).length,ae.length));const ue=ae?String(ae).padStart(V||ae.length||1,"0"):"";m=(Se||"")+(ue||String(Math.floor(Math.random()*9e5)+1e5))}catch{m=String(Math.floor(Math.random()*9e5)+1e5)}}catch{}m||(m=String(Math.floor(Math.random()*9e5)+1e5));const v=l.cliente||(i==="factura"?"Consumidor Final":"Cotizacin Cliente"),E=l.identidad||l.rtnCliente||l.clientRTN||l.rtn||r.identidad||"C/F",T=new Date().toLocaleString(),L=Array.isArray(r.carrito)?r.carrito:[],R=typeof r.subtotal=="number"?r.subtotal:L.reduce((P,Se)=>P+Number(Se.producto&&Se.producto.precio||Se.precio||0)*(Se.cantidad||1),0),z=typeof r.descuento=="number"?r.descuento:0,C=typeof r.exonerado=="number"?r.exonerado:0,O=typeof r.gravado=="number"?r.gravado:R,I=typeof r.exento=="number"?r.exento:0,k=typeof r.isvTotal=="number"?r.isvTotal:0,M=typeof r.imp18Total=="number"?r.imp18Total:0,G=typeof r.impTouristTotal=="number"?r.impTouristTotal:0,K=typeof r.total=="number"?r.total:null,ne=R+(k||0)+(M||0)+(G||0),Y=K??ne,B=Y,A=r.pagos||{},N=typeof A.efectivo=="number"?A.efectivo:typeof r.Efectivo=="number"?r.Efectivo:0,q=typeof A.tarjeta=="number"?A.tarjeta:typeof r.Tarjeta=="number"?r.Tarjeta:0,X=typeof A.transferencia=="number"?A.transferencia:typeof r.Transferencia=="number"?r.Transferencia:0,ge=typeof A.totalPaid=="number"?A.totalPaid:N+q+X;let re;if(typeof A.cambio=="number")re=A.cambio;else if(typeof r.cambio=="number")re=r.cambio;else{const P=Number(ge)-Number(B||0);re=isNaN(P)?0:P>0?P:0}const $=L.map(P=>{const Se=String(P.producto&&(P.producto.nombre||P.producto.descripcion)||P.descripcion||P.nombre||""),J=Number(P.cantidad||0),ae=Number((P.producto&&(P.producto.precio??P.producto.precio_unitario))??P.precio_unitario??P.precio??0),V=!!(P.producto&&P.producto.exento)||!!P.exento,ue=!!(P.producto&&P.producto.aplica_impuesto_18)||!!P.aplica_impuesto_18,de=!!(P.producto&&P.producto.aplica_impuesto_turistico)||!!P.aplica_impuesto_turistico,he=ue?r.tax18Rate??r.tax18??0:r.taxRate??r.tax??0,Te=de?r.taxTouristRate??r.taxTourist??0:0,Oe=(Number(he)||0)+(Number(Te)||0);let Ue=ae;!V&&Oe>0&&(Ue=ae/(1+Oe));const Le=Number(Ue||0).toFixed(2),ze=Ue*J,se=Number(ze||0).toFixed(2);return`<tr><td>${P.producto&&P.producto.sku||P.sku||""} ${Se}</td><td style="text-align:center">${J}</td><td style="text-align:right">L ${Le}</td><td style="text-align:right">L ${se}</td></tr>`}).join(`
`),H=(Number(N)||0)+(Number(X)||0)+(Number(q)||0)-(Number(re)||0),Z=isNaN(H)?0:H,ee=Wv(Z);return`<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Factura Cinta</title>

<style>
    body {
        font-family: monospace;
        font-size: 12px;
        width: 260px; /* tamao para impresora trmica 58mm */
        margin: 0 auto;
        padding: 0;
    }

    .center { text-align: center; }
    .line { border-top: 1px dashed #000; margin: 5px 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 2px 0; }
    th { border-bottom: 1px solid #000; }
    .right { text-align: right; }
    .left { text-align: left; }
    .bold { font-weight: bold; }
</style>
</head>

<body>

<div class="center">
    <img src="${p}" alt="logo" style="width:120px; height:auto;" />
</div>

<div class="center bold">FACTURA</div>
<div class="center">No. ${m}</div>

<div class="line"></div>

<div class="center bold">${s}</div>
<p>RTN: ${c}</p>
<p>Direccin: ${d}</p>
<p>Tel: ${f}</p>
<p>Email: ${g}</p>

<div class="line"></div>

<p>Fecha/Hora: ${T}</p>
<p>CAI: ${b}</p>
<p>F. Lmite: ${S}</p>
<p>Rango:  
${w?w+" "+j+" al "+w+" "+x:j+" al "+x}</p>

<div class="line"></div>

<p>Cliente: ${v}</p>
<p>RTN Cliente: ${E}</p>

<div class="line"></div>

<table>
    <thead>
        <tr>
            <th class="left">Descripcin</th>
            <th class="right">Cant</th>
            <th class="right">P.U</th>
            <th class="right">Total</th>
        </tr>
    </thead>
    <tbody>
        ${$}
    </tbody>
</table>

<div class="line"></div>

<p>Descuento: <span class="right">L ${z.toFixed(2)}</span></p>
<p>SubT Exonerado: <span class="right">L ${Number(C).toFixed(2)}</span></p>
<p>SubT Gravado: <span class="right">L ${Number(O).toFixed(2)}</span></p>
<p>SubT Exento: <span class="right">L ${Number(I).toFixed(2)}</span></p>
<p>Tasa Turstica 4%: <span class="right">L ${Number(G).toFixed(2)}</span></p>
<p>ISV 15%: <span class="right">L ${Number(k).toFixed(2)}</span></p>
<p>ISV 18%: <span class="right">L ${Number(M).toFixed(2)}</span></p>

<div class="line"></div>

<p class="bold">TOTAL TRANSACCIN:
   <span class="right bold">L ${Number(Y).toFixed(2)}</span>
</p>

<div class="line"></div>

<p class="bold">TOTAL FACTURA :
   <span class="right bold">L ${B.toFixed(2)}</span>
</p>

<p>Efectivo: <span class="right">L ${Number(N).toFixed(2)}</span></p>
<p>Tarjeta: <span class="right">L ${Number(q).toFixed(2)}</span></p>
<p>Transferencia: <span class="right">L ${Number(X).toFixed(2)}</span></p>
<p>Cambio: <span class="right">L ${Number(re).toFixed(2)}</span></p>

<div class="line"></div>

<div class="center">
    <p>Total Pagado: L ${Z.toFixed(2)}</p>
    <p>*** ${ee} Lempiras ***</p>
</div>

<div class="line"></div>

<p>Firma Cliente: ____________________</p>
<p>Firma Emisor: _____________________</p>

<div class="center">
    <p>Original: Cliente</p>
    <p>Copia: Obligado tributario emisor</p>
</div>

<div class="center">
    <p>Para cualquier reclamo debe<br/>presentar su factura</p>
    <p>Gracias por su compra!</p>
    <p>LA FACTURA ES BENEFICIO DE TODOS,<br/>EXJALA!</p>
</div>

</body>
</html>
`}function Wv(l){if(!isFinite(l))return"";const i=["","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez","once","doce","trece","catorce","quince","dieciseis","diecisiete","dieciocho","diecinueve","veinte"],r=["","","veinte","treinta","cuarenta","cincuenta","sesenta","setenta","ochenta","noventa"],s=["","cien","doscientos","trescientos","cuatrocientos","quinientos","seiscientos","setecientos","ochocientos","novecientos"];function c(b){if(b===0)return"";if(b<21)return i[b];if(b<100){const S=Math.floor(b/10),j=b%10;return r[S]+(j?" y "+i[j]:"")}if(b<1e3){const S=Math.floor(b/100),j=b%100;return(S===1&&j===0?"cien":s[S]||"")+(j?" "+c(j):"")}return""}const d=Math.floor(Math.abs(l));if(d===0)return"cero";const f=[];let g=d;const p=["","mil","milln","mil millones"];let m=0;for(;g>0;){const b=g%1e3;if(b){let S=c(b);m===2&&b===1&&(S="un"),f.unshift(S+(p[m]?" "+p[m]:""))}g=Math.floor(g/1e3),m++}return f.join(" ").trim()}function Gv({onLogout:l}){y.useEffect(()=>{const te=document.body.style.overflow,be=window.innerWidth<=1024;return document.body.style.overflow=be?"auto":"hidden",()=>{document.body.style.overflow=te||""}},[]);const{session:i}=iu(),[r,s]=y.useState(!1),[c,d]=y.useState([]),[f,g]=y.useState([]),[p,m]=y.useState(""),[b,S]=y.useState("Todas"),[j,x]=y.useState("producto"),[w,v]=y.useState(!1),[E,T]=y.useState(.15),[L,R]=y.useState(0),[z,C]=y.useState(0),[O,I]=y.useState(26.27),k=["Todas",...Array.from(new Set(c.map(te=>te.categoria)))],M=c.filter(te=>(String(te.nombre||"").toLowerCase().includes(p.toLowerCase())||String(te.sku||"").toLowerCase().includes(p.toLowerCase()))&&(b==="Todas"||te.categoria===b)&&(te.tipo===j||!te.tipo)),G=f.reduce((te,be)=>te+Number(be.producto.precio||0)*be.cantidad,0);let K=0,ne=0,Y=0;for(const te of f){const be=Number(te.producto.precio||0)*te.cantidad,Ne=!!te.producto.exento,pe=!!te.producto.aplica_impuesto_18,_e=!!te.producto.aplica_impuesto_turistico;if(Ne)continue;const ke=pe?L||0:E||0,Ae=_e&&z||0,xe=(Number(ke)||0)+(Number(Ae)||0);if(xe<=0)continue;const we=be-be/(1+xe);pe?ne+=we*(ke/xe):K+=we*(ke/xe),_e&&(Y+=we*(Ae/xe))}const B=async(te,be,Ne)=>{try{lt.current=!0,await qr(te,be,null,Ne||ue)}catch(pe){console.warn("Error printing cotizacion direct:",pe)}finally{lt.current=!1}},A=G,N=Math.max(0,G-(K+ne+Y)),q=f.map(te=>{const be=Number(te.producto.precio||0)*te.cantidad,Ne=!!te.producto.exento,pe=!!te.producto.aplica_impuesto_18,_e=!!te.producto.aplica_impuesto_turistico;if(Ne)return{id:te.producto.id,nombre:te.producto.nombre,price:be,isv:0,imp18:0,tur:0,totalTax:0};const ke=pe?L||0:E||0,Ae=_e&&z||0,xe=(Number(ke)||0)+(Number(Ae)||0);if(xe<=0)return{id:te.producto.id,nombre:te.producto.nombre,price:be,isv:0,imp18:0,tur:0,totalTax:0};const we=be-be/(1+xe),me=pe?0:we*(ke/xe),Re=pe?we*(ke/xe):0,Fe=_e?we*(Ae/xe):0;return{id:te.producto.id,nombre:te.producto.nombre,price:be,isv:me,imp18:Re,tur:Fe,totalTax:me+Re+Fe}}),X=te=>{if(!i){s(!0);return}const be=te.tipo==="servicio",Ne=Number(te.stock??0);Number(te.precio??0)<=0||!be&&Ne<1||g(_e=>_e.find(Ae=>Ae.producto.id===te.id)?_e.map(Ae=>Ae.producto.id===te.id?{...Ae,cantidad:Ae.cantidad+1}:Ae):[..._e,{producto:te,cantidad:1}])},ge=(te,be)=>{g(Ne=>Ne.map(pe=>{if(String(pe.producto.id)===String(te)){const _e=pe.cantidad+be;return _e>0?{...pe,cantidad:_e}:pe}return pe}).filter(pe=>pe.cantidad>0))},re=te=>{g(be=>be.filter(Ne=>String(Ne.producto.id)!==String(te)))},U=()=>g([]),[$,H]=y.useState(!1),[Z,ee]=y.useState("factura"),[oe,P]=y.useState(!1),[Se,J]=y.useState(null),[ae,V]=y.useState(null),[ue,de]=y.useState(null),[he,Te]=y.useState(!1),[Oe,Ue]=y.useState(!1),[Le,ze]=y.useState(""),[se,ve]=y.useState(""),$e=y.useRef(null),gt=y.useRef(null),[st,vt]=y.useState("final"),[kt,Rt]=y.useState(""),[ut,mn]=y.useState(""),[Ot,Nn]=y.useState(!1),[bn,qe]=y.useState(!1),[et,ft]=y.useState(!1),lt=y.useRef(!1),[bt,ht]=y.useState(!1),[rn,Xt]=y.useState(!1),[on,xn]=y.useState(null),[qn,fa]=y.useState(!1),[ea,qo]=y.useState("carta"),[$o,Gi]=y.useState(!1),Si=async te=>{if(ve(te),!te||String(te).trim()===""){ze("");return}try{if(st==="juridico"){console.debug("handleRTNChange: buscando cliente juridico para RTN=",te);const{data:_e,error:ke}=await F.from("clientes").select("id,nombre,telefono,correo_electronico,exonerado").eq("rtn",te).eq("tipo_cliente","juridico").maybeSingle();if(console.debug("handleRTNChange: supabase response",{data:_e,error:ke}),!ke&&_e&&_e.nombre){ze(_e.nombre||""),Rt(_e.telefono||""),mn(_e.correo_electronico||""),Nn(!!_e.exonerado),setTimeout(()=>{try{gt.current?.focus()}catch{}},50);return}else{ze(""),Rt(""),mn(""),Nn(!1);return}}const be="clientenatural";console.debug("handleRTNChange: buscando clientenatural para RTN=",te);const{data:Ne,error:pe}=await F.from(be).select("nombre").eq("rtn",te).maybeSingle();console.debug("handleRTNChange: supabase response clientenatural",{data:Ne,error:pe}),!pe&&Ne&&Ne.nombre?(ze(Ne.nombre||""),setTimeout(()=>{try{gt.current?.focus()}catch{}},50)):ze("")}catch(be){console.warn("Error buscando cliente por RTN:",be)}},bl=te=>{if(te==="cotizacion"){ee("cotizacion"),ft(!0);return}ee(te),H(!0)},Lr=async(te={})=>{try{if(!f||f.length===0)return null;const be=Ya(),Ne=K,pe=ne,_e=Y,ke=Number(Ne||0)+Number(pe||0)+Number(_e||0),Ae=be+ke;let xe=te.cliente_id??null;if(!xe&&te.rtn)try{const{data:Xe,error:at}=await F.from("clientes").select("id").eq("rtn",te.rtn).maybeSingle();!at&&Xe&&Xe.id&&(xe=Xe.id)}catch{}const we=tn||"system",me=String(Math.floor(Math.random()*9e5)+1e5),Re={cliente_id:xe,usuario:we,numero_cotizacion:me,validez_dias:30,subtotal:be,impuesto:ke,total:Ae,estado:"pendiente"};let Fe=te.cotizacion_id??ae,Ie=null;if(Fe){const Xe={cliente_id:Re.cliente_id||null,usuario:Re.usuario,validez_dias:Re.validez_dias,subtotal:Re.subtotal,impuesto:Re.impuesto,total:Re.total,estado:Re.estado},{error:at}=await F.from("cotizaciones").update(Xe).eq("id",Fe);if(at)return console.warn("Error actualizando cotizacion:",at),null;try{const{data:Bt,error:aa}=await F.from("cotizaciones").select("*").eq("id",Fe).maybeSingle();if(!aa&&Bt){Ie=Bt.numero_cotizacion||Bt.Nmero||null;try{de(Ie)}catch{}}}catch{}}else{const{data:Xe,error:at}=await F.from("cotizaciones").insert([Re]).select("*").maybeSingle();if(at)return console.warn("Error insertando cotizacion:",at),null;Fe=Xe?.id||null;try{if(Fe){const{data:Bt,error:aa}=await F.from("cotizaciones").select("*").eq("id",Fe).maybeSingle();!aa&&Bt?Ie=Bt.numero_cotizacion||Bt.Nmero||me:Ie=Xe?.numero_cotizacion||Xe?.Nmero||me}else Ie=Xe?.numero_cotizacion||Xe?.Nmero||me}catch{Ie=Xe?.numero_cotizacion||Xe?.Nmero||me}try{de(Ie)}catch{}if(!Fe)return null}const Nt=f.map(Xe=>{const at=Number(Xe.producto.precio||0),Bt=Number(Xe.cantidad||0),aa=!!Xe.producto.exento,Hn=!!Xe.producto.aplica_impuesto_18,Wt=!!Xe.producto.aplica_impuesto_turistico,Aa=aa||Hn?0:at*(E||0)*Bt,Yi=aa?0:Hn?at*(L||0)*Bt:0,ma=aa?0:Wt?at*(z||0)*Bt:0,An=at*Bt,ya=An+Aa+Yi+ma,Be=String(Xe.producto.id).startsWith("temp-");return{cotizacion_id:Fe,producto_id:Be?null:Xe.producto.id||null,descripcion:Xe.producto.nombre||"",cantidad:Bt,precio_unitario:at,subtotal:An,descuento:0,total:ya}});try{await F.from("cotizaciones_detalle").delete().eq("cotizacion_id",Fe)}catch{}const{error:qt}=await F.from("cotizaciones_detalle").insert(Nt);qt?console.warn("Error insertando cotizaciones_detalle:",qt):console.debug("Cotizacion guardada id=",Fe);try{U()}catch(Xe){console.debug("Error vaciando carrito tras guardar cotizacion:",Xe)}try{await pa()}catch(Xe){console.debug("Error refrescando productos tras guardar cotizacion:",Xe)}return{id:Fe,numero:Ie}}catch(be){return console.warn("Error guardando cotizacion:",be),null}},Ya=()=>{const te=f.reduce((_e,ke)=>_e+Number(ke.producto.precio||0)*ke.cantidad,0);let be=0,Ne=0,pe=0;for(const _e of f){const ke=Number(_e.producto.precio||0)*_e.cantidad,Ae=!!_e.producto.exento,xe=!!_e.producto.aplica_impuesto_18,we=!!_e.producto.aplica_impuesto_turistico;if(Ae)continue;const me=xe?L||0:E||0,Re=we&&z||0,Fe=(Number(me)||0)+(Number(Re)||0);if(Fe<=0)continue;const Ie=ke-ke/(1+Fe);xe?Ne+=Ie*(me/Fe):be+=Ie*(me/Fe),we&&(pe+=Ie*(Re/Fe))}return Math.max(0,te-(be+Ne+pe))},Ho=()=>f.reduce((te,be)=>te+(be.producto.exento?0:Number(be.producto.precio||0)*be.cantidad),0),Ir=async()=>{vt("final"),ze("Consumidor Final"),ve("C/F"),console.debug("doFacturaClienteFinal: abrir modal pago (invoiceAfterPayment)"),fa(!0),ht(!0),H(!1)},Mr=()=>{vt("normal"),ze(""),ve(""),Xt(!1),xn(null),Te(!0),H(!1)},Po=()=>{vt("juridico"),ze(""),ve(""),Xt(!1),xn(null),Te(!0),H(!1)},qr=async(te,be,Ne,pe)=>{let _e=ea==="cinta"?jg:gl;const ke={cliente:te,rtn:be};if(Z==="cotizacion"){_e=ru;const xe=pe||ue||null;xe&&(ke.cotizacion=xe),ke.cotizacion==null&&ue&&(ke.Nmero=ue)}const Ae=await _e(ke,Z,{carrito:f,subtotal:Ya(),isvTotal:K,imp18Total:ne,impTouristTotal:Y,taxRate:E,tax18Rate:L,taxTouristRate:z,total:A,pagos:Ne});if(Z==="factura"&&ae)try{console.debug("Pre-print: marcando cotizacion como aceptada, id=",ae);const{error:xe}=await F.from("cotizaciones").update({estado:"aceptada"}).eq("id",ae);if(xe)console.warn("Error marcando cotizacion (pre-print):",xe);else try{V(null)}catch{}}catch(xe){console.warn("Error marcacion pre-print:",xe)}if(Z==="factura")try{let xe=null,we=null;try{const me=localStorage.getItem("user"),Re=me?JSON.parse(me):null;we=Re&&(Re.id||Re.user?.id||Re.sub||Re.user_id)?Re.id||Re.user?.id||Re.sub||Re.user_id:null;const Fe=Re&&(Re.username||Re.user?.username||Re.name||Re.user?.name)?Re.username||Re.user?.username||Re.name||Re.user?.name:null;if(console.debug("PV: CAI lookup - raw localStorage.user:",me),console.debug("PV: CAI lookup - parsed user object:",Re),console.debug("PV: CAI lookup - extracted userId:",we,"typeof",typeof we),console.debug("PV: CAI lookup - extracted userNameFromStorage:",Fe),we){const Ie=typeof we=="string"&&/^\d+$/.test(we)?Number(we):we;try{const{data:Nt,error:qt}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("usuario_id",Ie).order("id",{ascending:!1}).limit(1);!qt&&Array.isArray(Nt)&&Nt.length>0&&(xe=Nt[0])}catch(Nt){console.debug("PV: CAI lookup by usuario_id failed (likely column missing):",Nt)}}if(!xe&&Fe)try{const{data:Ie,error:Nt}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("cajero",Fe).order("id",{ascending:!1}).limit(1);!Nt&&Array.isArray(Ie)&&Ie.length>0&&(xe=Ie[0])}catch(Ie){console.debug("PV: CAI lookup by cajero failed:",Ie)}}catch(me){console.debug("No se pudo cargar CAI desde frontend:",me)}await ta({clienteName:te,rtn:be,paymentPayload:Ne,caiData:xe,usuarioId:we})}catch(xe){console.warn("Error preparando venta antes de imprimir:",xe);const we=xe instanceof Error?xe.message:JSON.stringify(xe,null,2);console.error("Detalles del error:",we),alert("Error preparando venta antes de imprimir: "+we)}try{const xe=document.createElement("iframe");xe.style.position="fixed",xe.style.right="0",xe.style.bottom="0",xe.style.width="0",xe.style.height="0",xe.style.border="0",xe.style.overflow="hidden",xe.setAttribute("aria-hidden","true"),document.body.appendChild(xe);const we=xe.contentWindow,me=xe.contentDocument||xe.contentWindow?.document;if(!me||!we)try{document.body.removeChild(xe)}catch{}else{me.open(),me.write(Ae),me.close();const Re=()=>{try{we.focus(),we.print()}catch(Ie){console.warn("Error during iframe print (finalize):",Ie)}setTimeout(()=>{try{document.body.removeChild(xe)}catch{}},800)},Fe=()=>{try{const Ie=me.images;if(Ie&&Ie.length>0){let Nt=0;for(let qt=0;qt<Ie.length;qt++){const Xe=Ie[qt];Xe.complete?Nt++:(Xe.addEventListener("load",()=>{Nt++,Nt===Ie.length&&Re()}),Xe.addEventListener("error",()=>{Nt++,Nt===Ie.length&&Re()}))}Nt===Ie.length&&Re()}else Re()}catch{try{we.addEventListener("load",Re)}catch{}setTimeout(Re,1e3)}};try{me.readyState==="complete"?Fe():(we.addEventListener("load",Fe),setTimeout(Fe,1500))}catch{setTimeout(Fe,800)}}}catch(xe){console.warn("Direct print failed, falling back to opening new window",xe);const we=window.open("","_blank");we&&(we.document.open(),we.document.write(Ae),we.document.close(),setTimeout(()=>{try{we.print(),we.close()}catch{}},800))}Z==="factura"&&(U(),await Ft()),Z==="cotizacion"&&(J({cliente:te,rtn:be}),lt.current?(P(!1),J(null)):P(!0))},ta=async({clienteName:te,rtn:be,paymentPayload:Ne,caiData:pe,usuarioId:_e})=>{if(!f||f.length===0)return null;const ke=Ne&&Ne.tipoPagoString?String(Ne.tipoPagoString):"",Ae=Ne&&Ne.totalPaid?Number(Ne.totalPaid||0):0,xe=Ae>Number(A||0)?Ae-Number(A||0):0;let we=String(Math.floor(Math.random()*9e5)+1e5);const me=ga||pe||null;let Re=null,Fe=0,Ie=null,Nt=null;if(me&&(me.rango_de!==void 0||me.secuencia_actual!==void 0))try{const Be=me.rango_de!=null?String(me.rango_de):"",Ke=me.rango_hasta!=null?String(me.rango_hasta):"",it=me.secuencia_actual!=null?String(me.secuencia_actual):"",De=Number(String(Be).replace(/[^0-9]/g,""))||0,Ve=Number(String(Ke).replace(/[^0-9]/g,""))||0,Qe=Number(String(it).replace(/[^0-9]/g,""))||De||0;Fe=Math.max((Ke||Be||"").length,String(Qe).length,1),Nt=String(Qe).padStart(Fe,"0"),we=(me.identificador?String(me.identificador):"")+Nt;const nn=Qe+1;Re=nn,Ie=String(nn).padStart(Fe,"0")}catch(Be){console.debug("Error computing factura from caiInfoState, falling back to random:",Be)}const qt={rtn:be||null,nombre_cliente:te||null,usuario:tn||"system",factura:we,tipo_pago:ke,subtotal:Number(N||0),impuesto:Number(K+ne+Y||0),isv_15:Number(K||0),isv_18:Number(ne||0),isv_4:Number(Y||0),sub_exonerado:0,sub_exento:0,sub_gravado:0,total:Number(A||0),estado:"pagada",cambio:String(Number(xe).toFixed(2)),cai:me?.cai??null,rango_desde:(me&&me.identificador?String(me.identificador):"")+(me?.rango_de!=null?String(me.rango_de):"")||null,rango_hasta:(me&&me.identificador?String(me.identificador):"")+(me?.rango_hasta!=null?String(me.rango_hasta):"")||null,fecha_limite_emision:me?.fecha_vencimiento??me?.fecha_limite_emision??null};try{let Be=0,Ke=0,it=0;const De=!!Ot;for(const Ve of f){const Qe=Number(Ve.producto.precio||0),Ut=Number(Ve.cantidad||0),nn=Qe*Ut,$t=!!Ve.producto.exento,ia=!!Ve.producto.aplica_impuesto_18,ra=!!Ve.producto.aplica_impuesto_turistico,Ja=ia?L||0:E||0,Yo=ra&&z||0,sn=(Number(Ja)||0)+(Number(Yo)||0),ba=sn>0?nn-nn/(1+sn):0;$t?Ke+=nn:De?Be+=Math.max(0,nn-ba):it+=Math.max(0,nn-ba)}qt.sub_exonerado=Number(Number(Be||0).toFixed(6)),qt.sub_exento=Number(Number(Ke||0).toFixed(6)),qt.sub_gravado=Number(Number(it||0).toFixed(6))}catch(Be){console.debug("Error computing sub_* for ventaPayload",Be)}let Xe=null,at=null,Bt=0;const aa=10;for(;Bt<aa;)try{const Be=await F.from("ventas").insert([qt]).select("id, factura");if(Xe=Be.data??Be,at=Be.error??null,!at)break;if((at&&at.code?String(at.code):"")==="23505"&&at.details&&at.details.includes("factura")){if(console.warn(`Factura ${we} duplicada, incrementando...`),Bt++,Re!==null){Re++;const it=String(Re).padStart(Fe,"0");we=(me?.identificador?String(me.identificador):"")+it}else we=String(Math.floor(Math.random()*9e5)+1e5+Bt);qt.factura=we;continue}break}catch(Be){at=Be;break}if(console.debug("Insert venta response:",{ventaInsRaw:Xe,ventaErr:at,intentos:Bt}),at){const Be=String(at&&(at.message||at.msg||at.details)||""),Ke=at&&at.code?String(at.code):"";if(Ke==="PGRST204"||Be.includes("Could not find the")||/column .* of 'ventas'/.test(Be)){console.warn("Insert venta failed due missing column(s). Retrying without CAI fields.",{msg:Be,code:Ke});const De={...qt};delete De.cai,delete De.rango_desde,delete De.rango_hasta,delete De.fecha_limite_emision,delete De.isv_15,delete De.isv_18,delete De.isv_4,delete De.sub_exonerado,delete De.sub_exento,delete De.sub_gravado;try{const Ve=await F.from("ventas").insert([De]).select("id, factura");if(Xe=Ve.data??Ve,at=Ve.error??null,console.debug("Fallback insert ventas response:",{ventaInsRaw:Xe,ventaErr:at}),at)throw at}catch(Ve){throw console.error("Fallback insert also failed:",Ve),Ve}}else throw at}const Hn=Array.isArray(Xe)?Xe[0]:Xe;let Wt=Hn?Hn.id||Hn.id:null;if(!Wt)try{const{data:Be,error:Ke}=await F.from("ventas").select("id").eq("factura",we).maybeSingle();Ke&&console.debug("Error buscando venta por factura (fallback):",Ke),Be&&Be.id&&(Wt=Be.id)}catch(Be){console.debug("fallback lookup error",Be)}if(!Wt)return console.warn("No se pudo obtener venta.id tras insertar. Respuesta:",Xe),null;const Aa=f.map(Be=>{const Ke=Number(Be.producto.precio||0),it=Number(Be.cantidad||0),De=Ke*it,Ve=0,Qe=De-Ve,Ut=String(Be.producto.id).startsWith("temp-");return{venta_id:Wt,factura:we,producto_id:Ut?null:Be.producto.id,descripcion:Ut?Be.producto.nombre||"Servicio":null,cantidad:it,precio_unitario:Ke,subtotal:De,descuento:Ve,total:Qe}});if(pe&&_e&&(Be=>typeof Be=="string"&&/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(Be))(_e))try{const Be=f.filter(De=>!String(De.producto.id).startsWith("temp-")).map(De=>({producto_id:String(De.producto.id),cantidad:Number(De.cantidad||0),precio_unitario:Number(De.producto.precio||0),subtotal:Number((Number(De.producto.precio||0)*De.cantidad).toFixed(6)),descuento:0,total:Number((Number(De.producto.precio||0)*De.cantidad).toFixed(6))})),{data:Ke,error:it}=await F.rpc("create_venta_with_detalle",{p_usuario_id:_e,p_usuario:tn||_e,p_rtn:be||null,p_nombre_cliente:te||null,p_tipo_pago:ke,p_subtotal:Number(N||0),p_impuesto:Number(K+ne+Y||0),p_isv_15:Number(K||0),p_isv_18:Number(ne||0),p_isv_4:Number(Y||0),p_sub_exonerado:Number(qt.sub_exonerado||0),p_sub_exento:Number(qt.sub_exento||0),p_sub_gravado:Number(qt.sub_gravado||0),p_total:Number(A||0),p_cambio:String(Number(xe).toFixed(2)),p_detalles:Be});if(console.debug("RPC create_venta_with_detalle response:",{rpcData:Ke,rpcErr:it}),it)console.warn("RPC create_venta_with_detalle failed, falling back to client inserts",it);else if(Ke&&Array.isArray(Ke)&&Ke.length>0){const De=Ke[0];try{if(me&&me.id!=null)try{const{data:Ve,error:Qe}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("id",me.id).maybeSingle();if(!Qe&&Ve){Na(Ve);try{localStorage.setItem("caiInfo",JSON.stringify(Ve))}catch{}}}catch(Ve){console.debug("Error refreshing cai after RPC:",Ve)}}catch(Ve){console.debug("Error during post-RPC cai refresh:",Ve)}return De.venta_id||De.venta_id===0?De.venta_id:Wt}else if(Ke&&Ke.venta_id){try{if(me&&me.id!=null)try{const{data:De,error:Ve}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("id",me.id).maybeSingle();if(!Ve&&De){Na(De);try{localStorage.setItem("caiInfo",JSON.stringify(De))}catch{}}}catch(De){console.debug("Error refreshing cai after RPC (scalar):",De)}}catch(De){console.debug("Error during post-RPC cai refresh (scalar):",De)}return Ke.venta_id}}catch(Be){console.warn("Error calling RPC create_venta_with_detalle:",Be)}else pe&&_e&&console.debug("Skipping RPC create_venta_with_detalle because usuarioId is not a UUID. usuarioId:",_e);const{data:ma,error:An}=await F.from("ventas_detalle").insert(Aa).select("id");if(console.debug("Insert ventas_detalle response:",{detalleIns:ma,detErr:An}),An)throw An;try{const Be=`venta: ${we}`;let Ke=tn||"sistema";try{const Ve=localStorage.getItem("user");if(Ve){const Qe=JSON.parse(Ve);Ke=Qe&&(Qe.username||Qe.user?.username||Qe.name||Qe.user?.name)?Qe.username||Qe.user?.username||Qe.name||Qe.user?.name:String(Qe)}}catch{}const it=Ga(),De=Aa.filter(Ve=>{if(!Ve.producto_id||Ve.producto_id===null)return!1;const Qe=f.find(Ut=>String(Ut.producto.id)===String(Ve.producto_id));return Qe&&Qe.producto.tipo!=="servicio"}).map(Ve=>({producto_id:Ve.producto_id,cantidad:Ve.cantidad,tipo_de_movimiento:"SALIDA",referencia:Be,usuario:Ke,fecha_salida:it}));if(De.length>0){const{data:Ve,error:Qe}=await F.from("registro_de_inventario").insert(De).select("id");Qe?console.warn("Error registrando salida en registro_de_inventario:",Qe):console.debug("Registro_de_inventario inserciones (salida):",Ve)}}catch(Be){console.warn("Excepcin registrando salidas en registro_de_inventario:",Be)}try{const Be={};for(const Ke of Aa){if(!Ke.producto_id||Ke.producto_id===null)continue;const it=String(Ke.producto_id),De=Number(Ke.cantidad||0),Ve=f.find(Qe=>String(Qe.producto.id)===it);Ve&&Ve.producto.tipo==="servicio"||(Be[it]||(Be[it]=0),Be[it]+=De)}for(const Ke of Object.keys(Be))try{const it=Number(Be[Ke]||0);if(it<=0)continue;const{data:De,error:Ve}=await F.from("inventario").select("stock").eq("id",Ke).maybeSingle();if(Ve){console.warn("Error leyendo stock de inventario para producto",Ke,Ve);continue}const Qe=De&&De.stock!=null?Number(De.stock):0,Ut=Math.max(0,Qe-it),{error:nn}=await F.from("inventario").update({stock:Ut}).eq("id",Ke);nn?console.warn("Error actualizando stock para producto",Ke,nn):console.debug("Stock actualizado para producto",Ke,"de",Qe,"a",Ut)}catch(it){console.warn("Excepcin actualizando stock para producto",Ke,it)}}catch(Be){console.warn("Excepcin agregada en proceso de actualizacin de stock:",Be)}try{if(Ne&&Array.isArray(Ne.pagos)&&Ne.pagos.length>0){const Ke=typeof _e=="string"&&/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(_e),De=typeof _e=="number"||typeof _e=="string"&&/^\d+$/.test(_e)?Number(_e):null,Ve=Ne.pagos.map($t=>{const ia=String($t.tipo||"").toLowerCase();let ra=null;try{ia.includes("efectivo")||ia==="cash"?ra="1 = 1 lps":(ia.includes("dolar")||ia.includes("usd"))&&(ra=`1 = ${Number(O||0).toFixed(2)} lps`)}catch{ra=null}return{venta_id:Wt,tipo:$t.tipo,monto:Number($t.monto||0),banco:$t.banco||null,tarjeta:$t.tarjeta||null,factura:we||$t.factura||null,autorizador:$t.autorizador||null,referencia:$t.referencia||null,meta:$t.meta||null,created_by:Ke?_e:null,created_at:Ga(),usuario_id:De,usuario_nombre:typeof tn=="string"&&tn.length>0?tn:null,valor_moneda:ra}});try{const $t=Number(xe||0);if($t>0){const ia={venta_id:Wt,tipo:"efectivo",monto:-Number($t.toFixed(2)),banco:null,tarjeta:null,factura:we||null,autorizador:null,referencia:"Cambio",meta:null,created_by:Ke?_e:null,created_at:Ga(),usuario_id:De,usuario_nombre:typeof tn=="string"&&tn.length>0?tn:null,valor_moneda:"1 = 1 lps"};Ve.push(ia)}}catch($t){console.debug("Error registrando cambio en pagos:",$t)}const Qe=Ve,{data:Ut,error:nn}=await F.from("pagos").insert(Qe).select("id");nn?console.warn("Error insertando pagos en tabla pagos:",nn):console.debug("Pagos insertados:",Ut)}}catch(Be){console.warn("Excepcin insertando pagos:",Be)}const ya=me&&(me.id||me.id===0)?me.id:null;if(ya!=null&&Re!=null)try{const Be=Ie??String(Re);try{const Ke=me?.rango_hasta!=null?String(me.rango_hasta):"",it=Number(Ke.replace(/[^0-9]/g,""))||null,De=Number(String(Be).replace(/[^0-9]/g,""))||null;if(it!=null&&De!=null&&De>it)console.warn("No se actualizar cai.secuencia_actual porque excede rango_hasta",{toStoreNum:De,rangoHastaNum:it});else{const{error:Ve}=await F.from("cai").update({secuencia_actual:Be}).eq("id",ya);if(Ve)console.debug("Error updating cai.secuencia_actual (manual path):",Ve);else{console.debug("Updated cai.secuencia_actual to",Be,"for cai id",ya);try{const Qe={...me||{},secuencia_actual:Be};Na(Qe);try{localStorage.setItem("caiInfo",JSON.stringify(Qe))}catch{}}catch(Qe){console.debug("Error updating local caiInfoState/localStorage:",Qe)}}}}catch(Ke){console.debug("Validation error while checking rango_hasta:",Ke);const{error:it}=await F.from("cai").update({secuencia_actual:Be}).eq("id",ya);if(it)console.debug("Error updating cai.secuencia_actual (manual path, after validation fail):",it);else{console.debug("Updated cai.secuencia_actual to",Be,"for cai id",ya);try{const De={...me||{},secuencia_actual:Be};Na(De);try{localStorage.setItem("caiInfo",JSON.stringify(De))}catch{}}catch(De){console.debug("Error updating local caiInfoState/localStorage (after validation):",De)}}}}catch(Be){console.debug("Exception updating cai.secuencia_actual:",Be)}try{await pa()}catch(Be){console.debug("refreshProducts after insertVenta failed",Be)}return Wt},Ft=async()=>{if(Z==="factura"&&ae)try{console.debug("handlePostPrint: marcando cotizacion como facturado, id=",ae);const{error:te}=await F.from("cotizaciones").update({estado:"aceptada"}).eq("id",ae);te?console.warn("Error marcando cotizacion como facturado:",te):console.debug("Cotizacion marcada como facturado:",ae)}catch(te){console.warn("Error procesando cotizacion tras facturar",te)}};y.useEffect(()=>{he&&setTimeout(()=>{try{$e.current?.focus()}catch{}},80)},[he]);const hn=async()=>{try{if(se&&Le){const pe={rtn:se,nombre:Le},{error:_e}=await F.from("clientenatural").upsert(pe,{onConflict:"rtn"});_e&&console.warn("Error guardando clientenatural:",_e)}}catch(pe){console.warn("Error upsert clientenatural:",pe)}try{if(se&&Le)if(st==="juridico"){const{data:pe,error:_e}=await F.from("clientes").select("id").eq("rtn",se).eq("tipo_cliente","juridico").maybeSingle();if(_e&&console.warn("Error buscando cliente juridico:",_e),pe&&pe.id){const{error:ke}=await F.from("clientes").update({nombre:Le,telefono:kt||null,correo_electronico:ut||null,exonerado:Ot}).eq("id",pe.id);ke&&console.warn("Error actualizando cliente juridico:",ke)}else{const{error:ke}=await F.from("clientes").insert([{nombre:Le,rtn:se,telefono:kt||null,correo_electronico:ut||null,tipo_cliente:"juridico",exonerado:Ot}]);ke&&console.warn("Error insertando cliente juridico:",ke)}}else{const pe={rtn:se,nombre:Le},{error:_e}=await F.from("clientenatural").upsert(pe,{onConflict:"rtn"});_e&&console.warn("Error guardando clientenatural:",_e)}}catch(pe){console.warn("Error upsert cliente:",pe)}const be=await(ea==="cinta"?jg:gl)({cliente:Le||"Cliente",rtn:se||""},Z,{carrito:f,subtotal:Ya(),isvTotal:K,imp18Total:ne,impTouristTotal:Y,taxRate:E,tax18Rate:L,taxTouristRate:z,total:A,pagos:on});if(Z==="factura"&&ae)try{console.debug("Pre-print: marcando cotizacion como facturado, id=",ae);const{error:pe}=await F.from("cotizaciones").update({estado:"aceptada"}).eq("id",ae);if(pe)console.warn("Error marcando cotizacion como facturado (pre-print):",pe);else{console.debug("Cotizacion marcada como facturado (pre-print):",ae);try{V(null)}catch{}}}catch(pe){console.warn("Error marcacion pre-print:",pe)}if(Z==="factura")try{let pe=null,_e=null;try{const ke=localStorage.getItem("user"),Ae=ke?JSON.parse(ke):null;_e=Ae&&(Ae.id||Ae.user?.id||Ae.sub||Ae.user_id)?Ae.id||Ae.user?.id||Ae.sub||Ae.user_id:null;const xe=Ae&&(Ae.username||Ae.user?.username||Ae.name||Ae.user?.name)?Ae.username||Ae.user?.username||Ae.name||Ae.user?.name:null;if(console.debug("PV (clienteNormal): CAI lookup - raw localStorage.user:",ke),console.debug("PV (clienteNormal): CAI lookup - parsed user object:",Ae),console.debug("PV (clienteNormal): CAI lookup - extracted userId:",_e,"typeof",typeof _e),console.debug("PV (clienteNormal): CAI lookup - extracted userNameFromStorage:",xe),_e){const we=typeof _e=="string"&&/^\d+$/.test(_e)?Number(_e):_e;try{const{data:me,error:Re}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("usuario_id",we).order("id",{ascending:!1}).limit(1);!Re&&Array.isArray(me)&&me.length>0&&(pe=me[0])}catch(me){console.debug("PV (clienteNormal): CAI lookup by usuario_id failed (likely column missing):",me)}}if(!pe&&xe)try{const{data:we,error:me}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("cajero",xe).order("id",{ascending:!1}).limit(1);!me&&Array.isArray(we)&&we.length>0&&(pe=we[0])}catch(we){console.debug("PV (clienteNormal): CAI lookup by cajero failed:",we)}}catch(ke){console.debug("No se pudo cargar CAI desde frontend (cliente normal):",ke)}await ta({clienteName:Le||"Cliente",rtn:se||null,paymentPayload:on,caiData:pe,usuarioId:_e})}catch(pe){console.warn("Error insertando venta en flujo cliente normal:",pe)}try{const pe=document.createElement("iframe");pe.style.position="fixed",pe.style.right="0",pe.style.bottom="0",pe.style.width="0",pe.style.height="0",pe.style.border="0",pe.style.overflow="hidden",pe.setAttribute("aria-hidden","true"),document.body.appendChild(pe);const _e=pe.contentWindow,ke=pe.contentDocument||pe.contentWindow?.document;if(!ke||!_e)try{document.body.removeChild(pe)}catch{}else{ke.open(),ke.write(be),ke.close();const Ae=()=>{try{_e.focus(),_e.print()}catch(we){console.warn("Error during iframe print (cliente normal):",we)}setTimeout(()=>{try{document.body.removeChild(pe)}catch{}},800)},xe=()=>{try{const we=ke.images;if(we&&we.length>0){let me=0;for(let Re=0;Re<we.length;Re++){const Fe=we[Re];Fe.complete?me++:(Fe.addEventListener("load",()=>{me++,me===we.length&&Ae()}),Fe.addEventListener("error",()=>{me++,me===we.length&&Ae()}))}me===we.length&&Ae()}else Ae()}catch{try{_e.addEventListener("load",Ae)}catch{}setTimeout(Ae,1e3)}};try{ke.readyState==="complete"?xe():(_e.addEventListener("load",xe),setTimeout(xe,1500))}catch{setTimeout(xe,800)}}}catch(pe){console.warn("Direct print (cliente normal) failed, falling back to new window",pe);const _e=window.open("","_blank");_e&&(_e.document.open(),_e.document.write(be),_e.document.close(),setTimeout(()=>{try{_e.print(),_e.close()}catch{}},800))}await(async()=>{Z==="factura"&&(U(),await Ft()),Z==="cotizacion"&&(J({cliente:Le||"Cliente",rtn:se||null}),P(!0))})(),Te(!1)},[vn,$n]=y.useState(null),[Fo,xl]=y.useState([]),[Vo,Ea]=y.useState(!1),[$r,ha]=y.useState(null);y.useEffect(()=>{fetch("/data-base/inventario.json").then(async te=>{if(!te.ok)return console.warn("inventario.json no disponible, status",te.status),null;const be=te.headers.get("content-type")||"";if(!be.includes("application/json"))return console.warn("inventario.json no es JSON, content-type:",be),null;try{return await te.json()}catch(Ne){return console.warn("Error parseando inventario.json:",Ne),null}}).then(te=>{te&&Array.isArray(te.items)&&xl(te.items),console.log("inventario cargado:",te&&te.items?te.items.length:0)}).catch(te=>{console.warn("Error cargando inventario:",te)})},[]);const pa=async()=>{try{const{data:te,error:be}=await F.from("inventario").select("id, sku, nombre, categoria, imagen, modelo, descripcion, exento, aplica_impuesto_18, aplica_impuesto_turistico, tipo");if(be)throw be;const Ne=Array.isArray(te)?te:[],pe=Ne.map(xe=>String(xe.id));if(pe.length===0){d([]);return}const _e={};try{const{data:xe,error:we}=await F.from("precios").select("producto_id, precio").order("id",{ascending:!1});if(we)throw we;if(Array.isArray(xe))for(const me of xe){const Re=String(me.producto_id);_e[Re]||(_e[Re]=Number(me.precio||0))}}catch(xe){console.warn("Error cargando precios en PV:",xe)}let ke={};try{const{data:xe,error:we}=await F.from("registro_de_inventario").select("producto_id, cantidad, tipo_de_movimiento").in("producto_id",pe);if(we)throw we;const me=Array.isArray(xe)?xe:[];ke={},pe.forEach(Re=>ke[Re]=0);for(const Re of me){const Fe=String(Re.producto_id),Ie=Number(Re.cantidad)||0,Nt=String(Re.tipo_de_movimiento||"").toUpperCase();Nt==="ENTRADA"?ke[Fe]=(ke[Fe]||0)+Ie:Nt==="SALIDA"&&(ke[Fe]=(ke[Fe]||0)-Ie)}}catch(xe){console.warn("Error cargando registro_de_inventario en PV:",xe),ke={},pe.forEach(we=>ke[we]=0)}const Ae=Ne.map(xe=>({id:String(xe.id),sku:xe.sku,nombre:xe.nombre,categoria:xe.categoria,imagen:xe.imagen,precio:_e[String(xe.id)]!==void 0?_e[String(xe.id)]:xe.precio!==void 0?Number(xe.precio):0,exento:xe.exento===!0||String(xe.exento)==="true"||Number(xe.exento)===1||!1,aplica_impuesto_18:xe.aplica_impuesto_18===!0||String(xe.aplica_impuesto_18)==="true"||Number(xe.aplica_impuesto_18)===1||!1,aplica_impuesto_turistico:xe.aplica_impuesto_turistico===!0||String(xe.aplica_impuesto_turistico)==="true"||Number(xe.aplica_impuesto_turistico)===1||!1,stock:Number((ke[String(xe.id)]||0).toFixed(2)),tipo:xe.tipo==="servicio"?"servicio":"producto"}));d(Ae)}catch(te){console.warn("Error cargando productos desde inventario:",te),d([])}};y.useEffect(()=>{let te=!0;return pa().catch(be=>{te&&console.warn("refreshProducts error",be)}),()=>{te=!1}},[]),y.useEffect(()=>{const te=Ne=>{try{const pe=Ne||(()=>{const Ae=localStorage.getItem("cotizacion_to_load");return Ae?JSON.parse(Ae):null})();if(!pe)return;try{V(pe.header&&pe.header.id?String(pe.header.id):null)}catch{}try{const Ae=pe.header&&(pe.header.numero_cotizacion||pe.header.Nmero||pe.header.numero)?pe.header.numero_cotizacion||pe.header.Nmero||pe.header.numero:null;Ae&&de(Ae)}catch{}const ke=(Array.isArray(pe.detalles)?pe.detalles:[]).map(Ae=>{const xe=c.find(me=>String(me.id)===String(Ae.producto_id));return{producto:xe?{...xe}:{id:String(Ae.producto_id||"temp-"+Math.random().toString(36).slice(2,8)),sku:Ae.sku??void 0,nombre:Ae.descripcion||Ae.nombre||"Artculo",precio:Number(Ae.precio_unitario||Ae.precio||0),categoria:void 0,exento:!1,aplica_impuesto_18:!1,aplica_impuesto_turistico:!1,stock:0,imagen:void 0},cantidad:Number(Ae.cantidad||1)}});ke.length>0&&g(ke);try{localStorage.removeItem("cotizacion_to_load")}catch{}}catch{}};te();const be=Ne=>{try{te(Ne.detail)}catch{}};return window.addEventListener("cotizacion:load",be),()=>{window.removeEventListener("cotizacion:load",be)}},[c]);const[tn,Ka]=y.useState(null),[Vt,Wo]=y.useState(null),[Hr,Ta]=y.useState(null),[ga,Na]=y.useState(null),[vl,Pr]=y.useState(null),[jl,_i]=y.useState(!1),[wi,na]=y.useState({}),jn=async()=>{try{let te=null;try{const be=localStorage.getItem("user"),Ne=be?JSON.parse(be):null;let pe=Hr??(Ne&&(Ne.id||Ne.user?.id||Ne.sub||Ne.user_id)?Ne.id||Ne.user?.id||Ne.sub||Ne.user_id:null);const _e=tn??(Ne&&(Ne.username||Ne.user?.username||Ne.name||Ne.user?.name)?Ne.username||Ne.user?.username||Ne.name||Ne.user?.name:null),ke=pe!=null&&typeof pe=="string"&&/^\d+$/.test(pe)?Number(pe):pe;if(ke!=null)try{const{data:Ae,error:xe}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("usuario_id",ke).order("id",{ascending:!1}).limit(1);!xe&&Array.isArray(Ae)&&Ae.length>0&&(te=Ae[0])}catch(Ae){console.debug("refreshCaiInfo: lookup by usuario_id failed:",Ae)}if(!te&&_e)try{const{data:Ae,error:xe}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("cajero",_e).order("id",{ascending:!1}).limit(1);!xe&&Array.isArray(Ae)&&Ae.length>0&&(te=Ae[0])}catch(Ae){console.debug("refreshCaiInfo: lookup by cajero failed:",Ae)}}catch(be){console.debug("refreshCaiInfo: error building lookup params",be)}if(te){Na(te);try{localStorage.setItem("caiInfo",JSON.stringify(te))}catch{}console.debug("refreshCaiInfo: updated caiInfoState",te)}}catch(te){console.debug("refreshCaiInfo: unexpected error",te)}};y.useEffect(()=>{try{const te=localStorage.getItem("user");if(te){const be=JSON.parse(te);Ka(be.username||be.name||null),Wo(be.role||null);let Ne=null;try{Ne=be&&(be.id||be.user?.id||be.sub||be.user_id)?be.id||be.user?.id||be.sub||be.user_id:null,Ta(Ne??null),console.debug("PV: localStorage.user parsed:",be),console.debug("PV: extracted userId for CAI/RPC usage:",Ne)}catch(pe){console.debug("PV: error parsing localStorage.user for debug:",pe)}try{const pe=localStorage.getItem("caiInfo");if(pe){const _e=JSON.parse(pe);Na(_e),console.debug("PV: loaded caiInfo from localStorage:",_e),(async()=>{try{if(!(_e&&_e.rango_de!==void 0&&_e.rango_hasta!==void 0&&_e.fecha_vencimiento!==void 0&&_e.secuencia_actual!==void 0)){const Ae=be&&(be.username||be.user?.username||be.name||be.user?.name)?be.username||be.user?.username||be.name||be.user?.name:null,xe=Ne&&typeof Ne=="string"&&/^\d+$/.test(Ne)?Number(Ne):Ne;let we=null;try{if(xe!=null){const{data:me,error:Re}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("usuario_id",xe).order("id",{ascending:!1}).limit(1);!Re&&Array.isArray(me)&&me.length>0&&(we=me[0])}}catch(me){console.debug("PV: refetch CAI by usuario_id failed (column may be missing):",me)}if(!we&&Ae)try{const{data:me,error:Re}=await F.from("cai").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual").eq("cajero",Ae).order("id",{ascending:!1}).limit(1);!Re&&Array.isArray(me)&&me.length>0&&(we=me[0])}catch(me){console.debug("PV: refetch CAI by cajero failed:",me)}if(we){Na(we);try{localStorage.setItem("caiInfo",JSON.stringify(we))}catch{}console.debug("PV: refreshed caiInfo from Supabase:",we)}}}catch(ke){console.debug("PV: error trying to refresh caiInfo:",ke)}})()}}catch(pe){console.debug("PV: error parsing localStorage.caiInfo:",pe)}try{const pe=localStorage.getItem("ncInfo");if(pe){const _e=JSON.parse(pe);Pr(_e),console.debug("PV: loaded ncInfo from localStorage:",_e),(async()=>{try{if(!(_e&&_e.rango_de!==void 0&&_e.rango_hasta!==void 0&&_e.fecha_vencimiento!==void 0&&_e.secuencia_actual!==void 0)){const Ae=be&&(be.username||be.user?.username||be.name||be.user?.name)?be.username||be.user?.username||be.name||be.user?.name:null,xe=Ne&&typeof Ne=="string"&&/^\d+$/.test(Ne)?Number(Ne):Ne;let we=null;try{if(xe!=null){const{data:me,error:Re}=await F.from("ncredito").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual,caja,cajero,usuario_id").eq("usuario_id",xe).order("id",{ascending:!1}).limit(1);!Re&&Array.isArray(me)&&me.length>0&&(we=me[0])}}catch(me){console.debug("PV: refetch ncInfo by usuario_id failed (column may be missing):",me)}if(!we&&Ae)try{const{data:me,error:Re}=await F.from("ncredito").select("id,cai,identificador,rango_de,rango_hasta,fecha_vencimiento,secuencia_actual,caja,cajero,usuario_id").eq("cajero",Ae).order("id",{ascending:!1}).limit(1);!Re&&Array.isArray(me)&&me.length>0&&(we=me[0])}catch(me){console.debug("PV: refetch ncInfo by cajero failed:",me)}if(we){Pr(we);try{localStorage.setItem("ncInfo",JSON.stringify(we))}catch{}console.debug("PV: refreshed ncInfo from Supabase:",we)}}}catch(ke){console.debug("PV: error trying to refresh ncInfo:",ke)}})()}}catch(pe){console.debug("PV: error parsing localStorage.ncInfo:",pe)}}}catch{}},[]),y.useEffect(()=>{let te=!0;return(async()=>{try{const{data:be,error:Ne}=await F.from("impuesto").select("id, impuesto_venta");if(Ne)throw Ne;if(!be||!Array.isArray(be))return;const pe=xe=>{const we=be.find(Fe=>Number(Fe.id)===xe);if(!we)return null;const me=we.impuesto_venta;if(me==null)return null;const Re=Number(me);return Number.isNaN(Re)?null:Re>1?Re/100:Re},_e=pe(1),ke=pe(2),Ae=pe(3);if(te){let xe=_e,we=ke,me=Ae;try{if((xe===null||xe===0)&&te){const Fe=(await F.from("impuesto").select("impuesto_venta").eq("id",1).maybeSingle())?.data?.impuesto_venta??null,Ie=Fe==null?null:Number(Fe);Ie!=null&&!Number.isNaN(Ie)&&(xe=Ie>1?Ie/100:Ie)}if((we===null||we===0)&&te){const Fe=(await F.from("impuesto").select("impuesto_venta").eq("id",2).maybeSingle())?.data?.impuesto_venta??null,Ie=Fe==null?null:Number(Fe);Ie!=null&&!Number.isNaN(Ie)&&(we=Ie>1?Ie/100:Ie)}if((me===null||me===0)&&te){const Fe=(await F.from("impuesto").select("impuesto_venta").eq("id",3).maybeSingle())?.data?.impuesto_venta??null,Ie=Fe==null?null:Number(Fe);Ie!=null&&!Number.isNaN(Ie)&&(me=Ie>1?Ie/100:Ie)}}catch(Re){console.warn("PV: fallback single-id impuesto fetch failed",Re)}(xe===null||xe===0)&&(xe=.15),(we===null||we===0)&&(we=.18),(me===null||me===0)&&(me=.04),T(xe),R(we),C(me),console.debug("PV: impuestos raw rows",be),console.debug("PV: resolved tax rates",{taxRate:xe,tax18Rate:we,taxTouristRate:me})}}catch(be){console.warn("Error cargando impuesto en PV:",be)}})(),()=>{te=!1}},[]);const Go=te=>{console.log("openUbicacion",te,"entradasCount",Fo.length);let be=null;try{be=c.find(pe=>String(pe.sku||"")===String(te)||String(pe.id)===String(te))||null}catch{be=null}if(be){const pe=Number(be.stock??0),_e={id:be.id,producto:be.nombre||"",sku:be.sku||"",imagen:be.imagen||null,descripcion:be.descripcion||"",ubicacion:be.ubicacion||null,cantidad:pe};ha(_e),Ea(!0);return}const Ne=Fo.find(pe=>pe.sku===te)||null;console.log("entrada encontrada",Ne),ha(Ne),Ea(!0)};if(y.useEffect(()=>{let te=!0;return(async()=>{try{const be="inventario",Ne={};await Promise.all((c||[]).map(async pe=>{const _e=pe.imagen;if(!_e){Ne[String(pe.id)]=null;return}const ke=String(_e);if(ke.startsWith("http")){Ne[String(pe.id)]=ke;return}let Ae=ke;const xe=String(ke).match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);xe&&(Ae=decodeURIComponent(xe[2]));try{const we=await F.storage.from(be).getPublicUrl(Ae),me=we?.data?.publicUrl||we?.data?.publicURL||null;if(me){Ne[String(pe.id)]=me;return}}catch{}try{const me=(await F.storage.from(be).createSignedUrl(Ae,604800))?.data?.signedUrl??null;Ne[String(pe.id)]=me}catch{Ne[String(pe.id)]=null}})),te&&na(Ne)}catch(be){console.warn("Error resolviendo imgenes en PV",be)}})(),()=>{te=!1}},[c]),vn){if(vn==="DevolucionCaja")return t.jsx(bv,{onBack:()=>$n(null)});if(vn==="IngresoEfectivo")return t.jsx(Sv,{onBack:()=>$n(null)});if(vn==="CotizacionesGuardadas")return t.jsx(wv,{onBack:()=>$n(null)});if(vn==="PedidosEnLinea")return t.jsx(Cv,{onBack:()=>$n(null)});if(vn==="CorteCajaParcial")return t.jsx(Rv,{onBack:()=>$n(null)});if(vn==="AnulacionFactura")return t.jsx(Sm,{onBack:()=>$n(null)})}return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
          /* Ajustes para tablets y viewport */
          @media (max-width: 1024px) {
            .pdv-main-container {
              padding-top: 8px !important;
              min-height: auto !important;
            }
            .pdv-grid {
              grid-template-columns: 1fr 300px !important;
              gap: 8px !important;
            }
            .pdv-cart {
              max-height: 60vh !important;
            }
            .pdv-table-container {
              max-height: 60vh !important;
              min-height: 40vh !important;
            }
            .pdv-table-container table th {
              padding: 8px 6px !important;
              font-size: 0.75rem !important;
            }
            .pdv-table-container table td {
              padding: 6px 5px !important;
              font-size: 0.8rem !important;
            }
            .pdv-buttons {
              flex-wrap: wrap !important;
              justify-content: center !important;
              padding: 8px 12px !important;
            }
            .pdv-button {
              flex: 1 1 100px !important;
              min-width: 100px !important;
              padding: 6px 12px !important;
              font-size: 11px !important;
            }
          }
          @media (max-width: 768px) {
            .pdv-grid {
              grid-template-columns: 1fr 250px !important;
              gap: 6px !important;
            }
            .pdv-main-container {
              padding: 8px !important;
            }
            .pdv-search-bar {
              flex-direction: column !important;
            }
            .pdv-search-bar input,
            .pdv-search-bar select {
              width: 100% !important;
              min-width: 100% !important;
            }
            .pdv-button {
              padding: 8px 14px !important;
              font-size: 11px !important;
            }
          }
        `}),t.jsxs("div",{style:{minHeight:"100vh",fontFamily:"system-ui, sans-serif",background:"#f8fafc"},children:[t.jsx(Iv,{userName:tn,userRole:Vt,userId:Hr,caiInfo:ga,onLogout:l,onNavigate:te=>$n(te),onOpenDatosFactura:()=>_i(!0),onPrintFormatChange:te=>qo(te),onOpenCajaConfig:()=>Gi(!0),printFormat:ea}),t.jsxs("div",{className:"pdv-main-container",style:{padding:16,maxWidth:1600,margin:"0 auto"},children:[t.jsxs("div",{className:"pdv-search-bar",style:{background:"white",padding:14,borderRadius:10,boxShadow:"0 1px 4px rgba(0,0,0,0.05)",marginBottom:16,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[t.jsx("input",{type:"text",placeholder:"Buscar por nombre o SKU...",value:p,onChange:te=>m(te.target.value),onKeyDown:te=>{if(te.key==="Enter"){const be=String(p||"").trim().toLowerCase();if(!be)return;const pe=M.find(_e=>String(_e.sku||"").toLowerCase()===be)||M[0];if(pe){const _e=Number(pe.stock??0),ke=Number(pe.precio??0);_e>=1&&ke>0?X(pe):console.debug("No se puede agregar por stock/precio",{id:pe.id,stockNum:_e,precioNum:ke})}}},style:{flex:1,minWidth:220,padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1"}}),t.jsx("select",{value:b,onChange:te=>S(te.target.value),style:{padding:"10px 12px",borderRadius:8,border:"1px solid #cbd5e1",minWidth:140},children:k.map(te=>t.jsx("option",{value:te,children:te},te))})]}),t.jsxs("div",{className:"pdv-grid",style:{display:"grid",gridTemplateColumns:"1fr 420px",gap:16},children:[t.jsxs("div",{className:"pdv-table-container",style:{background:"white",borderRadius:10,overflow:"hidden",boxShadow:"0 1px 4px rgba(0,0,0,0.05)",minHeight:"50vh",maxHeight:"70vh",display:"flex",flexDirection:"column"},children:[t.jsx(Uv,{productos:M,imageUrls:wi,agregarAlCarrito:X,openUbicacion:Go,thStyle:Kv,tdStyle:Jv,skuStyle:Qv}),t.jsxs("div",{className:"pdv-buttons",style:{padding:"12px 16px",background:"#f8fafc",borderTop:"1px solid #e2e8f0",display:"flex",gap:8,justifyContent:"center"},children:[t.jsx("button",{className:"pdv-button",onClick:()=>x("producto"),style:{padding:"8px 20px",borderRadius:6,fontSize:13,fontWeight:600,border:"1px solid",borderColor:j==="producto"?"#0ea5e9":"#e2e8f0",background:j==="producto"?"#0ea5e9":"white",color:j==="producto"?"white":"#64748b",cursor:"pointer",transition:"all 0.15s ease"},children:" Producto"}),t.jsx("button",{className:"pdv-button",onClick:()=>x("servicio"),style:{padding:"8px 20px",borderRadius:6,fontSize:13,fontWeight:600,border:"1px solid",borderColor:j==="servicio"?"#0ea5e9":"#e2e8f0",background:j==="servicio"?"#0ea5e9":"white",color:j==="servicio"?"white":"#64748b",cursor:"pointer",transition:"all 0.15s ease"},children:" Servicio"}),t.jsx("button",{className:"pdv-button",onClick:()=>v(!0),style:{padding:"8px 20px",borderRadius:6,fontSize:13,fontWeight:600,border:"1px solid #10b981",background:"#10b981",color:"white",cursor:"pointer",transition:"all 0.15s ease"},children:" Entrada Manual"})]})]}),t.jsx(Lv,{carrito:f,actualizarCantidad:ge,eliminarDelCarrito:re,vaciarCarrito:U,subtotal:N,perItemTaxes:q,taxRate:E,tax18Rate:L,taxTouristRate:z,total:A,openSelector:bl,btnStyle:Xv})]})]}),t.jsx($v,{open:Vo,selectedEntrada:$r,onClose:()=>{Ea(!1),ha(null)},imageUrls:wi}),t.jsx(Bv,{open:bt,totalDue:A,exchangeRate:O,onClose:()=>ht(!1),onConfirm:async te=>{if(xn(te),Xt(!0),qn)try{fa(!1),await qr("Consumidor Final","C/F",te)}catch(be){console.warn("Error facturando despus del pago:",be)}ht(!1)}}),t.jsx(Dr.Suspense,{fallback:null}),t.jsx(Mv,{open:$o,onClose:()=>Gi(!1),printFormat:ea,onPrintFormatChange:te=>qo(te),exchangeRate:O,onExchangeRateChange:te=>I(te)}),t.jsx(Hv,{open:oe,onClose:()=>P(!1),onCancel:()=>{P(!1),J(null)},onSave:async()=>{P(!1);try{const te=await Lr(Se||{});te&&te.id&&V(String(te.id))}catch(te){console.warn("Error guardando cotizacion desde confirm modal",te)}J(null)}}),t.jsx(Vv,{open:et,onClose:()=>ft(!1),carritoLength:f.length,subtotal:Ya(),saveCotizacion:Lr,finalizePrint:B}),t.jsx(Pv,{open:$,onClose:()=>H(!1),doFacturaClienteFinal:Ir,doFacturaClienteNormal:Mr,doFacturaClienteJuridico:Po,carritoLength:f.length,subtotal:Ya(),taxRate:E,taxableSubtotal:Ho()}),t.jsx(Fv,{open:he,onClose:()=>Te(!1),clienteTipo:st,clienteRTN:se,clienteNombre:Le,clienteTelefono:kt,clienteCorreo:ut,clienteExonerado:Ot,clienteSearchOpen:Oe,setClienteSearchOpen:te=>Ue(te),onRTNChange:te=>Si(te),onNombreChange:te=>ze(te),onTelefonoChange:te=>Rt(te),onCorreoChange:te=>mn(te),onExoneradoChange:te=>Nn(te),onCreateCliente:()=>qe(!0),onCancel:()=>Te(!1),onOpenCreateCliente:()=>qe(!0),onOpenPayment:()=>ht(!0),paymentDone:rn,submitClienteNormal:hn}),t.jsx(_m,{open:bn,onClose:()=>qe(!1),clienteRTN:se,clienteNombre:Le,clienteTelefono:kt,clienteCorreo:ut,clienteExonerado:Ot,onChangeRTN:te=>ve(te),onChangeNombre:te=>ze(te),onChangeTelefono:te=>Rt(te),onChangeCorreo:te=>mn(te),onChangeExonerado:te=>Nn(te),onCreate:async()=>{try{if(!Le||!se)return;const{data:te,error:be}=await F.from("clientes").select("id").eq("rtn",se).maybeSingle();if(be&&console.warn("Error buscando cliente al crear:",be),te&&te.id){const{error:Ne}=await F.from("clientes").update({nombre:Le,telefono:kt||null,correo_electronica:ut||null,tipo_cliente:"juridico",exonerado:Ot}).eq("id",te.id);Ne&&console.warn("Error actualizando cliente al crear:",Ne)}else{const{error:Ne}=await F.from("clientes").insert([{nombre:Le,rtn:se,telefono:kt||null,correo_electronica:ut||null,tipo_cliente:"juridico",exonerado:Ot}]);Ne&&console.warn("Error insertando cliente al crear:",Ne)}}catch(te){console.warn("Error creando cliente juridico:",te)}qe(!1)}}),t.jsx(qv,{open:jl,onClose:()=>_i(!1),caiInfo:ga,onRefresh:jn}),r&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:3e3},children:t.jsxs("div",{style:{background:"white",padding:24,borderRadius:12,width:400,textAlign:"center",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},children:[t.jsx("div",{style:{fontSize:48,marginBottom:16},children:""}),t.jsx("h3",{style:{margin:"0 0 12px 0",color:"#1e293b"},children:"Caja Cerrada"}),t.jsx("p",{style:{color:"#64748b",marginBottom:24,lineHeight:1.5},children:"Debes realizar la apertura de caja antes de poder realizar ventas."}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:12},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>s(!1),children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:()=>{s(!1),$n("CorteCajaParcial")},children:"Ir a Apertura"})]})]})}),w&&t.jsx(Yv,{open:w,onClose:()=>v(!1),onAgregar:te=>{const be={id:`temp-${Date.now()}`,nombre:te.descripcion,precio:te.precio,categoria:te.tipo,tipo:"servicio",stock:0,exento:!1};X(be),v(!1)}})]})]})}function Yv({open:l,onClose:i,onAgregar:r}){const[s,c]=y.useState(""),[d,f]=y.useState("SERVICIOS VARIOS"),[g,p]=y.useState(""),m=b=>{if(b.preventDefault(),!s.trim()){alert("Ingrese una descripcin");return}if(!g||parseFloat(g)<=0){alert("Ingrese un precio vlido mayor a 0");return}r({descripcion:s.trim(),tipo:d,precio:parseFloat(g)}),c(""),f("SERVICIOS VARIOS"),p("")};return l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{background:"white",padding:24,borderRadius:12,width:500,maxHeight:"90vh",overflow:"auto",boxShadow:"0 10px 40px rgba(0,0,0,0.2)"},children:[t.jsx("h3",{style:{marginTop:0,color:"#1e293b",fontSize:20},children:" Entrada Manual - Servicio"}),t.jsxs("form",{onSubmit:m,children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569",marginBottom:6,fontWeight:600},children:"Descripcin del servicio *"}),t.jsx("input",{className:"input",type:"text",value:s,onChange:b=>c(b.target.value),placeholder:"Ej: Reparacin de equipo, servicio tcnico...",autoFocus:!0})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569",marginBottom:6,fontWeight:600},children:"Tipo de servicio *"}),t.jsxs("select",{className:"input",value:d,onChange:b=>f(b.target.value),children:[t.jsx("option",{value:"SERVICIOS VARIOS",children:"SERVICIOS VARIOS"}),t.jsx("option",{value:"REPARACIONES VARIAS",children:"REPARACIONES VARIAS"}),t.jsx("option",{value:"COBRO POR INCONSISTENCIA",children:"COBRO POR INCONSISTENCIA"})]})]}),t.jsxs("div",{style:{marginBottom:24},children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569",marginBottom:6,fontWeight:600},children:"Precio (L) *"}),t.jsx("input",{className:"input",type:"number",step:"0.01",min:"0.01",value:g,onChange:b=>p(b.target.value),placeholder:"0.00"})]}),t.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"flex-end"},children:[t.jsx("button",{type:"button",className:"btn-opaque",onClick:i,style:{padding:"10px 20px",background:"#e2e8f0",color:"#475569"},children:"Cancelar"}),t.jsx("button",{type:"submit",className:"btn-opaque",style:{padding:"10px 20px",background:"#10b981",color:"white"},children:" Agregar al Carrito"})]})]})]})}):null}const Kv={padding:"12px 10px",textAlign:"left",fontSize:"0.85rem",fontWeight:600,color:"#475569"},Jv={padding:"10px",fontSize:"0.9rem",verticalAlign:"middle"},Qv={fontSize:"0.75rem",background:"#e2e8f0",padding:"2px 6px",borderRadius:4,fontFamily:"monospace"},Xv={width:26,height:26,borderRadius:6,border:"none",background:"#e2e8f0",fontWeight:"bold",cursor:"pointer",fontSize:"0.9rem"};function wm(){const l=typeof localStorage<"u"&&localStorage.getItem("webIntegrationEnabled")==="true";return[{id:"dashboard",label:"Dashboard"},{id:"datos",label:"Datos de mi empresa"},{id:"usuarios",label:"Usuarios / Cajeros",children:[{id:"usuarios_internal",label:"Usuarios Cajeros"},...l?[{id:"usuarios_web",label:"Usuarios web (usuarios_web)"}]:[],{id:"clientes",label:"Clientes (clientes)"}]},{id:"factura",label:"Factura y CAI",children:[{id:"cai",label:"Gestio de CAI por cajas"},{id:"facturas",label:"Facturas (ventas)"},{id:"cotizaciones",label:"Cotizaciones (cotizaciones)"},{id:"anulacion_factura",label:"Anulacin de factura"},{id:"notas_credito",label:"Notas de crdito"},{id:"impuestos",label:"Impuestos"}]},{id:"inventario",label:"Inventario",children:[{id:"inventario_productos",label:"Productos (Inventario)"},{id:"registro_producto",label:"Registro de producto"},{id:"precios_productos",label:"Precios de productos"},{id:"precios_historico",label:"Histrico de precios"},{id:"stock",label:"Stock"},{id:"inventario_salidas",label:"Movimiento de Inventario"}]},{id:"compras",label:"Compras y Proveedores",children:[{id:"compras_main",label:"Compras (compras)"},{id:"proveedores",label:"Proveedores (proveedores)"},{id:"devoluciones_proveedores",label:"Devolucin a Proveedores"}]},{id:"cierres",label:"Cierres de caja",children:[{id:"caja_sesiones",label:"Sesiones de caja (caja_sesiones)"},{id:"caja_movimientos",label:"Movimientos de caja (caja_movimientos)"}]},...l?[{id:"pedidos",label:"Pedidos web / Ecommerce",children:[{id:"pedidos_web",label:"Pedidos web (pedidos_web)"},{id:"pedidos_detalle",label:"Detalle de pedidos (pedidos_web_detalle)"},{id:"pagos_web",label:"Pagos web (pagos_web)"}]}]:[],{id:"reportes",label:"Reportes",children:[{id:"rep_ventas",label:"Ventas (ventas + ventas_detalle)"},{id:"rep_devoluciones",label:"Devoluciones (devoluciones_ventas)"},{id:"rep_ingresos_egresos",label:"Ingresos / Egresos (caja_movimientos)"},{id:"rep_compras",label:"Compras"},{id:"rep_inventario",label:"Inventario"}]},{id:"contaduria",label:"Contadura / Libro Diario",children:[{id:"cuentas_contables",label:"Cuentas contables"},{id:"libro_diario",label:"Libro diario"},{id:"libro_mayor",label:"Libro mayor"},{id:"balance_general",label:"Balance general"},{id:"estado_resultados",label:"Estado de resultados"}]},{id:"salir",label:"Salir"}]}wm();function Zv({title:l,children:i}){return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:l}),t.jsx("div",{style:{marginTop:8,color:"#475569"},children:i})]})}function ej(){const[l,i]=y.useState(null),[r,s]=y.useState(!0),[c,d]=y.useState(null),[f,g]=y.useState([]),[p,m]=y.useState([]),[b,S]=y.useState([]),[j,x]=y.useState([]);y.useEffect(()=>{w()},[]);const w=async()=>{try{s(!0),d(null);const R=new Date,z=new Date(R.getFullYear(),R.getMonth(),R.getDate()),C=new Date(R.getFullYear(),R.getMonth(),1);console.log("Iniciando carga de dashboard..."),console.log("Cliente Supabase configurado:",{initialized:!!_a,clientType:typeof _a}),console.log("Intentando consulta simple a ventas...");const{data:O,error:I,count:k}=await _a.from("ventas").select("id",{count:"exact"}).limit(1);if(console.log("Resultado test ventas:",{hasData:!!O,count:k,error:I,errorDetails:I?{message:I.message,details:I.details,hint:I.hint,code:I.code}:null}),I)throw console.error("Error detallado en test:",I),I.code==="PGRST301"||I.message?.includes("policy")?new Error(`Las polticas RLS estn bloqueando el acceso.

Verifica en Supabase Dashboard  Authentication  Policies:
1. Que las polticas existen
2. Que estn habilitadas
3. O desactiva RLS temporalmente para testing`):new Error(`Error al consultar ventas: ${I.message||I.code}

Detalles: ${JSON.stringify(I,null,2)}`);const{data:M,error:G}=await _a.from("ventas").select("*").order("fecha_venta",{ascending:!1}).limit(1e3);if(G)throw console.error("Error obteniendo todas las ventas:",G),new Error(`Error en ventas: ${G.message}`);console.log("Ventas obtenidas:",M?.length||0);const K=M?.filter(V=>new Date(V.fecha_venta||V.created_at)>=z&&(V.estado==="pagada"||V.estado==="completada"||!V.estado))||[],ne=M?.filter(V=>new Date(V.fecha_venta||V.created_at)>=C&&(V.estado==="pagada"||V.estado==="completada"||!V.estado))||[],{data:Y}=await _a.from("compras").select("*").order("fecha_compra",{ascending:!1}).limit(1e3),B=Y?.filter(V=>new Date(V.fecha_compra||V.created_at)>=z)||[],A=Y?.filter(V=>new Date(V.fecha_compra||V.created_at)>=C)||[],{data:N}=await _a.from("caja_movimientos").select("*").order("fecha",{ascending:!1}).limit(1e3),q=N?.filter(V=>new Date(V.fecha||V.created_at)>=z)||[],X=N?.filter(V=>new Date(V.fecha||V.created_at)>=C)||[],ge=q.filter(V=>(V.tipo_movimiento||V.tipo||"").toLowerCase()==="ingreso").reduce((V,ue)=>V+Number(ue.monto||0),0),re=q.filter(V=>(V.tipo_movimiento||V.tipo||"").toLowerCase()==="egreso").reduce((V,ue)=>V+Number(ue.monto||0),0),U=X.filter(V=>(V.tipo_movimiento||V.tipo||"").toLowerCase()==="ingreso").reduce((V,ue)=>V+Number(ue.monto||0),0),$=X.filter(V=>(V.tipo_movimiento||V.tipo||"").toLowerCase()==="egreso").reduce((V,ue)=>V+Number(ue.monto||0),0),{data:H}=await _a.from("inventario").select("*").limit(5e3),Z=H?.filter(V=>V.tipo==="producto"||!V.tipo)||[],ee=Z.filter(V=>(V.stock||0)<10).length,oe=Z.reduce((V,ue)=>V+Number(ue.precio||0)*Number(ue.stock||0),0),{data:P}=await _a.from("ventas_detalle").select("*, inventario(*)").not("producto_id","is",null).order("created_at",{ascending:!1}).limit(1e3),Se=P?.filter(V=>V.created_at?new Date(V.created_at)>=C:!0)||[],J=new Map;Se.forEach(V=>{const ue=V.producto_id;if(!ue)return;const de=Number(V.cantidad||0),he=V.inventario?.nombre||"Sin nombre",Te=Number(V.total||V.subtotal||0);if(J.has(ue)){const Oe=J.get(ue);J.set(ue,{...Oe,cantidad:Oe.cantidad+de,monto:Oe.monto+Te})}else J.set(ue,{nombre:he,cantidad:de,monto:Te})});const ae=Array.from(J.values()).sort((V,ue)=>ue.monto-V.monto).slice(0,5);i({ventasHoy:K.length,ventasHoyTotal:K.reduce((V,ue)=>V+Number(ue.total||0),0),ventasMes:ne.length,ventasMesTotal:ne.reduce((V,ue)=>V+Number(ue.total||0),0),comprasHoy:B.length,comprasHoyTotal:B.reduce((V,ue)=>V+Number(ue.total||0),0),comprasMes:A.length,comprasMesTotal:A.reduce((V,ue)=>V+Number(ue.total||0),0),ingresosHoy:ge,egresosHoy:re,ingresosMes:U,egresosMes:$,productosStockBajo:ee,totalProductos:Z.length,valorInventario:oe}),g(ae),m(M?.slice(0,5)||[]),S(Y?.slice(0,5)||[]),x(N?.slice(0,5)||[])}catch(R){console.error("Error cargando dashboard:",R),d(R.message||"Error desconocido")}finally{s(!1)}},v=R=>new Intl.NumberFormat("es-HN",{style:"currency",currency:"HNL",minimumFractionDigits:2}).format(R),E=R=>R?new Date(R).toLocaleString("es-HN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";if(r)return t.jsxs("div",{style:{padding:24},children:[t.jsx("h2",{style:{marginTop:0,marginBottom:24},children:" Dashboard"}),t.jsxs("div",{style:{textAlign:"center",padding:60,color:"#64748b"},children:[t.jsx("div",{style:{fontSize:18,marginBottom:12},children:" Cargando datos..."}),t.jsx("div",{style:{fontSize:14},children:"Esto puede tomar unos segundos"})]})]});if(c)return t.jsxs("div",{style:{padding:24},children:[t.jsx("h2",{style:{marginTop:0,marginBottom:24},children:" Dashboard"}),t.jsxs("div",{style:{padding:24,background:"#fee2e2",border:"1px solid #ef4444",borderRadius:8,color:"#991b1b"},children:[t.jsx("div",{style:{fontSize:18,fontWeight:600,marginBottom:12},children:" Error al cargar datos"}),t.jsx("div",{style:{fontSize:14,marginBottom:16,whiteSpace:"pre-wrap"},children:c}),c.includes("RLS")||c.includes("polticas")||c.includes("tabla")?t.jsxs("div",{style:{marginTop:16,padding:16,background:"#fef3c7",border:"1px solid #f59e0b",borderRadius:6,color:"#78350f"},children:[t.jsx("div",{style:{fontSize:14,fontWeight:600,marginBottom:8},children:" Solucin:"}),t.jsx("div",{style:{fontSize:13,marginBottom:12},children:"Ejecuta los siguientes comandos SQL en Supabase (Settings  SQL Editor):"}),t.jsx("pre",{style:{background:"#1f2937",color:"#10b981",padding:12,borderRadius:6,fontSize:12,overflowX:"auto",fontFamily:"monospace"},children:`-- Permitir lectura pblica de las tablas
CREATE POLICY "Permitir lectura pblica de ventas" 
ON ventas FOR SELECT USING (true);

CREATE POLICY "Permitir lectura pblica de inventario" 
ON inventario FOR SELECT USING (true);

CREATE POLICY "Permitir lectura pblica de ventas_detalle" 
ON ventas_detalle FOR SELECT USING (true);

CREATE POLICY "Permitir lectura pblica de compras" 
ON compras FOR SELECT USING (true);

CREATE POLICY "Permitir lectura pblica de caja_movimientos" 
ON caja_movimientos FOR SELECT USING (true);`})]}):null,t.jsx("button",{onClick:w,style:{marginTop:16,padding:"8px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:6,cursor:"pointer",fontWeight:600},children:" Reintentar"})]})]});const T=(l?.ventasMesTotal||0)-(l?.comprasMesTotal||0),L=(l?.ventasMesTotal||0)+(l?.ingresosMes||0)-(l?.comprasMesTotal||0)-(l?.egresosMes||0);return t.jsxs("div",{style:{padding:24,background:"#f8fafc",minHeight:"100vh"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[t.jsx("h2",{style:{margin:0,fontSize:28,color:"#0f172a"},children:" Dashboard Ejecutivo"}),t.jsx("button",{onClick:w,style:{padding:"10px 20px",background:"#3b82f6",color:"white",border:"none",borderRadius:8,cursor:"pointer",fontSize:14,fontWeight:600,boxShadow:"0 2px 4px rgba(59,130,246,0.3)"},children:" Actualizar"})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:16,color:"#64748b",fontWeight:500},children:" VENTAS"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:16},children:[t.jsxs("div",{style:{padding:24,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #10b981"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8,fontWeight:500},children:"Ventas Hoy"}),t.jsx("div",{style:{fontSize:32,fontWeight:"bold",color:"#0f172a",marginBottom:4},children:l?.ventasHoy||0}),t.jsx("div",{style:{fontSize:18,color:"#10b981",fontWeight:600},children:v(l?.ventasHoyTotal||0)})]}),t.jsxs("div",{style:{padding:24,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #3b82f6"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8,fontWeight:500},children:"Ventas del Mes"}),t.jsx("div",{style:{fontSize:32,fontWeight:"bold",color:"#0f172a",marginBottom:4},children:l?.ventasMes||0}),t.jsx("div",{style:{fontSize:18,color:"#3b82f6",fontWeight:600},children:v(l?.ventasMesTotal||0)})]}),t.jsxs("div",{style:{padding:24,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #8b5cf6"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8,fontWeight:500},children:"Promedio por Venta"}),t.jsx("div",{style:{fontSize:28,fontWeight:"bold",color:"#0f172a"},children:v(l?.ventasMes&&l.ventasMes>0?l.ventasMesTotal/l.ventasMes:0)}),t.jsxs("div",{style:{fontSize:12,color:"#8b5cf6",marginTop:4},children:["Basado en ",l?.ventasMes||0," ventas del mes"]})]})]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:16,color:"#64748b",fontWeight:500},children:" COMPRAS Y GASTOS"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:16},children:[t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #ef4444"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Compras Hoy"}),t.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#0f172a",marginBottom:4},children:l?.comprasHoy||0}),t.jsx("div",{style:{fontSize:16,color:"#ef4444",fontWeight:600},children:v(l?.comprasHoyTotal||0)})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #f97316"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Compras del Mes"}),t.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#0f172a",marginBottom:4},children:l?.comprasMes||0}),t.jsx("div",{style:{fontSize:16,color:"#f97316",fontWeight:600},children:v(l?.comprasMesTotal||0)})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #f59e0b"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Egresos Hoy"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:"#f59e0b"},children:v(l?.egresosHoy||0)}),t.jsx("div",{style:{fontSize:11,color:"#94a3b8",marginTop:4},children:"Movimientos de caja"})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #eab308"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Egresos del Mes"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:"#eab308"},children:v(l?.egresosMes||0)}),t.jsx("div",{style:{fontSize:11,color:"#94a3b8",marginTop:4},children:"Movimientos de caja"})]})]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:16,color:"#64748b",fontWeight:500},children:" INGRESOS Y MTRICAS"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:16},children:[t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #14b8a6"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Ingresos Hoy"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:"#14b8a6"},children:v(l?.ingresosHoy||0)}),t.jsx("div",{style:{fontSize:11,color:"#94a3b8",marginTop:4},children:"Movimientos de caja"})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #06b6d4"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Ingresos del Mes"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:"#06b6d4"},children:v(l?.ingresosMes||0)}),t.jsx("div",{style:{fontSize:11,color:"#94a3b8",marginTop:4},children:"Movimientos de caja"})]}),t.jsxs("div",{style:{padding:20,background:T>=0?"#d1fae5":"#fee2e2",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:`4px solid ${T>=0?"#10b981":"#ef4444"}`},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Utilidad Bruta Mes"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:T>=0?"#059669":"#dc2626"},children:v(T)}),t.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:4},children:"Ventas - Compras"})]}),t.jsxs("div",{style:{padding:20,background:L>=0?"#dbeafe":"#fee2e2",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:`4px solid ${L>=0?"#3b82f6":"#ef4444"}`},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Flujo Efectivo Mes"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:L>=0?"#2563eb":"#dc2626"},children:v(L)}),t.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:4},children:"Ingresos - Egresos totales"})]})]})]}),t.jsxs("div",{style:{marginBottom:24},children:[t.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:16,color:"#64748b",fontWeight:500},children:" INVENTARIO"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:16},children:[t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Total Productos"}),t.jsx("div",{style:{fontSize:28,fontWeight:"bold",color:"#0f172a"},children:l?.totalProductos||0})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:l?.productosStockBajo?"4px solid #ef4444":"4px solid #10b981"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Stock Bajo (< 10)"}),t.jsx("div",{style:{fontSize:28,fontWeight:"bold",color:l?.productosStockBajo?"#ef4444":"#10b981"},children:l?.productosStockBajo||0})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)",borderLeft:"4px solid #6366f1"},children:[t.jsx("div",{style:{fontSize:13,color:"#64748b",marginBottom:8},children:"Valor Inventario"}),t.jsx("div",{style:{fontSize:20,fontWeight:"bold",color:"#6366f1"},children:v(l?.valorInventario||0)}),t.jsx("div",{style:{fontSize:11,color:"#94a3b8",marginTop:4},children:"Valor estimado (precio  stock)"})]})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:16},children:[t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:16,fontSize:16,color:"#0f172a"},children:" Top 5 Productos (Monto)"}),f.length===0?t.jsx("div",{style:{color:"#94a3b8",fontSize:14,padding:20,textAlign:"center"},children:"No hay datos disponibles"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:f.map((R,z)=>t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"10px 12px",background:"#f8fafc",borderRadius:8,fontSize:13},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("span",{style:{fontWeight:600,color:"#0f172a"},children:[z+1,". ",R.nombre]}),t.jsxs("div",{style:{fontSize:11,color:"#64748b",marginTop:2},children:[R.cantidad," unidades"]})]}),t.jsx("span",{style:{color:"#10b981",fontWeight:600,fontSize:14},children:v(R.monto)})]},z))})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:16,fontSize:16,color:"#0f172a"},children:" ltimas Ventas"}),p.length===0?t.jsx("div",{style:{color:"#94a3b8",fontSize:14,padding:20,textAlign:"center"},children:"No hay ventas recientes"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:p.map((R,z)=>t.jsxs("div",{style:{padding:"10px 12px",background:"#f8fafc",borderRadius:8,borderLeft:`3px solid ${R.estado==="pagada"?"#10b981":"#ef4444"}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsx("span",{style:{fontWeight:600,fontSize:13,color:"#0f172a"},children:R.factura}),t.jsx("span",{style:{fontSize:13,fontWeight:600,color:"#10b981"},children:v(Number(R.total||0))})]}),t.jsx("div",{style:{fontSize:11,color:"#64748b"},children:R.nombre_cliente||"Cliente general"}),t.jsx("div",{style:{fontSize:10,color:"#94a3b8",marginTop:2},children:E(R.fecha_venta||R.created_at)})]},z))})]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:16,fontSize:16,color:"#0f172a"},children:" ltimas Compras"}),b.length===0?t.jsx("div",{style:{color:"#94a3b8",fontSize:14,padding:20,textAlign:"center"},children:"No hay compras recientes"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:b.map((R,z)=>t.jsxs("div",{style:{padding:"10px 12px",background:"#fef3c7",borderRadius:8,borderLeft:"3px solid #f59e0b"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsx("span",{style:{fontWeight:600,fontSize:13,color:"#0f172a"},children:R.numero_documento||"Sin #"}),t.jsx("span",{style:{fontSize:13,fontWeight:600,color:"#f59e0b"},children:v(Number(R.total||0))})]}),t.jsx("div",{style:{fontSize:10,color:"#92400e",marginTop:2},children:E(R.fecha_compra||R.created_at)})]},z))})]}),t.jsxs("div",{style:{padding:20,background:"white",borderRadius:12,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t.jsx("h3",{style:{marginTop:0,marginBottom:16,fontSize:16,color:"#0f172a"},children:" ltimos Movimientos"}),j.length===0?t.jsx("div",{style:{color:"#94a3b8",fontSize:14,padding:20,textAlign:"center"},children:"No hay movimientos recientes"}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:j.map((R,z)=>{const C=(R.tipo_movimiento||R.tipo||"").toLowerCase(),O=C==="ingreso";return t.jsxs("div",{style:{padding:"10px 12px",background:"#f8fafc",borderRadius:8,borderLeft:`3px solid ${O?"#10b981":"#ef4444"}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[t.jsxs("span",{style:{fontWeight:600,fontSize:13,color:"#0f172a",textTransform:"uppercase"},children:[O?"":""," ",C]}),t.jsx("span",{style:{fontSize:13,fontWeight:600,color:O?"#10b981":"#ef4444"},children:v(Number(R.monto||0))})]}),t.jsx("div",{style:{fontSize:11,color:"#64748b"},children:R.descripcion||R.concepto||"Sin descripcin"}),t.jsx("div",{style:{fontSize:10,color:"#94a3b8",marginTop:2},children:E(R.fecha||R.created_at)})]},z)})})]})]})]})}const tj="modulepreload",nj=function(l){return"/"+l},Sg={},Zn=function(i,r,s){let c=Promise.resolve();if(r&&r.length>0){let m=function(b){return Promise.all(b.map(S=>Promise.resolve(S).then(j=>({status:"fulfilled",value:j}),j=>({status:"rejected",reason:j}))))};var f=m;document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),p=g?.nonce||g?.getAttribute("nonce");c=m(r.map(b=>{if(b=nj(b),b in Sg)return;Sg[b]=!0;const S=b.endsWith(".css"),j=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${j}`))return;const x=document.createElement("link");if(x.rel=S?"stylesheet":tj,S||(x.as="script"),x.crossOrigin="",x.href=b,p&&x.setAttribute("nonce",p),document.head.appendChild(x),S)return new Promise((w,v)=>{x.addEventListener("load",w),x.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(g){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=g,window.dispatchEvent(p),!p.defaultPrevented)throw g}return c.then(g=>{for(const p of g||[])p.status==="rejected"&&d(p.reason);return i().catch(d)})};function aj(){const[l,i]=y.useState(null),[r,s]=y.useState(!1),[c,d]=y.useState(!1),[f,g]=y.useState({}),[p,m]=y.useState(null),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState(!1),[E,T]=y.useState(null),[L,R]=y.useState(null),[z,C]=y.useState(!1),[O,I]=y.useState(""),[k,M]=y.useState(""),[G,K]=y.useState(null),[ne,Y]=y.useState(null),[B,A]=y.useState(!1),[N,q]=y.useState(!1),[X,ge]=y.useState(""),[re,U]=y.useState(""),[$,H]=y.useState(!1);y.useEffect(()=>{try{const de=localStorage.getItem("webIntegrationEnabled")==="true";A(de)}catch{}},[]),y.useEffect(()=>{let de=!0;return(async()=>{s(!0);try{const he=(await Zn(async()=>{const{default:Ue}=await Promise.resolve().then(()=>Xn);return{default:Ue}},void 0)).default,{data:Te,error:Oe}=await he.from("empresa").select("*").limit(1).single();if(!de)return;if(Oe)throw Oe;if(Te){i(Te),g(Te);try{localStorage.setItem("companyData",JSON.stringify(Te))}catch{}s(!1);return}}catch(he){console.debug("No se pudo cargar empresa desde Supabase, fallback a JSON/localStorage",he)}try{const he=localStorage.getItem("companyData");if(he){i(JSON.parse(he)),g(JSON.parse(he)),s(!1);return}}catch{}try{const he=await fetch("/data-base/company.json");if(!he.ok)throw new Error("no json");const Te=await he.json();if(!de)return;i(Te),g(Te)}catch{de&&i(null)}finally{de&&s(!1)}})(),()=>{de=!1}},[]),y.useEffect(()=>{l&&g(l)},[l]),y.useEffect(()=>{try{const de=localStorage.getItem("pendingCompanySave");if(de){const he=JSON.parse(de);S(!0),x(he.payload??null),v(!!he.needsLogo)}}catch{}},[]),y.useEffect(()=>{let de=!0;return(async()=>{try{if(!l||!l.logo){de&&K(null);return}const he=String(l.logo);if(he.startsWith("http")){de&&K(he);return}const Te=(await Zn(async()=>{const{default:ve}=await Promise.resolve().then(()=>Xn);return{default:ve}},void 0)).default,Oe="logo",Le=(await Te.storage.from(Oe).getPublicUrl(he))?.data?.publicUrl??null;if(Le){de&&K(Le);return}const se=(await Te.storage.from(Oe).createSignedUrl(he,3600))?.data?.signedUrl??null;if(se){de&&K(se);return}de&&K(null)}catch(he){console.warn("Error resolving company logo URL",he),de&&K(null)}})(),()=>{de=!1}},[l?.logo]),y.useEffect(()=>{let de=!0;return(async()=>{try{if(p){de&&Y(p);return}const he=f?.logo;if(!he){de&&Y(null);return}const Te=String(he);if(Te.startsWith("http")){de&&Y(Te);return}const Oe=(await Zn(async()=>{const{default:$e}=await Promise.resolve().then(()=>Xn);return{default:$e}},void 0)).default,Ue="logo",ze=(await Oe.storage.from(Ue).getPublicUrl(Te))?.data?.publicUrl??null;if(ze){de&&Y(ze);return}const ve=(await Oe.storage.from(Ue).createSignedUrl(Te,3600))?.data?.signedUrl??null;if(ve){de&&Y(ve);return}de&&Y(null)}catch(he){console.warn("Error resolving edit logo URL",he),de&&Y(null)}})(),()=>{de=!1}},[f?.logo,p]);function Z(){d(!0),g(l||{})}function ee(){d(!1);try{p&&(URL.revokeObjectURL(p),m(null))}catch{}g(l||{});try{typeof window<"u"&&window.location&&window.location.reload()}catch{}}function oe(de){const{name:he,value:Te}=de.target;g(Oe=>({...Oe,[he]:Te}))}function P(de){const he=de.target.files?.[0]??null;if(g(Te=>({...Te,logoFile:he})),he)try{const Te=URL.createObjectURL(he);m(Te)}catch{m(null)}else m(null)}function Se(de=!1){const he="logo",Te="https://sqwqlvsjtimallidxrsz.supabase.co";if(de){if(p)return p;const Le=f?.logo;if(!Le)return"/logo192.png";if(String(Le).startsWith("http"))return String(Le);let ze=String(Le);return ze.startsWith(`${he}/`)&&(ze=ze.slice(he.length+1)),`${Te}/storage/v1/object/public/${he}/${encodeURIComponent(ze)}`}if(!l)return"/logo192.png";const Oe=l.logo;if(!Oe)return"/logo192.png";if(String(Oe).startsWith("http"))return String(Oe);let Ue=String(Oe);return Ue.startsWith(`${he}/`)&&(Ue=Ue.slice(he.length+1)),`${Te}/storage/v1/object/public/${he}/${encodeURIComponent(Ue)}`}async function J(){try{const de=(await Zn(async()=>{const{default:ze}=await Promise.resolve().then(()=>Xn);return{default:ze}},void 0)).default,he={...f||{}};let Te=null;const Oe=ze=>{if(!ze)return null;if(!ze.startsWith("http"))return ze;const se=ze.match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);return se?decodeURIComponent(se[2]):null},Ue=l?.logo??null;try{const ze=f&&f.logoFile instanceof File?f.logoFile:null,se="logo";if(ze){const $e=`logo/${he.id??(crypto&&crypto.randomUUID?crypto.randomUUID():String(Date.now()))}/${Date.now()}_${ze.name.replace(/[^a-zA-Z0-9.\-_/]/g,"_")}`,gt=await de.storage.from(se).upload($e,ze,{upsert:!0});if(gt.error)throw gt.error;const st=gt.data?.path??$e;Te=st,he.logo=st}}catch(ze){console.warn("Logo upload error",ze)}try{he.logoFile&&delete he.logoFile,he.pagina_web_integrada&&delete he.pagina_web_integrada}catch{}let Le=null;try{if(l&&l.id){const ze={...he};delete ze.id;const{data:se,error:ve}=await de.from("empresa").update(ze).eq("id",l.id).select("*");if(ve)throw ve;Le=Array.isArray(se)?se[0]??null:se}else{const{data:ze,error:se}=await de.from("empresa").insert(he).select("*");if(se)throw se;Le=Array.isArray(ze)?ze[0]??null:ze}try{if(Te){const ze=Oe(Ue);if(ze&&ze!==Te){const ve=await de.storage.from("logo").remove([ze]);ve.error&&console.warn("Failed to remove old company logo after DB update",ve.error)}}}catch(ze){console.warn("Error removing old logo after DB success",ze)}}catch(ze){try{if(Te){const ve=await de.storage.from("logo").remove([Te]);ve.error&&console.warn("Failed to remove uploaded logo after DB error",ve.error)}}catch(se){console.warn("Error cleaning uploaded logo after DB failure",se)}throw ze}i(Le),g(Le);try{console.debug("Empresa guardada, logo field:",Le?.logo)}catch{}try{R(Le?.logo??null)}catch{}try{I("Datos guardados"),M("Los datos de la empresa se guardaron correctamente."),C(!0)}catch{}try{typeof window<"u"&&window.location&&window.location.reload()}catch{}try{p&&(URL.revokeObjectURL(p),m(null))}catch{}try{localStorage.setItem("companyData",JSON.stringify(Le))}catch{}d(!1)}catch(de){console.error("Error guardando empresa en Supabase",de);try{T(de?.message||String(de))}catch{}try{const he={...f||{}};he.logoFile&&delete he.logoFile;const Te=!!(f&&f.logoFile instanceof File);localStorage.setItem("pendingCompanySave",JSON.stringify({payload:he,needsLogo:Te,ts:Date.now()})),S(!0),x(he),v(Te),i(f);try{localStorage.setItem("companyData",JSON.stringify(f))}catch{}d(!1),I("Guardado localmente"),M("Los datos se guardaron localmente porque no se pudo alcanzar Supabase. Puedes reintentar cuando tengas conexin."),C(!0)}catch(he){console.error("Error saving locally",he)}}}async function ae(){const de=j;if(!de){I("Sin pendientes"),M("No hay datos pendientes para enviar"),C(!0);return}try{const he=(await Zn(async()=>{const{default:Oe}=await Promise.resolve().then(()=>Xn);return{default:Oe}},void 0)).default;let Te=null;if(de.id){const Oe={...de};delete Oe.id;const{data:Ue,error:Le}=await he.from("empresa").update(Oe).eq("id",de.id).select("*");if(Le)throw Le;Te=Array.isArray(Ue)?Ue[0]??null:Ue}else{const{data:Oe,error:Ue}=await he.from("empresa").insert(de).select("*");if(Ue)throw Ue;Te=Array.isArray(Oe)?Oe[0]??null:Oe}localStorage.removeItem("pendingCompanySave"),S(!1),x(null),v(!1),i(Te),g(Te),I("Sincronizado"),M("Los datos pendientes se sincronizaron con Supabase correctamente."),C(!0);try{typeof window<"u"&&window.location&&window.location.reload()}catch{}}catch(he){console.error("Error reenviando datos pendientes",he),I("Error al reenviar"),M("No se pudo reenviar los datos a Supabase: "+(he?.message||String(he))),C(!0)}}function V(){try{localStorage.removeItem("pendingCompanySave"),S(!1),x(null),v(!1),I("Pendiente descartado"),M("El guardado pendiente fue descartado."),C(!0)}catch{}}async function ue(){H(!0);try{const{hasUpdate:de,versionInfo:he}=await uv();de&&he?window.confirm(` Nueva versin disponible: v${he.version}

${he.changelog}

Desea actualizar ahora? La aplicacin se recargar.`)&&await xm(he.version):(I(" Sistema actualizado"),M(`Ests usando la versin ms reciente${he?`: v${he.version}`:""}`),C(!0))}catch{I(" Error"),M("No se pudo verificar actualizaciones. Intenta ms tarde."),C(!0)}finally{H(!1)}}return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Datos de mi empresa"}),t.jsxs("div",{style:{background:"#fff",padding:18,borderRadius:8,marginBottom:20,boxShadow:"0 1px 3px rgba(2,6,23,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:600,fontSize:"1rem",marginBottom:4},children:" Integracin de pgina web"}),t.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Mostrar mens de usuarios web y pedidos web/ecommerce"})]}),t.jsxs("label",{style:{position:"relative",display:"inline-block",width:56,height:28,cursor:"pointer"},children:[t.jsx("input",{type:"checkbox",checked:B,onChange:de=>{de.target.checked?(q(!0),ge(""),U("")):(A(!1),localStorage.setItem("webIntegrationEnabled","false"),window.location.reload())},style:{opacity:0,width:0,height:0}}),t.jsx("span",{style:{position:"absolute",cursor:"pointer",top:0,left:0,right:0,bottom:0,background:B?"#3b82f6":"#cbd5e1",transition:"0.3s",borderRadius:28},children:t.jsx("span",{style:{position:"absolute",content:"",height:22,width:22,left:B?30:3,bottom:3,background:"white",transition:"0.3s",borderRadius:"50%"}})})]})]}),t.jsxs("div",{style:{background:"#fff",padding:18,borderRadius:8,marginBottom:20,boxShadow:"0 1px 3px rgba(2,6,23,0.06)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:600,fontSize:"1rem",marginBottom:4},children:" Actualizaciones de la aplicacin"}),t.jsx("div",{style:{fontSize:"0.875rem",color:"#64748b"},children:"Verifica si hay una nueva versin disponible"})]}),t.jsx("button",{onClick:ue,disabled:$,style:{padding:"10px 20px",background:$?"#cbd5e1":"linear-gradient(135deg, #3b82f6, #2563eb)",color:"white",border:"none",borderRadius:8,fontWeight:600,fontSize:"0.875rem",cursor:$?"not-allowed":"pointer",boxShadow:$?"none":"0 2px 8px rgba(59, 130, 246, 0.3)",transition:"all 150ms",display:"flex",alignItems:"center",gap:8},onMouseEnter:de=>{$||(de.currentTarget.style.transform="translateY(-2px)",de.currentTarget.style.boxShadow="0 4px 12px rgba(59, 130, 246, 0.4)")},onMouseLeave:de=>{de.currentTarget.style.transform="translateY(0)",de.currentTarget.style.boxShadow=$?"none":"0 2px 8px rgba(59, 130, 246, 0.3)"},children:$?t.jsxs(t.Fragment,{children:[t.jsx("span",{style:{display:"inline-block",width:14,height:14,border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),"Verificando..."]}):"Buscar actualizaciones"})]}),t.jsx("style",{children:`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `}),N&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2, 6, 23, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:t.jsxs("div",{style:{background:"white",borderRadius:12,padding:24,width:"90%",maxWidth:420,boxShadow:"0 20px 60px rgba(2, 6, 23, 0.3)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,paddingBottom:12,borderBottom:"2px solid #e2e8f0"},children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:" Activar integracin web"}),t.jsx("button",{style:{background:"transparent",border:"none",fontSize:"1.5rem",color:"#64748b",cursor:"pointer",padding:"4px 8px",lineHeight:1},onClick:()=>{q(!1),ge(""),U("")},type:"button",children:""})]}),t.jsx("p",{style:{color:"#334155",marginBottom:20},children:"Ingresa la clave de activacin para habilitar los mens de integracin web."}),t.jsxs("div",{style:{marginBottom:20},children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:6},children:"Clave de activacin *"}),t.jsx("input",{type:"password",value:X,onChange:de=>{ge(de.target.value),U("")},placeholder:"Ingresa la clave",style:{width:"100%",padding:"10px 12px",border:re?"1px solid #ef4444":"1px solid #cbd5e1",borderRadius:8,fontSize:"0.95rem",boxSizing:"border-box"},autoFocus:!0,onKeyDown:de=>{de.key==="Enter"&&(X==="web8863"?(A(!0),localStorage.setItem("webIntegrationEnabled","true"),q(!1),ge(""),U(""),window.location.reload()):U("Clave incorrecta. Intntalo de nuevo."))}}),re&&t.jsx("div",{style:{color:"#ef4444",fontSize:"0.875rem",marginTop:6},children:re})]}),t.jsxs("div",{style:{display:"flex",gap:10,justifyContent:"flex-end",paddingTop:16,borderTop:"1px solid #e2e8f0"},children:[t.jsx("button",{style:{padding:"10px 20px",borderRadius:8,fontSize:"0.95rem",fontWeight:600,cursor:"pointer",border:"1px solid #cbd5e1",background:"#f1f5f9",color:"#334155"},onClick:()=>{q(!1),ge(""),U("")},type:"button",children:"Cancelar"}),t.jsx("button",{style:{padding:"10px 20px",borderRadius:8,fontSize:"0.95rem",fontWeight:600,cursor:"pointer",border:"none",background:"#3b82f6",color:"white"},onClick:()=>{X==="web8863"?(A(!0),localStorage.setItem("webIntegrationEnabled","true"),q(!1),ge(""),U(""),window.location.reload()):U("Clave incorrecta. Intntalo de nuevo.")},type:"button",children:"Activar"})]})]})}),r?t.jsx("div",{children:"Cargando datos de la empresa..."}):l?t.jsxs("div",{style:{display:"flex",gap:16,alignItems:"flex-start"},children:[t.jsxs("div",{style:{background:"#fff",padding:18,borderRadius:8,minWidth:420,boxShadow:"0 1px 3px rgba(2,6,23,0.06)"},children:[b?t.jsx("div",{style:{background:"#fff7ed",border:"1px solid #fbbf24",padding:8,borderRadius:6,marginBottom:8},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("strong",{children:"Guardado localmente:"})," Los datos no se sincronizaron con Supabase.",E?t.jsxs("div",{style:{fontSize:12,color:"#b91c1c"},children:["Error: ",String(E)]}):null,w?t.jsx("div",{style:{fontSize:12,color:"#92400e"},children:"Nota: el archivo de logo no se incluy y deber subirse de nuevo."}):null]}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{className:"btn-primary",onClick:ae,children:"Reintentar guardar en Supabase"}),t.jsx("button",{className:"btn-opaque",onClick:V,children:"Descartar pendiente"})]})]})}):null,L?t.jsxs("div",{style:{marginBottom:8,fontSize:13},children:[t.jsx("strong",{children:"Logo guardado:"}),t.jsxs("div",{style:{marginTop:6},children:[t.jsx("a",{href:Se(!1),target:"_blank",rel:"noopener noreferrer",children:"Abrir logo"}),t.jsx("div",{style:{color:"#374151",fontSize:12},children:String(L)})]})]}):null,t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[t.jsx("div",{style:{width:120,height:60,display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9",borderRadius:6,overflow:"hidden"},children:t.jsx("img",{src:c?ne??Se(!0):G??Se(!1),alt:"logo",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}),c?t.jsx("input",{name:"nombre",value:f.nombre||"",onChange:oe,className:"input",placeholder:"Nombre del negocio",style:{fontSize:18,fontWeight:600,padding:6}}):t.jsx("h3",{style:{marginTop:0},children:l.nombre})]}),t.jsxs("div",{style:{marginTop:8,color:"#334155"},children:[t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"RTN:"})," ",c?t.jsx("input",{name:"rtn",value:f.rtn||"",onChange:oe,className:"input"}):l.rtn]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Telfono:"})," ",c?t.jsx("input",{name:"telefono",value:f.telefono||"",onChange:oe,className:"input"}):l.telefono]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Correo:"})," ",c?t.jsx("input",{name:"email",value:f.email||"",onChange:oe,className:"input"}):l.email]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Direccin:"})," ",c?t.jsx("textarea",{name:"direccion",value:f.direccion||"",onChange:oe,className:"input",style:{minHeight:64}}):l.direccion]}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("strong",{children:"Logo (archivo o URL):"}),c?t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:6},children:[t.jsx("input",{type:"file",accept:"image/*",onChange:P}),t.jsx("input",{name:"logo",value:f.logo||"",onChange:oe,className:"input",placeholder:"https://.../logo.png",style:{flex:1}})]}):t.jsx("span",{style:{marginLeft:6},children:l.logo?"URL configurada":"No hay logo"}),c&&p?t.jsxs("div",{style:{marginTop:8},children:[t.jsx("small",{children:"Preview:"}),t.jsx("div",{style:{width:160,height:60,marginTop:6,background:"#fff",border:"1px solid #e6e6e6",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("img",{src:p,alt:"preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]}):null]})]}),t.jsx("div",{style:{marginTop:12,display:"flex",gap:8},children:c?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",onClick:J,className:"btn-primary",children:"Guardar"}),t.jsx("button",{type:"button",onClick:ee,className:"btn-opaque",children:"Cancelar"})]}):t.jsx(t.Fragment,{children:t.jsx("button",{type:"button",onClick:Z,className:"btn-primary",children:"Actualizar datos"})})})]}),t.jsx("div",{style:{flex:1,minWidth:320},children:t.jsxs("div",{style:{background:"#fff",padding:16,borderRadius:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[t.jsx("div",{style:{width:220,height:90,display:"flex",alignItems:"center",justifyContent:"center",background:"#f1f5f9",borderRadius:8,overflow:"hidden",marginBottom:12},children:t.jsx("img",{src:c?ne??Se(!0):G??Se(!1),alt:"logo",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}),t.jsx("h4",{style:{margin:0,marginBottom:8},children:"Detalles rpidos"}),t.jsxs("p",{style:{margin:0},children:["RTN: ",t.jsx("strong",{children:l.rtn})]}),t.jsxs("p",{style:{margin:0},children:["Telfono: ",t.jsx("strong",{children:l.telefono})]}),t.jsxs("p",{style:{marginTop:8},children:["Correo: ",t.jsx("strong",{children:l.email})]}),t.jsxs("p",{style:{marginTop:8},children:["Direccin: ",t.jsx("strong",{children:l.direccion})]})]})})]}):t.jsx("div",{children:"No se encontraron datos de la empresa."}),t.jsx(Tn,{open:z,title:O,message:k,onClose:()=>C(!1)})]})}function ij(){return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Usuarios web (usuarios_web)"}),t.jsx("div",{style:{marginTop:8,color:"#475569"},children:"Esta vista mostrar los usuarios registrados desde la web. (Placeholder)"})]})}function rj({open:l,onClose:i,onSave:r,editUser:s}){const[c,d]=y.useState(""),[f,g]=y.useState(""),[p,m]=y.useState(""),[b,S]=y.useState(!1),[j,x]=y.useState(null);y.useEffect(()=>{l&&s?(d(s.username||""),m(s.nombre_usuario||""),g(""),x(null)):l&&!s&&(d(""),g(""),m(""),x(null))},[l,s]);const w=async v=>{if(v.preventDefault(),x(null),!c.trim()){x("El nombre de usuario es requerido");return}if(!s&&!f.trim()){x("La contrasea es requerida para usuarios nuevos");return}if(!p.trim()){x("El nombre completo es requerido");return}S(!0);try{const E={username:c.trim(),nombre_usuario:p.trim(),role:"cajero"};f.trim()&&(E.password=f),await r(E),i()}catch(E){x(E?.message||"Error al guardar el usuario")}finally{S(!1)}};return l?t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
        .usuario-modal-backdrop {
          position: fixed;
          inset: 0;
          background: rgba(2, 6, 23, 0.6);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          animation: fadeIn 200ms ease-out;
        }
        .usuario-modal-content {
          background: white;
          border-radius: 12px;
          padding: 24px;
          width: 90%;
          max-width: 520px;
          box-shadow: 0 20px 60px rgba(2, 6, 23, 0.3);
          animation: slideUp 250ms ease-out;
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { 
            opacity: 0;
            transform: translateY(20px) scale(0.98);
          }
          to { 
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        .usuario-modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 12px;
          border-bottom: 2px solid #e2e8f0;
        }
        .usuario-modal-title {
          font-size: 1.25rem;
          font-weight: 700;
          color: #1e293b;
          margin: 0;
        }
        .usuario-modal-close {
          background: transparent;
          border: none;
          font-size: 1.5rem;
          color: #64748b;
          cursor: pointer;
          padding: 4px 8px;
          line-height: 1;
          transition: color 150ms;
        }
        .usuario-modal-close:hover {
          color: #1e293b;
        }
        .usuario-form-group {
          margin-bottom: 16px;
        }
        .usuario-form-label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: #334155;
          margin-bottom: 6px;
        }
        .usuario-form-input {
          width: 100%;
          padding: 10px 12px;
          border: 1px solid #cbd5e1;
          border-radius: 8px;
          font-size: 0.95rem;
          transition: border-color 150ms, box-shadow 150ms;
          box-sizing: border-box;
        }
        .usuario-form-input:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .usuario-form-select {
          width: 100%;
          padding: 10px 12px;
          border: 1px solid #cbd5e1;
          border-radius: 8px;
          font-size: 0.95rem;
          background: white;
          cursor: pointer;
          transition: border-color 150ms;
        }
        .usuario-form-select:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .usuario-error {
          background: #fee2e2;
          border: 1px solid #fca5a5;
          color: #b91c1c;
          padding: 10px 12px;
          border-radius: 8px;
          font-size: 0.875rem;
          margin-bottom: 16px;
        }
        .usuario-form-actions {
          display: flex;
          gap: 10px;
          justify-content: flex-end;
          margin-top: 24px;
          padding-top: 16px;
          border-top: 1px solid #e2e8f0;
        }
        .usuario-btn {
          padding: 10px 20px;
          border-radius: 8px;
          font-size: 0.95rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 150ms;
          border: none;
        }
        .usuario-btn-primary {
          background: #3b82f6;
          color: white;
        }
        .usuario-btn-primary:hover:not(:disabled) {
          background: #2563eb;
        }
        .usuario-btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }
        .usuario-btn-secondary {
          background: #f1f5f9;
          color: #334155;
          border: 1px solid #cbd5e1;
        }
        .usuario-btn-secondary:hover:not(:disabled) {
          background: #e2e8f0;
        }
        .usuario-hint {
          font-size: 0.8rem;
          color: #64748b;
          margin-top: 4px;
        }
      `}),t.jsx("div",{className:"usuario-modal-backdrop",children:t.jsxs("div",{className:"usuario-modal-content",children:[t.jsxs("div",{className:"usuario-modal-header",children:[t.jsx("h3",{className:"usuario-modal-title",children:s?"Editar Usuario":"Nuevo Usuario"}),t.jsx("button",{className:"usuario-modal-close",onClick:i,type:"button",children:""})]}),t.jsxs("form",{onSubmit:w,children:[j&&t.jsx("div",{className:"usuario-error",children:j}),t.jsxs("div",{className:"usuario-form-group",children:[t.jsx("label",{className:"usuario-form-label",htmlFor:"username",children:"Nombre de usuario *"}),t.jsx("input",{id:"username",type:"text",className:"usuario-form-input",value:c,onChange:v=>d(v.target.value),placeholder:"Ej: jperez",disabled:b,autoComplete:"off"})]}),t.jsxs("div",{className:"usuario-form-group",children:[t.jsx("label",{className:"usuario-form-label",htmlFor:"nombreUsuario",children:"Nombre completo *"}),t.jsx("input",{id:"nombreUsuario",type:"text",className:"usuario-form-input",value:p,onChange:v=>m(v.target.value),placeholder:"Ej: Juan Prez",disabled:b,autoComplete:"off"})]}),t.jsxs("div",{className:"usuario-form-group",children:[t.jsxs("label",{className:"usuario-form-label",htmlFor:"password",children:["Contrasea ",s&&"(dejar vaco para no cambiar)",!s&&" *"]}),t.jsx("input",{id:"password",type:"password",className:"usuario-form-input",value:f,onChange:v=>g(v.target.value),placeholder:s?"Nueva contrasea (opcional)":"Contrasea",disabled:b,autoComplete:"new-password"}),s&&t.jsx("div",{className:"usuario-hint",children:"Solo ingresa una contrasea si deseas cambiarla"})]}),t.jsxs("div",{className:"usuario-form-actions",children:[t.jsx("button",{type:"button",className:"usuario-btn usuario-btn-secondary",onClick:i,disabled:b,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"usuario-btn usuario-btn-primary",disabled:b,children:b?"Guardando...":s?"Guardar cambios":"Crear usuario"})]})]})]})})]}):null}function oj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(""),[p,m]=y.useState("all"),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState(!1),[E,T]=y.useState(null),[L,R]=y.useState(""),[z,C]=y.useState(""),[O,I]=y.useState(null),[k,M]=y.useState(!1),[G,K]=y.useState(!1),[ne,Y]=y.useState(!1),[B,A]=y.useState("");async function N(){s(!0),d(null);try{const{data:ee,error:oe}=await F.from("users").select("id, username, role, nombre_usuario").order("id",{ascending:!1}).limit(1e3);if(oe)throw oe;i(Array.isArray(ee)?ee:[])}catch(ee){d(ee?.message||String(ee)),i([])}finally{s(!1)}}async function q(ee){s(!0);try{if(j){const oe={username:ee.username,nombre_usuario:ee.nombre_usuario,role:ee.role};ee.password&&(oe.password=ee.password);const{error:P}=await F.from("users").update(oe).eq("id",j.id);if(P)throw P}else{const oe={username:ee.username,password:ee.password,nombre_usuario:ee.nombre_usuario,role:ee.role},{error:P}=await F.from("users").insert(oe);if(P)throw P}await N(),S(!1),x(null)}catch(oe){throw new Error(oe?.message||String(oe))}finally{s(!1)}}function X(){x(null),S(!0)}function ge(ee){x(ee),S(!0)}function re(){S(!1),x(null)}function U(ee,oe,P){if(P!=="cajero"){A('Solo se pueden eliminar usuarios con rol "cajero"'),Y(!0);return}T(ee),R(oe),C(""),I(null),v(!0)}async function $(){if(E!=null){if(!z.trim()){I("Ingrese la contrasea de administrador");return}M(!0),I(null);try{const ee=localStorage.getItem("user");if(!ee){I("No se encontr sesin de administrador");return}const oe=JSON.parse(ee),P=oe?.username||oe?.user?.username;if(!P){I("No se pudo verificar el usuario actual");return}const{data:Se,error:J}=await F.from("users").select("id, role, password").eq("username",P).single();if(J||!Se){I("Error al verificar credenciales");return}if(Se.role!=="admin"){I("Solo administradores pueden eliminar usuarios");return}if(Se.password!==z){I("Contrasea incorrecta");return}s(!0);const{error:ae}=await F.from("users").delete().eq("id",E);if(ae)throw ae;await N(),v(!1),C(""),K(!0)}catch(ee){I(ee?.message||String(ee))}finally{M(!1),s(!1)}}}y.useEffect(()=>{let ee=!0;return(async()=>ee&&await N())(),()=>{ee=!1}},[]);const H=l.filter(ee=>{if(p!=="all"&&ee.role!==p)return!1;if(!f)return!0;const oe=f.toLowerCase();return(ee.username||"").toLowerCase().includes(oe)||(String(ee.id)||"").includes(oe)||(ee.role||"").toLowerCase().includes(oe)||(ee.nombre_usuario||"").toLowerCase().includes(oe)}),Z=ee=>{switch(ee){case"admin":return{bg:"#dbeafe",color:"#1e40af",border:"#93c5fd"};case"cajero":return{bg:"#dcfce7",color:"#166534",border:"#86efac"};default:return{bg:"#f3f4f6",color:"#374151",border:"#d1d5db"}}};return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
        .usuarios-container {
          padding: 24px;
          max-width: 1400px;
          margin: 0 auto;
          background: #f8fafc;
          min-height: 100vh;
        }
        .usuarios-header {
          margin-bottom: 24px;
        }
        .usuarios-title {
          font-size: 1.75rem;
          font-weight: 800;
          color: #1e293b;
          margin: 0 0 8px 0;
        }
        .usuarios-subtitle {
          color: #64748b;
          font-size: 0.95rem;
          margin: 0;
        }
        .usuarios-toolbar {
          background: white;
          padding: 20px;
          border-radius: 12px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          margin-bottom: 24px;
          display: flex;
          gap: 12px;
          align-items: center;
          flex-wrap: wrap;
        }
        .usuarios-search {
          flex: 1;
          min-width: 250px;
          padding: 10px 14px;
          border: 1px solid #cbd5e1;
          border-radius: 8px;
          font-size: 0.95rem;
          transition: border-color 150ms, box-shadow 150ms;
        }
        .usuarios-search:focus {
          outline: none;
          border-color: #3b82f6;
          box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .usuarios-filter-select {
          padding: 10px 14px;
          border: 1px solid #cbd5e1;
          border-radius: 8px;
          font-size: 0.95rem;
          background: white;
          cursor: pointer;
          min-width: 150px;
        }
        .usuarios-btn {
          padding: 10px 18px;
          border-radius: 8px;
          font-size: 0.95rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 150ms;
          border: none;
          display: flex;
          align-items: center;
          gap: 6px;
        }
        .usuarios-btn-primary {
          background: #3b82f6;
          color: white;
        }
        .usuarios-btn-primary:hover {
          background: #2563eb;
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .usuarios-btn-secondary {
          background: #f1f5f9;
          color: #334155;
          border: 1px solid #cbd5e1;
        }
        .usuarios-btn-secondary:hover {
          background: #e2e8f0;
        }
        .usuarios-stats {
          margin-left: auto;
          display: flex;
          align-items: center;
          gap: 8px;
          color: #64748b;
          font-size: 0.9rem;
        }
        .usuarios-stats-number {
          font-weight: 700;
          color: #1e293b;
          font-size: 1.1rem;
        }
        .usuarios-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
          gap: 20px;
        }
        .usuario-card {
          background: white;
          border-radius: 12px;
          padding: 20px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          transition: all 200ms;
          border: 1px solid #e2e8f0;
        }
        .usuario-card:hover {
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
          transform: translateY(-2px);
        }
        .usuario-card-header {
          display: flex;
          align-items: flex-start;
          justify-content: space-between;
          margin-bottom: 16px;
        }
        .usuario-avatar {
          width: 48px;
          height: 48px;
          border-radius: 50%;
          background: linear-gradient(135deg, #3b82f6, #8b5cf6);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: 700;
          font-size: 1.2rem;
        }
        .usuario-info {
          flex: 1;
          margin-left: 14px;
        }
        .usuario-name {
          font-size: 1.1rem;
          font-weight: 700;
          color: #1e293b;
          margin: 0 0 4px 0;
        }
        .usuario-username {
          color: #64748b;
          font-size: 0.875rem;
          margin: 0;
        }
        .usuario-badge {
          padding: 4px 10px;
          border-radius: 6px;
          font-size: 0.75rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
        }
        .usuario-card-footer {
          display: flex;
          gap: 8px;
          margin-top: 16px;
          padding-top: 16px;
          border-top: 1px solid #f1f5f9;
        }
        .usuario-card-btn {
          flex: 1;
          padding: 8px 12px;
          border-radius: 6px;
          font-size: 0.875rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 150ms;
          border: none;
          text-align: center;
        }
        .usuario-card-btn-edit {
          background: #f1f5f9;
          color: #334155;
        }
        .usuario-card-btn-edit:hover {
          background: #e2e8f0;
        }
        .usuario-card-btn-delete {
          background: #fee2e2;
          color: #b91c1c;
        }
        .usuario-card-btn-delete:hover {
          background: #fca5a5;
        }
        .usuario-card-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }
        .usuarios-empty {
          text-align: center;
          padding: 60px 20px;
          background: white;
          border-radius: 12px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .usuarios-empty-icon {
          font-size: 3rem;
          margin-bottom: 16px;
          opacity: 0.3;
        }
        .usuarios-empty-title {
          font-size: 1.25rem;
          font-weight: 700;
          color: #1e293b;
          margin-bottom: 8px;
        }
        .usuarios-empty-text {
          color: #64748b;
          margin-bottom: 20px;
        }
        @media (max-width: 768px) {
          .usuarios-container {
            padding: 16px;
          }
          .usuarios-toolbar {
            flex-direction: column;
            align-items: stretch;
          }
          .usuarios-search,
          .usuarios-filter-select {
            width: 100%;
          }
          .usuarios-stats {
            margin-left: 0;
            justify-content: center;
          }
          .usuarios-grid {
            grid-template-columns: 1fr;
          }
        }
      `}),t.jsxs("div",{className:"usuarios-container",children:[t.jsxs("div",{className:"usuarios-header",children:[t.jsx("h1",{className:"usuarios-title",children:" Usuarios del Sistema"}),t.jsx("p",{className:"usuarios-subtitle",children:"Gestiona los usuarios y cajeros del sistema"})]}),t.jsxs("div",{className:"usuarios-toolbar",children:[t.jsx("input",{type:"text",placeholder:" Buscar usuario, nombre o ID...",className:"usuarios-search",value:f,onChange:ee=>g(ee.target.value)}),t.jsxs("select",{className:"usuarios-filter-select",value:p,onChange:ee=>m(ee.target.value),children:[t.jsx("option",{value:"all",children:"Todos los roles"}),t.jsx("option",{value:"admin",children:"Administradores"}),t.jsx("option",{value:"cajero",children:"Cajeros"})]}),t.jsx("button",{className:"usuarios-btn usuarios-btn-secondary",onClick:()=>N(),disabled:r,children:" Recargar"}),t.jsx("button",{className:"usuarios-btn usuarios-btn-primary",onClick:X,children:" Nuevo Usuario"}),t.jsxs("div",{className:"usuarios-stats",children:[t.jsx("span",{className:"usuarios-stats-number",children:H.length}),t.jsxs("span",{children:["usuario",H.length!==1?"s":""]})]})]}),c&&t.jsxs("div",{style:{background:"#fee2e2",border:"1px solid #fca5a5",color:"#b91c1c",padding:"14px 16px",borderRadius:"8px",marginBottom:"20px",fontSize:"0.95rem"},children:[" ",c]}),r&&H.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",background:"white",borderRadius:"12px",color:"#64748b"},children:[t.jsx("div",{style:{fontSize:"2rem",marginBottom:"12px"},children:""}),t.jsx("div",{children:"Cargando usuarios..."})]}):H.length===0?t.jsxs("div",{className:"usuarios-empty",children:[t.jsx("div",{className:"usuarios-empty-icon",children:""}),t.jsx("div",{className:"usuarios-empty-title",children:"No hay usuarios"}),t.jsx("div",{className:"usuarios-empty-text",children:f||p!=="all"?"No se encontraron resultados para tu bsqueda":"Comienza creando tu primer usuario"}),!f&&p==="all"&&t.jsx("button",{className:"usuarios-btn usuarios-btn-primary",onClick:X,children:" Crear primer usuario"})]}):t.jsx("div",{className:"usuarios-grid",children:H.map(ee=>{const oe=Z(ee.role),P=(ee.nombre_usuario||ee.username||"?").split(" ").map(Se=>Se[0]).join("").toUpperCase().slice(0,2);return t.jsxs("div",{className:"usuario-card",children:[t.jsxs("div",{className:"usuario-card-header",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx("div",{className:"usuario-avatar",children:P}),t.jsxs("div",{className:"usuario-info",children:[t.jsx("h3",{className:"usuario-name",children:ee.nombre_usuario||ee.username||"Sin nombre"}),t.jsxs("p",{className:"usuario-username",children:["@",ee.username]})]})]}),t.jsx("span",{className:"usuario-badge",style:{background:oe.bg,color:oe.color,border:`1px solid ${oe.border}`},children:ee.role==="admin"?" Admin":" Cajero"})]}),t.jsx("div",{style:{fontSize:"0.85rem",color:"#64748b",marginTop:"8px"},children:t.jsxs("div",{children:["ID: ",ee.id]})}),t.jsxs("div",{className:"usuario-card-footer",children:[t.jsx("button",{className:"usuario-card-btn usuario-card-btn-edit",onClick:()=>ge(ee),children:" Editar"}),t.jsx("button",{className:"usuario-card-btn usuario-card-btn-delete",onClick:()=>U(ee.id,ee.username,ee.role),disabled:ee.role!=="cajero",title:ee.role!=="cajero"?"Solo se pueden eliminar cajeros":"",children:" Eliminar"})]})]},ee.id)})})]}),t.jsx(rj,{open:b,onClose:re,onSave:q,editUser:j}),w&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(2, 6, 23, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:t.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",width:"90%",maxWidth:"480px",boxShadow:"0 20px 60px rgba(2, 6, 23, 0.3)"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",paddingBottom:"12px",borderBottom:"2px solid #e2e8f0"},children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:700,color:"#1e293b",margin:0},children:" Confirmar eliminacin"}),t.jsx("button",{style:{background:"transparent",border:"none",fontSize:"1.5rem",color:"#64748b",cursor:"pointer",padding:"4px 8px",lineHeight:1},onClick:()=>{v(!1),C(""),I(null)},type:"button",children:""})]}),t.jsxs("p",{style:{color:"#334155",marginBottom:"20px"},children:["Ests seguro de eliminar al usuario"," ",t.jsxs("strong",{children:['"',L,'"']}),"? Esta accin no se puede deshacer."]}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:600,color:"#334155",marginBottom:"6px"},children:"Contrasea de administrador *"}),t.jsx("input",{type:"password",value:z,onChange:ee=>{C(ee.target.value),I(null)},placeholder:"Ingresa tu contrasea",style:{width:"100%",padding:"10px 12px",border:O?"1px solid #ef4444":"1px solid #cbd5e1",borderRadius:"8px",fontSize:"0.95rem",boxSizing:"border-box"},disabled:k||r,autoFocus:!0,onKeyDown:ee=>{ee.key==="Enter"&&!k&&!r&&$()}}),O&&t.jsx("div",{style:{color:"#ef4444",fontSize:"0.875rem",marginTop:"6px"},children:O})]}),t.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",paddingTop:"16px",borderTop:"1px solid #e2e8f0"},children:[t.jsx("button",{style:{padding:"10px 20px",borderRadius:"8px",fontSize:"0.95rem",fontWeight:600,cursor:"pointer",border:"1px solid #cbd5e1",background:"#f1f5f9",color:"#334155"},onClick:()=>{v(!1),C(""),I(null)},disabled:k||r,type:"button",children:"Cancelar"}),t.jsx("button",{style:{padding:"10px 20px",borderRadius:"8px",fontSize:"0.95rem",fontWeight:600,cursor:k||r?"not-allowed":"pointer",border:"none",background:"#ef4444",color:"white",opacity:k||r?.6:1},onClick:$,disabled:k||r,type:"button",children:k||r?"Verificando...":"Eliminar usuario"})]})]})}),t.jsx(Tn,{open:G,title:" Usuario eliminado",message:"El usuario fue eliminado correctamente del sistema.",onClose:()=>K(!1)}),t.jsx(Tn,{open:ne,title:" Error",message:B,onClose:()=>Y(!1)})]})}function Cm({open:l,onClose:i,row:r,cajeros:s,availableCajeros:c,availableCajas:d,onSave:f}){const[g,p]=y.useState(null),[m,b]=y.useState(null),[S,j]=y.useState(!1),[x,w]=y.useState(null),[v,E]=y.useState(""),[T,L]=y.useState(""),[R,z]=y.useState(""),[C,O]=y.useState(""),[I,k]=y.useState(null),[M,G]=y.useState(""),[K,ne]=y.useState(!1),[Y,B]=y.useState(null);if(y.useEffect(()=>{if(!l||!r)return;w(r.caja??null),E(r.cai??""),G(r.identificador??""),L(r.rango_de??""),z(r.rango_hasta??""),O(r.fecha_vencimiento??""),k(r.secuencia_actual??null);const N=r.cajero??null;if(N){const q=s.find(X=>X.username===N||X.nombre_usuario===N);q?(p(q.id),b(null),j(!1)):(p(null),b(N),j(!0))}else p(null),b(null),j(!1);B(null)},[l,r,s]),!l||!r)return null;async function A(){if(!r){B("Registro invlido");return}if(x!=null&&(x<1||x>5)){B("La caja debe estar entre 1 y 5");return}ne(!0),B(null);try{const N={cai:v??null,identificador:M??null,rango_de:T??null,rango_hasta:R??null,fecha_vencimiento:C??null,secuencia_actual:I??null,caja:x??null};if(g!=null){const q=s.find(X=>X.id===g);N.cajero=q?q.username:null,N.usuario_id=q?q.id:null}else N.cajero=m??null,N.usuario_id=null;await f(r.id,N),i()}catch(N){B(N?.message||String(N))}finally{ne(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:720,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsxs("h3",{style:{marginTop:0},children:["Editar CAI  ID ",r.id]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"CAI"}),t.jsx("input",{className:"input",value:v,onChange:N=>E(N.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Identificador"}),t.jsx("input",{className:"input",value:M,onChange:N=>G(N.target.value),placeholder:"Identificador (opcional)"}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Rango Desde"}),t.jsx("input",{className:"input",value:T,onChange:N=>L(N.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Rango Hasta"}),t.jsx("input",{className:"input",value:R,onChange:N=>z(N.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Fecha de Vencimiento"}),t.jsx("input",{className:"input",type:"date",value:C,onChange:N=>O(N.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Secuencia actual"}),t.jsx("input",{className:"input",value:I??"",onChange:N=>k(N.target.value===""?null:N.target.value),placeholder:"0"}),t.jsx("label",{style:{display:"block",marginTop:12,marginBottom:6},children:"Cajero"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("select",{className:"input",style:{minHeight:36,minWidth:200},value:g!=null?String(g):S?"__custom__":"",onChange:N=>{const q=N.target.value;q===""?(p(null),b(null),j(!1)):q==="__custom__"?(p(null),j(!0)):/^\d+$/.test(q)&&(p(Number(q)),b(null),j(!1))},children:[t.jsx("option",{value:"",children:"-- sin asignar --"}),(c??s).map(N=>t.jsxs("option",{value:String(N.id),children:[N.username,N.nombre_usuario?`  ${N.nombre_usuario}`:""]},N.id)),t.jsx("option",{value:"__custom__",children:"-- personalizado --"})]}),S&&t.jsx("input",{className:"input",placeholder:"Nombre de cajero",value:m??"",onChange:N=>{b(N.target.value),p(null)},style:{minHeight:36}}),t.jsxs("div",{style:{marginLeft:12},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Caja"}),t.jsxs("select",{className:"input",style:{minHeight:36,minWidth:120},value:x??"",onChange:N=>w(N.target.value===""?null:Number(N.target.value)),children:[t.jsx("option",{value:"",children:"-- sin asignar --"}),(d??[1,2,3,4,5]).map(N=>t.jsx("option",{value:N,children:N},N))]})]})]})]})]}),Y&&t.jsx("div",{style:{color:"red",marginTop:12},children:Y}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:K,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:A,disabled:K,style:{width:"auto",padding:"8px 14px"},children:K?"Guardando...":"Guardar"})]})]})})}function sj({open:l,onClose:i,cajeros:r,availableCajeros:s,availableCajas:c,onCreate:d}){const[f,g]=y.useState(null),[p,m]=y.useState(null),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState(""),[E,T]=y.useState(""),[L,R]=y.useState(""),[z,C]=y.useState(""),[O,I]=y.useState(null),[k,M]=y.useState(""),[G,K]=y.useState(!1),[ne,Y]=y.useState(null);if(!l)return null;async function B(){const A=[];if(w||A.push("CAI"),E||A.push("Rango Desde"),L||A.push("Rango Hasta"),z||A.push("Fecha de Vencimiento"),j==null&&A.push("Caja"),f==null&&!p&&A.push("Cajero"),A.length>0){Y(`Campos obligatorios faltantes: ${A.join(", ")}`);return}if(j!=null&&(j<1||j>5)){Y("La caja debe estar entre 1 y 5");return}K(!0),Y(null);try{const N={cai:w??null,identificador:k??null,rango_de:E??null,rango_hasta:L??null,fecha_vencimiento:z??null,secuencia_actual:O??null,caja:j??null};if(f!=null){const q=r.find(X=>X.id===f);N.cajero=q?q.username:null,N.usuario_id=q?q.id:null}else N.cajero=p??null,N.usuario_id=null;await d(N),i()}catch(N){Y(N?.message||String(N))}finally{K(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:720,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsx("h3",{style:{marginTop:0},children:"Agregar CAI"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"CAI"}),t.jsx("input",{className:"input",value:w,onChange:A=>v(A.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Identificador"}),t.jsx("input",{className:"input",value:k,onChange:A=>M(A.target.value),placeholder:"Identificador (opcional)"}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Rango Desde"}),t.jsx("input",{className:"input",value:E,onChange:A=>T(A.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Rango Hasta"}),t.jsx("input",{className:"input",value:L,onChange:A=>R(A.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Fecha de Vencimiento"}),t.jsx("input",{className:"input",type:"date",value:z,onChange:A=>C(A.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Secuencia actual"}),t.jsx("input",{className:"input",value:O??"",onChange:A=>I(A.target.value===""?null:A.target.value),placeholder:"0"}),t.jsx("label",{style:{display:"block",marginTop:12,marginBottom:6},children:"Cajero"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("select",{className:"input",style:{minHeight:36,minWidth:200},value:f!=null?String(f):b?"__custom__":"",onChange:A=>{const N=A.target.value;N===""?(g(null),m(null),S(!1)):N==="__custom__"?(g(null),S(!0)):/^\d+$/.test(N)&&(g(Number(N)),m(null),S(!1))},children:[t.jsx("option",{value:"",children:"-- sin asignar --"}),(s??r).map(A=>t.jsxs("option",{value:String(A.id),children:[A.username,A.nombre_usuario?`  ${A.nombre_usuario}`:""]},A.id)),t.jsx("option",{value:"__custom__",children:"-- personalizado --"})]}),b&&t.jsx("input",{className:"input",placeholder:"Nombre de cajero",value:p??"",onChange:A=>{m(A.target.value),g(null)},style:{minHeight:36}}),t.jsxs("div",{style:{marginLeft:12},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Caja"}),t.jsxs("select",{className:"input",style:{minHeight:36,minWidth:120},value:j??"",onChange:A=>x(A.target.value===""?null:Number(A.target.value)),children:[t.jsx("option",{value:"",children:"-- sin asignar --"}),(c??[1,2,3,4,5]).map(A=>t.jsx("option",{value:A,children:A},A))]})]})]})]})]}),ne&&t.jsx("div",{style:{color:"red",marginTop:12},children:ne}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:G,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:B,disabled:G,style:{width:"auto",padding:"8px 14px"},children:G?"Creando...":"Crear"})]})]})})}function lj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState([]),[p,m]=y.useState(null),[b,S]=y.useState(!1),[j,x]=y.useState(!1);async function w(){s(!0),d(null);try{const{data:C,error:O}=await F.from("cai").select("id, cai, identificador, rango_de, rango_hasta, fecha_vencimiento, secuencia_actual, caja, cajero, usuario_id").order("id",{ascending:!0});if(O)throw O;i(Array.isArray(C)?C:[])}catch(C){d(C?.message||String(C)),i([])}finally{s(!1)}}async function v(){try{const{data:C}=await F.from("users").select("id, username, nombre_usuario").eq("role","cajero").order("username",{ascending:!0});g(Array.isArray(C)?C:[])}catch{}}y.useEffect(()=>{w(),v()},[]);const E=new Set(l.filter(C=>C.cajero).map(C=>String(C.cajero))),T=new Set(l.filter(C=>C.caja!=null).map(C=>Number(C.caja)));function L(C){m(C),S(!0),d(null)}function R(){S(!1),m(null)}async function z(C,O){s(!0),d(null);try{const{error:I}=await F.from("cai").update(O).eq("id",C);if(I)throw I;await w()}catch(I){throw d(I?.message||String(I)),I}finally{s(!1)}}return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Gestio de -CAI- por cajas"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>w(),children:"Recargar"}),t.jsx("button",{className:"btn-primary",onClick:()=>x(!0),style:{marginLeft:6},children:"Agregar"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:r?"Cargando...":`${l.length} registros`})]}),c&&t.jsx("div",{style:{color:"red",marginBottom:12},children:c}),t.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:[t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"CAI"}),t.jsx("th",{children:"Identificador"}),t.jsx("th",{children:"Rango Desde"}),t.jsx("th",{children:"Rango Hasta"}),t.jsx("th",{children:"Vencimiento"}),t.jsx("th",{children:"Secuencia actual"}),t.jsx("th",{children:"Cajero"}),t.jsx("th",{children:"Usuario ID"}),t.jsx("th",{children:"Caja"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:l.map(C=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:80},children:C.id}),t.jsx("td",{style:{minWidth:200},children:C.cai}),t.jsx("td",{style:{minWidth:160},children:C.identificador??"-"}),t.jsx("td",{children:C.rango_de}),t.jsx("td",{children:C.rango_hasta}),t.jsx("td",{children:C.fecha_vencimiento}),t.jsx("td",{children:C.secuencia_actual??"-"}),t.jsx("td",{style:{minWidth:180},children:C.cajero||"-"}),t.jsx("td",{style:{minWidth:160},children:C.usuario_id??"-"}),t.jsx("td",{style:{width:120},children:C.caja??"-"}),t.jsx("td",{style:{whiteSpace:"nowrap"},children:t.jsx(t.Fragment,{children:t.jsx("button",{onClick:()=>L(C),className:"btn-opaque",style:{marginRight:6},children:"Editar"})})})]},C.id))})]}),l.length===0&&!r&&t.jsx("div",{style:{padding:12},children:"No se encontraron registros."})]}),t.jsx(Cm,{open:b,onClose:R,row:p,cajeros:f,availableCajeros:p?f.filter(C=>!E.has(C.username)||C.username===p.cajero):f.filter(C=>!E.has(C.username)),availableCajas:p?[1,2,3,4,5].filter(C=>!T.has(C)||C===p.caja):[1,2,3,4,5].filter(C=>!T.has(C)),onSave:z}),t.jsx(sj,{open:j,onClose:()=>x(!1),cajeros:f,availableCajeros:f.filter(C=>!E.has(C.username)),availableCajas:[1,2,3,4,5].filter(C=>!T.has(C)),onCreate:async C=>{s(!0),d(null);try{const{error:O}=await F.from("cai").insert(C);if(O)throw O;await w(),x(!1)}catch(O){throw d(O?.message||String(O)),O}finally{s(!1)}}})]})}function cj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState([]),[p,m]=y.useState(!1),[b,S]=y.useState(0),[j,x]=y.useState(0),[w,v]=y.useState(0),E=async()=>{m(!0);try{const T=new Date(r+"T00:00:00").toISOString(),L=new Date(c+"T23:59:59").toISOString(),{data:R,error:z}=await F.from("ventas").select("*").gte("fecha_venta",T).lte("fecha_venta",L).order("fecha_venta",{ascending:!1});if(z)throw z;const O=(Array.isArray(R)?R:[]).filter(M=>String(M.estado||"").toLowerCase()==="pagada");g(O);const I=O.reduce((M,G)=>M+Number(G.total||0),0);S(I),x(O.length);const k=O.map(M=>M.id).filter(Boolean);if(k.length>0){const{data:M,error:G}=await F.from("ventas_detalle").select("cantidad, venta_id").in("venta_id",k);if(!G&&Array.isArray(M)){const K=M.reduce((ne,Y)=>ne+Number(Y.cantidad||0),0);v(K)}else v(0)}else v(0)}catch(T){console.error("Error fetching ventas:",T)}finally{m(!1)}};return y.useEffect(()=>{E()},[r,c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Facturas (ventas)"}),t.jsxs("div",{style:{display:"flex",gap:12,marginBottom:18,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:T=>s(T.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:T=>d(T.target.value)})]}),t.jsx("div",{style:{marginLeft:"auto"},children:t.jsx("button",{className:"btn-opaque",onClick:E,disabled:p,children:p?"Cargando...":"Actualizar"})})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:20},children:[t.jsxs("div",{style:{background:"white",padding:16,borderRadius:8},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Total facturas"}),t.jsx("div",{style:{fontSize:20,fontWeight:700},children:j})]}),t.jsxs("div",{style:{background:"white",padding:16,borderRadius:8},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Total venta"}),t.jsxs("div",{style:{fontSize:20,fontWeight:700},children:["L ",b.toFixed(2)]})]}),t.jsxs("div",{style:{background:"white",padding:16,borderRadius:8},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Promedio por factura"}),t.jsxs("div",{style:{fontSize:20,fontWeight:700},children:["L ",(j?b/j:0).toFixed(2)]})]}),t.jsxs("div",{style:{background:"white",padding:16,borderRadius:8},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Artculos vendidos"}),t.jsx("div",{style:{fontSize:20,fontWeight:700},children:w})]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8},children:[t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[t.jsx("th",{style:{padding:12},children:"Factura"}),t.jsx("th",{style:{padding:12},children:"Fecha"}),t.jsx("th",{style:{padding:12,textAlign:"right"},children:"Total"}),t.jsx("th",{style:{padding:12},children:"Cliente"}),t.jsx("th",{style:{padding:12},children:"Estado"})]})}),t.jsx("tbody",{children:f.map(T=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:12},children:T.factura}),t.jsx("td",{style:{padding:12},children:T.fecha_venta?new Date(T.fecha_venta).toLocaleString():"-"}),t.jsxs("td",{style:{padding:12,textAlign:"right"},children:["L ",Number(T.total||0).toFixed(2)]}),t.jsx("td",{style:{padding:12},children:T.nombre_cliente||T.cliente_id||"-"}),t.jsx("td",{style:{padding:12},children:T.estado})]},T.id))})]}),f.length===0&&t.jsx("div",{style:{padding:32,textAlign:"center",color:"#94a3b8"},children:"No hay facturas en este rango"})]})]})}function dj({open:l,onClose:i,cajeros:r,availableCajeros:s,availableCajas:c,onCreated:d}){const[f,g]=y.useState(null),[p,m]=y.useState(null),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState(""),[E,T]=y.useState(""),[L,R]=y.useState(""),[z,C]=y.useState(""),[O,I]=y.useState(null),[k,M]=y.useState(""),[G,K]=y.useState(!1),[ne,Y]=y.useState(null);if(!l)return null;async function B(){const A=[];if(w||A.push("CAI"),E||A.push("Rango Desde"),L||A.push("Rango Hasta"),z||A.push("Fecha de Vencimiento"),j==null&&A.push("Caja"),f==null&&!p&&A.push("Cajero"),A.length>0){Y(`Campos obligatorios faltantes: ${A.join(", ")}`);return}if(j!=null&&(j<1||j>5)){Y("La caja debe estar entre 1 y 5");return}K(!0),Y(null);try{const N={cai:w??null,identificador:k??null,rango_de:E??null,rango_hasta:L??null,fecha_vencimiento:z??null,secuencia_actual:O??null,caja:j??null};if(f!=null){const X=r.find(ge=>ge.id===f);N.cajero=X?X.username:null,N.usuario_id=X?X.id:null}else N.cajero=p??null,N.usuario_id=null;const q=await F.from("ncredito").insert(N).select("id").maybeSingle();if(q.error)throw q.error;d&&d(),i()}catch(N){Y(N?.message||String(N))}finally{K(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:720,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsx("h3",{style:{marginTop:0},children:"Crear CAI - Nota de crdito"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"CAI"}),t.jsx("input",{className:"input",value:w,onChange:A=>v(A.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Identificador"}),t.jsx("input",{className:"input",value:k,onChange:A=>M(A.target.value),placeholder:"Identificador (opcional)"}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Rango Desde"}),t.jsx("input",{className:"input",value:E,onChange:A=>T(A.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Rango Hasta"}),t.jsx("input",{className:"input",value:L,onChange:A=>R(A.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Fecha de Vencimiento"}),t.jsx("input",{className:"input",type:"date",value:z,onChange:A=>C(A.target.value)}),t.jsx("label",{style:{display:"block",marginTop:8,marginBottom:6},children:"Secuencia actual"}),t.jsx("input",{className:"input",value:O??"",onChange:A=>I(A.target.value===""?null:A.target.value),placeholder:"0"}),t.jsx("label",{style:{display:"block",marginTop:12,marginBottom:6},children:"Cajero"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("select",{className:"input",style:{minHeight:36,minWidth:200},value:f!=null?String(f):b?"__custom__":"",onChange:A=>{const N=A.target.value;N===""?(g(null),m(null),S(!1)):N==="__custom__"?(g(null),S(!0)):/^\d+$/.test(N)&&(g(Number(N)),m(null),S(!1))},children:[t.jsx("option",{value:"",children:"-- sin asignar --"}),(s??r).map(A=>t.jsxs("option",{value:String(A.id),children:[A.username,A.nombre_usuario?`  ${A.nombre_usuario}`:""]},A.id)),t.jsx("option",{value:"__custom__",children:"-- personalizado --"})]}),b&&t.jsx("input",{className:"input",placeholder:"Nombre de cajero",value:p??"",onChange:A=>{m(A.target.value),g(null)},style:{minHeight:36}}),t.jsxs("div",{style:{marginLeft:12},children:[t.jsx("label",{style:{display:"block",marginBottom:6},children:"Caja"}),t.jsxs("select",{className:"input",style:{minHeight:36,minWidth:120},value:j??"",onChange:A=>x(A.target.value===""?null:Number(A.target.value)),children:[t.jsx("option",{value:"",children:"-- sin asignar --"}),(c??[1,2,3,4,5]).map(A=>t.jsx("option",{value:A,children:A},A))]})]})]})]})]}),ne&&t.jsx("div",{style:{color:"red",marginTop:12},children:ne}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:G,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:B,disabled:G,style:{width:"auto",padding:"8px 14px"},children:G?"Creando...":"Crear"})]})]})})}function uj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState([]),[p,m]=y.useState(null),[b,S]=y.useState(!1),[j,x]=y.useState(!1);async function w(){s(!0),d(null);try{const{data:C,error:O}=await F.from("ncredito").select("id, cai, identificador, rango_de, rango_hasta, fecha_vencimiento, secuencia_actual, caja, cajero, usuario_id").order("id",{ascending:!0});if(O)throw O;i(Array.isArray(C)?C:[])}catch(C){d(C?.message||String(C)),i([])}finally{s(!1)}}async function v(){try{const{data:C}=await F.from("users").select("id, username, nombre_usuario").eq("role","cajero").order("username",{ascending:!0});g(Array.isArray(C)?C:[])}catch{}}y.useEffect(()=>{w(),v()},[]);const E=new Set(l.filter(C=>C.cajero).map(C=>String(C.cajero))),T=new Set(l.filter(C=>C.caja!=null).map(C=>Number(C.caja)));function L(C){m(C),S(!0),d(null)}function R(){S(!1),m(null)}async function z(C,O){s(!0),d(null);try{const{error:I}=await F.from("ncredito").update(O).eq("id",C);if(I)throw I;await w()}catch(I){throw d(I?.message||String(I)),I}finally{s(!1)}}return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Notas de crdito (gestin similar a CAI)"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>w(),children:"Recargar"}),t.jsx("button",{className:"btn-primary",onClick:()=>x(!0),style:{marginLeft:6},children:"Agregar"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:r?"Cargando...":`${l.length} registros`})]}),c&&t.jsx("div",{style:{color:"red",marginBottom:12},children:c}),t.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:[t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"CAI"}),t.jsx("th",{children:"Identificador"}),t.jsx("th",{children:"Rango Desde"}),t.jsx("th",{children:"Rango Hasta"}),t.jsx("th",{children:"Vencimiento"}),t.jsx("th",{children:"Secuencia actual"}),t.jsx("th",{children:"Cajero"}),t.jsx("th",{children:"Usuario ID"}),t.jsx("th",{children:"Caja"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:l.map(C=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:80},children:C.id}),t.jsx("td",{style:{minWidth:200},children:C.cai}),t.jsx("td",{style:{minWidth:160},children:C.identificador??"-"}),t.jsx("td",{children:C.rango_de}),t.jsx("td",{children:C.rango_hasta}),t.jsx("td",{children:C.fecha_vencimiento}),t.jsx("td",{children:C.secuencia_actual??"-"}),t.jsx("td",{style:{minWidth:180},children:C.cajero||"-"}),t.jsx("td",{style:{minWidth:160},children:C.usuario_id??"-"}),t.jsx("td",{style:{width:120},children:C.caja??"-"}),t.jsx("td",{style:{whiteSpace:"nowrap"},children:t.jsx(t.Fragment,{children:t.jsx("button",{onClick:()=>L(C),className:"btn-opaque",style:{marginRight:6},children:"Editar"})})})]},C.id))})]}),l.length===0&&!r&&t.jsx("div",{style:{padding:12},children:"No se encontraron registros."})]}),t.jsx(Cm,{open:b,onClose:R,row:p,cajeros:f,availableCajeros:p?f.filter(C=>!E.has(C.username)||C.username===p.cajero):f.filter(C=>!E.has(C.username)),availableCajas:p?[1,2,3,4,5].filter(C=>!T.has(C)||C===p.caja):[1,2,3,4,5].filter(C=>!T.has(C)),onSave:z}),t.jsx(dj,{open:j,onClose:()=>x(!1),cajeros:f,availableCajeros:f.filter(C=>!E.has(C.username)),availableCajas:[1,2,3,4,5].filter(C=>!T.has(C)),onCreated:async()=>{await w(),x(!1)}})]})}var ou=Cg();function fj({open:l,title:i="Confirmar",message:r="Ests seguro?",onClose:s,onConfirm:c}){const[d,f]=Dr.useState(!1);if(!l)return null;const g=async()=>{try{f(!0),await c()}finally{f(!1)}};return ou.createPortal(t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsxs("div",{style:{background:"#fff",padding:18,borderRadius:8,width:420},children:[t.jsx("h3",{style:{marginTop:0},children:i}),t.jsx("p",{children:r}),t.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[t.jsx("button",{className:"btn-opaque",onClick:s,disabled:d,children:"Cancelar"}),t.jsx("button",{className:"btn-danger",onClick:g,disabled:d,children:d?"...":"Eliminar"})]})]})}),typeof document<"u"&&document.body||document.createElement("div"))}function hj({open:l,title:i="Formulario",columns:r,initialData:s={},onClose:c,onSave:d}){const[f,g]=y.useState({}),[p,m]=y.useState(!1),[b,S]=y.useState(null);if(y.useEffect(()=>{g(s||{}),s&&typeof s.imagen=="string"?S(s.imagen):S(null)},[s,l]),!l)return null;const j=(E,T)=>{g(L=>({...L,[E]:T}))},x=async E=>{E.preventDefault();try{m(!0),await d(f)}finally{m(!1)}},w=E=>E==="creado_en"?null:E==="id"?t.jsx("input",{className:"input",value:f[E]??"",readOnly:!0}):E.includes("publicacion")||E.includes("exento")||E.includes("aplica_impuesto")||E==="publicacion_web"?t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[t.jsxs("label",{className:"switch",children:[t.jsx("input",{type:"checkbox",checked:!!f[E],onChange:T=>j(E,T.target.checked)}),t.jsx("span",{className:"slider"})]}),t.jsx("span",{style:{fontSize:13},children:f[E]?"S":"No"})]}):E==="tipo"?t.jsxs("select",{className:"input",value:f[E]||"producto",onChange:T=>j(E,T.target.value),children:[t.jsx("option",{value:"producto",children:" Producto"}),t.jsx("option",{value:"servicio",children:" Servicio"})]}):E==="categoria"?t.jsxs("select",{className:"input",value:f[E]??"",onChange:T=>j(E,T.target.value===""?null:T.target.value),children:[t.jsx("option",{value:"",children:"-- Seleccionar categora --"}),t.jsx("option",{value:"SERVICIO",children:"SERVICIO"}),t.jsx("option",{value:"REPUESTO",children:"REPUESTO"}),t.jsx("option",{value:"PRODUCTO",children:"PRODUCTO"})]}):E.includes("categoria")||E.includes("marca")?t.jsx("input",{type:"text",className:"input",value:f[E]??"",onChange:T=>j(E,T.target.value===""?null:T.target.value)}):E==="imagen"?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[b?t.jsx("img",{src:b,alt:"preview",style:{maxWidth:200,maxHeight:120,objectFit:"contain"}}):null,t.jsx("input",{type:"file",accept:"image/*",onChange:T=>{const L=T.target.files&&T.target.files[0];if(j(E,L??null),L)try{const R=URL.createObjectURL(L);S(R)}catch{S(null)}else S(null)}}),b?t.jsx("button",{type:"button",className:"btn-opaque",onClick:()=>{j(E,null),S(null)},children:"Eliminar imagen"}):null]}):t.jsx("input",{className:"input",value:f[E]??"",onChange:T=>j(E,T.target.value)}),v=t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsxs("div",{style:{background:"#fff",padding:18,borderRadius:8,width:720,maxHeight:"90vh",overflow:"auto"},children:[t.jsx("h3",{style:{marginTop:0},children:i}),t.jsxs("form",{onSubmit:x,children:[t.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:r.map(E=>t.jsxs("label",{style:{display:"block"},children:[t.jsx("div",{style:{fontSize:12,color:"#374151",marginBottom:6},children:String(E).replace(/_/g," ").toUpperCase()}),w(E)]},E))}),t.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[t.jsx("button",{type:"button",className:"btn-opaque",onClick:c,disabled:p,children:"Cancelar"}),t.jsx("button",{type:"submit",className:"btn-primary",disabled:p,children:p?"Guardando...":"Guardar"})]})]})]})});return ou.createPortal(v,typeof document<"u"&&document.body||document.createElement("div"))}function pj({open:l,data:i,title:r="Detalle",onClose:s,onEdit:c,onDeleteClick:d}){if(!l)return null;const f=i||{},[g,p]=y.useState(null),[m,b]=y.useState(null),[S,j]=y.useState(null),[x,w]=y.useState(null);return y.useEffect(()=>{let v=!0;return(async()=>{const T=typeof f.imagen=="string"?f.imagen:null;if(!T){v&&p(null);return}if(T.startsWith("http")){v&&(p(T),j(T));return}let L=T;const R=String(T).match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);R&&(L=decodeURIComponent(R[2]));const z="inventario";try{const C=(await Zn(async()=>{const{default:G}=await Promise.resolve().then(()=>Xn);return{default:G}},void 0)).default,O=await C.storage.from(z).getPublicUrl(L),I=O?.data?.publicUrl||O?.data?.publicURL||null;if(I){v&&(p(I),j(I));return}const k=await C.storage.from(z).createSignedUrl(L,3600*24*7);if(k.error){console.warn("ProductDetailModal createSignedUrl error",k.error),v&&p(null);return}const M=k.data?.signedUrl??null;v&&(p(M),j(M))}catch(C){console.error("ProductDetailModal resolve error",C),v&&p(null)}})(),()=>{v=!1}},[f]),y.useEffect(()=>{let v=!0;return(async()=>{if(w(null),!!S)try{const T=await fetch(S,{method:"HEAD"});if(!v)return;w(`HEAD ${T.status} ${T.statusText} - content-type: ${T.headers.get("content-type")}`)}catch(T){if(!v)return;w(`FETCH_ERROR: ${String(T)}`)}})(),()=>{v=!1}},[S]),ou.createPortal(t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsxs("div",{style:{background:"#fff",padding:18,borderRadius:8,width:760,maxHeight:"90vh",overflow:"auto"},children:[t.jsx("h3",{style:{marginTop:0},children:r}),t.jsxs("div",{style:{display:"flex",gap:18},children:[t.jsx("div",{style:{flex:1},children:t.jsx("table",{style:{width:"100%"},children:t.jsx("tbody",{children:Object.keys(f).map(v=>{const E=f[v];return v==="imagen"&&typeof E=="string"?null:t.jsxs("tr",{children:[t.jsx("td",{style:{fontWeight:700,padding:6,width:160},children:String(v).replace(/_/g," ").toUpperCase()}),t.jsx("td",{style:{padding:6},children:String(E??"-")})]},v)})})})}),t.jsx("div",{style:{width:280,textAlign:"center"},children:g?t.jsx("img",{src:encodeURI(g),alt:"imagen",style:{maxWidth:260,maxHeight:260,objectFit:"contain"},onError:v=>{console.warn("Image load failed for",g),b(g),p(null)}}):m?t.jsxs("div",{style:{width:260,height:200,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#fff5f5",color:"#b91c1c",border:"1px dashed #fca5a5",padding:8},children:[t.jsx("div",{style:{marginBottom:8,fontWeight:700},children:"Error cargando imagen"}),t.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",style:{color:"#b91c1c",wordBreak:"break-all"},children:"Abrir imagen"})]}):t.jsx("div",{style:{width:260,height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#f3f4f6",color:"#6b7280"},children:"Sin imagen"})})]}),t.jsxs("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[t.jsx("button",{type:"button",className:"btn-opaque",onClick:()=>c(f),children:"Editar"}),t.jsx("button",{type:"button",className:"btn-danger",onClick:()=>d(f.id),children:"Eliminar"}),t.jsx("button",{type:"button",className:"btn-opaque",onClick:s,children:"Cerrar"})]})]})}),typeof document<"u"&&document.body||document.createElement("div"))}function gj({table:l,select:i,title:r,limit:s=500,columns:c,searchColumns:d,order:f,filters:g,allowAdd:p=!1,allowEdit:m=!1,allowDelete:b=!1,formExclude:S=[]}){const[j,x]=y.useState(null),[w,v]=y.useState(!1),[E,T]=y.useState(null),[L,R]=y.useState(""),[z,C]=y.useState(!1),[O,I]=y.useState("add"),[k,M]=y.useState({}),[G,K]=y.useState(!1),[ne,Y]=y.useState(null),[B,A]=y.useState(!1),[N,q]=y.useState(null),X=y.useRef(!0),ge=async()=>{v(!0),T(null);try{const oe=(await Zn(async()=>{const{default:ae}=await Promise.resolve().then(()=>Xn);return{default:ae}},void 0)).default,P=i||"*";let Se=oe.from(l).select(P).limit(s);f&&(Array.isArray(f)?f:String(f).split(",").map(V=>V.trim()).filter(Boolean)).forEach(V=>{const ue=V.split(" ").map(Te=>Te.trim()).filter(Boolean),de=ue[0],he=ue[1]?ue[1].toLowerCase():"asc";Se=Se.order(de,{ascending:he!=="desc"})}),g&&Object.entries(g).forEach(([ae,V])=>{V==null||V===""||(Se=Se.eq(ae,V))});const J=await Se;if(console.debug("SupabaseTable fetch result for",l,J),!X.current)return;if(J.error)throw J.error;x(Array.isArray(J.data)?J.data:[])}catch(oe){console.error("SupabaseTable error",oe),T(oe?.message||String(oe)),x([])}finally{X.current&&v(!1)}};y.useEffect(()=>(X.current=!0,ge(),()=>{X.current=!1}),[l,i,s]);const re=y.useMemo(()=>c&&c.length>0?c:!j||j.length===0?[]:Object.keys(j[0]),[c,j]),U=y.useMemo(()=>{if(!j)return null;const oe=(L||"").toString().trim().toLowerCase();if(!oe)return j;const P=d&&d.length>0?d:re;return j.filter(Se=>P.some(J=>{const ae=Se?.[J];return ae==null?!1:String(ae).toLowerCase().includes(oe)}))},[j,L,d,re]),$=()=>{p&&(I("add"),M({}),C(!0))},H=oe=>{m&&(I("edit"),M(oe),C(!0))},Z=async oe=>{const P=(await Zn(async()=>{const{default:Se}=await Promise.resolve().then(()=>Xn);return{default:Se}},void 0)).default;try{const Se="inventario",J={...oe},ae=O==="edit"?k?.imagen??null:null,V=ue=>{if(!ue)return null;if(!ue.startsWith("http"))return ue;const de=ue.match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);return de?decodeURIComponent(de[2]):null};if(J.imagen&&J.imagen instanceof File){const ue=J.imagen,de=J.id??(crypto&&crypto.randomUUID?crypto.randomUUID():String(Date.now())),he=`${l}/${de}/${Date.now()}_${ue.name.replace(/[^a-zA-Z0-9.\-_/]/g,"_")}`,Te=await P.storage.from(Se).upload(he,ue,{upsert:!0});if(Te.error)throw Te.error;const Oe=Te.data?.path??he;J.imagen=Oe;try{const Ue=V(ae);if(Ue&&Ue!==Oe){const Le=await P.storage.from(Se).remove([Ue]);Le.error&&console.warn("Failed to remove old image",Le.error)}}catch(Ue){console.warn("Error removing old image",Ue)}}if(O==="edit"&&(J.imagen==null||J.imagen===""))try{const ue=V(k?.imagen??null);if(ue){const de=await P.storage.from(Se).remove([ue]);de.error&&console.warn("Failed to remove old image on clear",de.error)}}catch(ue){console.warn("Error removing old image on clear",ue)}if(O==="add"){const{error:ue}=await P.from(l).insert([J]);if(ue)throw ue}else{const ue=J.id,de={...J};delete de.id;const{error:he}=await P.from(l).update(de).eq("id",ue);if(he)throw he}C(!1),await ge()}catch(Se){console.error("Error saving",Se),T(Se?.message||String(Se))}},ee=async()=>{if(ne==null)return;const oe=(await Zn(async()=>{const{default:P}=await Promise.resolve().then(()=>Xn);return{default:P}},void 0)).default;try{if(!b)return;try{const Se="inventario",J=j?.find(de=>de.id===ne),ae=de=>{if(!de)return null;if(!de.startsWith("http"))return de;const he=de.match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);return he?decodeURIComponent(he[2]):null},V=J?.imagen??null,ue=ae(V);if(ue){const de=await oe.storage.from(Se).remove([ue]);de.error&&console.warn("Failed to remove image on delete",de.error)}}catch(Se){console.warn("Error removing image before delete",Se)}const{error:P}=await oe.from(l).delete().eq("id",ne);if(P)throw P;K(!1),Y(null),await ge()}catch(P){console.error("Error deleting",P),T(P?.message||String(P))}};return t.jsxs("div",{style:{padding:"clamp(10px, 2vw, 18px)",width:"100%"},children:[r?t.jsx("h2",{style:{marginTop:0,fontSize:"clamp(18px, 3vw, 24px)"},children:r}):null,t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"clamp(6px, 1.5vw, 8px)",marginBottom:12},children:[t.jsx("input",{placeholder:"Buscar...",value:L,onChange:oe=>R(oe.target.value),className:"input",style:{minWidth:"clamp(180px, 40vw, 240px)",flex:"1 1 auto",fontSize:"clamp(12px, 2vw, 14px)"}}),t.jsx("button",{onClick:()=>{T(null),R(""),ge()},className:"btn-opaque",style:{fontSize:"clamp(11px, 2vw, 13px)",padding:"clamp(6px, 1.2vw, 8px) clamp(10px, 2vw, 12px)"},children:"Recargar"}),t.jsx("div",{style:{marginLeft:"auto"},children:t.jsx("button",{onClick:$,className:"btn-primary",style:{fontSize:"clamp(11px, 2vw, 13px)",padding:"clamp(6px, 1.2vw, 8px) clamp(10px, 2vw, 12px)"},children:"Agregar"})})]}),w&&t.jsxs("div",{children:["Cargando datos de `",l,"` desde Supabase..."]}),E&&t.jsxs("div",{style:{color:"#b91c1c"},children:["Error: ",E]}),!w&&j&&j.length===0&&t.jsxs("div",{children:["No hay registros en la tabla ",t.jsx("strong",{children:l}),"."]}),!w&&U&&U.length>0&&t.jsx("div",{style:{width:"100%",overflowX:"auto"},children:t.jsxs("table",{className:"admin-table",style:{minWidth:"100%"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[re.map(oe=>t.jsx("th",{children:String(oe).replace(/_/g," ").toUpperCase()},oe)),t.jsx("th",{style:{width:140},children:"Acciones"})]})}),t.jsx("tbody",{children:U.map((oe,P)=>t.jsxs("tr",{children:[re.map(Se=>{if(Se==="imagen"){const J=oe?.imagen??null;return J||console.debug("SupabaseTable: row has no imagen for id",oe?.id,oe),t.jsx("td",{style:{width:"clamp(80px, 15vw, 120px)",maxWidth:"clamp(80px, 15vw, 120px)",overflow:"hidden",textOverflow:"ellipsis"},children:J?t.jsx(Em,{src:String(J)}):t.jsx("span",{style:{color:"#6b7280"},children:"-"})},Se)}return t.jsx("td",{style:{maxWidth:420,wordBreak:"break-word"},children:mj(oe[Se])},Se)}),t.jsx("td",{className:"admin-actions",children:t.jsx("button",{className:"btn-opaque",onClick:()=>{q(oe),A(!0)},children:"Ver"})})]},oe.id??P))})]})}),t.jsx(hj,{open:z,title:O==="add"?`Agregar a ${l}`:`Editar ${l}`,columns:re.filter(oe=>!S.includes(oe)),initialData:k,onClose:()=>C(!1),onSave:Z}),t.jsx(pj,{open:B,data:N,title:`Detalle de ${l}`,onClose:()=>A(!1),onEdit:oe=>{A(!1),H(oe)},onDeleteClick:oe=>{A(!1),Y(oe),K(!0)}}),t.jsx(fj,{open:G,title:"Confirmar eliminacin",message:`Eliminar registro de ${l}?`,onClose:()=>K(!1),onConfirm:ee})]})}function mj(l){if(l==null)return"-";if(typeof l=="object")return JSON.stringify(l);if(typeof l=="boolean")return l?"S":"No";if(typeof l=="number"&&(l===0||l===1))return l===1?"S":"No";if(typeof l=="string"){const i=l.toLowerCase().trim();if(i==="1"||i==="true"||i==="t"||i==="si"||i==="s"||i==="yes")return"S";if(i==="0"||i==="false"||i==="f"||i==="no"||i==="n"||i==="not")return"No";if((l.startsWith("http")||l.startsWith("/"))&&(i.endsWith(".png")||i.endsWith(".jpg")||i.endsWith(".jpeg")||i.endsWith(".gif")||i.endsWith(".webp")||i.endsWith(".svg")||i.includes("/storage/")))return t.jsx(Em,{src:l})}return String(l)}function Em({src:l}){const[i,r]=y.useState(null),[s,c]=y.useState(null);return y.useEffect(()=>{let d=!0;return(async()=>{if(!l)return;if(l.startsWith("http")){d&&r(l);return}let g=l;const p=String(l).match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);p&&(g=decodeURIComponent(p[2]));try{const m=(await Zn(async()=>{const{default:v}=await Promise.resolve().then(()=>Xn);return{default:v}},void 0)).default,b="inventario",S=await m.storage.from(b).getPublicUrl(g),j=S?.data?.publicUrl||S?.data?.publicURL||null;if(j){d&&r(j);return}const x=await m.storage.from(b).createSignedUrl(g,3600*24*7);if(x.error){console.warn("Thumbnail createSignedUrl error",x.error),d&&r(null);return}const w=x.data?.signedUrl??null;d&&r(w)}catch(m){console.error("Thumbnail resolve error",m),d&&r(null)}})(),()=>{d=!1}},[l]),!i&&!s?t.jsx("div",{style:{width:"100%",maxWidth:"clamp(60px, 12vw, 100px)",height:"clamp(40px, 8vw, 60px)",display:"flex",alignItems:"center",justifyContent:"center",background:"#f3f4f6",color:"#6b7280",borderRadius:4,fontSize:"clamp(8px, 1.5vw, 10px)"},children:"Cargando..."}):i?t.jsx("img",{src:encodeURI(i),alt:"img",style:{maxWidth:"clamp(60px, 12vw, 100px)",maxHeight:"clamp(40px, 8vw, 60px)",objectFit:"contain",width:"100%"},onError:d=>{c(i),r(null)}}):t.jsx("div",{style:{width:140,height:80,display:"flex",alignItems:"center",justifyContent:"center",background:"#fff7ed",border:"1px dashed #f59e0b",padding:4},children:t.jsx("a",{href:s??l,target:"_blank",rel:"noopener noreferrer",style:{fontSize:12,color:"#92400e",textDecoration:"underline",wordBreak:"break-all"},children:"Abrir imagen"})})}function yj(){const[l,i]=y.useState(null),[r,s]=y.useState(""),[c,d]=y.useState(""),[f,g]=y.useState([]),[p,m]=y.useState([]);return y.useEffect(()=>{let b=!0;return(async()=>{try{const x=await(await Zn(async()=>{const{default:M}=await Promise.resolve().then(()=>Xn);return{default:M}},void 0)).default.from("inventario").select("id,categoria,marca,publicacion_web,exento,aplica_impuesto_18,aplica_impuesto_turistico,tipo");if(!b)return;const w=Array.isArray(x.data)?x.data:[],v=new Set(w.map(M=>M.categoria??"").filter(Boolean)),E=new Set(w.map(M=>M.marca??"").filter(Boolean)),T=w.length,L=w.filter(M=>(M.tipo||"producto")==="producto").length,R=w.filter(M=>M.tipo==="servicio").length,z=w.filter(M=>!!M.publicacion_web).length,C=M=>{if(M==null)return!1;if(typeof M=="boolean")return M===!0;if(typeof M=="number")return M===1;const G=String(M).toLowerCase().trim();return G==="1"||G==="true"||G==="t"||G==="si"||G==="s"||G==="yes"},O=w.filter(M=>C(M.exento)).length,I=w.filter(M=>C(M.aplica_impuesto_18)).length,k=w.filter(M=>C(M.aplica_impuesto_turistico)).length;i({categorias:v.size,marcas:E.size,items:T,productos:L,servicios:R,publicadas:z,exentos:O,aplica_impuesto_18:I,aplica_impuesto_turistico:k}),g(Array.from(v).sort()),m(Array.from(E).sort())}catch(j){console.error("Error loading inventario summary",j)}})(),()=>{b=!1}},[]),t.jsxs("div",{style:{padding:"clamp(8px, 2vw, 18px)"},children:[t.jsx("h2",{style:{marginTop:0,fontSize:"clamp(18px, 3vw, 24px)"},children:"PRODUCTOS"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"clamp(8px, 1.5vw, 12px)",marginBottom:16},children:[t.jsx(Va,{label:"Categoras (cuenta)",value:l?String(l.categorias):"..."}),t.jsx(Va,{label:"Marcas",value:l?String(l.marcas):"..."}),t.jsx(Va,{label:"Items",value:l?String(l.items):"..."}),t.jsx(Va,{label:" Productos",value:l?String(l.productos):"..."}),t.jsx(Va,{label:" Servicios",value:l?String(l.servicios):"..."}),t.jsx(Va,{label:"Publicadas en web",value:l?String(l.publicadas):"..."}),t.jsx(Va,{label:"Exentos",value:l?String(l.exentos):"..."}),t.jsx(Va,{label:"Aplica impuesto 18%",value:l?String(l.aplica_impuesto_18):"..."}),t.jsx(Va,{label:"Impuesto turstico",value:l?String(l.aplica_impuesto_turistico):"..."})]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"clamp(6px, 1.5vw, 8px)",alignItems:"center",marginBottom:12,fontSize:"clamp(11px, 2vw, 13px)"},children:[t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("div",{style:{fontSize:13,color:"#374151"},children:"Categoria:"}),t.jsxs("select",{value:r,onChange:b=>s(b.target.value),className:"input",children:[t.jsx("option",{value:"",children:"Todas"}),f.map(b=>t.jsx("option",{value:b,children:b},b))]})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("div",{style:{fontSize:13,color:"#374151"},children:"Marca:"}),t.jsxs("select",{value:c,onChange:b=>d(b.target.value),className:"input",children:[t.jsx("option",{value:"",children:"Todas"}),p.map(b=>t.jsx("option",{value:b,children:b},b))]})]}),t.jsx("button",{className:"btn-opaque",onClick:()=>{s(""),d("")},children:"Limpiar filtros"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{document.body.classList.add("print-table-only"),setTimeout(()=>{window.print(),document.body.classList.remove("print-table-only")},50)},children:"Imprimir tabla"})]}),t.jsx("div",{style:{maxHeight:"65vh",overflowY:"auto",width:"100%",overflowX:"hidden"},children:t.jsx(gj,{table:"inventario",select:"id, nombre, sku, codigo_barras, categoria, marca, descripcion, modelo, tipo, publicacion_web, exento, aplica_impuesto_18, aplica_impuesto_turistico, creado_en,imagen",title:"",order:["id","categoria","marca"],filters:{categoria:r||void 0,marca:c||void 0},columns:["imagen","sku","nombre","tipo","marca","modelo","categoria","descripcion","publicacion_web","exento","aplica_impuesto_18","aplica_impuesto_turistico","creado_en"],searchColumns:["nombre","sku","descripcion","codigo_barras","modelo"],formExclude:["codigo_barras","creado_en"],allowAdd:!0,allowEdit:!0,allowDelete:!0})})]})}function Va({label:l,value:i}){return t.jsxs("div",{style:{padding:"clamp(8px, 1.5vw, 12px)",background:"#fff",borderRadius:8,boxShadow:"0 1px 2px rgba(0,0,0,0.04)",minWidth:"clamp(100px, 20vw, 140px)",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"clamp(10px, 1.8vw, 12px)",color:"#6b7280",marginBottom:4},children:l}),t.jsx("div",{style:{fontSize:"clamp(16px, 3vw, 20px)",fontWeight:700,marginTop:6},children:i})]})}function bj({open:l,onClose:i,products:r,availableCajas:s,onCreate:c}){const[d,f]=y.useState(null),[g,p]=y.useState(""),[m,b]=y.useState(!1),[S,j]=y.useState(null),[x,w]=y.useState(null),[v,E]=y.useState(null),[T,L]=y.useState(null),[R,z]=y.useState(null),[C,O]=y.useState(null),[I,k]=y.useState(null),[M,G]=y.useState(null),[K,ne]=y.useState(null),[Y,B]=y.useState(!1);y.useEffect(()=>{l&&(f(null),p(""),w(null),E(null),L(null),G(null),ne(null),j(null))},[l]);async function A(){const q=[];if(d||q.push("Producto"),g||q.push("Precio"),q.length>0){j(`Faltan campos: ${q.join(", ")}`);return}const X=Number(g);if(isNaN(X)||X<0){j("Precio invlido");return}b(!0),j(null);try{await c({producto_id:d,precio:g});try{const ge={};if(R!==null&&(ge.exento=R),C!==null&&(ge.aplica_impuesto_18=C),I!==null&&(ge.aplica_impuesto_turistico=I),Object.keys(ge).length>0){const{error:re}=await F.from("inventario").update(ge).eq("id",d);re&&console.warn("Error actualizando inventario flags:",re)}}catch(ge){console.warn("Error al persistir flags en inventario:",ge)}i()}catch(ge){j(ge?.message||String(ge))}finally{b(!1)}}function N(q){return q?Number(q.replace(",",".")):NaN}return y.useEffect(()=>{let q=!0;async function X(){if(w(null),E(null),L(null),G(null),ne(null),!d)return;const ge=N(g);if(!isNaN(ge)){B(!0);try{const{data:re,error:U}=await F.from("compras_detalle").select("costo_unitario").eq("producto_id",d);if(U)throw U;const $=Array.isArray(re)?re.map(se=>Number(se.costo_unitario)).filter(se=>!isNaN(se)):[],H=$.length>0?$.reduce((se,ve)=>se+ve,0)/$.length:0;if(!q)return;w(H);let Z=!1,ee=!1,oe=!1;try{const{data:se,error:ve}=await F.from("inventario").select("exento,aplica_impuesto_18,aplica_impuesto_turistico").eq("id",d).single();!ve&&se&&(Z=!!se.exento,ee=!!se.aplica_impuesto_18,oe=!!se.aplica_impuesto_turistico,R===null&&z(Z),C===null&&O(ee),I===null&&k(oe))}catch{}const{data:P}=await F.from("impuesto").select("id, impuesto_venta"),Se={};Array.isArray(P)&&P.forEach(se=>{Se[String(se.id)]=Number(se.impuesto_venta)});const J=R!==null?R:Z,ae=C!==null?C:ee,V=I!==null?I:oe;let ue=0;J?ue=0:ae?ue=Se[2]??Se[1]??0:ue=Se[1]??0;let de=0;V&&(de=Se[3]??0);const he=(ue||0)+(de||0),Te=he>1?he/100:he,Oe=ge*Te;E(he),L(Oe);const Ue=ge-H,Le=H>0?Ue/H*100:null;G(Le);const ze=ge>0?(ge-H-Oe)/ge*100:null;ne(ze)}catch{}finally{q&&B(!1)}}}return X(),()=>{q=!1}},[d,g,R,C,I]),l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:640,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsx("h3",{style:{marginTop:0},children:"Agregar precio"}),t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsx("label",{style:{fontSize:13},children:"Producto"}),t.jsxs("select",{className:"input",value:d??"",onChange:q=>f(q.target.value||null),children:[t.jsx("option",{value:"",children:"-- seleccionar producto --"}),r.map(q=>t.jsx("option",{value:q.id,children:q.nombre},q.id))]}),t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:6},children:[t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:!!R,onChange:q=>z(q.target.checked)}),t.jsx("span",{style:{fontSize:13},children:"Exento (si activo, impuesto = 0)"})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:!!C,onChange:q=>O(q.target.checked)}),t.jsx("span",{style:{fontSize:13},children:"Usar impuesto 18% (id=2)"})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:!!I,onChange:q=>k(q.target.checked)}),t.jsx("span",{style:{fontSize:13},children:"Impuesto turstico (+ id=3)"})]})]}),t.jsx("label",{style:{fontSize:13},children:"Precio"}),t.jsx("input",{className:"input",value:g,onChange:q=>p(q.target.value),placeholder:"0.00"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:8},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Costo (promedio compras)"}),t.jsx("input",{className:"input",value:x==null?"":x.toFixed(2),readOnly:!0,placeholder:"--"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Impuesto (monto)"}),t.jsx("input",{className:"input",value:T==null?"":T.toFixed(2),readOnly:!0,placeholder:"--"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Margen de ganancia (%)"}),t.jsx("input",{className:"input",value:M==null?"":M.toFixed(2),readOnly:!0,placeholder:"--"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Rentabilidad (%)"}),t.jsx("input",{className:"input",value:K==null?"":K.toFixed(2),readOnly:!0,placeholder:"--"})]})]})]}),S&&t.jsx("div",{style:{color:"red",marginTop:12},children:S}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:m,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:A,disabled:m,style:{width:"auto",padding:"8px 14px"},children:m?"Creando...":"Crear"})]})]})}):null}function xj({open:l,onClose:i,row:r,products:s,availableProducts:c,onSave:d}){const[f,g]=y.useState(null),[p,m]=y.useState(""),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState(null),[E,T]=y.useState(null),[L,R]=y.useState(null),[z,C]=y.useState(null),[O,I]=y.useState(null),[k,M]=y.useState(null),[G,K]=y.useState(null),[ne,Y]=y.useState(null),[B,A]=y.useState(!1);y.useEffect(()=>{if(!(!l||!r)){g(r.producto_id);try{const X=Number(r.precio);m(isNaN(X)?String(r.precio):X.toFixed(2))}catch{m(r.precio)}x(null)}},[l,r]);function N(X){return X?Number(X.replace(",",".")):NaN}if(y.useEffect(()=>{let X=!0;async function ge(){if(v(null),T(null),R(null),K(null),Y(null),!l||!r||!f)return;const re=N(p);if(!isNaN(re)){A(!0);try{const{data:U,error:$}=await F.from("compras_detalle").select("costo_unitario").eq("producto_id",f);if($)throw $;const H=Array.isArray(U)?U.map(ve=>Number(ve.costo_unitario)).filter(ve=>!isNaN(ve)):[],Z=H.length>0?H.reduce((ve,$e)=>ve+$e,0)/H.length:0;if(!X)return;v(Z);let ee=!1,oe=!1,P=!1;try{const{data:ve,error:$e}=await F.from("inventario").select("exento,aplica_impuesto_18,aplica_impuesto_turistico").eq("id",f).single();!$e&&ve&&(ee=!!ve.exento,oe=!!ve.aplica_impuesto_18,P=!!ve.aplica_impuesto_turistico,z===null&&C(ee),O===null&&I(oe),k===null&&M(P))}catch{}const{data:Se}=await F.from("impuesto").select("id, impuesto_venta"),J={};Array.isArray(Se)&&Se.forEach(ve=>J[String(ve.id)]=Number(ve.impuesto_venta));const ae=z!==null?z:ee,V=O!==null?O:oe,ue=k!==null?k:P;let de=0;ae?de=0:V?de=J[2]??J[1]??0:de=J[1]??0;let he=0;ue&&(he=J[3]??0);const Te=(de||0)+(he||0),Oe=Te>1?Te/100:Te,Ue=re*Oe;T(Te),R(Ue);const Le=re-Z,ze=Z>0?Le/Z*100:null;K(ze);const se=re>0?(re-Z-Ue)/re*100:null;Y(se)}catch{}finally{X&&A(!1)}}}return ge(),()=>{X=!1}},[l,r,f,p,z,O,k]),!l||!r)return null;async function q(){const X=[];if(f||X.push("Producto"),p||X.push("Precio"),X.length>0){x(`Faltan campos: ${X.join(", ")}`);return}const ge=Number(p);if(isNaN(ge)||ge<0){x("Precio invlido");return}S(!0),x(null);try{const re=r.id;await d(re,{producto_id:f,precio:p});try{const U={};if(z!==null&&(U.exento=z),O!==null&&(U.aplica_impuesto_18=O),k!==null&&(U.aplica_impuesto_turistico=k),Object.keys(U).length>0&&f){const{error:$}=await F.from("inventario").update(U).eq("id",f);$&&console.warn("Error actualizando inventario flags:",$)}}catch(U){console.warn("Error al persistir flags en inventario:",U)}i()}catch(re){x(re?.message||String(re))}finally{S(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:640,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsxs("h3",{style:{marginTop:0},children:["Editar precio  ID ",r.id]}),t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsx("label",{style:{fontSize:13},children:"Producto"}),t.jsxs("select",{className:"input",value:f??"",onChange:X=>g(X.target.value||null),children:[t.jsx("option",{value:"",children:"-- seleccionar producto --"}),(c??s).map(X=>t.jsx("option",{value:X.id,children:X.nombre},X.id))]}),t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:6},children:[t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:!!z,onChange:X=>C(X.target.checked)}),t.jsx("span",{style:{fontSize:13},children:"Exento (si activo, impuesto = 0)"})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:!!O,onChange:X=>I(X.target.checked)}),t.jsx("span",{style:{fontSize:13},children:"Usar impuesto 18% (id=2)"})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:!!k,onChange:X=>M(X.target.checked)}),t.jsx("span",{style:{fontSize:13},children:"Impuesto turstico (+ id=3)"})]})]}),t.jsx("label",{style:{fontSize:13},children:"Precio"}),t.jsx("input",{className:"input",value:p,onChange:X=>m(X.target.value),placeholder:"0.00"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:8},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Costo (promedio compras)"}),t.jsx("input",{className:"input",value:w==null?"":w.toFixed(2),readOnly:!0,placeholder:"--"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Impuesto (monto)"}),t.jsx("input",{className:"input",value:L==null?"":L.toFixed(2),readOnly:!0,placeholder:"--"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Margen de ganancia (%)"}),t.jsx("input",{className:"input",value:G==null?"":G.toFixed(2),readOnly:!0,placeholder:"--"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Rentabilidad (%)"}),t.jsx("input",{className:"input",value:ne==null?"":ne.toFixed(2),readOnly:!0,placeholder:"--"})]})]})]}),j&&t.jsx("div",{style:{color:"red",marginTop:12},children:j}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:b,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:q,disabled:b,style:{width:"auto",padding:"8px 14px"},children:b?"Guardando...":"Guardar"})]})]})})}function vj(){const[l,i]=y.useState([]),[r,s]=y.useState([]),[c,d]=y.useState(!1),[f,g]=y.useState(null),[p,m]=y.useState(!1),[b,S]=y.useState(!1),[j,x]=y.useState(null);async function w(){d(!0),g(null);try{const{data:C,error:O}=await F.from("precios").select("id, producto_id, precio").order("id",{ascending:!0});if(O)throw O;i(Array.isArray(C)?C:[])}catch(C){g(C?.message||String(C)),i([])}finally{d(!1)}}async function v(){try{const{data:C}=await F.from("inventario").select("id, nombre").order("nombre",{ascending:!0});s(Array.isArray(C)?C:[])}catch{}}y.useEffect(()=>{w(),v()},[]);const E=new Set(l.map(C=>String(C.producto_id))),T=r.filter(C=>!E.has(C.id));function L(C){x(C),S(!0),g(null)}async function R(C){d(!0),g(null);try{const{error:O}=await F.from("precios").insert(C);if(O)throw O;try{const I={producto_id:C.producto_id,precio:C.precio},{error:k}=await F.from("precios_historico").insert(I);k&&console.warn("No se pudo insertar en precios_historico",k)}catch(I){console.warn("Error registrando precios_historico",I)}await w()}catch(O){throw g(O?.message||String(O)),O}finally{d(!1)}}async function z(C,O){d(!0),g(null);try{const{error:I}=await F.from("precios").update(O).eq("id",C);if(I)throw I;let k=O.producto_id,M=O.precio;if(!k||M===void 0)try{const{data:G}=await F.from("precios").select("producto_id, precio").eq("id",C).limit(1).single();G&&(k=k||G.producto_id,M=M===void 0?G.precio:M)}catch{}try{if(k&&M!==void 0){const G={producto_id:k,precio:M},{error:K}=await F.from("precios_historico").insert(G);K&&console.warn("No se pudo insertar en precios_historico",K)}}catch(G){console.warn("Error registrando precios_historico",G)}await w()}catch(I){throw g(I?.message||String(I)),I}finally{d(!1)}}return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Precios de productos"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>{w(),v()},children:"Recargar"}),t.jsx("button",{className:"btn-primary",onClick:()=>m(!0),style:{marginLeft:6},children:"Agregar precio"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:c?"Cargando...":`${l.length} precios`})]}),f&&t.jsx("div",{style:{color:"red",marginBottom:12},children:f}),t.jsx("div",{style:{background:"#fff",padding:12,borderRadius:8},children:t.jsx("div",{style:{maxHeight:"65vh",overflowY:"auto",overflowX:"auto"},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Precio"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:l.map(C=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:80},children:C.id}),t.jsx("td",{style:{minWidth:220},children:r.find(O=>O.id===C.producto_id)?.nombre||C.producto_id}),t.jsx("td",{children:C.precio}),t.jsx("td",{style:{whiteSpace:"nowrap"},children:t.jsx("button",{className:"btn-opaque",onClick:()=>L(C),children:"Editar"})})]},C.id))})]})})}),t.jsx(bj,{open:p,onClose:()=>m(!1),products:T,onCreate:async C=>{await R(C),m(!1)}}),t.jsx(xj,{open:b,onClose:()=>{S(!1),x(null)},row:j,products:r,availableProducts:[...r.filter(C=>!E.has(C.id)),...j?r.filter(C=>C.id===j.producto_id):[]],onSave:async(C,O)=>{await z(C,O),S(!1),x(null)}})]})}function jj(){const[l,i]=y.useState(""),[r,s]=y.useState([]),[c,d]=y.useState(null),[f,g]=y.useState([]),[p,m]=y.useState(!1),[b,S]=y.useState(null);async function j(){if(S(null),s([]),d(null),g([]),!!l){m(!0);try{const{data:w,error:v}=await F.from("inventario").select("id, nombre, sku").ilike("sku",`%${l}%`).order("nombre",{ascending:!0});if(v)throw v;if(s(Array.isArray(w)?w:[]),Array.isArray(w)&&w.length===1){const E=w[0].id;d(E),await x(E)}}catch(w){S(w?.message||String(w))}finally{m(!1)}}}async function x(w){m(!0),S(null);try{const{data:v,error:E}=await F.from("precios_historico").select("id, producto_id, precio, cambiado_en").eq("producto_id",w).order("cambiado_en",{ascending:!1});if(E)throw E;g(Array.isArray(v)?v:[])}catch(v){S(v?.message||String(v)),g([])}finally{m(!1)}}return y.useEffect(()=>{c&&x(c)},[c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Histrico de precios"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("input",{className:"input",placeholder:"Buscar por SKU",value:l,onChange:w=>i(w.target.value)}),t.jsx("button",{className:"btn-opaque",onClick:()=>j(),children:"Buscar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{i(""),s([]),d(null),g([])},children:"Limpiar"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:p?"Cargando...":`${f.length} registros`})]}),b&&t.jsx("div",{style:{color:"red",marginBottom:12},children:b}),r.length>0&&t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("div",{style:{fontSize:13,marginBottom:6},children:"Resultados:"}),t.jsx("ul",{children:r.map(w=>t.jsxs("li",{style:{marginBottom:6},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>d(w.id),style:{marginRight:8},children:w.sku}),t.jsx("strong",{children:w.nombre})," ",t.jsxs("span",{style:{color:"#6b7280"},children:["(",w.id,")"]})]},w.id))})]}),t.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{}),t.jsx("div",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>{document.body.classList.add("print-table-only"),setTimeout(()=>{window.print(),document.body.classList.remove("print-table-only")},50)},children:"Imprimir tabla"})})]}),t.jsxs("table",{className:"admin-table",style:{marginTop:8},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Precio"}),t.jsx("th",{children:"Actualizacion"})]})}),t.jsx("tbody",{children:f.map(w=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:80},children:String(w.id)}),t.jsx("td",{style:{minWidth:220},children:r.find(v=>v.id===w.producto_id)?.nombre||w.producto_id}),t.jsx("td",{children:Number(w.precio).toFixed(2)}),t.jsx("td",{children:w.cambiado_en})]},String(w.id)))})]})]})]})}function Sj(){const[l,i]=y.useState(""),[r,s]=y.useState(""),[c,d]=y.useState(""),[f,g]=y.useState([]),[p,m]=y.useState({}),[b,S]=y.useState({}),[j,x]=y.useState(!1),[w,v]=y.useState(null);async function E(){x(!0),v(null);try{let T=F.from("inventario").select("id, nombre, sku, marca, modelo, descripcion, imagen");l&&(T=T.ilike("sku",`%${l}%`)),r&&(T=T.ilike("marca",`%${r}%`)),c&&(T=T.ilike("modelo",`%${c}%`)),T=T.not("categoria","ilike","%servicios%");const{data:L,error:R}=await T.order("nombre",{ascending:!0});if(R)throw R;const z=Array.isArray(L)?L:[];g(z);const C=z.map(G=>G.id);if(C.length===0){m({});return}const{data:O,error:I}=await F.from("registro_de_inventario").select("producto_id, cantidad, tipo_de_movimiento").in("producto_id",C);if(I)throw I;const k=Array.isArray(O)?O:[],M={};for(const G of z)M[String(G.id)]=0;for(const G of k){const K=String(G.producto_id),ne=Number(G.cantidad)||0,Y=String(G.tipo_de_movimiento||"").toUpperCase();M.hasOwnProperty(K)||(M[K]=0),Y==="ENTRADA"?M[K]=(M[K]||0)+ne:Y==="SALIDA"&&(M[K]=(M[K]||0)-ne)}for(const G of Object.keys(M))M[G]=Number((M[G]||0).toFixed(2));m(M);try{const G=(await Zn(async()=>{const{default:Y}=await Promise.resolve().then(()=>Xn);return{default:Y}},void 0)).default,K="inventario",ne={};await Promise.all(z.map(async Y=>{const B=Y.imagen;if(!B){ne[String(Y.id)]=null;return}const A=String(B);if(A.startsWith("http")){ne[String(Y.id)]=A;return}let N=A;const q=String(A).match(/\/storage\/v1\/object\/public\/([^/]+)\/(.*)/);q&&(N=decodeURIComponent(q[2]));try{const X=await G.storage.from(K).getPublicUrl(N),ge=X?.data?.publicUrl||X?.data?.publicURL||null;if(ge){ne[String(Y.id)]=ge;return}}catch{}try{const ge=(await G.storage.from(K).createSignedUrl(N,604800))?.data?.signedUrl??null;ne[String(Y.id)]=ge}catch{ne[String(Y.id)]=null}})),S(ne)}catch{}}catch(T){v(T?.message||String(T)),g([]),m({})}finally{x(!1)}}return y.useEffect(()=>{E()},[]),t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Stock"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("input",{className:"input",placeholder:"Filtro SKU",value:l,onChange:T=>i(T.target.value)}),t.jsx("input",{className:"input",placeholder:"Filtro Marca",value:r,onChange:T=>s(T.target.value)}),t.jsx("input",{className:"input",placeholder:"Filtro Modelo",value:c,onChange:T=>d(T.target.value)}),t.jsx("button",{className:"btn-opaque",onClick:()=>E(),children:"Aplicar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{i(""),s(""),d(""),E()},children:"Limpiar"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:j?"Cargando...":`${f.length} productos`})]}),w&&t.jsx("div",{style:{color:"red",marginBottom:12},children:w}),t.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{}),t.jsx("div",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>{document.body.classList.add("print-table-only"),setTimeout(()=>{window.print(),document.body.classList.remove("print-table-only")},50)},children:"Imprimir tabla"})})]}),t.jsx("div",{style:{maxHeight:"65vh",overflowY:"auto",overflowX:"auto",marginTop:8},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Imagen"}),t.jsx("th",{children:"SKU"}),t.jsx("th",{children:"Marca"}),t.jsx("th",{children:"Modelo"}),t.jsx("th",{children:"Descripcin"}),t.jsx("th",{children:"Stock"})]})}),t.jsx("tbody",{children:f.map(T=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:70},children:b[String(T.id)]?t.jsx("img",{src:encodeURI(b[String(T.id)]),alt:T.nombre,style:{width:48,height:48,objectFit:"cover"},onError:L=>{L.currentTarget.src=""}}):T.imagen?t.jsx("img",{src:T.imagen,alt:T.nombre,style:{width:48,height:48,objectFit:"cover"},onError:L=>{L.currentTarget.src=""}}):""}),t.jsx("td",{children:T.sku||""}),t.jsx("td",{children:T.marca||""}),t.jsx("td",{children:T.modelo||""}),t.jsx("td",{style:{maxWidth:320},children:T.descripcion||""}),t.jsx("td",{style:{textAlign:"right"},children:p[String(T.id)]!=null?String(p[String(T.id)]):"0"})]},T.id))})]})})]})]})}function _j(){const[l,i]=y.useState(""),[r,s]=y.useState(""),[c,d]=y.useState(""),[f,g]=y.useState([]),[p,m]=y.useState([]),[b,S]=y.useState(!1),[j,x]=y.useState([]),[w,v]=y.useState({}),[E,T]=y.useState(!1),[L,R]=y.useState(null);async function z(){T(!0),R(null),x([]);try{let k=null;if(l||r||c){let N=F.from("inventario").select("id, tipo, categoria").order("nombre",{ascending:!0});l&&(N=N.ilike("sku",`%${l}%`)),r&&(N=N.ilike("marca",`%${r}%`)),c&&(N=N.ilike("categoria",`%${c}%`)),N=N.not("categoria","ilike","%servicios%");const{data:q,error:X}=await N;if(X)throw X;if(k=(Array.isArray(q)?q.filter(re=>{const U=String(re.tipo||"producto").toLowerCase(),$=String(re.categoria||"").toUpperCase();return U!=="servicio"&&!$.includes("SERVICIO")}):[]).map(re=>String(re.id)),k.length===0){x([]),v({}),T(!1);return}}let M=F.from("registro_de_inventario").select("id, producto_id, cantidad, tipo_de_movimiento, referencia, usuario, fecha_salida");if(k&&(M=M.in("producto_id",k)),b){const N=new Date(Date.now()-864e5).toISOString();M=M.gte("fecha_salida",N)}M=M.order("fecha_salida",{ascending:!1});const{data:G,error:K}=await M;if(K)throw K;const ne=Array.isArray(G)?G.map(N=>({id:N.id,producto_id:String(N.producto_id),cantidad:Number(N.cantidad),tipo_de_movimiento:N.tipo_de_movimiento,referencia:N.referencia,usuario:N.usuario,fecha_salida:N.fecha_salida})):[],Y=Array.from(new Set(ne.map(N=>N.producto_id))).filter(Boolean);let B={};if(Y.length>0){const{data:N}=await F.from("inventario").select("id, nombre, sku, marca, categoria, tipo").in("id",Y).not("categoria","ilike","%servicios%");Array.isArray(N)&&N.filter(X=>String(X.tipo||"producto").toLowerCase()!=="servicio").forEach(X=>{B[String(X.id)]={id:X.id,nombre:X.nombre,sku:X.sku,marca:X.marca,categoria:X.categoria}})}v(B);const A=ne.filter(N=>B.hasOwnProperty(N.producto_id));x(A)}catch(k){R(k?.message||String(k)),x([])}finally{T(!1)}}async function C(){try{const{data:k,error:M}=await F.from("inventario").select("marca, categoria");if(M)throw M;const G=new Set,K=new Set;Array.isArray(k)&&k.forEach(ne=>{ne.marca&&G.add(String(ne.marca)),ne.categoria&&K.add(String(ne.categoria))}),g(Array.from(G).sort()),m(Array.from(K).sort())}catch(k){console.warn("Error loading filter options",k)}}y.useEffect(()=>{z(),C()},[]);const O=j.filter(k=>String(k.tipo_de_movimiento).toUpperCase()==="ENTRADA"),I=j.filter(k=>String(k.tipo_de_movimiento).toUpperCase()==="SALIDA");return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Movimiento de Inventario"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("input",{className:"input",placeholder:"SKU",value:l,onChange:k=>i(k.target.value)}),t.jsxs("select",{className:"input",value:r,onChange:k=>s(k.target.value),children:[t.jsx("option",{value:"",children:"-- Marca (todas) --"}),f.map(k=>t.jsx("option",{value:k,children:k},k))]}),t.jsxs("select",{className:"input",value:c,onChange:k=>d(k.target.value),children:[t.jsx("option",{value:"",children:"-- Categora (todas) --"}),p.map(k=>t.jsx("option",{value:k,children:k},k))]}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:b,onChange:k=>S(k.target.checked)})," ","ltimas 24h"]}),t.jsx("button",{className:"btn-opaque",onClick:()=>z(),children:"Aplicar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{i(""),s(""),d(""),S(!1),z()},children:"Limpiar"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:E?"Cargando...":`${j.length} registros`})]}),L&&t.jsx("div",{style:{color:"red",marginBottom:12},children:L}),t.jsxs("div",{style:{display:"flex",gap:12},children:[t.jsxs("div",{style:{flex:1,background:"#fff",padding:12,borderRadius:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("strong",{children:"Entradas"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{document.body.classList.add("print-table-only"),setTimeout(()=>{window.print(),document.body.classList.remove("print-table-only")},50)},children:"Imprimir"})]}),t.jsx("div",{style:{maxHeight:"65vh",overflowY:"auto",overflowX:"auto",marginTop:8},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"SKU"}),t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Referencia"}),t.jsx("th",{children:"Usuario"}),t.jsx("th",{children:"Fecha"})]})}),t.jsx("tbody",{children:O.map(k=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:70},children:String(k.id)}),t.jsx("td",{style:{minWidth:120},children:w[k.producto_id]?.sku||k.producto_id}),t.jsx("td",{children:w[k.producto_id]?.nombre||""}),t.jsx("td",{style:{textAlign:"right"},children:Number(k.cantidad).toFixed(2)}),t.jsx("td",{children:k.referencia||""}),t.jsx("td",{children:k.usuario||""}),t.jsx("td",{children:k.fecha_salida||""})]},String(k.id)))})]})})]}),t.jsxs("div",{style:{flex:1,background:"#fff",padding:12,borderRadius:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("strong",{children:"Salidas"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{document.body.classList.add("print-table-only"),setTimeout(()=>{window.print(),document.body.classList.remove("print-table-only")},50)},children:"Imprimir"})]}),t.jsx("div",{style:{maxHeight:"65vh",overflowY:"auto",overflowX:"auto",marginTop:8},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"SKU"}),t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Referencia"}),t.jsx("th",{children:"Usuario"}),t.jsx("th",{children:"Fecha"})]})}),t.jsx("tbody",{children:I.map(k=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:70},children:String(k.id)}),t.jsx("td",{style:{minWidth:120},children:w[k.producto_id]?.sku||k.producto_id}),t.jsx("td",{children:w[k.producto_id]?.nombre||""}),t.jsx("td",{style:{textAlign:"right"},children:Number(k.cantidad).toFixed(2)}),t.jsx("td",{children:k.referencia||""}),t.jsx("td",{children:k.usuario||""}),t.jsx("td",{children:k.fecha_salida||""})]},String(k.id)))})]})})]})]})]})}function wj(){return t.jsx(Sm,{onBack:()=>{}})}function Cj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState("todas"),[f,g]=y.useState(""),[p,m]=y.useState(""),[b,S]=y.useState(!1),[j,x]=y.useState(!1),[w,v]=y.useState(null),[E,T]=y.useState(!1),[L,R]=y.useState(0),[z,C]=y.useState({total_ingresos:0,total_egresos:0,saldo_final:0}),[O,I]=y.useState(null),{hondurasNowISO:k}=pl(),M=async()=>{s(!0);try{let B=F.from("caja_sesiones").select("*").order("fecha_apertura",{ascending:!1});if(c!=="todas"&&(B=B.eq("estado",c)),f){const q=new Date(f+"T00:00:00").toISOString();B=B.gte("fecha_apertura",q)}if(p){const q=new Date(p+"T23:59:59").toISOString();B=B.lte("fecha_cierre",q)}const{data:A,error:N}=await B;if(N)throw N;i(Array.isArray(A)?A:[])}catch(B){console.error("Error loading sessions",B),I("Error cargando sesiones: "+(B.message||String(B)))}finally{s(!1)}};y.useEffect(()=>{M()},[c,f,p]);const G=()=>{try{const B=localStorage.getItem("user"),A=B?JSON.parse(B):null;return A&&(A.username||A.user?.username||A.name||A.user?.name)||"admin"}catch{return"admin"}},K=async()=>{try{I(null);const B={usuario:G(),fecha_apertura:k(),monto_inicial:Number(L||0),total_ingresos:0,total_egresos:0,saldo_final:null,fecha_cierre:null,estado:"abierta"},{data:A,error:N}=await F.from("caja_sesiones").insert([B]).select("*").single();if(N)throw N;S(!1),R(0),I("Sesin creada correctamente"),await M()}catch(B){console.error("Error creating session",B),I("Error creando sesin: "+(B.message||String(B)))}},ne=B=>{v(B),C({total_ingresos:B.total_ingresos||0,total_egresos:B.total_egresos||0,saldo_final:B.saldo_final||0}),x(!0)},Y=async()=>{if(w)try{I(null);const B={...z,fecha_cierre:k(),estado:"cerrada"},{data:A,error:N}=await F.from("caja_sesiones").update(B).eq("id",w.id).select("*").single();if(N)throw N;x(!1),v(null),I("Sesin cerrada correctamente"),await M()}catch(B){console.error("Error closing session",B),I("Error cerrando sesin: "+(B.message||String(B)))}};return t.jsxs("div",{style:{padding:18},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{margin:0},children:"Sesiones de caja"}),t.jsx("div",{style:{color:"#64748b",fontSize:13},children:"Gestin de aperturas y cierres de cajas"})]}),t.jsx("div",{style:{display:"flex",gap:8},children:t.jsx("button",{className:"btn-opaque",onClick:()=>M(),children:"Actualizar"})})]}),t.jsxs("section",{style:{display:"flex",gap:12,marginBottom:12,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Estado"}),t.jsxs("select",{className:"input",value:c,onChange:B=>d(B.target.value),children:[t.jsx("option",{value:"todas",children:"Todas"}),t.jsx("option",{value:"abierta",children:"Abierta"}),t.jsx("option",{value:"cerrada",children:"Cerrada"})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:f,onChange:B=>g(B.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:p,onChange:B=>m(B.target.value)})]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8},children:[t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[t.jsx("th",{style:{padding:10},children:"Usuario"}),t.jsx("th",{style:{padding:10},children:"Apertura"}),t.jsx("th",{style:{padding:10},children:"Cierre"}),t.jsx("th",{style:{padding:10},children:"Estado"}),t.jsx("th",{style:{padding:10,textAlign:"right"},children:"Diferencia"})]})}),t.jsx("tbody",{children:l.map(B=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9",cursor:"pointer"},onClick:()=>{v(B),T(!0)},children:[t.jsx("td",{style:{padding:10},children:B.usuario}),t.jsx("td",{style:{padding:10},children:B.fecha_apertura?new Date(B.fecha_apertura).toLocaleString():"-"}),t.jsx("td",{style:{padding:10},children:B.fecha_cierre?new Date(B.fecha_cierre).toLocaleString():"-"}),t.jsx("td",{style:{padding:10},children:B.estado}),t.jsx("td",{style:{padding:10,textAlign:"right"},children:B.diferencia!=null?`L ${Number(B.diferencia).toFixed(2)}`:"L 0.00"})]},B.id))})]}),l.length===0&&t.jsx("div",{style:{padding:16,color:"#94a3b8"},children:"No hay sesiones en este rango"})]}),t.jsxs(Mn,{open:b,onClose:()=>S(!1),width:520,children:[t.jsx("h3",{style:{marginTop:0},children:"Nueva sesin"}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569"},children:"Monto inicial"}),t.jsx("input",{className:"input",type:"number",value:L,onChange:B=>R(Number(B.target.value))})]}),t.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>S(!1),children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:K,children:"Crear sesin"})]})]}),t.jsxs(Mn,{open:j,onClose:()=>x(!1),width:600,children:[t.jsx("h3",{style:{marginTop:0},children:"Cerrar sesin"}),w&&t.jsxs("div",{children:[t.jsx("div",{style:{marginTop:8},children:t.jsxs("div",{children:[t.jsx("strong",{children:"Factura:"})," Sesin #",w.id,"  Usuario: ",w.usuario]})}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569"},children:"Total ingresos"}),t.jsx("input",{className:"input",type:"number",value:z.total_ingresos,onChange:B=>C(A=>({...A,total_ingresos:Number(B.target.value)}))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569"},children:"Total egresos"}),t.jsx("input",{className:"input",type:"number",value:z.total_egresos,onChange:B=>C(A=>({...A,total_egresos:Number(B.target.value)}))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:13,color:"#475569"},children:"Saldo final"}),t.jsx("input",{className:"input",type:"number",value:z.saldo_final,onChange:B=>C(A=>({...A,saldo_final:Number(B.target.value)}))})]})]}),t.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>x(!1),children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:Y,children:"Confirmar cierre"})]})]})]}),t.jsx(Mn,{open:E,onClose:()=>T(!1),width:720,children:w?t.jsxs("div",{children:[t.jsxs("h3",{style:{marginTop:0},children:["Detalle sesin #",w.id]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Usuario:"}),t.jsx("br",{}),w.usuario]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Estado:"}),t.jsx("br",{}),w.estado]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Fecha apertura:"}),t.jsx("br",{}),w.fecha_apertura?new Date(w.fecha_apertura).toLocaleString():"-"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Fecha cierre:"}),t.jsx("br",{}),w.fecha_cierre?new Date(w.fecha_cierre).toLocaleString():"-"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Monto inicial:"}),t.jsx("br",{}),"L ",Number(w.monto_inicial||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Total ingresos:"}),t.jsx("br",{}),"L ",Number(w.total_ingresos||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Total egresos:"}),t.jsx("br",{}),"L ",Number(w.total_egresos||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Saldo final:"}),t.jsx("br",{}),w.saldo_final!=null?`L ${Number(w.saldo_final).toFixed(2)}`:"-"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Efectivo obtenido:"}),t.jsx("br",{}),"L ",Number(w.efectivo_obtenido||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Dlares obtenido:"}),t.jsx("br",{}),"L ",Number(w.dolares_obtenido||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Tarjeta obtenido:"}),t.jsx("br",{}),"L ",Number(w.tarjeta_obtenido||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Transferencia obtenido:"}),t.jsx("br",{}),"L ",Number(w.transferencia_obtenido||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Efectivo registrado:"}),t.jsx("br",{}),"L ",Number(w.efectivo_registrado||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Dlares registrado:"}),t.jsx("br",{}),"L ",Number(w.dolares_registrado||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Tarjeta registrado:"}),t.jsx("br",{}),"L ",Number(w.tarjeta_registrado||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Transferencia registrado:"}),t.jsx("br",{}),"L ",Number(w.transferencia_registrado||0).toFixed(2)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Diferencia:"}),t.jsx("br",{}),"L ",Number(w.diferencia||0).toFixed(2)]})]}),t.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>T(!1),children:"Cerrar"}),w.estado==="abierta"&&t.jsx("button",{className:"btn-primary",onClick:()=>{T(!1),ne(w)},children:"Cerrar sesin"})]})]}):null}),t.jsx("div",{style:{marginTop:12},children:O&&t.jsx("div",{style:{color:O.startsWith("Error")?"#ef4444":"#10b981"},children:O})})]})}function Ej(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState([]),[f,g]=y.useState(""),[p,m]=y.useState(""),[b,S]=y.useState(""),[j,x]=y.useState(""),w=async()=>{try{const{data:E,error:T}=await F.from("caja_movimientos").select("usuario").limit(1e3);if(T)throw T;const L=Array.isArray(E)?E.map(z=>z.usuario).filter(Boolean):[],R=Array.from(new Set(L)).slice(0,200);d(R)}catch(E){console.debug("Error loading usuarios for movimientos",E),d([])}},v=async()=>{s(!0);try{let E=F.from("caja_movimientos").select("*").order("fecha",{ascending:!1});if(b){const z=new Date(b+"T00:00:00").toISOString();E=E.gte("fecha",z)}if(j){const z=new Date(j+"T23:59:59").toISOString();E=E.lte("fecha",z)}const{data:T,error:L}=await E;if(L)throw L;let R=Array.isArray(T)?T:[];if(f){const z=f.trim();R=R.filter(C=>(C.usuario||C.user||"").toString().trim()===z)}if(p){const z=p.trim().toLowerCase();R=R.filter(C=>(C.tipo_movimiento||C.tipo||"")?.toString().trim().toLowerCase()===z)}i(R)}catch(E){console.error("Error loading movimientos",E),i([])}finally{s(!1)}};return y.useEffect(()=>{w()},[]),y.useEffect(()=>{v()},[f,p,b,j]),t.jsxs("div",{style:{padding:18},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{margin:0},children:"Movimientos de caja"}),t.jsx("div",{style:{color:"#64748b",fontSize:13},children:"Visualizacin de movimientos (solo lectura)"})]}),t.jsx("div",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>v(),children:"Actualizar"})})]}),t.jsxs("section",{style:{display:"flex",gap:12,marginBottom:12,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Usuario"}),t.jsxs("select",{className:"input",value:f,onChange:E=>g(E.target.value),children:[t.jsx("option",{value:"",children:"Todos"}),c.map(E=>t.jsx("option",{value:E,children:E},E))]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Tipo"}),t.jsxs("select",{className:"input",value:p,onChange:E=>m(E.target.value),children:[t.jsx("option",{value:"",children:"Todos"}),t.jsx("option",{value:"ingreso",children:"Ingresos"}),t.jsx("option",{value:"egreso",children:"Egresos"})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:b,onChange:E=>S(E.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:j,onChange:E=>x(E.target.value)})]})]}),t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},children:r?t.jsx("div",{style:{color:"#64748b"},children:"Cargando..."}):t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[t.jsx("th",{style:{padding:10},children:"Concepto"}),t.jsx("th",{style:{padding:10},children:"Referencia"}),t.jsx("th",{style:{padding:10,textAlign:"right"},children:"Monto"}),t.jsx("th",{style:{padding:10},children:"Fecha"}),t.jsx("th",{style:{padding:10},children:"Usuario"}),t.jsx("th",{style:{padding:10},children:"Tipo"})]})}),t.jsx("tbody",{children:l.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{padding:20,textAlign:"center",color:"#94a3b8"},children:"No hay movimientos"})}):l.map(E=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:10},children:E.concepto||E.motivo||E.descripcion||""}),t.jsx("td",{style:{padding:10},children:E.referencia||""}),t.jsxs("td",{style:{padding:10,textAlign:"right"},children:["L ",Number(E.monto||0).toFixed(2)]}),t.jsx("td",{style:{padding:10},children:E.fecha?new Date(E.fecha).toLocaleString():""}),t.jsx("td",{style:{padding:10},children:E.usuario||E.user||""}),t.jsx("td",{style:{padding:10},children:E.tipo_movimiento||E.tipo||""})]},E.id))})]})})})]})}function Tj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState(!1),[p,m]=y.useState([]),b=async()=>{g(!0);try{const z=new Date(r+"T00:00:00").toISOString(),C=new Date(c+"T23:59:59").toISOString(),{data:O,error:I}=await F.from("ventas").select("*").gte("fecha_venta",z).lte("fecha_venta",C).order("fecha_venta",{ascending:!1});if(I)throw I;const M=(Array.isArray(O)?O:[]).filter(A=>String(A.estado||"").toLowerCase()==="pagada"),G=M.map(A=>A.id).filter(Boolean);let K=[];if(G.length>0){const{data:A,error:N}=await F.from("ventas_detalle").select("*").in("venta_id",G);if(N)throw N;K=Array.isArray(A)?A:[]}const ne=Array.from(new Set(K.map(A=>A.producto_id).filter(Boolean)));let Y={};if(ne.length>0)try{const{data:A}=await F.from("inventario").select("id,nombre,sku,exento,aplica_impuesto_18").in("id",ne);Array.isArray(A)&&A.forEach(N=>{Y[String(N.id)]=N})}catch(A){console.warn("Error cargando inventario para reportes de ventas",A)}const B=M.map(A=>{const N=K.filter(ae=>String(ae.venta_id)===String(A.id)),q=N.map(ae=>ae.producto_nombre||Y[String(ae.producto_id)]?.nombre||ae.nombre||"").filter(Boolean),X=N.reduce((ae,V)=>ae+Number(V.cantidad||0),0);let ge=0,re=0,U=0,$=0,H=0,Z=0,ee=0;const oe=A.sub_exonerado!=null||A.subExonerado!=null||A.sub_exento!=null||A.subExento!=null||A.sub_gravado!=null||A.subGravado!=null,P=A.isv_15!=null||A.isv15!=null||A.isv_18!=null||A.isv18!=null||A.isv_4!=null||A.isv4!=null;(oe||P)&&(ge=Number(A.sub_exonerado??A.subExonerado??0),re=Number(A.sub_exento??A.subExento??0),U=Number(A.sub_gravado??A.subGravado??0),H=Number(A.isv_15??A.isv15??0),Z=Number(A.isv_18??A.isv18??0),ee=Number(A.isv_4??A.isv4??0),$=Number(A.sub_turistico??A.subTuristico??0));const Se=ae=>{if(!ae)return null;if(typeof ae=="object")return ae;try{return JSON.parse(String(ae))}catch{return null}},J=ae=>{if(ae==null)return!1;if(typeof ae=="boolean")return ae;if(typeof ae=="number")return ae!==0;const V=String(ae).toLowerCase().trim();return V==="true"||V==="1"||V==="t"||V==="y"||V==="yes"};for(const ae of N){if(oe||P)continue;const V=Number(ae.cantidad||0),ue=Number(ae.precio_unitario??ae.precio??0),de=ae.subtotal!=null?Number(ae.subtotal):Number(V*ue),he=Y[String(ae.producto_id)]||{},Te=Se(ae.producto),Oe=ae.exento!=null?J(ae.exento):J(Te?.exento??he.exento),Ue=ae.exonerado!=null?J(ae.exonerado):!1,Le=ae.aplica_impuesto_18!=null?J(ae.aplica_impuesto_18):J(Te?.aplica_impuesto_18??he.aplica_impuesto_18);if(Ue)ge+=de;else if(Oe)re+=de;else{U+=de;const ze=ae.aplica_impuesto_turistico!=null?J(ae.aplica_impuesto_turistico):J(Te?.aplica_impuesto_turistico??he.aplica_impuesto_turistico);ze&&($+=de);const se=Le?.18:.15,ve=ze?.04:0,$e=(se||0)+(ve||0);if($e>0){const gt=de-de/(1+$e),st=gt*((se||0)/$e),vt=gt*((ve||0)/$e);Le?Z+=st:H+=st,ee+=vt}}}return{id:A.id,fecha:A.fecha_venta||A.fecha||null,factura:A.factura||A.numero_factura||A.numero||A.id,cliente:A.nombre_cliente||A.cliente||A.cliente_nombre||"",identidad:A.rtn||A.identidad||null,productos:q,cantidad:X,subExonerado:ge,subExento:re,subGravado:U,subTuristico:$,isv15:H,isv18:Z,isv4:ee,total:Number(A.total||0),forma_pago:A.tipo_pago||A.forma_pago||""}});m(B)}catch(z){console.error("Error fetching report ventas",z),m([])}finally{g(!1)}},S=p.reduce((z,C)=>z+Number(C.cantidad||0),0),j=p.reduce((z,C)=>z+Number(C.subExonerado||0),0),x=p.reduce((z,C)=>z+Number(C.subExento||0),0),w=p.reduce((z,C)=>z+Number(C.subGravado||0),0),v=p.reduce((z,C)=>z+Number(C.subTuristico||0),0),E=p.reduce((z,C)=>z+Number(C.isv15||0),0),T=p.reduce((z,C)=>z+Number(C.isv18||0),0),L=p.reduce((z,C)=>z+Number(C.isv4||0),0),R=p.reduce((z,C)=>z+Number(C.total||0),0);return y.useEffect(()=>{b()},[r,c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
          }
        `}),t.jsx("h2",{style:{marginTop:0},children:"Ventas (reportes)"}),t.jsxs("div",{style:{display:"flex",gap:12,marginBottom:18,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:z=>s(z.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:z=>d(z.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:b,disabled:f,children:f?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir Reporte"})]})]}),t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Arial, Helvetica, sans-serif",fontSize:13,color:"#0f1724"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FECHA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TIPO DOC"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FACTURA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"CLIENTE"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"IDENTIDAD"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"CANTIDAD"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"SUB EXONERADO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"SUB EXENTO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"SUB GRAVADO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"SUB TURSTICO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"ISV (15%)"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"ISV (18%)"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"ISV (4%)"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TOTAL"})]})}),t.jsxs("tbody",{children:[p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:14,style:{padding:24,textAlign:"center",color:"#94a3b8",fontSize:13},children:"No hay ventas pagadas en este rango"})}):p.map(z=>t.jsxs("tr",{style:{borderBottom:"1px solid #e6eef6"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:z.fecha?new Date(z.fecha).toLocaleString():""}),t.jsx("td",{style:{padding:12,fontSize:13},children:"factura emitida"}),t.jsx("td",{style:{padding:12,fontSize:13},children:z.factura}),t.jsx("td",{style:{padding:12,fontSize:13},children:z.cliente}),t.jsx("td",{style:{padding:12,fontSize:13},children:z.identidad||""}),t.jsx("td",{style:{padding:12,fontSize:13},children:z.cantidad}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.subExonerado||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.subExento||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.subGravado||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.subTuristico||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.isv15||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.isv18||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.isv4||0).toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(z.total||0).toFixed(2)]})]},z.id)),p.length>0&&t.jsxs("tr",{style:{borderTop:"2px solid #0f1724",fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"TOTAL"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13},children:S}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",j.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",x.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",w.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",v.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",E.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",T.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",L.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",R.toFixed(2)]})]})]})]})})]})}function Nj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState(!1),[p,m]=y.useState([]),b=async()=>{g(!0);try{const x=new Date(r+"T00:00:00").toISOString(),w=new Date(c+"T23:59:59").toISOString(),{data:v,error:E}=await F.from("devoluciones_ventas").select("*").gte("fecha_devolucion",x).lte("fecha_devolucion",w).order("fecha_devolucion",{ascending:!1});if(E)throw E;const T=Array.isArray(v)?v:[],L=Array.from(new Set(T.map(k=>k.venta_id).filter(Boolean))),R=Array.from(new Set(T.map(k=>k.producto_id).filter(Boolean)));let z={};if(L.length>0){const{data:k}=await F.from("ventas").select("id, factura, nombre_cliente, rtn").in("id",L);Array.isArray(k)&&k.forEach(M=>{z[String(M.id)]=M})}let C={};if(R.length>0){const{data:k}=await F.from("inventario").select("id, nombre, sku").in("id",R);Array.isArray(k)&&k.forEach(M=>{C[String(M.id)]=M})}let O={};if(L.length>0){const{data:k}=await F.from("ventas_detalle").select("venta_id, producto_id, precio_unitario").in("venta_id",L);Array.isArray(k)&&k.forEach(M=>{const G=`${M.venta_id}-${M.producto_id}`;O[G]=M})}const I=T.map(k=>{const M=z[String(k.venta_id)]||{},G=C[String(k.producto_id)]||{},K=`${k.venta_id}-${k.producto_id}`,ne=O[K]||{},Y=Number(ne.precio_unitario||0),B=Number(k.cantidad||0),A=Y*B;return{id:k.id,fecha:k.fecha_devolucion,factura:M.factura||"",cliente:M.nombre_cliente||"",identidad:M.rtn||"",producto:G.nombre||G.sku||"",cantidad:B,motivo:k.motivo||"",usuario:k.usuario||"",tipo_devolucion:k.tipo_devolucion||"",total:A}});m(I)}catch(x){console.error("Error fetching report devoluciones",x),m([])}finally{g(!1)}},S=p.reduce((x,w)=>x+Number(w.cantidad||0),0),j=p.reduce((x,w)=>x+Number(w.total||0),0);return y.useEffect(()=>{b()},[r,c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
          }
        `}),t.jsx("h2",{style:{marginTop:0},children:"Devoluciones (reportes)"}),t.jsxs("div",{style:{display:"flex",gap:12,marginBottom:18,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:x=>s(x.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:x=>d(x.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:b,disabled:f,children:f?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir Reporte"})]})]}),t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Arial, Helvetica, sans-serif",fontSize:13,color:"#0f1724"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FECHA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TIPO DOC"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FACTURA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"CLIENTE"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"IDENTIDAD"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"PRODUCTO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"CANTIDAD"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"MOTIVO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"USUARIO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TIPO DEVOLUCIN"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TOTAL"})]})}),t.jsxs("tbody",{children:[p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:11,style:{padding:24,textAlign:"center",color:"#94a3b8",fontSize:13},children:"No hay devoluciones en este rango"})}):p.map(x=>t.jsxs("tr",{style:{borderBottom:"1px solid #e6eef6"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:x.fecha?new Date(x.fecha).toLocaleString():""}),t.jsx("td",{style:{padding:12,fontSize:13},children:"devolucin"}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.factura}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.cliente}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.identidad||""}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.producto}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.cantidad}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.motivo}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.usuario}),t.jsx("td",{style:{padding:12,fontSize:13},children:x.tipo_devolucion}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",Number(x.total||0).toFixed(2)]})]},x.id)),p.length>0&&t.jsxs("tr",{style:{borderTop:"2px solid #0f1724",fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"TOTAL"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13},children:S}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",j.toFixed(2)]})]})]})]})})]})}function Aj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState(!1),[p,m]=y.useState([]),b=async()=>{g(!0);try{const w=new Date(r+"T00:00:00").toISOString(),v=new Date(c+"T23:59:59").toISOString(),{data:E,error:T}=await F.from("caja_movimientos").select("*").gte("fecha",w).lte("fecha",v).order("fecha",{ascending:!1});if(T)throw T;const R=(Array.isArray(E)?E:[]).map(z=>({id:z.id,fecha:z.fecha,tipo_movimiento:z.tipo_movimiento,concepto:z.concepto,referencia:z.referencia||"",usuario:z.usuario,monto:Number(z.monto||0)}));m(R)}catch(w){console.error("Error fetching report ingresos egresos",w),m([])}finally{g(!1)}},S=p.filter(w=>w.tipo_movimiento==="ingreso").reduce((w,v)=>w+v.monto,0),j=p.filter(w=>w.tipo_movimiento==="egreso").reduce((w,v)=>w+v.monto,0),x=S-j;return y.useEffect(()=>{b()},[r,c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
          }
        `}),t.jsx("h2",{style:{marginTop:0},children:"Ingresos / Egresos (reportes)"}),t.jsxs("div",{style:{display:"flex",gap:12,marginBottom:18,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:w=>s(w.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:w=>d(w.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:b,disabled:f,children:f?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir Reporte"})]})]}),t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Arial, Helvetica, sans-serif",fontSize:13,color:"#0f1724"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FECHA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TIPO DOC"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TIPO MOVIMIENTO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"CONCEPTO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"REFERENCIA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"USUARIO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"MONTO"})]})}),t.jsxs("tbody",{children:[p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:7,style:{padding:24,textAlign:"center",color:"#94a3b8",fontSize:13},children:"No hay movimientos en este rango"})}):p.map(w=>t.jsxs("tr",{style:{borderBottom:"1px solid #e6eef6"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:w.fecha?new Date(w.fecha).toLocaleString():""}),t.jsx("td",{style:{padding:12,fontSize:13},children:"movimiento caja"}),t.jsx("td",{style:{padding:12,fontSize:13},children:w.tipo_movimiento}),t.jsx("td",{style:{padding:12,fontSize:13},children:w.concepto}),t.jsx("td",{style:{padding:12,fontSize:13},children:w.referencia}),t.jsx("td",{style:{padding:12,fontSize:13},children:w.usuario}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",w.monto.toFixed(2)]})]},w.id)),p.length>0&&t.jsxs("tr",{style:{borderTop:"2px solid #0f1724",fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"TOTALES"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}})]}),p.length>0&&t.jsxs("tr",{style:{fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"Ingresos"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",S.toFixed(2)]})]}),p.length>0&&t.jsxs("tr",{style:{fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"Egresos"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",j.toFixed(2)]})]}),p.length>0&&t.jsxs("tr",{style:{borderTop:"1px solid #0f1724",fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"Saldo Neto"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",x.toFixed(2)]})]})]})]})})]})}function zj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState(!1),[p,m]=y.useState([]),b=async()=>{g(!0);try{const v=new Date(r+"T00:00:00").toISOString(),E=new Date(c+"T23:59:59").toISOString(),{data:T,error:L}=await F.from("compras").select("*").gte("fecha_compra",v).lte("fecha_compra",E).order("fecha_compra",{ascending:!1});if(L)throw L;const R=Array.isArray(T)?T:[],z=R.map(K=>K.id).filter(Boolean),C=Array.from(new Set(R.map(K=>K.proveedor_id).filter(Boolean)));let O={};if(C.length>0){const{data:K}=await F.from("proveedores").select("id, nombre").in("id",C);Array.isArray(K)&&K.forEach(ne=>{O[String(ne.id)]=ne})}let I={};if(z.length>0){const{data:K}=await F.from("compras_detalle").select("compra_id, producto_id, cantidad").in("compra_id",z);Array.isArray(K)&&K.forEach(ne=>{I[String(ne.compra_id)]||(I[String(ne.compra_id)]=[]),I[String(ne.compra_id)].push(ne)})}const k=Array.from(new Set(Object.values(I).flat().map(K=>K.producto_id).filter(Boolean)));let M={};if(k.length>0){const{data:K}=await F.from("inventario").select("id, nombre, sku").in("id",k);Array.isArray(K)&&K.forEach(ne=>{M[String(ne.id)]=ne})}const G=R.map(K=>{const ne=O[String(K.proveedor_id)]||{},Y=I[String(K.id)]||[],B=Y.map(N=>M[String(N.producto_id)]?.nombre||M[String(N.producto_id)]?.sku||"").filter(Boolean),A=Y.reduce((N,q)=>N+Number(q.cantidad||0),0);return{id:K.id,fecha:K.fecha_compra,factura:K.numero_factura||"",proveedor:ne.nombre||"",productos:B,cantidad:A,subtotal:Number(K.subtotal||0),impuesto:Number(K.impuesto||0),total:Number(K.total||0),estado:K.estado||"",usuario:K.usuario||""}});m(G)}catch(v){console.error("Error fetching report compras",v),m([])}finally{g(!1)}},S=p.reduce((v,E)=>v+Number(E.cantidad||0),0),j=p.reduce((v,E)=>v+E.subtotal,0),x=p.reduce((v,E)=>v+E.impuesto,0),w=p.reduce((v,E)=>v+E.total,0);return y.useEffect(()=>{b()},[r,c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
          }
        `}),t.jsx("h2",{style:{marginTop:0},children:"Compras (reportes)"}),t.jsxs("div",{style:{display:"flex",gap:12,marginBottom:18,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:v=>s(v.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:v=>d(v.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:b,disabled:f,children:f?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir Reporte"})]})]}),t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Arial, Helvetica, sans-serif",fontSize:13,color:"#0f1724"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FECHA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TIPO DOC"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"FACTURA"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"PROVEEDOR"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"PRODUCTOS"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"CANTIDAD"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"SUBTOTAL"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"IMPUESTO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"TOTAL"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"ESTADO"}),t.jsx("th",{style:{padding:12,fontSize:13,fontWeight:700,color:"#0b1220"},children:"USUARIO"})]})}),t.jsxs("tbody",{children:[p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:11,style:{padding:24,textAlign:"center",color:"#94a3b8",fontSize:13},children:"No hay compras en este rango"})}):p.map(v=>t.jsxs("tr",{style:{borderBottom:"1px solid #e6eef6"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:v.fecha?new Date(v.fecha).toLocaleString():""}),t.jsx("td",{style:{padding:12,fontSize:13},children:"compra"}),t.jsx("td",{style:{padding:12,fontSize:13},children:v.factura}),t.jsx("td",{style:{padding:12,fontSize:13},children:v.proveedor}),t.jsx("td",{style:{padding:12,fontSize:13},children:(v.productos||[]).join(", ")}),t.jsx("td",{style:{padding:12,fontSize:13},children:v.cantidad}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",v.subtotal.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",v.impuesto.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",v.total.toFixed(2)]}),t.jsx("td",{style:{padding:12,fontSize:13},children:v.estado}),t.jsx("td",{style:{padding:12,fontSize:13},children:v.usuario})]},v.id)),p.length>0&&t.jsxs("tr",{style:{borderTop:"2px solid #0f1724",fontWeight:"bold"},children:[t.jsx("td",{style:{padding:12,fontSize:13},children:"TOTAL"}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13},children:S}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",j.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",x.toFixed(2)]}),t.jsxs("td",{style:{padding:12,fontSize:13},children:["L ",w.toFixed(2)]}),t.jsx("td",{style:{padding:12,fontSize:13}}),t.jsx("td",{style:{padding:12,fontSize:13}})]})]})]})})]})}function kj(){const[l,i]=y.useState(""),[r,s]=y.useState(""),[c,d]=y.useState(""),[f,g]=y.useState(""),[p,m]=y.useState([]),[b,S]=y.useState({}),[j,x]=y.useState(!1),w=async()=>{x(!0);try{let v=F.from("inventario").select("id, nombre, sku, marca, modelo, categoria, descripcion");v=v.not("categoria","ilike","%servicios%"),l&&(v=v.ilike("sku",`%${l}%`)),r&&(v=v.ilike("marca",`%${r}%`)),c&&(v=v.ilike("modelo",`%${c}%`)),f&&(v=v.ilike("categoria",`%${f}%`));const{data:E,error:T}=await v.order("nombre",{ascending:!0});if(T)throw T;const L=Array.isArray(E)?E:[];m(L);const R=L.map(k=>k.id);if(R.length===0){S({}),x(!1);return}const{data:z,error:C}=await F.from("registro_de_inventario").select("producto_id, cantidad, tipo_de_movimiento").in("producto_id",R);if(C)throw C;const O=Array.isArray(z)?z:[],I={};for(const k of L)I[String(k.id)]=0;for(const k of O){const M=String(k.producto_id),G=Number(k.cantidad)||0,K=String(k.tipo_de_movimiento||"").toUpperCase();I.hasOwnProperty(M)||(I[M]=0),K==="ENTRADA"?I[M]=(I[M]||0)+G:K==="SALIDA"&&(I[M]=(I[M]||0)-G)}for(const k of Object.keys(I))I[k]=Number((I[k]||0).toFixed(2));S(I)}catch(v){console.error("Error fetching inventario report",v),m([]),S({})}finally{x(!1)}};return y.useEffect(()=>{w()},[]),t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
          }
        `}),t.jsx("h2",{style:{marginTop:0},children:"Inventario (reportes)"}),t.jsxs("div",{className:"no-print",style:{display:"flex",gap:12,marginBottom:18,alignItems:"flex-end",flexWrap:"wrap"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"SKU"}),t.jsx("input",{className:"input",type:"text",value:l,onChange:v=>i(v.target.value),placeholder:"Filtrar por SKU"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Marca"}),t.jsx("input",{className:"input",type:"text",value:r,onChange:v=>s(v.target.value),placeholder:"Filtrar por marca"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Modelo"}),t.jsx("input",{className:"input",type:"text",value:c,onChange:v=>d(v.target.value),placeholder:"Filtrar por modelo"})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Categora"}),t.jsx("input",{className:"input",type:"text",value:f,onChange:v=>g(v.target.value),placeholder:"Filtrar por categora"})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:w,disabled:j,children:j?"Cargando...":"Buscar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir Hoja de Toma"})]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:20},children:[t.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:700},children:"HOJA DE TOMA DE INVENTARIO"}),t.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:12,color:"#475569"},children:["Fecha: ",new Date().toLocaleDateString()]})]}),t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontFamily:"Arial, Helvetica, sans-serif",fontSize:12,color:"#0f1724"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1"},children:"SKU"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1"},children:"PRODUCTO"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1"},children:"MARCA"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1"},children:"MODELO"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1"},children:"CATEGORA"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1",textAlign:"center"},children:"STOCK SISTEMA"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1",textAlign:"center"},children:"CONTEO FSICO"}),t.jsx("th",{style:{padding:8,fontSize:11,fontWeight:700,color:"#0b1220",border:"1px solid #cbd5e1",textAlign:"center"},children:"DIFERENCIA"})]})}),t.jsx("tbody",{children:p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:8,style:{padding:24,textAlign:"center",color:"#94a3b8",fontSize:12,border:"1px solid #cbd5e1"},children:"No hay productos en el inventario"})}):p.map(v=>{const E=b[String(v.id)]||0;return t.jsxs("tr",{children:[t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1"},children:v.sku||""}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1"},children:v.nombre}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1"},children:v.marca||""}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1"},children:v.modelo||""}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1"},children:v.categoria||""}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1",textAlign:"center"},children:E}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1",background:"#f8fafc"}}),t.jsx("td",{style:{padding:8,fontSize:11,border:"1px solid #cbd5e1",background:"#f8fafc"}})]},v.id)})})]}),t.jsxs("div",{style:{marginTop:30,display:"flex",justifyContent:"space-between",fontSize:12},children:[t.jsxs("div",{style:{width:"40%"},children:[t.jsx("p",{style:{margin:"0 0 30px 0"},children:"Realizado por: _______________________________"}),t.jsx("p",{style:{margin:0},children:"Firma: _______________________________"})]}),t.jsxs("div",{style:{width:"40%"},children:[t.jsx("p",{style:{margin:"0 0 30px 0"},children:"Revisado por: _______________________________"}),t.jsx("p",{style:{margin:0},children:"Firma: _______________________________"})]})]})]})]})}function Rj(){return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Exportar reportes generales (PDF / Excel)"}),t.jsx("p",{style:{color:"#475569"},children:"Exportar reportes a PDF/Excel. (Placeholder)"})]})}function Oj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(!1),[f,g]=y.useState(null),[p,m]=y.useState({codigo:"",nombre:"",tipo:"activo",descripcion:"",cuenta_padre_id:"",activo:!0}),b=async()=>{s(!0);try{const{data:v,error:E}=await F.from("cuentas_contables").select("*").order("codigo",{ascending:!0});if(E)throw E;i(v||[])}catch(v){console.error("Error fetching cuentas contables",v)}finally{s(!1)}};y.useEffect(()=>{b()},[]);const S=v=>{v?(g(v),m({codigo:v.codigo,nombre:v.nombre,tipo:v.tipo,descripcion:v.descripcion||"",cuenta_padre_id:v.cuenta_padre_id?.toString()||"",activo:v.activo})):(g(null),m({codigo:"",nombre:"",tipo:"activo",descripcion:"",cuenta_padre_id:"",activo:!0})),d(!0)},j=async()=>{try{const v={codigo:p.codigo,nombre:p.nombre,tipo:p.tipo,descripcion:p.descripcion||null,cuenta_padre_id:p.cuenta_padre_id?parseInt(p.cuenta_padre_id):null,activo:p.activo};if(f){const{error:E}=await F.from("cuentas_contables").update(v).eq("id",f.id);if(E)throw E}else{const{error:E}=await F.from("cuentas_contables").insert([v]);if(E)throw E}d(!1),b()}catch(v){console.error("Error saving cuenta",v),alert("Error al guardar la cuenta")}},x=async v=>{if(confirm("Est seguro de eliminar esta cuenta?"))try{const{error:E}=await F.from("cuentas_contables").delete().eq("id",v);if(E)throw E;b()}catch(E){console.error("Error deleting cuenta",E),alert("Error al eliminar la cuenta")}},w=v=>{if(!v)return"-";const E=l.find(T=>T.id===v);return E?`${E.codigo} - ${E.nombre}`:"-"};return t.jsxs("div",{style:{padding:18},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsx("h2",{style:{margin:0},children:"Plan de Cuentas Contables"}),t.jsx("button",{className:"btn-opaque",onClick:()=>S(),children:"+ Nueva Cuenta"})]}),r?t.jsx("p",{children:"Cargando..."}):t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:12,fontWeight:700},children:"Cdigo"}),t.jsx("th",{style:{padding:12,fontWeight:700},children:"Nombre"}),t.jsx("th",{style:{padding:12,fontWeight:700},children:"Tipo"}),t.jsx("th",{style:{padding:12,fontWeight:700},children:"Cuenta Padre"}),t.jsx("th",{style:{padding:12,fontWeight:700},children:"Estado"}),t.jsx("th",{style:{padding:12,fontWeight:700},children:"Acciones"})]})}),t.jsx("tbody",{children:l.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{padding:24,textAlign:"center",color:"#94a3b8"},children:"No hay cuentas registradas"})}):l.map(v=>t.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[t.jsx("td",{style:{padding:12},children:v.codigo}),t.jsx("td",{style:{padding:12},children:v.nombre}),t.jsx("td",{style:{padding:12},children:t.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:11,fontWeight:600,background:v.tipo==="activo"?"#dbeafe":v.tipo==="pasivo"?"#fef3c7":v.tipo==="ingreso"?"#dcfce7":v.tipo==="gasto"?"#fee2e2":"#f3e8ff",color:v.tipo==="activo"?"#1e40af":v.tipo==="pasivo"?"#92400e":v.tipo==="ingreso"?"#15803d":v.tipo==="gasto"?"#991b1b":"#6b21a8"},children:v.tipo.toUpperCase()})}),t.jsx("td",{style:{padding:12,fontSize:12,color:"#64748b"},children:w(v.cuenta_padre_id)}),t.jsx("td",{style:{padding:12},children:t.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:11,fontWeight:600,background:v.activo?"#dcfce7":"#fee2e2",color:v.activo?"#15803d":"#991b1b"},children:v.activo?"ACTIVA":"INACTIVA"})}),t.jsxs("td",{style:{padding:12},children:[t.jsx("button",{onClick:()=>S(v),style:{marginRight:8,padding:"4px 8px",fontSize:12},children:"Editar"}),t.jsx("button",{onClick:()=>x(v.id),style:{padding:"4px 8px",fontSize:12,background:"#fee2e2",color:"#991b1b"},children:"Eliminar"})]})]},v.id))})]})}),c&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{style:{background:"white",padding:24,borderRadius:8,width:500,maxHeight:"90vh",overflow:"auto"},children:[t.jsx("h3",{style:{marginTop:0},children:f?"Editar Cuenta":"Nueva Cuenta"}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Cdigo *"}),t.jsx("input",{className:"input",value:p.codigo,onChange:v=>m({...p,codigo:v.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Nombre *"}),t.jsx("input",{className:"input",value:p.nombre,onChange:v=>m({...p,nombre:v.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Tipo *"}),t.jsxs("select",{className:"input",value:p.tipo,onChange:v=>m({...p,tipo:v.target.value}),children:[t.jsx("option",{value:"activo",children:"Activo"}),t.jsx("option",{value:"pasivo",children:"Pasivo"}),t.jsx("option",{value:"patrimonio",children:"Patrimonio"}),t.jsx("option",{value:"ingreso",children:"Ingreso"}),t.jsx("option",{value:"gasto",children:"Gasto"})]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Cuenta Padre (opcional)"}),t.jsxs("select",{className:"input",value:p.cuenta_padre_id,onChange:v=>m({...p,cuenta_padre_id:v.target.value}),children:[t.jsx("option",{value:"",children:"Sin cuenta padre"}),l.filter(v=>v.id!==f?.id).map(v=>t.jsxs("option",{value:v.id,children:[v.codigo," - ",v.nombre]},v.id))]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Descripcin"}),t.jsx("textarea",{className:"input",rows:3,value:p.descripcion,onChange:v=>m({...p,descripcion:v.target.value})})]}),t.jsx("div",{style:{marginBottom:16},children:t.jsxs("label",{style:{display:"flex",alignItems:"center",fontSize:13},children:[t.jsx("input",{type:"checkbox",checked:p.activo,onChange:v=>m({...p,activo:v.target.checked}),style:{marginRight:8}}),"Cuenta activa"]})}),t.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>d(!1),children:"Cancelar"}),t.jsx("button",{className:"btn-opaque",onClick:j,children:"Guardar"})]})]})})]})}function Dj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState([]),[p,m]=y.useState([]),[b,S]=y.useState(!1),[j,x]=y.useState(!1),[w,v]=y.useState(null),[E,T]=y.useState(!1),[L,R]=y.useState({fecha:new Date().toISOString().slice(0,10),cuenta:"",descripcion:"",tipo_movimiento:"debe",monto:"",referencia:""}),[z,C]=y.useState({fecha:new Date().toISOString().slice(0,10),cuentaDebe:"",cuentaHaber:"",monto:"",descripcion:"",referencia:""}),O=async()=>{try{const{data:B,error:A}=await F.from("cuentas_contables").select("*").eq("activo",!0).order("codigo",{ascending:!0});if(A)throw A;m(B||[])}catch(B){console.error("Error fetching cuentas",B)}},I=async()=>{S(!0);try{const B=new Date(r+"T00:00:00").toISOString(),A=new Date(c+"T23:59:59").toISOString(),{data:N,error:q}=await F.from("libro_diario").select("*").gte("fecha",B).lte("fecha",A).order("fecha",{ascending:!1}).order("id",{ascending:!1});if(q)throw q;g(N||[])}catch(B){console.error("Error fetching libro diario",B)}finally{S(!1)}};y.useEffect(()=>{O()},[]),y.useEffect(()=>{I()},[r,c]);const k=async B=>{if(confirm("Est seguro de eliminar este asiento?"))try{const{error:A}=await F.from("libro_diario").delete().eq("id",B);if(A)throw A;I()}catch(A){console.error("Error deleting asiento",A),alert("Error al eliminar el asiento")}},M=B=>{v(B.id),T(!1),R({fecha:new Date(B.fecha).toISOString().slice(0,10),cuenta:B.cuenta,descripcion:B.descripcion||"",tipo_movimiento:B.tipo_movimiento,monto:B.monto.toString(),referencia:B.referencia||""}),x(!0)},G=async()=>{try{const B=JSON.parse(localStorage.getItem("user")||"{}");if(E){if(!z.cuentaDebe||!z.cuentaHaber){alert("Debe seleccionar ambas cuentas para un asiento doble");return}if(!z.monto||parseFloat(z.monto)<=0){alert("El monto debe ser mayor a cero");return}const A=parseFloat(z.monto),N=new Date(z.fecha+"T12:00:00").toISOString(),q=[{fecha:N,cuenta:z.cuentaDebe,descripcion:z.descripcion||null,tipo_movimiento:"debe",monto:A,referencia:z.referencia||null,usuario:B.username||null},{fecha:N,cuenta:z.cuentaHaber,descripcion:z.descripcion||null,tipo_movimiento:"haber",monto:A,referencia:z.referencia||null,usuario:B.username||null}],{error:X}=await F.from("libro_diario").insert(q);if(X)throw X;C({fecha:new Date().toISOString().slice(0,10),cuentaDebe:"",cuentaHaber:"",monto:"",descripcion:"",referencia:""})}else{if(!L.cuenta){alert("Debe seleccionar una cuenta");return}if(!L.monto||parseFloat(L.monto)<=0){alert("El monto debe ser mayor a cero");return}const A={fecha:new Date(L.fecha+"T12:00:00").toISOString(),cuenta:L.cuenta,descripcion:L.descripcion||null,tipo_movimiento:L.tipo_movimiento,monto:parseFloat(L.monto),referencia:L.referencia||null,usuario:B.username||null};if(w){const{error:N}=await F.from("libro_diario").update(A).eq("id",w);if(N)throw N}else{const{error:N}=await F.from("libro_diario").insert([A]);if(N)throw N}R({fecha:new Date().toISOString().slice(0,10),cuenta:"",descripcion:"",tipo_movimiento:"debe",monto:"",referencia:""})}v(null),x(!1),I()}catch(B){console.error("Error saving asiento",B),alert("Error al guardar el asiento contable")}},K=f.filter(B=>B.tipo_movimiento==="debe").reduce((B,A)=>B+Number(A.monto),0),ne=f.filter(B=>B.tipo_movimiento==="haber").reduce((B,A)=>B+Number(A.monto),0),Y=K-ne;return t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
          }
        `}),t.jsxs("div",{className:"no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[t.jsx("h2",{style:{margin:0},children:"Libro Diario"}),t.jsx("button",{className:"btn-opaque",onClick:()=>x(!0),children:"+ Nuevo Asiento"})]}),t.jsxs("div",{className:"no-print",style:{display:"flex",gap:12,marginBottom:18,alignItems:"flex-end"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:B=>s(B.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:B=>d(B.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:I,disabled:b,children:b?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir"})]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:20},className:"print-only",children:[t.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:700},children:"LIBRO DIARIO"}),t.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:12,color:"#475569"},children:["Del ",new Date(r).toLocaleDateString()," al"," ",new Date(c).toLocaleDateString()]})]}),t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#eef2f7",textAlign:"left"},children:[t.jsx("th",{style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1"},children:"Fecha"}),t.jsx("th",{style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1"},children:"Cuenta"}),t.jsx("th",{style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1"},children:"Descripcin"}),t.jsx("th",{style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1"},children:"Referencia"}),t.jsx("th",{style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1",textAlign:"right"},children:"Debe"}),t.jsx("th",{style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1",textAlign:"right"},children:"Haber"}),t.jsx("th",{className:"no-print",style:{padding:12,fontWeight:700,border:"1px solid #cbd5e1",textAlign:"center"},children:"Acciones"})]})}),t.jsxs("tbody",{children:[f.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:7,style:{padding:24,textAlign:"center",color:"#94a3b8",border:"1px solid #cbd5e1"},children:"No hay asientos en este rango"})}):f.map(B=>t.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[t.jsx("td",{style:{padding:12,border:"1px solid #cbd5e1"},children:new Date(B.fecha).toLocaleDateString()}),t.jsx("td",{style:{padding:12,border:"1px solid #cbd5e1"},children:B.cuenta}),t.jsx("td",{style:{padding:12,border:"1px solid #cbd5e1",fontSize:12},children:B.descripcion||"-"}),t.jsx("td",{style:{padding:12,border:"1px solid #cbd5e1",fontSize:12},children:B.referencia||"-"}),t.jsx("td",{style:{padding:12,border:"1px solid #cbd5e1",textAlign:"right"},children:B.tipo_movimiento==="debe"?`L ${Number(B.monto).toFixed(2)}`:"-"}),t.jsx("td",{style:{padding:12,border:"1px solid #cbd5e1",textAlign:"right"},children:B.tipo_movimiento==="haber"?`L ${Number(B.monto).toFixed(2)}`:"-"}),t.jsxs("td",{className:"no-print",style:{padding:12,border:"1px solid #cbd5e1",textAlign:"center"},children:[t.jsx("button",{onClick:()=>M(B),style:{padding:"4px 8px",fontSize:12,background:"#3b82f6",color:"white",border:"none",borderRadius:4,cursor:"pointer",marginRight:4},children:"Editar"}),t.jsx("button",{onClick:()=>k(B.id),style:{padding:"4px 8px",fontSize:12,background:"#ef4444",color:"white",border:"none",borderRadius:4,cursor:"pointer"},children:"Eliminar"})]})]},B.id)),f.length>0&&t.jsxs("tr",{style:{fontWeight:"bold",background:"#f8fafc"},children:[t.jsx("td",{colSpan:4,style:{padding:12,border:"1px solid #cbd5e1"},children:"TOTALES"}),t.jsxs("td",{style:{padding:12,border:"1px solid #cbd5e1",textAlign:"right"},children:["L ",K.toFixed(2)]}),t.jsxs("td",{style:{padding:12,border:"1px solid #cbd5e1",textAlign:"right"},children:["L ",ne.toFixed(2)]})]}),f.length>0&&t.jsxs("tr",{style:{fontWeight:"bold",background:Y===0?"#dcfce7":"#fee2e2"},children:[t.jsx("td",{colSpan:4,style:{padding:12,border:"1px solid #cbd5e1"},children:"DIFERENCIA (Debe - Haber)"}),t.jsxs("td",{colSpan:2,style:{padding:12,border:"1px solid #cbd5e1",textAlign:"right"},children:["L ",Math.abs(Y).toFixed(2)," ",Y===0?"(Cuadrado)":Y>0?"(Debe mayor)":"(Haber mayor)"]})]})]})]})]}),j&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,overflow:"auto",padding:20},children:t.jsxs("div",{style:{background:"white",padding:24,borderRadius:8,width:600,maxHeight:"90vh",overflow:"auto"},children:[t.jsx("h3",{style:{marginTop:0},children:w?"Editar Asiento Contable":"Nuevo Asiento Contable"}),!w&&t.jsxs("div",{style:{marginBottom:20,padding:12,background:"#f8fafc",borderRadius:8},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[t.jsx("input",{type:"radio",checked:!E,onChange:()=>T(!1),style:{marginRight:8}}),t.jsx("span",{style:{fontSize:13,fontWeight:600},children:"Asiento Individual"})]}),t.jsxs("label",{style:{display:"flex",alignItems:"center"},children:[t.jsx("input",{type:"radio",checked:E,onChange:()=>T(!0),style:{marginRight:8}}),t.jsx("span",{style:{fontSize:13,fontWeight:600},children:"Asiento Doble (Partida Doble)"})]})]}),E?t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha *"}),t.jsx("input",{className:"input",type:"date",value:z.fecha,onChange:B=>C({...z,fecha:B.target.value})})]}),t.jsxs("div",{style:{marginBottom:16,padding:12,background:"#dbeafe",borderRadius:8},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#1e40af",marginBottom:8,fontWeight:600},children:"Cuenta DEBE *"}),t.jsxs("select",{className:"input",value:z.cuentaDebe,onChange:B=>C({...z,cuentaDebe:B.target.value}),children:[t.jsx("option",{value:"",children:"Seleccionar cuenta debe"}),p.map(B=>t.jsxs("option",{value:B.codigo,children:[B.codigo," - ",B.nombre]},B.id))]})]}),t.jsxs("div",{style:{marginBottom:16,padding:12,background:"#fef3c7",borderRadius:8},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#92400e",marginBottom:8,fontWeight:600},children:"Cuenta HABER *"}),t.jsxs("select",{className:"input",value:z.cuentaHaber,onChange:B=>C({...z,cuentaHaber:B.target.value}),children:[t.jsx("option",{value:"",children:"Seleccionar cuenta haber"}),p.map(B=>t.jsxs("option",{value:B.codigo,children:[B.codigo," - ",B.nombre]},B.id))]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Monto * (mismo para ambas cuentas)"}),t.jsx("input",{className:"input",type:"number",step:"0.01",value:z.monto,onChange:B=>C({...z,monto:B.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Descripcin"}),t.jsx("textarea",{className:"input",rows:3,value:z.descripcion,onChange:B=>C({...z,descripcion:B.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Referencia"}),t.jsx("input",{className:"input",value:z.referencia,onChange:B=>C({...z,referencia:B.target.value}),placeholder:"Factura, compra, nota, etc."})]}),t.jsx("div",{style:{padding:12,background:"#dcfce7",borderRadius:8,marginBottom:16},children:t.jsxs("p",{style:{margin:0,fontSize:12,color:"#15803d"},children:[t.jsx("strong",{children:"Partida Doble:"})," Se registrarn automticamente dos asientos con el mismo monto, uno en Debe y otro en Haber, manteniendo el balance contable."]})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha *"}),t.jsx("input",{className:"input",type:"date",value:L.fecha,onChange:B=>R({...L,fecha:B.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Cuenta *"}),t.jsxs("select",{className:"input",value:L.cuenta,onChange:B=>R({...L,cuenta:B.target.value}),children:[t.jsx("option",{value:"",children:"Seleccionar cuenta"}),p.map(B=>t.jsxs("option",{value:B.codigo,children:[B.codigo," - ",B.nombre]},B.id))]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Tipo de movimiento *"}),t.jsxs("select",{className:"input",value:L.tipo_movimiento,onChange:B=>R({...L,tipo_movimiento:B.target.value}),children:[t.jsx("option",{value:"debe",children:"Debe"}),t.jsx("option",{value:"haber",children:"Haber"})]})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Monto *"}),t.jsx("input",{className:"input",type:"number",step:"0.01",value:L.monto,onChange:B=>R({...L,monto:B.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Descripcin"}),t.jsx("textarea",{className:"input",rows:3,value:L.descripcion,onChange:B=>R({...L,descripcion:B.target.value})})]}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Referencia"}),t.jsx("input",{className:"input",value:L.referencia,onChange:B=>R({...L,referencia:B.target.value}),placeholder:"Factura, compra, nota, etc."})]})]}),t.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>{x(!1),v(null)},children:"Cancelar"}),t.jsx("button",{className:"btn-opaque",onClick:G,children:w?"Actualizar":"Guardar"})]})]})})]})}function Bj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState([]),[p,m]=y.useState(!1),[b,S]=y.useState(null),j=async()=>{m(!0);try{const x=new Date(r+"T00:00:00").toISOString(),w=new Date(c+"T23:59:59").toISOString(),{data:v,error:E}=await F.from("libro_diario").select("*").gte("fecha",x).lte("fecha",w).order("cuenta",{ascending:!0}).order("fecha",{ascending:!0});if(E)throw E;const T=v||[],L={};T.forEach(z=>{const C=z.cuenta;L[C]||(L[C]=[]),L[C].push(z)});const R=Object.keys(L).map(z=>{const C=L[z],O=C.filter(k=>k.tipo_movimiento==="debe").reduce((k,M)=>k+Number(M.monto),0),I=C.filter(k=>k.tipo_movimiento==="haber").reduce((k,M)=>k+Number(M.monto),0);return{cuenta:z,asientos:C,totalDebe:O,totalHaber:I,saldo:O-I}});g(R)}catch(x){console.error("Error fetching libro mayor",x)}finally{m(!1)}};return y.useEffect(()=>{j()},[r,c]),t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
          }
        `}),t.jsx("h2",{className:"no-print",style:{marginTop:0},children:"Libro Mayor"}),t.jsxs("div",{className:"no-print",style:{display:"flex",gap:12,marginBottom:18,alignItems:"flex-end"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:x=>s(x.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:x=>d(x.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:j,disabled:p,children:p?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir"})]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8},className:"printable",children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:20},className:"print-only",children:[t.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:700},children:"LIBRO MAYOR"}),t.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:12,color:"#475569"},children:["Del ",new Date(r).toLocaleDateString()," al"," ",new Date(c).toLocaleDateString()]})]}),f.length===0?t.jsx("p",{style:{padding:24,textAlign:"center",color:"#94a3b8"},children:"No hay movimientos en este rango"}):f.map((x,w)=>t.jsxs("div",{style:{marginBottom:32,pageBreakInside:"avoid"},children:[t.jsxs("div",{style:{background:"#eef2f7",padding:12,marginBottom:8,borderRadius:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("h4",{style:{margin:0,fontSize:14,fontWeight:700},children:["Cuenta: ",x.cuenta]}),t.jsx("button",{className:"no-print",onClick:()=>S(b===x.cuenta?null:x.cuenta),style:{padding:"4px 12px",fontSize:12},children:b===x.cuenta?"Ocultar":"Ver detalle"})]}),(b===x.cuenta||window.matchMedia("print").matches)&&t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12,marginBottom:12},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc"},children:[t.jsx("th",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"left"},children:"Fecha"}),t.jsx("th",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"left"},children:"Descripcin"}),t.jsx("th",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"left"},children:"Referencia"}),t.jsx("th",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"right"},children:"Debe"}),t.jsx("th",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"right"},children:"Haber"})]})}),t.jsx("tbody",{children:x.asientos.map(v=>t.jsxs("tr",{children:[t.jsx("td",{style:{padding:8,border:"1px solid #cbd5e1"},children:new Date(v.fecha).toLocaleDateString()}),t.jsx("td",{style:{padding:8,border:"1px solid #cbd5e1"},children:v.descripcion||"-"}),t.jsx("td",{style:{padding:8,border:"1px solid #cbd5e1"},children:v.referencia||"-"}),t.jsx("td",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"right"},children:v.tipo_movimiento==="debe"?`L ${Number(v.monto).toFixed(2)}`:"-"}),t.jsx("td",{style:{padding:8,border:"1px solid #cbd5e1",textAlign:"right"},children:v.tipo_movimiento==="haber"?`L ${Number(v.monto).toFixed(2)}`:"-"})]},v.id))})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 12px",background:"#f8fafc",borderRadius:4,fontSize:13,fontWeight:600},children:[t.jsxs("span",{children:["Total Debe: L ",x.totalDebe.toFixed(2)]}),t.jsxs("span",{children:["Total Haber: L ",x.totalHaber.toFixed(2)]}),t.jsxs("span",{style:{color:x.saldo>=0?"#15803d":"#991b1b"},children:["Saldo: L ",Math.abs(x.saldo).toFixed(2)," ",x.saldo>=0?"(Deudor)":"(Acreedor)"]})]})]},w))]})]})}function Uj(){const[l,i]=y.useState(new Date().toISOString().slice(0,10)),[r,s]=y.useState([]),[c,d]=y.useState([]),[f,g]=y.useState([]),[p,m]=y.useState(!1),b=async()=>{m(!0);try{const{data:v,error:E}=await F.from("cuentas_contables").select("*").eq("activo",!0).in("tipo",["activo","pasivo","patrimonio"]);if(E)throw E;const T=v||[],L=new Date(l+"T23:59:59").toISOString(),{data:R,error:z}=await F.from("libro_diario").select("*").lte("fecha",L);if(z)throw z;const C=R||[],O={};C.forEach(G=>{const K=G.cuenta;O[K]||(O[K]=0),G.tipo_movimiento==="debe"?O[K]+=Number(G.monto):O[K]-=Number(G.monto)});const I=[],k=[],M=[];T.forEach(G=>{const K=O[G.codigo]||0;if(K===0)return;const ne={cuenta:G,saldo:K};G.tipo==="activo"?I.push(ne):G.tipo==="pasivo"?k.push(ne):G.tipo==="patrimonio"&&M.push(ne)}),s(I.sort((G,K)=>G.cuenta.codigo.localeCompare(K.cuenta.codigo))),d(k.sort((G,K)=>G.cuenta.codigo.localeCompare(K.cuenta.codigo))),g(M.sort((G,K)=>G.cuenta.codigo.localeCompare(K.cuenta.codigo)))}catch(v){console.error("Error fetching balance general",v)}finally{m(!1)}};y.useEffect(()=>{b()},[l]);const S=r.reduce((v,E)=>v+E.saldo,0),j=c.reduce((v,E)=>v+E.saldo,0),x=f.reduce((v,E)=>v+E.saldo,0),w=j+x;return t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
          }
        `}),t.jsx("h2",{className:"no-print",style:{marginTop:0},children:"Balance General"}),t.jsxs("div",{className:"no-print",style:{display:"flex",gap:12,marginBottom:18,alignItems:"flex-end"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha de corte"}),t.jsx("input",{className:"input",type:"date",value:l,onChange:v=>i(v.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:b,disabled:p,children:p?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir"})]})]}),t.jsxs("div",{style:{background:"white",padding:24,borderRadius:8},className:"printable",children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:30},children:[t.jsx("h3",{style:{margin:0,fontSize:20,fontWeight:700},children:"BALANCE GENERAL"}),t.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:13,color:"#475569"},children:["Al ",new Date(l).toLocaleDateString()]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:32},children:[t.jsxs("div",{children:[t.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,color:"#1e40af",borderBottom:"2px solid #1e40af",paddingBottom:8},children:"ACTIVOS"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:t.jsxs("tbody",{children:[r.length===0?t.jsx("tr",{children:t.jsx("td",{style:{padding:8,color:"#94a3b8"},children:"No hay cuentas de activo"})}):r.map((v,E)=>t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"6px 0",fontSize:11},children:v.cuenta.codigo}),t.jsx("td",{style:{padding:"6px 8px"},children:v.cuenta.nombre}),t.jsxs("td",{style:{padding:"6px 0",textAlign:"right",fontWeight:500},children:["L ",v.saldo.toFixed(2)]})]},E)),t.jsxs("tr",{style:{borderTop:"2px solid #1e40af",fontWeight:700},children:[t.jsx("td",{colSpan:2,style:{padding:"12px 0 8px 0"},children:"TOTAL ACTIVOS"}),t.jsxs("td",{style:{padding:"12px 0 8px 0",textAlign:"right"},children:["L ",S.toFixed(2)]})]})]})})]}),t.jsxs("div",{children:[t.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,color:"#92400e",borderBottom:"2px solid #92400e",paddingBottom:8},children:"PASIVOS"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12,marginBottom:24},children:t.jsxs("tbody",{children:[c.length===0?t.jsx("tr",{children:t.jsx("td",{style:{padding:8,color:"#94a3b8"},children:"No hay cuentas de pasivo"})}):c.map((v,E)=>t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"6px 0",fontSize:11},children:v.cuenta.codigo}),t.jsx("td",{style:{padding:"6px 8px"},children:v.cuenta.nombre}),t.jsxs("td",{style:{padding:"6px 0",textAlign:"right",fontWeight:500},children:["L ",v.saldo.toFixed(2)]})]},E)),t.jsxs("tr",{style:{borderTop:"1px solid #cbd5e1",fontWeight:600},children:[t.jsx("td",{colSpan:2,style:{padding:"8px 0"},children:"Total Pasivos"}),t.jsxs("td",{style:{padding:"8px 0",textAlign:"right"},children:["L ",j.toFixed(2)]})]})]})}),t.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,color:"#6b21a8",borderBottom:"2px solid #6b21a8",paddingBottom:8},children:"PATRIMONIO"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:12},children:t.jsxs("tbody",{children:[f.length===0?t.jsx("tr",{children:t.jsx("td",{style:{padding:8,color:"#94a3b8"},children:"No hay cuentas de patrimonio"})}):f.map((v,E)=>t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"6px 0",fontSize:11},children:v.cuenta.codigo}),t.jsx("td",{style:{padding:"6px 8px"},children:v.cuenta.nombre}),t.jsxs("td",{style:{padding:"6px 0",textAlign:"right",fontWeight:500},children:["L ",v.saldo.toFixed(2)]})]},E)),t.jsxs("tr",{style:{borderTop:"1px solid #cbd5e1",fontWeight:600},children:[t.jsx("td",{colSpan:2,style:{padding:"8px 0"},children:"Total Patrimonio"}),t.jsxs("td",{style:{padding:"8px 0",textAlign:"right"},children:["L ",x.toFixed(2)]})]}),t.jsxs("tr",{style:{borderTop:"2px solid #6b21a8",fontWeight:700},children:[t.jsx("td",{colSpan:2,style:{padding:"12px 0 8px 0"},children:"TOTAL PASIVO + PATRIMONIO"}),t.jsxs("td",{style:{padding:"12px 0 8px 0",textAlign:"right"},children:["L ",w.toFixed(2)]})]})]})})]})]}),t.jsx("div",{style:{marginTop:32,padding:16,background:Math.abs(S-w)<.01?"#dcfce7":"#fee2e2",borderRadius:8,textAlign:"center"},children:t.jsx("p",{style:{margin:0,fontSize:14,fontWeight:600},children:Math.abs(S-w)<.01?" Ecuacin contable balanceada: Activos = Pasivos + Patrimonio":` Ecuacin contable desbalanceada. Diferencia: L ${Math.abs(S-w).toFixed(2)}`})})]})]})}function Lj(){const l=new Date,i=new Date;i.setDate(l.getDate()-30);const[r,s]=y.useState(i.toISOString().slice(0,10)),[c,d]=y.useState(l.toISOString().slice(0,10)),[f,g]=y.useState([]),[p,m]=y.useState([]),[b,S]=y.useState(!1),j=async()=>{S(!0);try{const{data:E,error:T}=await F.from("cuentas_contables").select("*").eq("activo",!0).in("tipo",["ingreso","gasto"]);if(T)throw T;const L=E||[],R=new Date(r+"T00:00:00").toISOString(),z=new Date(c+"T23:59:59").toISOString(),{data:C,error:O}=await F.from("libro_diario").select("*").gte("fecha",R).lte("fecha",z);if(O)throw O;const I=C||[],k={};I.forEach(K=>{const ne=K.cuenta;k[ne]||(k[ne]={debe:0,haber:0}),K.tipo_movimiento==="debe"?k[ne].debe+=Number(K.monto):k[ne].haber+=Number(K.monto)});const M=[],G=[];L.forEach(K=>{const ne=k[K.codigo];if(!ne)return;let Y=0;K.tipo==="ingreso"?(Y=ne.haber-ne.debe,Y>0&&M.push({cuenta:K,monto:Y})):K.tipo==="gasto"&&(Y=ne.debe-ne.haber,Y>0&&G.push({cuenta:K,monto:Y}))}),g(M.sort((K,ne)=>K.cuenta.codigo.localeCompare(ne.cuenta.codigo))),m(G.sort((K,ne)=>K.cuenta.codigo.localeCompare(ne.cuenta.codigo)))}catch(E){console.error("Error fetching estado de resultados",E)}finally{S(!1)}};y.useEffect(()=>{j()},[r,c]);const x=f.reduce((E,T)=>E+T.monto,0),w=p.reduce((E,T)=>E+T.monto,0),v=x-w;return t.jsxs("div",{style:{padding:18},children:[t.jsx("style",{children:`
          @media print {
            body * { visibility: hidden; }
            .printable, .printable * { visibility: visible; }
            .printable { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
          }
        `}),t.jsx("h2",{className:"no-print",style:{marginTop:0},children:"Estado de Resultados"}),t.jsxs("div",{className:"no-print",style:{display:"flex",gap:12,marginBottom:18,alignItems:"flex-end"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:r,onChange:E=>s(E.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569",marginBottom:4},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:E=>d(E.target.value)})]}),t.jsxs("div",{style:{marginLeft:"auto"},children:[t.jsx("button",{className:"btn-opaque",onClick:j,disabled:b,children:b?"Cargando...":"Actualizar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>window.print(),style:{marginLeft:8},children:"Imprimir"})]})]}),t.jsxs("div",{style:{background:"white",padding:24,borderRadius:8,maxWidth:800,margin:"0 auto"},className:"printable",children:[t.jsxs("div",{style:{textAlign:"center",marginBottom:30},children:[t.jsx("h3",{style:{margin:0,fontSize:20,fontWeight:700},children:"ESTADO DE RESULTADOS"}),t.jsxs("p",{style:{margin:"8px 0 0 0",fontSize:13,color:"#475569"},children:["Del ",new Date(r).toLocaleDateString()," al"," ",new Date(c).toLocaleDateString()]})]}),t.jsxs("div",{style:{marginBottom:32},children:[t.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,color:"#15803d",borderBottom:"2px solid #15803d",paddingBottom:8},children:"INGRESOS"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:t.jsxs("tbody",{children:[f.length===0?t.jsx("tr",{children:t.jsx("td",{style:{padding:8,color:"#94a3b8"},children:"No hay ingresos en este perodo"})}):f.map((E,T)=>t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"6px 0",fontSize:11},children:E.cuenta.codigo}),t.jsx("td",{style:{padding:"6px 12px"},children:E.cuenta.nombre}),t.jsxs("td",{style:{padding:"6px 0",textAlign:"right",fontWeight:500},children:["L ",E.monto.toFixed(2)]})]},T)),t.jsxs("tr",{style:{borderTop:"2px solid #15803d",fontWeight:700},children:[t.jsx("td",{colSpan:2,style:{padding:"12px 0 8px 0"},children:"TOTAL INGRESOS"}),t.jsxs("td",{style:{padding:"12px 0 8px 0",textAlign:"right"},children:["L ",x.toFixed(2)]})]})]})})]}),t.jsxs("div",{style:{marginBottom:32},children:[t.jsx("h4",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,color:"#991b1b",borderBottom:"2px solid #991b1b",paddingBottom:8},children:"GASTOS"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:t.jsxs("tbody",{children:[p.length===0?t.jsx("tr",{children:t.jsx("td",{style:{padding:8,color:"#94a3b8"},children:"No hay gastos en este perodo"})}):p.map((E,T)=>t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"6px 0",fontSize:11},children:E.cuenta.codigo}),t.jsx("td",{style:{padding:"6px 12px"},children:E.cuenta.nombre}),t.jsxs("td",{style:{padding:"6px 0",textAlign:"right",fontWeight:500},children:["L ",E.monto.toFixed(2)]})]},T)),t.jsxs("tr",{style:{borderTop:"2px solid #991b1b",fontWeight:700},children:[t.jsx("td",{colSpan:2,style:{padding:"12px 0 8px 0"},children:"TOTAL GASTOS"}),t.jsxs("td",{style:{padding:"12px 0 8px 0",textAlign:"right"},children:["L ",w.toFixed(2)]})]})]})})]}),t.jsxs("div",{style:{padding:20,background:v>=0?"#dcfce7":"#fee2e2",borderRadius:8,border:`2px solid ${v>=0?"#15803d":"#991b1b"}`},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h4",{style:{margin:0,fontSize:18,fontWeight:700,color:v>=0?"#15803d":"#991b1b"},children:v>=0?"UTILIDAD NETA":"PRDIDA NETA"}),t.jsxs("span",{style:{fontSize:24,fontWeight:700,color:v>=0?"#15803d":"#991b1b"},children:["L ",Math.abs(v).toFixed(2)]})]}),t.jsx("p",{style:{margin:"8px 0 0 0",fontSize:12,color:"#475569"},children:v>=0?"Los ingresos superan a los gastos en este perodo":"Los gastos superan a los ingresos en este perodo"})]}),t.jsx("div",{style:{marginTop:24,padding:16,background:"#f8fafc",borderRadius:8},children:t.jsx("table",{style:{width:"100%",fontSize:13},children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"4px 0"},children:"Total Ingresos:"}),t.jsxs("td",{style:{padding:"4px 0",textAlign:"right",fontWeight:600},children:["L ",x.toFixed(2)]})]}),t.jsxs("tr",{children:[t.jsx("td",{style:{padding:"4px 0"},children:"(-) Total Gastos:"}),t.jsxs("td",{style:{padding:"4px 0",textAlign:"right",fontWeight:600},children:["L ",w.toFixed(2)]})]}),t.jsxs("tr",{style:{borderTop:"2px solid #cbd5e1",fontWeight:700},children:[t.jsx("td",{style:{padding:"8px 0 4px 0"},children:v>=0?"Utilidad Neta:":"Prdida Neta:"}),t.jsxs("td",{style:{padding:"8px 0 4px 0",textAlign:"right",color:v>=0?"#15803d":"#991b1b"},children:["L ",Math.abs(v).toFixed(2)]})]})]})})})]})]})}function Ij(){return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Auditora (auditoria)"}),t.jsx("p",{style:{color:"#475569"},children:"Registro de auditoras y trazabilidad. (Placeholder)"})]})}function Mj({open:l,onClose:i,onCreate:r}){const[s,c]=y.useState(""),[d,f]=y.useState(""),[g,p]=y.useState(""),[m,b]=y.useState(""),[S,j]=y.useState(""),[x,w]=y.useState(""),[v,E]=y.useState(!0),[T,L]=y.useState(!1),[R,z]=y.useState(null);if(!l)return null;async function C(){const O=[];if(s.trim()||O.push("Nombre"),O.length){z(`Faltan campos: ${O.join(", ")}`);return}L(!0),z(null);try{await r({nombre:s.trim(),rtn:d.trim()||void 0,telefono:g.trim()||void 0,correo:m.trim()||void 0,direccion:S.trim()||void 0,tipo_proveedor:x||void 0,activo:v}),c(""),f(""),p(""),b(""),j(""),w(""),E(!0),i()}catch(I){z(I?.message||String(I))}finally{L(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:680,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsx("h3",{style:{marginTop:0},children:"Agregar proveedor"}),t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsx("label",{style:{fontSize:13},children:"Nombre"}),t.jsx("input",{className:"input",value:s,onChange:O=>c(O.target.value)}),t.jsx("label",{style:{fontSize:13},children:"RTN"}),t.jsx("input",{className:"input",value:d,onChange:O=>f(O.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Telfono"}),t.jsx("input",{className:"input",value:g,onChange:O=>p(O.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Correo"}),t.jsx("input",{className:"input",value:m,onChange:O=>b(O.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Direccin"}),t.jsx("input",{className:"input",value:S,onChange:O=>j(O.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Tipo"}),t.jsx("input",{className:"input",value:x,onChange:O=>w(O.target.value),placeholder:"local / internacional"}),t.jsxs("label",{style:{fontSize:13},children:[t.jsx("input",{type:"checkbox",checked:v,onChange:O=>E(O.target.checked)})," ","Activo"]})]}),R&&t.jsx("div",{style:{color:"red",marginTop:12},children:R}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:T,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:C,disabled:T,style:{width:"auto",padding:"8px 14px"},children:T?"Creando...":"Crear"})]})]})})}function qj({open:l,onClose:i,row:r,onSave:s}){const[c,d]=y.useState(""),[f,g]=y.useState(""),[p,m]=y.useState(""),[b,S]=y.useState(""),[j,x]=y.useState(""),[w,v]=y.useState(""),[E,T]=y.useState(!0),[L,R]=y.useState(!1),[z,C]=y.useState(null);if(y.useEffect(()=>{!l||!r||(d(r.nombre||""),g(r.rtn||""),m(r.telefono||""),S(r.correo||""),x(r.direccion||""),v(r.tipo_proveedor||""),T(r.activo??!0),C(null))},[l,r]),!l||!r)return null;async function O(){if(!r){C("No hay fila seleccionada");return}const I=[];if(c.trim()||I.push("Nombre"),I.length){C(`Faltan campos: ${I.join(", ")}`);return}R(!0),C(null);try{await s(r.id,{nombre:c.trim(),rtn:f.trim()||void 0,telefono:p.trim()||void 0,correo:b.trim()||void 0,direccion:j.trim()||void 0,tipo_proveedor:w||void 0,activo:E}),i()}catch(k){C(k?.message||String(k))}finally{R(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:680,maxWidth:"95%",background:"#fff",borderRadius:8,padding:16},children:[t.jsxs("h3",{style:{marginTop:0},children:["Editar proveedor  ID ",String(r.id)]}),t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsx("label",{style:{fontSize:13},children:"Nombre"}),t.jsx("input",{className:"input",value:c,onChange:I=>d(I.target.value)}),t.jsx("label",{style:{fontSize:13},children:"RTN"}),t.jsx("input",{className:"input",value:f,onChange:I=>g(I.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Telfono"}),t.jsx("input",{className:"input",value:p,onChange:I=>m(I.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Correo"}),t.jsx("input",{className:"input",value:b,onChange:I=>S(I.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Direccin"}),t.jsx("input",{className:"input",value:j,onChange:I=>x(I.target.value)}),t.jsx("label",{style:{fontSize:13},children:"Tipo"}),t.jsx("input",{className:"input",value:w,onChange:I=>v(I.target.value),placeholder:"local / internacional"}),t.jsxs("label",{style:{fontSize:13},children:[t.jsx("input",{type:"checkbox",checked:E,onChange:I=>T(I.target.checked)})," ","Activo"]})]}),z&&t.jsx("div",{style:{color:"red",marginTop:12},children:z}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:i,disabled:L,style:{width:"auto"},children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:O,disabled:L,style:{width:"auto",padding:"8px 14px"},children:L?"Guardando...":"Guardar"})]})]})})}function $j(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(""),[p,m]=y.useState(!1),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState(!1),[E,T]=y.useState(null);async function L(O){s(!0),d(null);try{let I=null,k=null;if(O&&O.trim()){const G=`%${O.trim()}%`,K=await F.from("proveedores").select("id, nombre, rtn, telefono, correo, direccion, tipo_proveedor, activo").or(`nombre.ilike.${G},rtn.ilike.${G}`).order("id",{ascending:!0});I=K.data,k=K.error}else{const M=await F.from("proveedores").select("id, nombre, rtn, telefono, correo, direccion, tipo_proveedor, activo").order("id",{ascending:!0});I=M.data,k=M.error}if(k)throw k;i(Array.isArray(I)?I:[])}catch(I){d(I?.message||String(I)),i([])}finally{s(!1)}}y.useEffect(()=>{L()},[]),y.useEffect(()=>{const O=setTimeout(()=>{L(f)},350);return()=>clearTimeout(O)},[f]);async function R(O){s(!0),d(null);try{const I={...O};if(delete I.id,I.rtn){const{data:M,error:G}=await F.from("proveedores").select("id, nombre").eq("rtn",I.rtn).limit(1);if(G)throw G;if(Array.isArray(M)&&M.length>0)throw new Error(`Ya existe un proveedor con RTN ${I.rtn}`)}const{error:k}=await F.from("proveedores").insert(I);if(k)throw k;await L()}catch(I){throw String(I).includes("Ya existe un proveedor")?d(String(I)):I?.code==="23505"||String(I).includes("duplicate key value")?d("Clave duplicada: el id ya existe. Ejecuta la reparacin de la sequence en la BD (setval) o contacta al administrador."):d(I?.message||String(I)),I}finally{s(!1)}}async function z(O,I){s(!0),d(null);try{const{error:k}=await F.from("proveedores").update(I).eq("id",O);if(k)throw k;await L()}catch(k){throw d(k?.message||String(k)),k}finally{s(!1)}}async function C(){if(E){s(!0),d(null);try{const{error:O}=await F.from("proveedores").delete().eq("id",E.id);if(O)throw O;v(!1),T(null),await L()}catch(O){d(O?.message||String(O))}finally{s(!1)}}}return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Proveedores (proveedores)"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>L(),children:"Recargar"}),t.jsx("button",{className:"btn-primary",onClick:()=>m(!0),children:"Agregar proveedor"}),t.jsxs("div",{style:{marginLeft:12,display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{className:"input",placeholder:"Buscar por nombre o RTN...",value:f,onChange:O=>g(O.target.value),style:{width:260}}),t.jsx("button",{className:"btn-opaque",onClick:()=>{g(""),L()},children:"Limpiar"})]}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:r?"Cargando...":`${l.length} proveedores`})]}),c&&t.jsx("div",{style:{color:"red",marginBottom:12},children:c}),t.jsx("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"RTN"}),t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Telfono"}),t.jsx("th",{children:"Correo"}),t.jsx("th",{children:"Direccin"}),t.jsx("th",{children:"Tipo"}),t.jsx("th",{children:"Activo"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:l.map(O=>t.jsxs("tr",{children:[t.jsx("td",{children:O.rtn||""}),t.jsx("td",{style:{minWidth:180},children:O.nombre}),t.jsx("td",{children:O.telefono||""}),t.jsx("td",{children:O.correo||""}),t.jsx("td",{children:O.direccion||""}),t.jsx("td",{children:O.tipo_proveedor||""}),t.jsx("td",{children:O.activo?"S":"No"}),t.jsxs("td",{style:{whiteSpace:"nowrap"},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>{x(O),S(!0)},children:"Editar"}),t.jsx("button",{className:"btn-danger",onClick:()=>{T(O),v(!0)},style:{marginLeft:8},children:"Eliminar"})]})]},O.id))})]})}),t.jsx(Mj,{open:p,onClose:()=>m(!1),onCreate:async O=>{await R(O),m(!1)}}),t.jsx(qj,{open:b,onClose:()=>{S(!1),x(null)},row:j,onSave:async(O,I)=>{await z(O,I),S(!1),x(null)}}),t.jsx(Tn,{open:w,title:E?`Eliminar proveedor ${E.nombre}`:"Eliminar proveedor",message:E?`Confirma eliminar al proveedor ${E.nombre}? Esta accin es irreversible.`:"Confirma eliminar el proveedor?",onClose:async()=>{await C()},onCancel:()=>{v(!1),T(null)},confirmLabel:"Eliminar",cancelLabel:"Cerrar"})]})}function Hj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(""),[p,m]=y.useState(!1),[b,S]=y.useState(null),[j,x]=y.useState(""),[w,v]=y.useState(""),[E,T]=y.useState(""),[L,R]=y.useState(""),[z,C]=y.useState(!1),[O,I]=y.useState(!1),[k,M]=y.useState(null);async function G(A){s(!0),d(null);try{let N;if(A&&A.trim()){const X=`%${A.trim()}%`;N=await F.from("clientes").select("id,nombre,rtn,telefono,correo_electronico,tipo_cliente,exonerado").or(`nombre.ilike.${X},rtn.ilike.${X}`).order("id",{ascending:!1})}else N=await F.from("clientes").select("id,nombre,rtn,telefono,correo_electronico,tipo_cliente,exonerado").order("id",{ascending:!1}).limit(500);if(N.error)throw N.error;i(Array.isArray(N.data)?N.data:[])}catch(N){d(N?.message||String(N)),i([])}finally{s(!1)}}y.useEffect(()=>{G()},[]),y.useEffect(()=>{const A=setTimeout(()=>G(f),300);return()=>clearTimeout(A)},[f]);function K(){S(null),x(""),v(""),T(""),R(""),C(!1),m(!0)}async function ne(){s(!0),d(null);try{const A={nombre:String(w||"").trim(),rtn:j||null,telefono:E||null,correo_electronico:L||null,exonerado:z||!1};if(!A.nombre)throw new Error("El campo nombre es requerido");if(b==null){if(A.rtn){const{data:q,error:X}=await F.from("clientes").select("id").eq("rtn",A.rtn).limit(1);if(X)throw X;if(Array.isArray(q)&&q.length>0)throw new Error(`Ya existe un cliente con RTN ${A.rtn}`)}const{error:N}=await F.from("clientes").insert(A);if(N)throw N}else{const{error:N}=await F.from("clientes").update(A).eq("id",b);if(N)throw N}m(!1),await G()}catch(A){throw d(A?.message||String(A)),A}finally{s(!1)}}function Y(A){S(A.id),x(A.rtn||""),v(A.nombre||""),T(A.telefono||""),R(A.correo_electronico||""),C(!!A.exonerado),m(!0)}async function B(){if(k){s(!0),d(null);try{const{error:A}=await F.from("clientes").delete().eq("id",k.id);if(A)throw A;I(!1),M(null),await G()}catch(A){d(A?.message||String(A))}finally{s(!1)}}}return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Clientes (clientes)"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>G(),children:"Recargar"}),t.jsx("button",{className:"btn-primary",onClick:K,children:"Agregar cliente"}),t.jsxs("div",{style:{marginLeft:12,display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{className:"input",placeholder:"Buscar por nombre o RTN...",value:f,onChange:A=>g(A.target.value),style:{width:260}}),t.jsx("button",{className:"btn-opaque",onClick:()=>{g(""),G()},children:"Limpiar"})]}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:r?"Cargando...":`${l.length} clientes`})]}),c&&t.jsx("div",{style:{color:"red",marginBottom:12},children:c}),t.jsx("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"RTN"}),t.jsx("th",{children:"Nombre"}),t.jsx("th",{children:"Telfono"}),t.jsx("th",{children:"Correo"}),t.jsx("th",{children:"Tipo"}),t.jsx("th",{children:"Exonerado"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:l.map(A=>t.jsxs("tr",{children:[t.jsx("td",{children:A.rtn||""}),t.jsx("td",{style:{minWidth:180},children:A.nombre}),t.jsx("td",{children:A.telefono||""}),t.jsx("td",{children:A.correo_electronico||""}),t.jsx("td",{children:A.tipo_cliente||""}),t.jsx("td",{children:A.exonerado?"S":"No"}),t.jsxs("td",{style:{whiteSpace:"nowrap"},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>Y(A),children:"Editar"}),t.jsx("button",{className:"btn-danger",onClick:()=>{M(A),I(!0)},style:{marginLeft:8},children:"Eliminar"})]})]},String(A.id)))})]})}),t.jsx(_m,{open:p,onClose:()=>{m(!1),S(null)},clienteRTN:j,clienteNombre:w,clienteTelefono:E,clienteCorreo:L,clienteExonerado:z,onChangeRTN:A=>x(A),onChangeNombre:A=>v(A),onChangeTelefono:A=>T(A),onChangeCorreo:A=>R(A),onChangeExonerado:A=>C(A),onCreate:async()=>{await ne()}}),t.jsx(Tn,{open:O,title:k?`Eliminar cliente ${k.nombre}`:"Eliminar cliente",message:k?`Confirma eliminar al cliente ${k.nombre}? Esta accin es irreversible.`:"Confirma eliminar el cliente?",onClose:async()=>{await B()},onCancel:()=>{I(!1),M(null)},confirmLabel:"Eliminar",cancelLabel:"Cerrar"})]})}function Pj({open:l,onClose:i,onCreated:r}){const[s,c]=y.useState([]),[d,f]=y.useState([]),[g,p]=y.useState(0),[m,b]=y.useState(null),[S,j]=y.useState(""),[x,w]=y.useState("factura"),[v,E]=y.useState([]),[T,L]=y.useState(null),[R,z]=y.useState(1),[C,O]=y.useState(null),[I,k]=y.useState(!1),[M,G]=y.useState(null);if(y.useEffect(()=>{l&&(async()=>{try{const q=await F.from("inventario").select("id, nombre, exento").order("nombre",{ascending:!0});c(Array.isArray(q.data)?q.data:[])}catch{}try{const q=await F.from("proveedores").select("id, nombre").order("nombre",{ascending:!0});f(Array.isArray(q.data)?q.data:[])}catch{}try{const q=await F.from("impuesto").select("impuesto_venta").limit(1).order("id",{ascending:!0}),X=Array.isArray(q.data)&&q.data.length>0?q.data[0]:null,ge=X?Number(X.impuesto_venta):0;p(ge)}catch{}})()},[l]),!l)return null;function K(){b(null),j(""),w("factura"),E([]),L(null),z(1),O(null),G(null)}function ne(){if(!T){G("Selecciona un producto");return}if(!C||C<=0){G("Costo unitario invlido");return}if(!R||R<=0){G("Cantidad invlida");return}const q=s.find(ge=>ge.id===T),X=ge=>{if(ge==null)return!1;if(typeof ge=="boolean")return ge===!0;if(typeof ge=="number")return ge===1;const re=String(ge).toLowerCase().trim();return re==="1"||re==="true"||re==="t"||re==="si"||re==="s"||re==="yes"};E(ge=>[...ge,{producto_id:T,nombre:q?.nombre||"",cantidad:R,costo_unitario:C,exento:X(q?.exento)}]),L(null),z(1),O(null),G(null)}function Y(q){E(X=>X.filter((ge,re)=>re!==q))}function B(){const q=g,X=q>1?q/100:q;let ge=0,re=0,U=0;for(const $ of v){const H=$.cantidad*$.costo_unitario;let Z=0,ee=H;$.exento||(Z=H*X,ee=H-Z),ge+=ee,re+=Z,U+=H}return{subtotal:ge,impuesto:re,total:U}}async function A(){if(G(null),!m){G("Selecciona un proveedor");return}if(v.length===0){G("Agrega al menos un producto");return}k(!0);try{const{subtotal:q,impuesto:X,total:ge}=B(),re={proveedor_id:m,numero_documento:S||null,tipo_documento:x||null,subtotal:q,impuesto:X,total:ge,usuario:null},U=await F.from("compras").insert(re).select("id").single();if(U.error)throw U.error;const $=U.data.id,H=v.map(ee=>({compra_id:$,producto_id:ee.producto_id,cantidad:ee.cantidad,costo_unitario:ee.costo_unitario})),Z=await F.from("compras_detalle").insert(H);if(Z.error)throw await F.from("compras").delete().eq("id",$),Z.error;try{const ee=S?`Compra - ${S}`:`Compra ${$}`;let oe="sistema";try{const ae=localStorage.getItem("user");if(ae){const V=JSON.parse(ae);oe=V.username?`${V.username}${V.role?` (${V.role})`:""}`:String(V)}}catch{}const P=Ga(),Se=v.map(ae=>({producto_id:ae.producto_id,cantidad:ae.cantidad,tipo_de_movimiento:"ENTRADA",referencia:ee,usuario:oe,fecha_salida:P})),J=await F.from("registro_de_inventario").insert(Se);J.error&&(console.warn("Error registrando en registro_de_inventario",J.error),G("Compra guardada, pero fall el registro en inventario: "+J.error.message))}catch(ee){console.warn("Registro inventario fallo",ee)}K(),i(),r&&r()}catch(q){G(q?.message||String(q))}finally{k(!1)}}const N=B();return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:900,maxWidth:"98%",background:"#fff",borderRadius:8,padding:16,maxHeight:"90vh",overflow:"auto"},children:[t.jsx("h3",{style:{marginTop:0},children:"Nueva compra"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Proveedor"}),t.jsxs("select",{className:"input",value:m??"",onChange:q=>b(q.target.value||null),children:[t.jsx("option",{value:"",children:"-- seleccionar proveedor --"}),d.map(q=>t.jsx("option",{value:q.id,children:q.nombre},String(q.id)))]}),t.jsx("label",{style:{fontSize:13,marginTop:8},children:"Nmero documento"}),t.jsx("input",{className:"input",value:S,onChange:q=>j(q.target.value)}),t.jsx("label",{style:{fontSize:13,marginTop:8},children:"Tipo documento"}),t.jsx("input",{className:"input",value:x,onChange:q=>w(q.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Agregar producto"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("select",{className:"input",value:T??"",onChange:q=>L(q.target.value||null),children:[t.jsx("option",{value:"",children:"-- seleccionar producto --"}),s.map(q=>t.jsx("option",{value:q.id,children:q.nombre},q.id))]}),t.jsx("input",{className:"input",type:"number",style:{width:90},value:R,onChange:q=>z(Number(q.target.value))}),t.jsx("input",{className:"input",type:"number",style:{width:120},value:C??"",onChange:q=>O(Number(q.target.value)),placeholder:"Costo unitario"}),t.jsx("button",{className:"btn-primary",onClick:ne,children:"Agregar"})]}),t.jsx("div",{style:{marginTop:12},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Costo unit."}),t.jsx("th",{children:"Impuesto"}),t.jsx("th",{children:"Subtotal"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:v.map((q,X)=>{const ge=q.cantidad*q.costo_unitario,re=g>1?g/100:g,U=q.exento?0:ge*re,$=q.exento?ge:ge-U;return t.jsxs("tr",{children:[t.jsx("td",{children:q.nombre}),t.jsx("td",{children:q.cantidad}),t.jsx("td",{children:q.costo_unitario.toFixed(2)}),t.jsx("td",{children:U.toFixed(2)}),t.jsx("td",{children:$.toFixed(2)}),t.jsx("td",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>Y(X),children:"Quitar"})})]},`${q.producto_id}-${X}`)})})]})})]})]}),t.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:12},children:t.jsxs("div",{style:{textAlign:"right"},children:[t.jsxs("div",{children:["Subtotal: ",t.jsx("strong",{children:N.subtotal.toFixed(2)})]}),t.jsxs("div",{children:["Impuesto: ",t.jsx("strong",{children:N.impuesto.toFixed(2)})]}),t.jsxs("div",{children:["Total: ",t.jsx("strong",{children:N.total.toFixed(2)})]})]})}),M&&t.jsx("div",{style:{color:"red",marginTop:12},children:M}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>{K(),i()},disabled:I,children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:A,disabled:I,children:I?"Guardando...":"Confirmar compra"})]})]})})}function Fj({open:l,compraId:i,onClose:r}){const[s,c]=y.useState([]),[d,f]=y.useState({}),[g,p]=y.useState({}),[m,b]=y.useState(0),[S,j]=y.useState(!1);return y.useEffect(()=>{if(!l||i==null)return;let x=!0;return(async()=>{j(!0);try{const{data:w,error:v}=await F.from("compras_detalle").select("id, compra_id, producto_id, cantidad, costo_unitario, subtotal").eq("compra_id",i);if(v)throw v;const E=Array.isArray(w)?w:[];if(!x)return;c(E);const T=Array.from(new Set(E.map(L=>L.producto_id))).filter(Boolean);if(T.length>0){const{data:L}=await F.from("inventario").select("id, nombre, exento").in("id",T),R={},z={};Array.isArray(L)&&L.forEach(C=>{R[String(C.id)]={id:C.id,nombre:C.nombre},z[String(C.id)]=C.exento===!0||C.exento===1||String(C.exento).toLowerCase()==="true"}),x&&(f(R),p(z))}else f({});try{const{data:L}=await F.from("impuesto").select("impuesto_venta").limit(1).order("id",{ascending:!0}),R=Array.isArray(L)&&L.length>0?L[0]:null,z=R?Number(R.impuesto_venta):0;x&&b(z)}catch{}}catch(w){console.error("Error cargando detalle de compra",w)}finally{x&&j(!1)}})(),()=>{x=!1}},[l,i]),l?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:760,maxWidth:"98%",background:"#fff",borderRadius:8,padding:16,maxHeight:"90vh",overflow:"auto"},children:[t.jsxs("h3",{style:{marginTop:0},children:["Detalle de compra ",i]}),t.jsx("div",{style:{marginTop:8},children:S?t.jsx("div",{children:"Cargando..."}):t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Costo unit."}),t.jsx("th",{children:"Impuesto"}),t.jsx("th",{children:"Subtotal"}),t.jsx("th",{children:"Total"})]})}),t.jsx("tbody",{children:s.map(x=>{const w=Number(x.cantidad),v=Number(x.costo_unitario),E=w*v,T=m>1?m/100:m,L=g[String(x.producto_id)]===!0,R=L?0:E*T,z=L?E:E-R;return t.jsxs("tr",{children:[t.jsx("td",{children:d[String(x.producto_id)]?d[String(x.producto_id)].nombre:String(x.producto_id)}),t.jsx("td",{children:w.toFixed(2)}),t.jsx("td",{children:v.toFixed(2)}),t.jsx("td",{children:R.toFixed(2)}),t.jsx("td",{children:z.toFixed(2)}),t.jsx("td",{children:E.toFixed(2)})]},String(x.id))})}),t.jsx("tfoot",{children:s.length>0&&(()=>{const x=s.reduce((w,v)=>{const E=Number(v.cantidad),T=Number(v.costo_unitario),L=E*T,R=m>1?m/100:m,z=g[String(v.producto_id)]===!0,C=z?0:L*R,O=z?L:L-C;return w.subtotal+=O,w.impuesto+=C,w.total+=L,w},{subtotal:0,impuesto:0,total:0});return t.jsxs("tr",{children:[t.jsx("td",{colSpan:3,style:{textAlign:"right"},children:"Totales:"}),t.jsx("td",{children:x.impuesto.toFixed(2)}),t.jsx("td",{children:x.subtotal.toFixed(2)}),t.jsx("td",{children:x.total.toFixed(2)})]})})()})]})}),t.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:t.jsx("button",{className:"btn-opaque",onClick:r,children:"Cerrar"})})]})}):null}function Vj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(!1),[p,m]=y.useState(!1),[b,S]=y.useState(null),[j,x]=y.useState([]),[w,v]=y.useState(""),[E,T]=y.useState(""),[L,R]=y.useState(!1);async function z(){s(!0),d(null);try{let C=F.from("compras").select("id, proveedor_id, numero_documento, fecha_compra, subtotal, impuesto, total");if(w){const k=Number(w);isNaN(k)?C=C.eq("proveedor_id",w):C=C.eq("proveedor_id",k)}if(E&&(C=C.ilike("numero_documento",`%${E}%`)),L){const k=new Date(Date.now()-864e5).toISOString();C=C.gte("fecha_compra",k)}const{data:O,error:I}=await C.order("id",{ascending:!1});if(I)throw I;i(Array.isArray(O)?O:[])}catch(C){d(C?.message||String(C)),i([])}finally{s(!1)}}return y.useEffect(()=>{z()},[]),y.useEffect(()=>{let C=!0;return(async()=>{try{const{data:O}=await F.from("proveedores").select("id, nombre").order("nombre",{ascending:!0});if(!C)return;x(Array.isArray(O)?O:[])}catch{}})(),()=>{C=!1}},[]),t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Compras (compras)"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12},children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("select",{className:"input",value:w,onChange:C=>v(C.target.value),children:[t.jsx("option",{value:"",children:"-- proveedor (todos) --"}),j.map(C=>t.jsx("option",{value:String(C.id),children:C.nombre},String(C.id)))]}),t.jsx("input",{className:"input",placeholder:"Nmero documento",value:E,onChange:C=>T(C.target.value)}),t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:L,onChange:C=>R(C.target.checked)})," ltimas 24h"]}),t.jsx("button",{className:"btn-opaque",onClick:()=>z(),children:"Aplicar"}),t.jsx("button",{className:"btn-opaque",onClick:()=>{v(""),T(""),R(!1),z()},children:"Limpiar"})]}),t.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[t.jsx("button",{className:"btn-opaque",onClick:()=>z(),children:"Recargar"}),t.jsx("button",{className:"btn-primary",onClick:()=>g(!0),children:"Nueva compra"}),t.jsx("div",{style:{marginLeft:12,color:"#64748b"},children:r?"Cargando...":`${l.length} compras`})]})]}),c&&t.jsx("div",{style:{color:"red",marginBottom:12},children:c}),t.jsx("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"Proveedor"}),t.jsx("th",{children:"Documento"}),t.jsx("th",{children:"Fecha"}),t.jsx("th",{children:"Subtotal"}),t.jsx("th",{children:"Impuesto"}),t.jsx("th",{children:"Total"})]})}),t.jsx("tbody",{children:l.map(C=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:80},children:String(C.id)}),t.jsx("td",{children:String(C.proveedor_id)}),t.jsx("td",{children:C.numero_documento||""}),t.jsx("td",{children:C.fecha_compra||""}),t.jsx("td",{children:C.subtotal||""}),t.jsx("td",{children:C.impuesto||""}),t.jsx("td",{children:C.total||""}),t.jsx("td",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>{S(C.id),m(!0)},children:"Detalle"})})]},String(C.id)))})]})}),t.jsx(Pj,{open:f,onClose:()=>g(!1),onCreated:()=>{g(!1),z()}}),t.jsx(Fj,{open:p,compraId:b,onClose:()=>{m(!1),S(null)}})]})}function Wj(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(!1),[p,m]=y.useState(null);async function b(){s(!0),d(null);try{const{data:S,error:j}=await F.from("devoluciones_proveedores").select("id, proveedor_id, numero_documento, usuario, created_at").order("created_at",{ascending:!1});if(j)throw j;i(Array.isArray(S)?S.map(x=>({id:x.id,proveedor_id:x.proveedor_id,numero_documento:x.numero_documento,usuario:x.usuario,fecha:x.created_at})):[])}catch(S){d(S?.message||String(S)),i([])}finally{s(!1)}}return y.useEffect(()=>{b()},[]),t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Devolucin a Proveedores"}),t.jsx("p",{style:{color:"#475569"},children:"Registra devoluciones de productos hacia proveedores. Este proceso crear un registro de devolucin y registrar la salida en `registro_de_inventario`."}),t.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[t.jsx("button",{className:"btn-primary",onClick:()=>g(!0),children:"Nueva devolucin"}),t.jsx("div",{style:{marginLeft:"auto",color:"#64748b"},children:r?"Cargando...":`${l.length} devoluciones`})]}),c&&t.jsx("div",{style:{color:"red",marginBottom:12},children:c}),t.jsx("div",{style:{background:"#fff",padding:12,borderRadius:8,overflowX:"auto"},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"ID"}),t.jsx("th",{children:"Proveedor"}),t.jsx("th",{children:"Documento"}),t.jsx("th",{children:"Usuario"}),t.jsx("th",{children:"Fecha"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:l.map(S=>t.jsxs("tr",{children:[t.jsx("td",{style:{width:80},children:String(S.id)}),t.jsx("td",{children:String(S.proveedor_id||"")}),t.jsx("td",{children:S.numero_documento||""}),t.jsx("td",{children:S.usuario||""}),t.jsx("td",{children:S.fecha||""}),t.jsx("td",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>m(S.id),children:"Detalle"})})]},String(S.id)))})]})}),f&&t.jsx(Gj,{onClose:()=>{g(!1),b()}}),p&&t.jsx(Yj,{id:p,onClose:()=>{m(null),b()}})]})}function Gj({onClose:l}){const[i,r]=y.useState([]),[s,c]=y.useState([]),[d,f]=y.useState(null),[g,p]=y.useState([]),[m,b]=y.useState(null),[S,j]=y.useState(null),[x,w]=y.useState(""),[v,E]=y.useState([]),[T,L]=y.useState(null),[R,z]=y.useState(1),[C,O]=y.useState(!1),[I,k]=y.useState(null);y.useEffect(()=>{(async()=>{try{const Y=await F.from("proveedores").select("id, nombre").order("nombre",{ascending:!0});r(Array.isArray(Y.data)?Y.data:[])}catch{}try{const Y=await F.from("inventario").select("id, nombre, sku").order("nombre",{ascending:!0});c(Array.isArray(Y.data)?Y.data:[])}catch{}})()},[]);async function M(){if(x){k(null);try{const{data:Y,error:B}=await F.from("compras").select("id, proveedor_id, numero_documento").eq("numero_documento",x).limit(1).single();if(B)throw B;if(!Y){k("No se encontr compra con ese nmero de documento");return}f(Y.id),b(Y.proveedor_id);try{const{data:Z}=await F.from("proveedores").select("id, nombre").eq("id",Y.proveedor_id).limit(1).single();Z&&Z.nombre&&j(Z.nombre)}catch{}const{data:A}=await F.from("compras_detalle").select("producto_id, cantidad, costo_unitario").eq("compra_id",Y.id),N=Array.isArray(A)?A:[],{data:q}=await F.from("devoluciones_proveedores").select("id").eq("numero_documento",x),X=Array.isArray(q)?q.map(Z=>Z.id):[];let ge={};if(X.length>0){const{data:Z}=await F.from("devoluciones_proveedores_detalle").select("producto_id, cantidad").in("devolucion_id",X);Array.isArray(Z)&&Z.forEach(ee=>{const oe=String(ee.producto_id);ge[oe]=(ge[oe]||0)+Number(ee.cantidad)})}const re=N.map(Z=>Z.producto_id),{data:U}=await F.from("inventario").select("id, nombre, sku").in("id",re),$={};Array.isArray(U)&&U.forEach(Z=>{$[String(Z.id)]=Z});const H=N.map(Z=>{const ee=String(Z.producto_id),oe=Number(Z.cantidad),P=ge[ee]||0,Se=Math.max(0,oe-P);return{producto_id:ee,nombre:$[ee]?.nombre||ee,sku:$[ee]?.sku,purchased:oe,returned:P,available:Se,costo_unitario:Number(Z.costo_unitario||0)}});p(H),c(H.map(Z=>({id:Z.producto_id,nombre:Z.nombre,sku:Z.sku})))}catch(Y){k(Y?.message||String(Y))}}}function G(){if(!T){k("Selecciona un producto");return}if(!R||R<=0){k("Cantidad invlida");return}const Y=s.find(A=>A.id===T),B=g.find(A=>A.producto_id===T);if(B&&R>B.available){k(`Cantidad excede disponible para devolucin (${B.available})`);return}E(A=>[...A,{producto_id:T,nombre:Y?.nombre,cantidad:R}]),L(null),z(1),k(null),B&&(p(A=>A.map(N=>N.producto_id===B.producto_id?{...N,available:Math.max(0,N.available-R)}:N)),c(A=>A.map(N=>(N.id===B.producto_id,N))))}function K(Y){E(B=>B.filter((A,N)=>N!==Y))}async function ne(){if(k(null),!m){k("Selecciona un proveedor");return}if(v.length===0){k("Agrega al menos un producto");return}O(!0);try{const Y={proveedor_id:m,numero_documento:x||null,usuario:null},B=await F.from("devoluciones_proveedores").insert(Y).select("id").single();if(B.error)throw B.error;const A=B.data.id;try{const N=v.map(X=>({devolucion_id:A,producto_id:X.producto_id,cantidad:X.cantidad})),q=await F.from("devoluciones_proveedores_detalle").insert(N);q.error&&console.warn("No se pudo insertar detalles de devolucin",q.error)}catch(N){console.warn("Detalles tabla puede no existir",N)}try{const N=x?`Devolucin - ${x}`:`Devolucin ${A}`;let q="sistema";try{const U=localStorage.getItem("user");if(U){const $=JSON.parse(U);q=$.username?`${$.username}${$.role?` (${$.role})`:""}`:String($)}}catch{}const X=Ga(),ge=v.map(U=>({producto_id:U.producto_id,cantidad:U.cantidad,tipo_de_movimiento:"SALIDA",referencia:N,usuario:q,fecha_salida:X})),re=await F.from("registro_de_inventario").insert(ge);re.error&&(console.warn("Error registrando en registro_de_inventario",re.error),k("Devolucin guardada, pero fall el registro en inventario: "+re.error.message))}catch(N){console.warn("Registro inventario fallo",N)}l()}catch(Y){k(Y?.message||String(Y))}finally{O(!1)}}return t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:900,maxWidth:"98%",background:"#fff",borderRadius:8,padding:16,maxHeight:"90vh",overflow:"auto"},children:[t.jsx("h3",{style:{marginTop:0},children:"Nueva devolucin a proveedor"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Proveedor"}),d?t.jsx("div",{style:{padding:8,background:"#f1f5f9",borderRadius:6},children:S||String(m||"")}):t.jsxs("select",{className:"input",value:m??"",onChange:Y=>b(Y.target.value||null),children:[t.jsx("option",{value:"",children:"-- seleccionar proveedor --"}),i.map(Y=>t.jsx("option",{value:Y.id,children:Y.nombre},String(Y.id)))]}),t.jsx("label",{style:{fontSize:13,marginTop:8},children:"Nmero documento / referencia"}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("input",{className:"input",value:x,onChange:Y=>w(Y.target.value)}),t.jsx("button",{className:"btn-opaque",onClick:()=>M(),children:"Buscar compra"})]}),d&&t.jsxs("div",{style:{marginTop:8,color:"#374151"},children:["Compra encontrada: #",d,"  proveedor seleccionado automticamente."]}),g&&g.length>0&&t.jsxs("div",{style:{marginTop:8,background:"#f8fafc",padding:8,borderRadius:6},children:[t.jsxs("div",{style:{fontSize:13,marginBottom:6},children:[t.jsx("strong",{children:"Productos en la compra"})," (disponible para devolucin)"]}),t.jsxs("table",{className:"admin-table",style:{width:"100%"},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Comprado"}),t.jsx("th",{children:"Devuelto"}),t.jsx("th",{children:"Disponible"}),t.jsx("th",{})]})}),t.jsx("tbody",{children:g.map(Y=>t.jsxs("tr",{children:[t.jsx("td",{children:Y.nombre}),t.jsx("td",{style:{textAlign:"right"},children:Number(Y.purchased).toFixed(2)}),t.jsx("td",{style:{textAlign:"right"},children:Number(Y.returned).toFixed(2)}),t.jsx("td",{style:{textAlign:"right"},children:Number(Y.available).toFixed(2)}),t.jsx("td",{style:{textAlign:"right"},children:t.jsx("button",{className:"btn-opaque",onClick:()=>{L(Y.producto_id),z(Y.available||1)},children:"Usar"})})]},Y.producto_id))})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:13},children:"Agregar producto a devolver"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsxs("select",{className:"input",value:T??"",onChange:Y=>L(Y.target.value||null),disabled:!!d,children:[t.jsx("option",{value:"",children:"-- seleccionar producto --"}),s.map(Y=>t.jsx("option",{value:Y.id,children:Y.nombre},Y.id))]}),t.jsx("input",{className:"input",type:"number",style:{width:90},value:R,onChange:Y=>{const B=Number(Y.target.value),A=g.find(N=>N.producto_id===T);if(A){const N=Number(A.available||0);return isNaN(B)||B<1?z(1):B>N?z(N):z(B)}z(B)},min:1,max:T?g.find(Y=>Y.producto_id===T)?.available??void 0:void 0,disabled:(()=>{const Y=g.find(B=>B.producto_id===T);return!!Y&&Number(Y.available||0)<=1})()}),t.jsx("button",{className:"btn-primary",onClick:G,children:"Agregar"})]}),t.jsx("div",{style:{marginTop:12},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cantidad"}),t.jsx("th",{children:"Acciones"})]})}),t.jsx("tbody",{children:v.map((Y,B)=>t.jsxs("tr",{children:[t.jsx("td",{children:Y.nombre}),t.jsx("td",{style:{textAlign:"right"},children:Y.cantidad}),t.jsx("td",{children:t.jsx("button",{className:"btn-opaque",onClick:()=>K(B),children:"Quitar"})})]},`${Y.producto_id}-${B}`))})]})})]})]}),I&&t.jsx("div",{style:{color:"red",marginTop:12},children:I}),t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:16},children:[t.jsx("button",{className:"btn-opaque",onClick:l,disabled:C,children:"Cancelar"}),t.jsx("button",{className:"btn-primary",onClick:ne,disabled:C,children:C?"Guardando...":"Registrar devolucin"})]})]})})}function Yj({id:l,onClose:i}){const[r,s]=y.useState([]),[c,d]=y.useState(!1),[f,g]=y.useState(null);async function p(){d(!0),g(null);try{const{data:m,error:b}=await F.from("devoluciones_proveedores_detalle").select("producto_id, cantidad").eq("devolucion_id",l);if(b)throw b;const S=Array.isArray(m)?m:[];if(S.length>0){const j=S.map(v=>v.producto_id),{data:x}=await F.from("inventario").select("id, nombre, sku").in("id",j),w={};Array.isArray(x)&&x.forEach(v=>{w[String(v.id)]=v}),s(S.map(v=>({producto:w[String(v.producto_id)]?.nombre||String(v.producto_id),cantidad:v.cantidad})))}else{const{data:j}=await F.from("registro_de_inventario").select("producto_id, cantidad").like("referencia",`%${l}%`),x=Array.isArray(j)?j:[],w=x.map(T=>T.producto_id),{data:v}=await F.from("inventario").select("id, nombre, sku").in("id",w),E={};Array.isArray(v)&&v.forEach(T=>{E[String(T.id)]=T}),s(x.map(T=>({producto:E[String(T.producto_id)]?.nombre||String(T.producto_id),cantidad:T.cantidad})))}}catch(m){g(m?.message||String(m)),s([])}finally{d(!1)}}return y.useEffect(()=>{p()},[l]),t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},children:t.jsxs("div",{style:{width:720,maxWidth:"98%",background:"#fff",borderRadius:8,padding:16,maxHeight:"80vh",overflow:"auto"},children:[t.jsxs("h3",{style:{marginTop:0},children:["Detalle devolucin #",String(l)]}),c&&t.jsx("div",{children:"Cargando..."}),f&&t.jsx("div",{style:{color:"red"},children:f}),t.jsxs("table",{className:"admin-table",style:{marginTop:8},children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Producto"}),t.jsx("th",{children:"Cantidad"})]})}),t.jsx("tbody",{children:r.map((m,b)=>t.jsxs("tr",{children:[t.jsx("td",{children:m.producto}),t.jsx("td",{style:{textAlign:"right"},children:Number(m.cantidad).toFixed(2)})]},b))})]}),t.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:t.jsx("button",{className:"btn-opaque",onClick:i,children:"Cerrar"})})]})})}const Kj=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Jj=l=>l.replace(/^([A-Z])|[\s-_]+(\w)/g,(i,r,s)=>s?s.toUpperCase():r.toLowerCase()),_g=l=>{const i=Jj(l);return i.charAt(0).toUpperCase()+i.slice(1)},Tm=(...l)=>l.filter((i,r,s)=>!!i&&i.trim()!==""&&s.indexOf(i)===r).join(" ").trim(),Qj=l=>{for(const i in l)if(i.startsWith("aria-")||i==="role"||i==="title")return!0};var Xj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Zj=y.forwardRef(({color:l="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:f,...g},p)=>y.createElement("svg",{ref:p,...Xj,width:i,height:i,stroke:l,strokeWidth:s?Number(r)*24/Number(i):r,className:Tm("lucide",c),...!d&&!Qj(g)&&{"aria-hidden":"true"},...g},[...f.map(([m,b])=>y.createElement(m,b)),...Array.isArray(d)?d:[d]]));const su=(l,i)=>{const r=y.forwardRef(({className:s,...c},d)=>y.createElement(Zj,{ref:d,iconNode:i,className:Tm(`lucide-${Kj(_g(l))}`,`lucide-${l}`,s),...c}));return r.displayName=_g(l),r};const e1=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],t1=su("check",e1);const n1=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],a1=su("square-pen",n1);const i1=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],r1=su("x",i1),o1={1:"Impuesto de venta",2:"Impuesto 18%",3:"Impuesto turstico"};function s1(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(null),[f,g]=y.useState(null),[p,m]=y.useState(""),[b,S]=y.useState(null),[j,x]=y.useState(null),w=async()=>{s(!0),S(null);try{const{data:L,error:R}=await F.from("impuesto").select("id, impuesto_venta").order("id",{ascending:!0});if(R)throw R;i(Array.isArray(L)?L:[])}catch(L){console.warn("Error cargando impuestos:",L),S(String(L.message||L))}finally{s(!1)}};y.useEffect(()=>{w()},[]);const v=L=>{g(L.id),m(L.impuesto_venta||""),S(null),x(null)},E=()=>{g(null),m(""),S(null)},T=async L=>{const R=parseFloat(p);if(isNaN(R)||R<0){S("Por favor ingrese un valor numrico vlido (ej. 0.15)");return}d(L),S(null),x(null);try{const z={impuesto_venta:p},{error:C}=await F.from("impuesto").update(z).eq("id",L);if(C)throw C;x("Impuesto actualizado correctamente"),g(null),await w(),setTimeout(()=>x(null),3e3)}catch(z){console.warn("Error guardando impuesto:",z),S(String(z.message||z))}finally{d(null)}};return t.jsxs("div",{style:{padding:20},children:[t.jsx("h2",{style:{fontSize:24,fontWeight:700,marginBottom:8},children:"Impuestos"}),t.jsx("p",{style:{color:"#64748b",marginBottom:24},children:"Administre los porcentajes de impuestos del sistema."}),b&&t.jsx("div",{style:{marginBottom:16,padding:"10px 14px",background:"#fef2f2",color:"#b91c1c",borderRadius:6,border:"1px solid #fecaca"},children:b}),j&&t.jsx("div",{style:{marginBottom:16,padding:"10px 14px",background:"#f0fdf4",color:"#15803d",borderRadius:6,border:"1px solid #bbf7d0"},children:j}),r?t.jsx("div",{style:{color:"#64748b"},children:"Cargando datos..."}):t.jsx("div",{style:{overflowX:"auto",background:"white",borderRadius:8,boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:t.jsxs("table",{className:"admin-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:80},children:"ID"}),t.jsx("th",{children:"Descripcin"}),t.jsx("th",{style:{width:200},children:"Valor (Decimal)"}),t.jsx("th",{style:{width:120,textAlign:"right"},children:"Acciones"})]})}),t.jsxs("tbody",{children:[l.map(L=>{const R=f===L.id,z=c===L.id;return t.jsxs("tr",{children:[t.jsx("td",{style:{color:"#64748b"},children:L.id}),t.jsx("td",{style:{fontWeight:500},children:o1[L.id]??`Impuesto Desconocido #${L.id}`}),t.jsx("td",{children:R?t.jsx("input",{type:"text",value:p,onChange:C=>m(C.target.value),className:"input",style:{padding:"6px 10px",width:"100%",maxWidth:150},placeholder:"0.00",autoFocus:!0,disabled:z,onKeyDown:C=>{C.key==="Enter"&&T(L.id),C.key==="Escape"&&E()}}):t.jsx("span",{style:{fontFamily:"monospace",fontSize:14},children:L.impuesto_venta??"-"})}),t.jsx("td",{style:{textAlign:"right"},children:t.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:R?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:E,className:"btn-opaque",style:{background:"#f1f5f9",color:"#475569",padding:6},title:"Cancelar",disabled:z,children:t.jsx(r1,{size:16})}),t.jsx("button",{onClick:()=>T(L.id),className:"btn-primary",style:{padding:6},title:"Guardar",disabled:z,children:z?t.jsx("span",{style:{fontSize:12},children:"..."}):t.jsx(t1,{size:16})})]}):t.jsx("button",{onClick:()=>v(L),className:"btn-opaque",style:{background:"transparent",color:"#64748b",padding:6,border:"1px solid #e2e8f0"},title:"Editar",children:t.jsx(a1,{size:16})})})})]},L.id)}),l.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:4,style:{textAlign:"center",padding:24,color:"#94a3b8"},children:"No se encontraron registros de impuestos."})})]})]})})]})}function l1(){const[l,i]=y.useState([]),[r,s]=y.useState([]),[c,d]=y.useState(""),[f,g]=y.useState(1),[p,m]=y.useState("ENTRADA"),[b,S]=y.useState(""),[j,x]=y.useState(!1),[w,v]=y.useState(null),E=async()=>{try{const{data:C,error:O}=await F.from("inventario").select("id, nombre, sku, categoria").not("categoria","ilike","%servicios%").order("nombre",{ascending:!0});if(O)throw O;i(Array.isArray(C)?C:[])}catch(C){console.error("Error loading productos",C),i([])}},T=async()=>{try{const{data:C,error:O}=await F.from("registro_de_inventario").select("*").order("fecha_salida",{ascending:!1}).limit(100);if(O)throw O;const I=Array.isArray(C)?C:[],k=Array.from(new Set(I.map(M=>String(M.producto_id)))).filter(Boolean);if(k.length>0){const{data:M}=await F.from("inventario").select("id").in("id",k).not("categoria","ilike","%servicios%"),G=new Set(Array.isArray(M)?M.map(K=>String(K.id)):[]);s(I.filter(K=>G.has(String(K.producto_id))))}else s([])}catch(C){console.error("Error loading movimientos",C),s([])}};y.useEffect(()=>{E(),T()},[]);const L=()=>{try{const C=localStorage.getItem("user"),O=C?JSON.parse(C):null;return O&&(O.username||O.user?.username||O.name||O.user?.name)||"sistema"}catch{return"sistema"}},R=async C=>{if(C.preventDefault(),!c){v("Seleccione un producto");return}if(!f||f<=0){v("Ingrese una cantidad vlida");return}x(!0),v(null);try{const O=L(),I={producto_id:c,cantidad:f,tipo_de_movimiento:p,referencia:b||`${p} manual desde admin`,usuario:O,fecha_salida:new Date().toISOString()},{data:k,error:M}=await F.from("registro_de_inventario").insert([I]);if(M)throw M;v("Movimiento registrado correctamente"),g(1),S(""),d(""),await T()}catch(O){console.error("Error inserting movimiento",O),v("Error al registrar movimiento: "+(O.message||String(O)))}finally{x(!1)}},z=l.reduce((C,O)=>(C[String(O.id)]=O.nombre||`#${O.id}`,C),{});return t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{marginTop:0},children:"Registro de producto"}),t.jsxs("div",{style:{display:"flex",gap:20},children:[t.jsxs("form",{onSubmit:R,style:{width:380,background:"white",padding:16,borderRadius:8},children:[t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Producto"}),t.jsxs("select",{className:"input",value:String(c),onChange:C=>d(C.target.value),children:[t.jsx("option",{value:"",children:"-- Seleccione --"}),l.map(C=>t.jsxs("option",{value:C.id,children:[C.nombre," ",C.sku?`(${C.sku})`:""]},C.id))]})]}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Tipo"}),t.jsxs("select",{className:"input",value:p,onChange:C=>m(C.target.value),children:[t.jsx("option",{value:"ENTRADA",children:"ENTRADA"}),t.jsx("option",{value:"SALIDA",children:"SALIDA"})]})]}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Cantidad"}),t.jsx("input",{className:"input",type:"number",min:1,value:f,onChange:C=>g(Number(C.target.value))})]}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("label",{style:{display:"block",fontSize:12,color:"#475569"},children:"Referencia"}),t.jsx("input",{className:"input",value:b,onChange:C=>S(C.target.value),placeholder:"Opcional"})]}),t.jsx("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:t.jsx("button",{type:"submit",className:"btn-primary",disabled:j,children:j?"Guardando...":"Registrar"})}),w&&t.jsx("div",{style:{marginTop:12,color:w.startsWith("Error")?"#ef4444":"#10b981"},children:w})]}),t.jsx("div",{style:{flex:1},children:t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8},children:[t.jsx("h3",{style:{marginTop:0},children:"ltimos movimientos"}),t.jsxs("div",{style:{maxHeight:480,overflow:"auto"},children:[t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[t.jsx("th",{style:{padding:8},children:"Fecha"}),t.jsx("th",{style:{padding:8},children:"Producto"}),t.jsx("th",{style:{padding:8,textAlign:"right"},children:"Cantidad"}),t.jsx("th",{style:{padding:8},children:"Tipo"}),t.jsx("th",{style:{padding:8},children:"Referencia"}),t.jsx("th",{style:{padding:8},children:"Usuario"})]})}),t.jsx("tbody",{children:r.map(C=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:8},children:C.fecha_salida?new Date(C.fecha_salida).toLocaleString():"-"}),t.jsx("td",{style:{padding:8},children:z[String(C.producto_id)]||String(C.producto_id)}),t.jsx("td",{style:{padding:8,textAlign:"right"},children:C.cantidad}),t.jsx("td",{style:{padding:8},children:C.tipo_de_movimiento}),t.jsx("td",{style:{padding:8},children:C.referencia}),t.jsx("td",{style:{padding:8},children:C.usuario})]},C.id))})]}),r.length===0&&t.jsx("div",{style:{padding:16,color:"#94a3b8"},children:"No hay movimientos registrados."})]})]})})]})]})}function c1(){const[l,i]=y.useState([]),[r,s]=y.useState(!1),[c,d]=y.useState(""),[f,g]=y.useState(""),[p,m]=y.useState(""),[b,S]=y.useState(!1),[j,x]=y.useState(null),[w,v]=y.useState([]),E=async()=>{s(!0);try{let k=F.from("cotizaciones").select("*").order("fecha_cotizacion",{ascending:!1});if(c){const B=new Date(c+"T00:00:00").toISOString();k=k.gte("fecha_cotizacion",B)}if(f){const B=new Date(f+"T23:59:59").toISOString();k=k.lte("fecha_cotizacion",B)}const{data:M,error:G}=await k;if(G)throw G;let K=Array.isArray(M)?M:[];const ne=Array.from(new Set(K.map(B=>B.cliente_id).filter(Boolean)));let Y={};if(ne.length>0)try{const{data:B}=await F.from("clientes").select("id,nombre").in("id",ne);if(Array.isArray(B))for(const A of B)Y[String(A.id)]=A.nombre||""}catch(B){console.warn("Error cargando nombres de clientes para cotizaciones",B)}if(K=K.map(B=>({...B,cliente_nombre:Y[String(B.cliente_id)]||B.cliente_nombre||null})),p&&p.trim()!==""){const B=p.trim().toLowerCase();K=K.filter(A=>{const N=(A.numero_cotizacion||A.numero||A.id||"")+"",q=(A.cliente_nombre||A.cliente||"")+"",X=(A.observaciones||A.nota||"")+"";return(N+" "+q+" "+X).toLowerCase().includes(B)})}i(K)}catch(k){console.error("Error loading cotizaciones",k),i([])}finally{s(!1)}},T=async k=>{x(k),S(!0);try{const{data:M,error:G}=await F.from("cotizaciones_detalle").select("*").eq("cotizacion_id",k.id).order("id",{ascending:!0});if(G)throw G;v(Array.isArray(M)?M:[])}catch(M){console.error("Error loading cotizaciones_detalle",M),v([])}};async function L(k){return new Promise(M=>{try{const G=document.createElement("iframe");G.style.position="fixed",G.style.right="0",G.style.bottom="0",G.style.width="0",G.style.height="0",G.style.border="0",document.body.appendChild(G);const K=G.contentWindow?.document;if(!K){M();return}K.open(),K.write(k),K.close();const ne=G.contentWindow;setTimeout(()=>{try{ne.focus(),ne.print()}catch(Y){console.debug("print error",Y)}setTimeout(()=>{try{document.body.removeChild(G)}catch{}M()},500)},500)}catch(G){console.debug("printHtmlInHiddenIframe exception",G),M()}})}const R=async()=>{if(j)try{let k=w;if(!k||k.length===0){const{data:B,error:A}=await F.from("cotizaciones_detalle").select("*").eq("cotizacion_id",j.id);!A&&Array.isArray(B)&&(k=B)}const M=(k||[]).map(B=>{const A=B.producto_nombre||B.producto&&(B.producto.nombre||B.producto)||B.nombre||"",N=B.descripcion||B.producto_descripcion||B.producto&&B.producto.descripcion||"",q=B.sku||B.producto&&B.producto.sku||"",X=Number(B.cantidad||B.cantidad_producto||0),ge=Number(B.precio_unitario??B.precio??(B.producto&&(B.producto.precio??B.producto.precio_unitario))??0),re=B.subtotal!=null?Number(B.subtotal):Number(X*ge);return{producto:{nombre:A,descripcion:N,sku:q,precio:ge},descripcion:N,sku:q,cantidad:X,precio:ge,subtotal:re}}),G=M.reduce((B,A)=>B+(Number(A.subtotal||0)||0),0),K={carrito:M,subtotal:G,total:Number(j.total||j.total_cotizacion||0),descuento:Number(j.descuento||0)},ne={cotizacion:j.numero_cotizacion||j.numero||j.id,cliente:j.cliente_nombre||j.cliente||"",identidad:j.rtn||j.identidad||""},Y=await ru(ne,"cotizacion",K);await L(Y)}catch(k){console.error("Error reimprimiendo cotizacin",k)}};y.useEffect(()=>{E()},[c,f,p]);const z=l.length,C=l.reduce((k,M)=>k+(Number(M.total||0)||0),0),O=z>0?C/z:0,I=l.reduce((k,M)=>{const G=(M.estado||"desconocido").toString();return k[G]=(k[G]||0)+1,k},{});return t.jsxs("div",{style:{padding:18},children:[t.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{margin:0},children:"Cotizaciones"}),t.jsx("div",{style:{color:"#64748b",fontSize:13},children:"Vista profesional (solo lectura)  cotizaciones y detalle"})]}),t.jsx("div",{style:{display:"flex",gap:8},children:t.jsx("button",{className:"btn-opaque",onClick:()=>E(),children:"Actualizar"})})]}),t.jsxs("section",{style:{display:"flex",gap:12,marginBottom:12,alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Fecha inicio"}),t.jsx("input",{className:"input",type:"date",value:c,onChange:k=>d(k.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Fecha fin"}),t.jsx("input",{className:"input",type:"date",value:f,onChange:k=>g(k.target.value)})]}),t.jsxs("div",{style:{flex:1},children:[t.jsx("label",{style:{fontSize:12,color:"#475569"},children:"Buscar"}),t.jsx("input",{className:"input",placeholder:"Nmero, cliente o observaciones",value:p,onChange:k=>m(k.target.value)})]})]}),t.jsxs("section",{style:{display:"flex",gap:12,marginBottom:12},children:[t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8,minWidth:160},children:[t.jsx("div",{style:{color:"#475569",fontSize:12},children:"Total cotizaciones"}),t.jsx("div",{style:{fontSize:20,fontWeight:600},children:z})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8,minWidth:160},children:[t.jsx("div",{style:{color:"#475569",fontSize:12},children:"Suma total"}),t.jsxs("div",{style:{fontSize:20,fontWeight:600},children:["L ",C.toFixed(2)]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8,minWidth:160},children:[t.jsx("div",{style:{color:"#475569",fontSize:12},children:"Promedio"}),t.jsxs("div",{style:{fontSize:20,fontWeight:600},children:["L ",O.toFixed(2)]})]}),t.jsxs("div",{style:{background:"white",padding:12,borderRadius:8,minWidth:220},children:[t.jsx("div",{style:{color:"#475569",fontSize:12},children:"Por estado"}),t.jsx("div",{style:{marginTop:6},children:Object.keys(I).length===0?t.jsx("div",{style:{color:"#94a3b8"},children:""}):t.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:Object.entries(I).map(([k,M])=>t.jsxs("div",{style:{background:"#f1f5f9",padding:"6px 8px",borderRadius:6,fontSize:13},children:[t.jsxs("strong",{style:{marginRight:6},children:[k,":"]})," ",M]},k))})})]})]}),t.jsx("div",{style:{background:"white",padding:12,borderRadius:8},children:r?t.jsx("div",{style:{color:"#64748b"},children:"Cargando..."}):t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[t.jsx("th",{style:{padding:10},children:"Nmero"}),t.jsx("th",{style:{padding:10},children:"Fecha cotizacin"}),t.jsx("th",{style:{padding:10},children:"Cliente"}),t.jsx("th",{style:{padding:10,textAlign:"right"},children:"Total"}),t.jsx("th",{style:{padding:10},children:"Estado"}),t.jsx("th",{style:{padding:10},children:"Acciones"})]})}),t.jsx("tbody",{children:l.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:6,style:{padding:20,textAlign:"center",color:"#94a3b8"},children:"No hay cotizaciones"})}):l.map(k=>t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsx("td",{style:{padding:10},children:k.numero_cotizacion||k.numero||k.id}),t.jsx("td",{style:{padding:10},children:k.fecha_cotizacion?new Date(k.fecha_cotizacion).toLocaleString():k.fecha?new Date(k.fecha).toLocaleString():""}),t.jsx("td",{style:{padding:10},children:k.cliente_nombre||k.cliente||""}),t.jsxs("td",{style:{padding:10,textAlign:"right"},children:["L ",Number(k.total||0).toFixed(2)]}),t.jsx("td",{style:{padding:10},children:k.estado||""}),t.jsx("td",{style:{padding:10},children:t.jsx("button",{className:"btn-opaque",onClick:()=>T(k),children:"Ver detalle"})})]},k.id))})]})})}),t.jsx(Mn,{open:b,onClose:()=>{S(!1),v([]),x(null)},width:760,children:t.jsxs("div",{style:{padding:14},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("h3",{style:{marginTop:0},children:"Detalle cotizacin"}),t.jsx("div",{children:t.jsx("button",{className:"btn-opaque",onClick:R,children:"Reimprimir cotizacin"})})]}),j?t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",gap:12,marginBottom:8},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"#:"})," ",j.numero_cotizacion||j.numero||j.id]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Fecha:"})," ",j.fecha_cotizacion?new Date(j.fecha_cotizacion).toLocaleString():j.fecha?new Date(j.fecha).toLocaleString():""]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Cliente:"})," ",j.cliente_nombre||j.cliente||""]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Total:"})," L ",Number(j.total||0).toFixed(2)]})]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[t.jsx("th",{style:{padding:8},children:"Producto"}),t.jsx("th",{style:{padding:8},children:"Cantidad"}),t.jsx("th",{style:{padding:8},children:"Precio"}),t.jsx("th",{style:{padding:8,textAlign:"right"},children:"Subtotal"})]})}),t.jsx("tbody",{children:w.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:4,style:{padding:12,color:"#94a3b8"},children:"No hay tems"})}):w.map(k=>{const M=k.producto_nombre||k.producto&&(k.producto.nombre||k.producto)||k.nombre||"",G=k.descripcion||k.producto_descripcion||k.producto&&(k.producto.descripcion||"")||"",K=k.sku||k.producto&&k.producto.sku||"",ne=Number(k.cantidad||k.cantidad_producto||0),Y=Number(k.precio_unitario??k.precio??(k.producto&&(k.producto.precio??k.producto.precio_unitario))??0),B=k.subtotal!=null?Number(k.subtotal):Number(ne*Y);return t.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[t.jsxs("td",{style:{padding:8},children:[t.jsx("div",{style:{fontWeight:600},children:M}),G||K?t.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[G,G&&K?"  ":"",K]}):null]}),t.jsx("td",{style:{padding:8},children:ne}),t.jsxs("td",{style:{padding:8},children:["L ",Y.toFixed(2)]}),t.jsxs("td",{style:{padding:8,textAlign:"right"},children:["L ",B.toFixed(2)]})]},k.id)})})]})})]}):t.jsx("div",{style:{color:"#64748b"},children:"Cargando detalle..."})]})})]})}const d1={dashboard:ej,datos:aj,usuarios_internal:oj,usuarios_web:ij,cai:lj,facturas:cj,inventario_productos:yj,registro_producto:l1,precios_productos:vj,precios_historico:jj,stock:Sj,inventario_salidas:_j,proveedores:$j,clientes:Hj,caja_sesiones:Cj,caja_movimientos:Ej,rep_ventas:Tj,rep_devoluciones:Nj,rep_ingresos_egresos:Aj,rep_compras:zj,rep_inventario:kj,compras_main:Vj,devoluciones_proveedores:Wj,rep_export:Rj,cuentas_contables:Oj,libro_diario:Dj,libro_mayor:Bj,balance_general:Uj,estado_resultados:Lj,auditoria:Ij,impuestos:s1,notas_credito:uj,anulacion_factura:wj,cotizaciones:c1};function u1({onLogout:l}){const i=y.useMemo(()=>wm(),[]),[r,s]=y.useState("dashboard"),[c,d]=y.useState(null),[f,g]=y.useState({}),p=c||r,m=d1[p],S=(x=>{for(const w of i){if(w.id===x)return w.label;if(w.children){const v=w.children.find(E=>E.id===x);if(v)return v.label}}return"Panel de Administracin"})(p),j=x=>{if(x.id==="salir")return l();x.children&&x.children.length>0?(g(w=>{const v=!!w[x.id];return{[x.id]:!v}}),f[x.id]?(s(x.id),d(null)):(s(x.id),d(x.children[0].id))):(s(x.id),d(null),g({}))};return t.jsxs("div",{style:{display:"flex",minHeight:"100vh",background:"#f8fafc"},children:[t.jsxs("aside",{style:{width:300,minWidth:220,maxWidth:380,background:"#0f1724",color:"white",padding:20,boxShadow:"2px 0 6px rgba(2,6,23,0.08)",transition:"width 180ms ease"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18},children:[t.jsx("strong",{children:"Panel Admin"}),t.jsx("button",{onClick:l,className:"btn-opaque",style:{background:"#ef4444",padding:"6px 8px"},children:"Salir"})]}),t.jsx("nav",{children:i.map(x=>t.jsxs("div",{style:{marginBottom:6},children:[t.jsxs("div",{onClick:()=>j(x),style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 8px",borderRadius:6,cursor:"pointer",background:r===x.id&&!c?"rgba(255,255,255,0.06)":"transparent"},children:[t.jsx("span",{children:x.label}),Array.isArray(x.children)&&x.children.length>0?t.jsx("span",{style:{marginLeft:8},children:f[x.id]?"":""}):null]}),Array.isArray(x.children)&&x.children.length>0&&f[x.id]&&t.jsx("div",{style:{marginLeft:12,marginTop:6},children:x.children.map(w=>t.jsx("div",{onClick:()=>{s(x.id),d(w.id)},style:{padding:"6px 8px",borderRadius:6,cursor:"pointer",marginBottom:4,fontSize:13,color:c===w.id?"#e2e8f0":"#cbd5e1",background:c===w.id?"rgba(255,255,255,0.04)":"transparent"},children:w.label},w.id))})]},x.id))})]}),t.jsx("main",{style:{flex:1,padding:24},children:m?t.jsx(m,{}):t.jsx(Zv,{title:S,children:r===p?"Seleccione una opcin del submen para ver la seccin correspondiente.":"Contenido no implementado o en construccin."})})]})}function f1(){const[l,i]=y.useState(null);y.useEffect(()=>{try{const c=localStorage.getItem("user");c&&i(JSON.parse(c))}catch{i(null)}},[]),y.useEffect(()=>{let c=!0;return(async()=>{try{const d=await wa();if(!c||!d)return;const f=d.nombre||d.comercio||d.name||"";f&&(document.title=String(f));const g=d.logoUrl||d.logo||null;if(g)try{let p=document.querySelector("link[rel~='icon']");p||(p=document.createElement("link"),p.rel="icon",document.getElementsByTagName("head")[0].appendChild(p)),p.href=String(g)}catch{}}catch{}})(),()=>{c=!1}},[]);function r(){try{const c=localStorage.getItem("user");c&&i(JSON.parse(c))}catch{i(null)}}function s(){localStorage.clear(),i(null)}return t.jsxs("div",{children:[t.jsx(cv,{}),t.jsx(fv,{}),!l&&t.jsx(hv,{onLogin:r}),l&&l.role==="cajero"&&t.jsx(Gv,{onLogout:s}),l&&l.role==="admin"&&t.jsx(u1,{onLogout:s}),l&&l.role!=="cajero"&&l.role!=="admin"&&t.jsxs("div",{style:{padding:24,maxWidth:900,margin:"32px auto",textAlign:"center"},children:[t.jsx("h2",{style:{marginTop:0},children:"Acceso restringido"}),t.jsxs("p",{style:{color:"#475569"},children:['Su cuenta tiene rol "',l.role||"sin rol",'". Solo usuarios con rol ',t.jsx("strong",{children:"cajero"})," pueden acceder al Punto de Ventas."]}),t.jsx("div",{style:{marginTop:18},children:t.jsx("button",{onClick:s,className:"btn-opaque",children:"Cerrar sesin"})})]})]})}class h1 extends Dr.Component{constructor(i){super(i),this.state={error:null,info:null}}static getDerivedStateFromError(i){return{error:i,info:null}}componentDidCatch(i,r){console.error("ErrorBoundary caught:",i,r),this.setState({error:i,info:r})}render(){return this.state.error?t.jsxs("div",{style:{padding:18},children:[t.jsx("h2",{style:{color:"#b91c1c"},children:"Error en la aplicacin"}),t.jsxs("div",{style:{background:"#fff",padding:12,borderRadius:6,border:"1px solid #fee2e2"},children:[t.jsxs("pre",{style:{whiteSpace:"pre-wrap",fontSize:12},children:[String(this.state.error),this.state.info?.componentStack]}),t.jsx("div",{style:{marginTop:12},children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:"Recargar"})})]})]}):this.props.children}}qb.createRoot(document.getElementById("root")).render(t.jsx(h1,{children:t.jsx(f1,{})}));
